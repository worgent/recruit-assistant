function loadCss(t){var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}function seriesLoadScripts(t,e){if("object"!=typeof t)var t=[t];var i=document.getElementsByTagName("head").item(0)||document.documentElement,s=new Array,a=t.length-1,n=function(r){s[r]=document.createElement("script"),s[r].setAttribute("type","text/javascript"),s[r].onload=s[r].onreadystatechange=function(){this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),r!=a?n(r+1):"function"==typeof e&&e()},s[r].setAttribute("src",t[r]),i.appendChild(s[r])};n(0)}function getQueryString(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(i);return e&&(s=e.split("?")[1].match(i)),null!=s?unescape(s[2]):null}function Utemplate(t,e){function i(t,e){return n+=e?t.match(a)?t+"\n":"arr.push("+t+");\n":""!=t?"arr.push('"+t.replace(/"/g,'\\"')+"');\n":"",arguments.callee}for(var s=/<%([^%>]+)?%>/g,a=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,n="var arr = []; \n",r=0;match=s.exec(t);)i(t.slice(r,match.index))(match[1],!0),r=match.index+match[0].length;return i(t.substr(r,t.length-r)),n+="return arr.join('')",new Function(n.replace(/[\r\t\n]/g,"")).apply(e)}function EventManger(){var t={};this.subscribe=function(e,i){void 0===t[e]&&(t[e]=[]),t[e].push({context:this,callback:i})},this.publish=function(e){if(void 0===t[e])return!1;for(var i=Array.prototype.slice.call(arguments,1),s=0,a=t[e].length;s<a;s++){var n=t[e][s];n.callback.apply(n.context,i)}}}function getQueryString(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),s=window.location.search.substr(1).match(i);return e&&(s=e.split("?")[1].match(i)),null!=s?unescape(s[2]):null}function getQueryParams(t){var e={};if(t.split("?").length>1)for(var i=t.split("?")[1],s=i.split("&"),a=0;a<s.length;a++){var n=s[a].split("=");n.length>1&&(e[n[0]]=n[1])}return e}function isVisiable(t){if(t){var e=t.getBoundingClientRect();return e.top>0&&window.innerHeight-e.top>0||e.top<=0&&e.bottom>=0}}function CopyToClipboard(t){var e=!0;if(window.clipboardData)window.clipboardData.setData("Text",t);else{var i=CreateElementForExecCommand(t);SelectContent(i);try{window.netscape&&netscape.security&&netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),e=document.execCommand("copy",!1,null)}catch(t){e=!1}document.body.removeChild(i)}e?alert("复制成功"):alert("复制失败，请手动复制该链接")}function filterXss(t){return t&&!/^\<img.*\>$/.test(t)?t.replace(/\</g,"&lt;").replace(/\>/g,">").replace("<phone>","").replace("</phone>","").replace("<copy>","").replace("</copy>",""):t}function localStorageInstance(t,e){if(window.localStorage)if(""==e)window.localStorage.removeItem(t);else{if(!e)return window.localStorage[t];window.localStorage[t]=e}}function getUuid(t,e){var i,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];if(e=e||s.length,t)for(i=0;i<t;i++)a[i]=s[0|Math.random()*e];else{var n;for(a[8]=a[13]=a[18]=a[23]="-",a[14]="4",i=0;i<36;i++)a[i]||(n=0|16*Math.random(),a[i]=s[19==i?3&n|8:n])}return a.join("")}function Prompt(t,e){var i=$('<div class="kz_tishi" style="position:absolute;z-index:9999;"/>').html(t);0==$(".kz_tishi").length&&(i.appendTo("body").delay(1500).fadeOut(500,function(){$(this).remove()}),i.css({left:1==e?($(window).width()-i.outerWidth())/2:0,top:1==e?($(window).height()-i.outerHeight())/2:0,width:1==e?"auto":"100%",position:"fixed"}))}function Utemplate(t,e){function i(t,e){return n+=e?t.match(a)?t+"\n":"arr.push("+t+");\n":""!=t?"arr.push('"+t.replace(/"/g,'\\"')+"');\n":"",arguments.callee}for(var s=/<%([^%>]+)?%>/g,a=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,n="var arr = []; \n",r=0;match=s.exec(t);)i(t.slice(r,match.index))(match[1],!0),r=match.index+match[0].length;return i(t.substr(r,t.length-r)),n+="return arr.join('')",new Function(n.replace(/[\r\t\n]/g,"")).apply(e)}function __conversion(t){try{_T.sendEvent(t)}catch(t){}}function __conversion(t){try{_T.sendEvent(t)}catch(t){}}function ProtobufMessage(){this.init()}var loadScript=function(t){var e,i;if(t&&""!=t)for(e=t.split(","),i=0;i<e.length;i++)$.getScript(e[i])},DEBUG=!0;if(void 0===staticPath)var staticPath="/v2/web/boss/";else staticPath+="/web/boss/";window.INTERFACE_URLS={homeUrl:"/",receiveUrl:"/chatsync.json",sendmsgUrl:"/chat/sendmsg.json",requestResumeUrl:"/chat/requestResume.json",acceptResumeUrl:"/chat/acceptResume.json",rejectResumeUrl:"/chat/rejectResume.json",niurenInfoUrl:"/chat/geek/info",getUserInfoUrl:"/chat/geek.json",lookYouListUrl:"/chat/view.json",likeYouListUrl:"/chat/recommend.json",bossInfoUrl:"/chat/job/info",addRelationUrl:"/chat/addRelation.json",historyMsgUrl:"/chat/historymsg.json",userlistUrl:"/chat/userList.json",jobInfoUrl:"/bossweb/jobinfo",readMessageUrl:"/chat/readmsg.json",chatProtoUrl:"/v2/web/boss/js/module/chat.proto",requestPhoneUrl:"/chat/requestContact.json",acceptPhoneUrl:"/chat/acceptContact.json",rejectPhoneUrl:"/chat/rejectContact.json",saveEmailUrl:"/user/updateEmail.json",expressionDataUrl:"/v2/chat_v2/js/pages/expression_data.txt",getIsFirstTalkUrl:"/chat/firstTalk.json",validationEmail:"/user/getEmail.json",feedbackReadUrl:"/chat/receiveMsgRead.json",feedbackReadSyncUrl:"/chat/receiveMsgReadSync.json",assetUrl:"/v2/chat_v2/",feedbackReceiveUrl:"/chat/receiveMsg.json",weixin:"",saveWeixinUrl:"/user/updateWeixin.json",validationWeixin:"/chat/validWeixin.json",requestWeixinUrl:"/chat/requestWeixin.json",acceptWeixinUrl:"/chat/acceptWeixin.json",rejectWeixinUrl:"/chat/rejectWeixin.json",jobValidationUrl:"/chat/jobValidation.json",colleaguesListUrl:"/chat/brandUserList.json",colleaguesSubmitUrl:"/chat/shareGeek.json",getJobListUrl:"/chat/user/joblist.json",setTopUrl:"/chat/friendIsTop.json",setBelongGroupL2Url:"/chat/friend/addGroup.json",sendInterviewUrl:"/bossweb/interview/invite.json",candidateMsgUrl:"/candidate/status.json",chatFilterUsersUrl:"/chat/userfilterlist.json",chatRankUsersUrl:"/chat/userlistrank.json",chatAddUsersUrl:"/chat/userfriend.json",candidateJs:staticPath+"js/candidate.js"},function(){var t=t||{};t={form:{Prompt:function(t,e){var i=$('<div class="kz_tishi" style="position:absolute;z-index:9999;"/>').html(t);0==$(".kz_tishi").length&&(i.appendTo("body").delay(1500).fadeOut(500,function(){$(this).remove()}),i.css({left:1==e?($(window).width()-i.outerWidth())/2:0,top:1==e?($(window).height()-i.outerHeight())/2:0,width:1==e?"auto":"100%",position:"fixed"}))}},pageLock:{show:function(e,i,s,a,n){if(0==$(window.parent.document).find(i.selector).length)var r=($(window.parent.document).width()-$(i).outerWidth())/2,o=($(window).height()-$(i).outerHeight())/2;else var r=($(window.parent.document).width()-$(window.parent.document).find(i.selector).outerWidth())/2,o=($(window).height()-$(window.parent.document).find(i.selector).outerHeight())/2;if(!$(window.parent.document).find("#lockpage").length>0){$("<div id='lockpage'/>").css({position:"absolute",zIndex:e||20,left:0,top:0,width:"100%",height:"100%",background:"#000",opacity:.8}).appendTo($(window.parent.document.body))}0==$(window.parent.document).find(i.selector).length?($(i).appendTo($(window.parent.document.body)),$(window.parent.document).find(i).css({position:"fixed",zIndex:e+1,left:r,top:o,display:"block"})):$(window.parent.document).find(i.selector).css({position:"fixed",zIndex:e+1,left:r,top:o,display:"block"}),t.pageLock.hide(s,i,n),"function"==typeof a&&a()},hide:function(t,e,i){$(window.parent.document).find(t).click(function(t){void 0===i&&$(window.parent.document).find(e).appendTo("body"),$(e).hide(),$(window.parent.document).find("#lockpage").remove(),t.preventDefault()})},runHide:function(t){$(window.parent.document).find(t.selector).length>0?setTimeout(function(){$(window.parent.document).find(t).remove()},100):$(window.parent.document).find(t).hide(),$(window.parent.document).find("#lockpage").remove()},runRemove:function(t){$(window.parent.document).find(t).appendTo("body"),$(t).hide(),$(window.parent.document).find("#lockpage").remove()}}};var e=($("img.uploading"),$("#add_photo")),i=$("div.add_photo"),s=$("#cropWrap"),a=null;window.cropInit=function(){function e(t){$("#cropWrap").find("#x").val(parseInt(t.x,10)),$("#cropWrap").find("#y").val(parseInt(t.y,10)),$("#cropWrap").find("#w").val(parseInt(t.w,10)),$("#cropWrap").find("#h").val(parseInt(t.h,10))}instanceCrop=$("#cropbox").Jcrop({aspectRatio:2,onSelect:e,bgFade:!0,allowMove:!0,bgOpacity:.2,minSize:[2,1],maxSize:[500,500],setSelect:[0,0,200,100]}),$("#cropWrap a.cancle").on("click",function(){i.removeClass("change_bg"),$("div.jcrop-holder").remove(),s.find("#cropbox").remove(),t.pageLock.runHide("#cropWrap"),"function"==typeof a&&a()})},window.runCrop=function(i,s,n){$(".crop_container").find(".jcrop-holder").remove(),$(".crop_container").find("#cropbox").remove(),$(".crop_container").append('<img src="'+i+'" id="cropbox" alt="">'),$("#cropWrap #saveCrop").unbind("click").bind("click",s),$("#deletePop").on("click","a.confirm",function(){var t=$(this);$.ajax({url:t.data("url"),type:t.data("method"),data:{id:orderArr[deleteIndex]},dataType:"json",success:function(t){t=t||{},1==t.rescode&&($("div.photo").eq(deleteIndex).remove(),photoFun(),$photoWrap.find("div.photo").length<5&&e.is(":hidden")&&(e.show(),initWebUpload(),$("div.add_photo").show()),orderArr.splice(deleteIndex,1),$order.val(orderArr.join(",")),hasBtn(),$(window.parent.document).find("#deletePop").hide(),$(window.parent.document).find("#lockpage").remove())}})}),a=n,t.pageLock.show(100,"#cropWrap","#cropWrap .cancle",window.cropInit)}}();var UA=window.navigator.userAgent,isIE,isZpdesk,isWebkit;(UA.indexOf("Edge/")>-1||UA.indexOf("MSIE ")>-1||UA.indexOf("Trident/")>-1)&&(isIE=!0),UA.indexOf("WebKit")>-1&&(isWebkit=!0),UA.indexOf("ZhipinDesktop/")>-1&&(isZpdesk=!0);var supportsCalcVh=!!window.CSS&&CSS.supports("height","calc(100vh - 0px)"),VersionStatus={isHunter:!("undefined"==typeof _PAGE||!_PAGE.isHunter),preKa:"undefined"!=typeof _PAGE&&_PAGE.isHunter?"hunter":""};isZpdesk&&seriesLoadScripts("/v2/web/boss/js/zpdesk.js");var PAGE_ACTIVITY=!0;!function(){function t(t){var i={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};t=t||window.event,PAGE_ACTIVITY=t.type in i?i[t.type]:!this[e]}var e="hidden";e in document?document.addEventListener("visibilitychange",t):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",t):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",t):(e="msHidden")in document?document.addEventListener("msvisibilitychange",t):"onfocusin"in document?document.onfocusin=document.onfocusout=t:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=t,window.addEventListener("message",function(t){var e=t.data;"wordhrRouter"==e.type&&Menu.updateWordhrTopNav(e),"handleClickDoc"==e.type&&$(document).click()},!1)}();var isEmpty=function(t){return Array.isArray(t)&&0===t.length||Object.prototype.isPrototypeOf(t)&&0===Object.keys(t).length};Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var i in e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t},Array.prototype.unique=function(t){if(this.length<2)return[this[0]]||[];for(var e={},i=[],s=0;s<this.length;s++){var a=this[s],n=!!t&&typeof e[a]!=typeof a;(void 0===e[a]||n)&&(e[a]=a,i.push(a))}return i},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]==t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)},Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(void 0===this||null===this)throw new TypeError;var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError;for(var s=[],a=arguments.length>=2?arguments[1]:void 0,n=0;n<i;n++)if(n in e){var r=e[n];t.call(a,r,n,e)&&s.push(r)}return s}),Array.prototype.map||(Array.prototype.map=function(t,e){var i,s,a;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),r=n.length>>>0;if("[object Function]"!=Object.prototype.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(i=e),s=new Array(r),a=0;a<r;){var o,c;a in n&&(o=n[a],c=t.call(i,o,a,n),s[a]=c),a++}return s}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var i;if(null==this)throw new TypeError('"this" is null or not defined');var s=Object(this),a=s.length>>>0;if(0===a)return-1;var n=0|e;if(n>=a)return-1;for(i=Math.max(n>=0?n:a-Math.abs(n),0);i<a;){if(i in s&&s[i]===t)return i;i++}return-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var s=arguments[1],a=0;a<i;){var n=e[a];if(t.call(s,n,a,e))return n;a++}}}),"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(t,e){"use strict";if(null===this||void 0===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var i,s,a=this.length>>>0,n=!1;for(1<arguments.length&&(s=e,n=!0),i=0;a>i;++i)this.hasOwnProperty(i)&&(n?s=t(s,this[i],i,this):(s=this[i],n=!0));if(!n)throw new TypeError("Reduce of empty array with no initial value");return s});var cookie={get:function(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?unescape(e[2]):null},set:function(t,e,i){if(i){var s=new Date;s.setMinutes(i),document.cookie=t+"="+encodeURIComponent(e)+";expires="+s.toGMTString()}else document.cookie=t+"="+encodeURIComponent(e)},clearcookie:function(t,e,i){cookie.get(t)&&(document.cookie=t+"="+(e?";path="+e:"")+(i?";domain="+i:"")+";expires=Thu,01-Jan-1970 00:00:01 GMT")}},__stringify=function(){function t(t){return/["\\\x00-\x1f]/.test(t)&&(t=t.replace(/["\\\x00-\x1f]/g,function(t){var e=a[t];return e||(e=t.charCodeAt(),"\\u00"+Math.floor(e/16).toString(16)+(e%16).toString(16))})),'"'+t+'"'}function e(t){var e,i,s,a=["["],n=t.length;for(i=0;i<n;i++)switch(typeof(s=t[i])){case"undefined":case"function":case"unknown":break;default:e&&a.push(","),a.push(__stringify(s)),e=1}return a.push("]"),a.join("")}function i(t){return t<10?"0"+t:t}function s(t){return'"'+t.getFullYear()+"-"+i(t.getMonth()+1)+"-"+i(t.getDate())+"T"+i(t.getHours())+":"+i(t.getMinutes())+":"+i(t.getSeconds())+'"'}var a={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(i){switch(typeof i){case"undefined":return"undefined";case"number":return isFinite(i)?String(i):"null";case"string":return t(i);case"boolean":return String(i);default:if(null===i)return"null";if(i instanceof Array)return e(i);if(i instanceof Date)return s(i);var a,n,r=["{"],o=__stringify;for(var c in i)if(Object.prototype.hasOwnProperty.call(i,c))switch(typeof(n=i[c])){case"undefined":case"unknown":case"function":break;default:a&&r.push(","),a=1,r.push(o(c)+":"+o(n))}return r.push("}"),r.join("")}}}(),__throttle=function(t,e,i){var s=null;return function(){(new Date).getTime();clearTimeout(s),s=setTimeout(t,e)}},Menu={init:function(){Menu.sideEl=$(".side-menu"),Menu.chatEl=Menu.sideEl.find(".menu-chat"),Menu.recommendEl=Menu.sideEl.find(".menu-recommend"),Menu.items=Menu.sideEl.find("dl"),Menu.continerEls=$(".page-container"),Menu.chatEl=$(".chat-container"),Menu.toSyncEl=$(".sync-container"),Menu.toViewedEl=$(".viewed-container"),Menu.toRsyncEl=$(".rsync-container"),Menu.toSetEl=$(".set-container"),Menu.topContainer=$("#header"),Menu.positionRecommendId=null,Menu.positionCommunicaionId=null,Menu.isSuportCalc=supportsCalcVh;var t="wordhr.zhipin.com",e={dev:"wordhr-pc.weizhipin.com",pre:"wordhr-preon-hr.weizhipin.com",online:"wordhr.zhipin.com"};if(this.jumpExternalPart(),$(".link-help").on("click",function(){Menu.showHelpTip()}),$(".link-promotion").on("click",function(){Menu.showPopFrame($(this))}),$(".link-vipaccount").on("click",function(){$(this).closest(".dropdown-wrap").find(".vip-frame").html('<iframe src="'+$(this).attr("data-url")+'" />')}),$(".vip-detail").on("click",function(){Menu.items.removeClass("cur"),Menu.gotoFramePage("/boss/item/vipprivilege.html","/boss/item/vipprivilege.html",$(this).attr("data-op"))}),$(document).on("click",".top-user .interview-detail",function(){menuInterview.view()}),Menu.sideEl.find(".menu-resume").length){var i=Menu.sideEl.find(".menu-resume a"),s=$(".top-resume a");window.top.location.host.indexOf(".weizhipin.com")>-1&&(i.attr("data-url",i.attr("data-url").replace(t,e.dev)),s.each(function(){$(this).attr("data-url",$(this).attr("data-url").replace(t,e.dev))})),"pre-www.zhipin.com"===window.top.location.host&&(i.attr("data-url",i.attr("data-url").replace(t,e.pre)),s.each(function(){$(this).attr("data-url",$(this).attr("data-url").replace(t,e.pre))}))}$(".top-slogan").on("click",function(){var t=Menu.sideEl.find(".menu-prop"),e=t.find("a").attr("data-url");Menu.sideEl.find(".menu-prop").hasClass("cur")||(e.indexOf("tab=mall")<0&&t.find("a").attr("data-url",e+"?tab=mall"),Menu.sideEl.find(".menu-prop a").click(),t.find("a").attr("data-url",e),__conversion("promotion_threeYears_slogan"))});var a,n=$(".top-user .dropdown-logout");n.on("mouseover",function(){a&&clearTimeout(a),n.addClass("dropdown-menu-open")}).on("mouseout",function(){a=setTimeout(function(){n.removeClass("dropdown-menu-open"),n.find(".recruit-tip").hide()},300)}),n.find("li").on("click",function(){var t=$(this).find("a");t.hasClass("link-profile")&&Menu.sideEl.find(".menu-user a").click(),t.hasClass("link-account")&&Menu.sideEl.find(".menu-account a").click(),t.hasClass("link-profile")&&Menu.sideEl.find(".menu-user a").click(),t.hasClass("link-account")&&Menu.sideEl.find(".menu-account a").click()}),n.find(".link-apply").on("click",function(t){n.find(".recruit-tip").fadeIn();try{_T.sendEvent("menu_dropdown_apply")}catch(t){}return!1}),$("#guide-wrap").on("click",function(){$(this).find(".guide-box").each(function(t){if(1==t&&$(this).is(":visible"))try{_T.sendEvent("newpx_autoclose")}catch(t){}}),$("#guide-wrap").hide()}),$(".link-pop-wordhr").on("click",function(){Menu.showPopWordhr($(this))}),Menu.sideEl.on("click","a",function(){if(!$(this).hasClass("link-pop-wordhr")){var t=Menu.sideEl.find("dl.cur");if(Menu.items.removeClass("cur"),$(this).closest("dl").addClass("cur"),Menu.topContainer.find(".top-op").hide(),t.hasClass("menu-recommend")&&!$(this).closest("dl").hasClass("menu-recommend")&&localStorageInstance("recommend-pos",$("#container").scrollTop()),$(this).closest("dl").hasClass("menu-chat")){Menu.continerEls.hide(),Menu.chatEl.show(),t.hasClass("menu-chat")?$(document).trigger("MENU_ROUTE_CHAT",{action:"flush"}):$(document).trigger("MENU_ROUTE_CHAT",{}),Menu.topContainer.find(".top-chat").show(),"undefined"!=typeof Recommend&&(Recommend.visiable=!1),$("#page_key_name").val(VersionStatus.preKa+"bpc_chat");try{_T.sendPageView()}catch(t){}Menu.setUrl("chat")}else Menu.chatEl.hide(),Menu.topContainer.find(".top-chat").hide(),$(document).trigger("MENU_ROUTE_CHAT",{});if($(this).closest("dl").hasClass("menu-recommend")){"undefined"==typeof Recommend&&(window.Recommend={}),Recommend.visiable=!0,t.hasClass("menu-recommend")?$(document).trigger("MENU_ROUTE_RECOMMEND",{action:"flush"}):$(document).trigger("MENU_ROUTE_RECOMMEND",{}),0==Menu.toSyncEl.find("#recommend-list .sec-content").length&&$.get($(this).attr("data-url"),function(t){1==t.rescode&&""!=t.html&&(Menu.toSyncEl.html(t.html),seriesLoadScripts(INTERFACE_URLS.candidateJs))}),Menu.continerEls.hide(),Menu.toSyncEl.show(),Menu.topContainer.find(".top-recommend").show(),Menu.topContainer.find(".top-recommend li").length||Menu.topContainer.find(".top-recommend .dropdown-wrap").hide(),5==Menu.toSyncEl.find(".sec-operate .op-category a.cur").data("status")&&Menu.topContainer.find(".top-recommend .dropdown-wrap").hide(),localStorageInstance("recommend-pos")&&$("#container").scrollTop(localStorageInstance("recommend-pos")),$("#page_key_name").val(VersionStatus.preKa+"bpc_geek_rcmd");try{_T.sendPageView()}catch(t){}if("recommend"==getQueryString("mu")&&getQueryString("jobid"))return;Menu.setUrl("recommend")}$(this).closest("dl").hasClass("menu-position")||$(this).closest("dl").hasClass("menu-user")||$(this).closest("dl").hasClass("menu-account")||$(this).closest("dl").hasClass("menu-prop")||$(this).closest("dl").hasClass("menu-geeksearch")||$(this).closest("dl").hasClass("menu-company-prop")||$(this).closest("dl").hasClass("menu-colleague")||$(this).parent().hasClass("figure")||$(this).closest("dl").hasClass("menu-resume")?($("body").addClass("page-iframe"),Menu.toRsyncEl.html('<iframe class="frame-container" name="frameContainer" src="'+$(this).attr("data-url")+'"></iframe>'),Menu.continerEls.hide(),Menu.toRsyncEl.show(),Menu.setUrl($(this).attr("data-url")),"undefined"!=typeof Recommend&&(Recommend.visiable=!1),Menu.isSuportCalc||Menu.toRsyncEl.find(".frame-container").css("height",$(window).height()-68+"px")):$("body").removeClass("page-iframe"),$(this).closest("dl").hasClass("menu-position")&&(Menu.topContainer.find(".top-position").show(),$("#page_key_name").val(VersionStatus.preKa+"bpc_job_list")),$(this).closest("dl").hasClass("menu-geeksearch")&&(Menu.topContainer.find(".top-geeksearch").show(),$("#page_key_name").val(VersionStatus.preKa+"bpc_geek_search")),$(this).closest("dl").hasClass("menu-prop")&&(Menu.topContainer.find(".top-prop").show(),Menu.topContainer.find(".top-prop a").removeClass("cur"),Menu.topContainer.find(".top-prop a").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_item_mine")),$(this).closest("dl").hasClass("menu-user")&&(Menu.topContainer.find(".top-company").show(),Menu.topContainer.find(".top-company a").removeClass("cur"),Menu.topContainer.find(".top-company a").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_boss_info_v1")),$(this).closest("dl").hasClass("menu-account")&&(Menu.topContainer.find(".top-account").show(),Menu.topContainer.find(".top-account a").removeClass("cur"),Menu.topContainer.find(".top-account a").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_boss_info_account")),$(this).closest("dl").hasClass("menu-company-prop")&&$("#page_key_name").val(VersionStatus.preKa+"bpc_meritem_item"),$(this).closest("dl").hasClass("menu-colleague")&&(Menu.topContainer.find(".top-colleague").show(),Menu.topContainer.find(".top-colleague a").removeClass("cur").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_colleagues")),$(this).closest("dl").hasClass("menu-resume")&&(Menu.topContainer.find(".top-resume").show(),Menu.topContainer.find(".top-resume a").removeClass("cur").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_wordhr_resume")),$(this).parent().hasClass("figure")&&(Menu.topContainer.find(".top-company").show(),Menu.topContainer.find(".top-company a").removeClass("cur"),Menu.topContainer.find(".top-company a").eq(0).addClass("cur"),$("#page_key_name").val(VersionStatus.preKa+"bpc_boss_info_v1"))}}),Menu.topContainer.find(".top-menu a").on("click",function(){var t=$(this);t.parent().find("a").removeClass("cur"),t.addClass("cur"),t.attr("data-url")&&($("body").addClass("page-iframe"),t.attr("data-message")?window.frames.frameContainer.postMessage({type:"routerLink",url:t.attr("data-message")},"*"):Menu.toRsyncEl.html('<iframe class="frame-container" src="'+$(this).attr("data-url")+'" name="frameContainer"></iframe>'),Menu.continerEls.hide(),Menu.toRsyncEl.show(),Menu.setUrl($(this).attr("data-url")),Menu.isSuportCalc||Menu.toRsyncEl.find(".frame-container").css("height",$(window).height()-68+"px"))}),Menu.gotoPage(),"onpopstate"in window&&(window.onpopstate=function(){Menu.gotoPage()})},showHelpTip:function(){$.dialog({title:"",content:$(".hunter-help").prop("outerHTML"),closeText:!0,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-hunter-welcome",lock:!0,onOpen:function(t){},onConfirm:function(t){t.remove()}})},toggleTopMenu:function(t){$(".top-op").hide(),$("."+t).show()},jumpExternalPart:function(){var t=decodeURIComponent(location.href),e=t.indexOf("mu=/hunter/index");t.match(/\?mu=(.+)/gim),-1!==e&&(Menu.gotoFramePage(RegExp.$1,RegExp.$1,$(this).attr("data-op")),Menu.items.removeClass("cur"),$(".menu-position").addClass("cur"))},gotoFramePage:function(t,e,i){Menu.setUrl(t),$("body").addClass("page-iframe"),Menu.toRsyncEl.html('<iframe class="frame-container" name="frameContainer" src="'+e+'"></iframe>'),Menu.continerEls.hide(),Menu.toRsyncEl.show(),$(".top-inner .top-op").hide(),i&&$(".top-inner").find("."+i).show()},gotoPage:function(){var t=getQueryString("mu"),e=!1;t&&("viewed"==t||t.indexOf("/bossweb/tag/2/")>-1?(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-viewed").addClass("cur"),Menu.sideEl.find(".menu-viewed a").trigger("click")):"recommend"==t||t.indexOf("/bossweb/recommend")>-1?(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-recommend").addClass("cur"),Menu.sideEl.find(".menu-recommend a").trigger("click")):"chat"==t||t.indexOf("/candidate/")>-1?(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-chat").addClass("cur"),Menu.sideEl.find(".menu-chat a").trigger("click")):t&&((t.indexOf("/bossweb/joblist.html")>-1||t.indexOf("/bossweb/jobedit")>-1)&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-position").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-position").show(),e=!0),t.indexOf("/boss/search")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-geeksearch").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-geeksearch").show(),e=!0),t.indexOf("/boss/item/mall")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-prop").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-prop").show(),Menu.topContainer.find(".top-prop .top-menu a").removeClass("cur").eq(0).addClass("cur"),e=!0),t.indexOf("/boss/item/myitemlist")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-prop").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-prop").show(),Menu.topContainer.find(".top-prop .top-menu a").removeClass("cur").eq(1).addClass("cur"),e=!0),t.indexOf("/boss/item/notice")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-prop").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-prop").show(),Menu.topContainer.find(".top-prop .top-menu a").removeClass("cur").eq(2).addClass("cur"),e=!0),t.indexOf("/boss/item/vipprivilege")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-prop").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-vip-detail").show(),e=!0),t.indexOf("/enterprise/")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-colleague").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-colleague").show(),t.indexOf("/enterprise/items")>-1?Menu.topContainer.find(".top-colleague .top-menu a").removeClass("cur").eq(1).addClass("cur"):t.indexOf("/enterprise/hot/job/account/")>-1||t.indexOf("/enterprise/vip/account/")>-1?Menu.topContainer.find(".top-colleague .top-menu a").removeClass("cur").eq(2).addClass("cur"):Menu.topContainer.find(".top-colleague .top-menu a").removeClass("cur").eq(0).addClass("cur"),e=!0),t.indexOf("/user/company")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-user").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-company").show(),Menu.topContainer.find(".top-company .top-menu a").removeClass("cur").eq(1).addClass("cur"),e=!0),t.indexOf("/boss/user/")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-user").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-company").show(),Menu.topContainer.find(".top-company .top-menu a").removeClass("cur").eq(0).addClass("cur"),e=!0),t.indexOf("/boss/account/management")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-account").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-account").show(),Menu.topContainer.find(".top-account .top-menu a").removeClass("cur").eq(0).addClass("cur"),e=!0),t.indexOf("zhipin/")>-1&&(Menu.items.removeClass("cur"),Menu.sideEl.find(".menu-resume").addClass("cur"),Menu.topContainer.find(".top-op").hide(),Menu.topContainer.find(".top-resume").show(),Menu.topContainer.find(".top-resume .top-menu a").removeClass("cur").eq(0).addClass("cur"),e=!0),e&&($("body").addClass("page-iframe"),Menu.toRsyncEl.html('<iframe class="frame-container" name="frameContainer" src="'+t+'"></iframe>'),Menu.continerEls.hide(),Menu.toRsyncEl.show(),Menu.isSuportCalc||Menu.toRsyncEl.find(".frame-container").css("height",$(window).height()-68+"px"))))},setUrl:function(t,e,i){var t=t||"",s=getQueryString("debug"),e=e||getQueryString("jobid"),i=i||getQueryString("status");t&&""!=t&&(t="?mu="+encodeURIComponent(t)),e&&t.indexOf("mu=recommend")>-1&&(t+="&jobid="+e),i&&t.indexOf("mu=recommend")>-1&&(t+="&status="+i),s&&(t+="&debug=1"),"pushState"in history&&(e&&i?window.history.replaceState(null,null,t):window.history.pushState(null,null,t)),Menu.sideEl.trigger("urlchange",t)},showPopFrame:function(t){var t=t,e=t.attr("data-url");$.dialog({title:"",content:'<iframe class="pop-frame" src="'+e+'"></iframe>',closeText:!0,confirmText:"",cancelText:"",preKa:"zd_gift_",wrapClass:"dialog-promotion-iframe",lock:!0,onOpen:function(t){},onConfirm:function(t){t.remove()}})},showPopWordhr:function(t){$.dialog({title:"",content:'<div class="content-wordhr"><a href="https://www.wordhr.com" target="_blank" ka="pop_wordhr_link"><img src="https://z.zhipin.com/web/boss/resource/provision/wordhr-pop-banner.jpg" /></a></div>',closeText:!0,confirmText:"",cancelText:"",preKa:"pop_wordhr",wrapClass:"dialog-promotion-worhr",lock:!0,onOpen:function(t){},onConfirm:function(t){t.remove()}})},updateWordhrTopNav:function(t){var e=t.url;e.indexOf("/zhipin/setting")>-1?Menu.topContainer.find(".top-resume a").removeClass("cur").eq(2).addClass("cur"):e.indexOf("/zhipin/interview")>-1?Menu.topContainer.find(".top-resume a").removeClass("cur").eq(1).addClass("cur"):Menu.topContainer.find(".top-resume a").removeClass("cur").eq(0).addClass("cur")}},Tab={init:function(){var t=$(".mod-tab .data-tab");t.each(function(e){var i=$(this).attr("event");i||(i="click"),t.eq(e).on(i,"a",function(){var t=$(this).index(),e=$(this).closest(".data-tab").children(),i=$(this).closest(".mod-tab").children(".tab-con");e.removeClass("cur"),$(this).addClass("cur"),i.hide(),i.eq(t).show()})})}},PageSet={markerInfo:{},getTipData:function(t){if($(".chat-container").is(":visible")||VersionStatus.isHunter){if(PageSet.markerInfo.rescode)return t(PageSet.markerInfo);$("#guide-wrap");$.get("/setting/notify/marker.json?types=1,5,9,10,11,12,13,15,18",function(e){1==e.rescode&&1==e.showGuide&&e[1]&&(PageSet.hasShowReplyTip=!1),VersionStatus.isHunter&&window.top==window.self&&1==e.rescode&&e[15]&&Menu.showHelpTip(),PageSet.markerInfo=e,"function"==typeof t&&t(PageSet.markerInfo)})}},bindEvent:function(t,e){var i=t||Menu.toSetEl;i.on("click",".radio-list .link-modify",function(){$(this).closest(".radio").find('input[type="radio"]').prop("checked","checked"),$(this).closest("dl").find(".defined-form").addClass("show-defined-form").removeClass("show-defined-tab"),$(this).closest("form").find('input[type="reasonType"]').val(""),
$(this).closest("form").find(".ipt-area").text($(this).closest("form").find(".ipt-area").attr("data-text")),$(this).closest("dl").find(".defined-form .tip-text").text("请不要填写手机、QQ、微信等联系方式或广告信息，否则系统将封禁您的账号！"),$(this).closest("dl").find(".count-num").length&&PageSet.countArea($(this).closest("dl").find(".ipt-area"))}),i.find(".defined-form .ipt-area").on("input",function(){PageSet.countArea($(this))}),i.find('.radio-list input[type="radio"]').on("change",function(){"0"===$(this).val()&&$(this).closest("form").find(".defined-form").removeClass("show-defined-form")}),i.on("click",".defined-form .btns .btn",function(){if($(this).hasClass("btn-back"))$(this).closest("dl").find(".defined-form").removeClass("show-defined-form");else if(""==$(this).closest("dl").find(".defined-form .ipt-area").val().replace(/(\s*$)/g,"")){if(!$(this).closest(".show-defined-tab").length)return $(this).closest("dl").find(".defined-form .tip-text").text("请输入内容"),$(this).closest("dl").find(".defined-form .ipt-area").focus(),!1;PageSet.postData($(this))}else{if($(this).closest("dl").find(".defined-form .count-num .red").length)return $(this).closest("dl").find(".defined-form .tip-text").text("内容不能超过200个字"),$(this).closest("dl").find(".defined-form .ipt-area").focus(),!1;$(this).closest("dl").find(".defined-form .tip-text").text("请不要填写手机、QQ、微信等联系方式或广告信息，否则系统将封禁您的账号！"),PageSet.postData($(this))}})},countArea:function(t){var t=t,e=t.attr("data-range"),i=PageSet.getLength(t.val()),s=t.closest(".defined-form").find(".count-num");s&&s.length&&(e=e.split(","),s.html("<em"+(i>e[1]?' class="red"':"")+">"+i+"</em>/"+e[1]))},postData:function(t,e){var i=t.closest("form"),s=i.attr("action"),a=i.serialize(),n=t.closest(".show-defined-tab").length;return i.find(".ipt-area").length&&""==i.find(".ipt-area").val().replace(/(\s*$)/g,"")&&!n?void i.find(".ipt-area").focus():!t.hasClass("disabled")&&(t.addClass("disabled"),void $.ajax({url:s,type:"POST",data:a,dataType:"JSON",timeout:3e4,success:function(s){if(s.rescode)if(n)"radioChange"!=e&&$.toast({content:"保存成功",type:"success"}),t.closest(".show-defined-tab").find("li.cur").attr("data-text",filterXss(i.find(".ipt-area").val()));else{if(t.closest("dl").find(".defined-form").removeClass("show-defined-form"),"radio"!=t.attr("type")&&(i.find(".ipt-area").attr("data-text",filterXss(i.find(".ipt-area").val())),t.closest("dl").find(".link-modify").closest("label").find("span").html("发送信息“"+filterXss(i.find(".ipt-area").val())+"”")),t.closest("dl").find(".sentence-list").length){var a=t.closest("dl").find("input[name=id]").val();a?t.closest("dl").find('.sentence-list a[data-id="'+a+'"]').closest("li").replaceWith(s.html):(t.closest("dl").find(".sentence-list ul").append(s.html),Menu.toSetEl.find(".set-nav li").eq(1).html("常用语（"+t.closest("dl").find(".sentence-list li").length+"条）"))}t.closest("dl").find(".sayhello-list").length&&(i.find('input[name="templateId"]').val()?t.closest("dl").find('input[value="'+i.find('input[name="templateId"]').val()+'"]').closest("li").find("span").text(filterXss(i.find(".ipt-area").val())):(t.closest("dl").find(".sayhello-list ul").append(s.html),t.closest("dl").find(".op-sentence").hide()))}else $.toast({content:s.resmsg,type:"error"});t.removeClass("disabled")},error:function(e){t.removeClass("disabled"),$.toast({content:"保存失败，请检查网络后重试",type:"error"})}}))},getLength:function(t){var e=0,t=t;len=t.length,charCode=-1;for(var i=0;i<len;i++)charCode=t.charCodeAt(i),charCode>=0&&charCode<=128?e+=.5:e+=1;return Math.round(e)}};$(function(){Menu.init(),Tab.init()}),function(t,e,i){"use strict";var s=(t(e),t(document),!1),a=function(e){if("string"==typeof e)var e={content:e};this.settings=t.extend({},a.defaults,e),this.init()};a.defaults={content:"提示",lock:!1,wrapClass:null,type:null,position:"top",parentWrap:"body",time:2300},a.prototype={init:function(){this.create(),this.settings.lock&&this.lock()},create:function(){var e="",i="",s=this;this.settings.type&&(e='<i class="icon-toast-'+this.settings.type+'"></i>'),i='<div id="toast"><div class="toast-con">'+e+this.settings.content+"</div></div>",t("#toast").length&&t("#toast").remove(),this.toast=t(i).appendTo(this.settings.parentWrap),this.settings.wrapClass&&this.toast.addClass(this.settings.wrapClass),this.settings.position&&this.position(),this.time(),this.toast.on("click",function(){s.close()})},position:function(){"top"==this.settings.position&&this.toast.css("top",0),"center"==this.settings.position&&this.toast.css("bottom",0),"bottom"==this.settings.position&&this.toast.css("bottom",0)},lock:function(){s||(t("html,body").css("overflow","hidden"),s=!0)},unLock:function(){this.settings.lock&&s&&(t("html,body").css("overflow","visible"),s=!1)},close:function(){var t=this;t.toast.addClass("slideup"),setTimeout(function(){t.toast.removeClass("slideup").remove()},500),t.unLock()},time:function(){var t=this;this.settings.time&&"loading"!=this.settings.type&&(this.closeTimer=setTimeout(function(){t.close()},this.settings.time))}},t.toast=function(t){new a(t)}}(jQuery,window),function(t,e,i){"use strict";var s=(t(e),t(document),!-[1]&&e.XMLHttpRequest,!1),a=function(e){this.settings=t.extend({},a.defaults,e),this.init()};a.defaults={bind:!1,wrapClass:"",content:"请稍等...",title:"提示",onCancel:null,onOpen:null,onConfirm:null,onClose:null,closeText:!0,confirmText:"确定",cancelText:"取消",position:"center",inline:!1,isSelecter:!1,element:null,preKa:"",time:null,lock:!0,closeLayer:!0,opacityLock:!1},a.prototype={init:function(){this.create()},create:function(){var e="",i="",s="",a="",n="",r="",o="";this.settings.type&&(e='<i class="icon-dialog icon-dialog-'+this.settings.type+'"></i>'),this.settings.lock&&(s='<div class="dialog-layer"></div>',this.settings.opacityLock&&(s='<div class="dialog-layer dialog-opacity-layer"></div>')),this.settings.preKa&&(a=this.settings.preKa+"_"),("around"==this.settings.position||this.settings.inline)&&(n='<span class="icon-dialog-arrow"></span>'),this.settings.closeText&&(r='<a href="javascript:;" class="close" ka="'+a+'dialog_close"><i class="icon-close"></i></a>'),(this.settings.confirmText||this.settings.cancelText)&&(o='<div class="dialog-footer"><div class="btns"></div></div>'),i='<div class="dialog-wrap">'+s+'<div class="dialog-container">'+n+'<div class="dialog-title">'+e+'<h3 class="title">'+this.settings.title+"</h3>"+r+'</div><div class="dialog-con">'+this.settings.content+"</div>"+o+"</div></div>",t(".dialog-wrap").length&&!this.settings.inline&&t(".dialog-wrap").remove(),this.settings.inline&&this.settings.element?this.dialog=t(i).appendTo(t(this.settings.element).parent()):this.dialog=t(i).appendTo("body"),(this.settings.onConfirm||this.settings.confirmText)&&this.onConfirm(),(this.settings.onCancel&&!1!==this.settings.cancelText||this.settings.cancelText)&&this.onCancel(),this.settings.wrapClass&&this.dialog.addClass(this.settings.wrapClass),this.settings.type&&this.dialog.addClass("dialog-icons-default"),this.settings.position&&this.position(),this.bindEvent(),t("body").addClass("dialog-open"),t.isFunction(this.settings.onOpen)&&(this.settings.bind?this.settings.onOpen.apply(this,this.dialog):this.settings.onOpen(this.dialog)),this.settings.lock&&this.lock(),t.isNumeric(this.settings.time)&&this.time()},onConfirm:function(){var e=this,i=this.dialog.find(".dialog-footer .btns");t("<span>",{ClASS:"btn btn-sure",text:e.settings.confirmText,ka:e.settings.preKa?e.settings.preKa+"_":"",click:function(){t.isFunction(e.settings.onConfirm)?e.settings.bind?e.settings.onConfirm.apply(e,e.dialog):e.settings.onConfirm(e.dialog):e.close()}}).prependTo(i)},onCancel:function(){var e=this,i=this.dialog.find(".dialog-footer .btns");t("<span>",{ClASS:"btn btn-outline btn-cancel",text:e.settings.cancelText,ka:(e.settings.preKa?e.settings.preKa+"_":"")+"dialog_cancel",click:function(){t.isFunction(e.settings.onCancel)?e.settings.bind?e.settings.onCancel.apply(e,e.dialog):e.settings.onCancel(e.dialog):e.close()}}).prependTo(i)},size:function(){var t=this.dialog.find(".dialog-con");this.dialog.find(".dialog-container");t.css({width:this.settings.width,height:this.settings.height})},position:function(){if(this.settings.element){var i=this,s=i.settings.element,a=i.dialog.find(".dialog-container").outerWidth(),n=t(s).offset(),r=n.left+s.width()/2;r<a&&(r=a/2),i.settings.inline||"around"!=i.settings.position||i.dialog.css({left:r+"px",top:n.top+"px"}),i.settings.inline&&(i.dialog.get(0).getBoundingClientRect().top>330&&e.innerHeight-i.dialog.get(0).getBoundingClientRect().top<280&&i.dialog.addClass("dialog-up-default"),i.settings.isSelecter&&t(document).on("click",function(e){e.target==s.get(0)||e.target.parentNode==s.get(0)||t(e.target).closest(".dialog-selecter-default").length||(i.dialog.closest(".dropdown-wrap").removeClass("dropdown-menu-open"),i.close())}))}},lock:function(){if(!s){var t=this;t.dialog.find(".dialog-container");this.settings.closeLayer&&t.dialog.find(".dialog-layer").on("click",function(){t.close()})}},unLock:function(){this.settings.lock&&s&&(t("html,body").css("overflow","visible"),s=!1)},close:function(){t.isFunction(this.settings.onClose)&&this.settings.onClose(this.dialog),this.dialog.remove(),this.unLock(),t("body").removeClass("dialog-open")},time:function(){var t=this;this.closeTimer=setTimeout(function(){t.close()},this.settings.time)},bindEvent:function(){var i=this;this.dialog.find(".close").on("click",function(){i.close()}),t(e).on("resize.dialog",function(){i.settings.onResize&&i.settings.onResize(i.dialog)})}},t.dialog=function(t){return new a(t)}}(jQuery,window);var DropDown={init:function(t){var t=t||$("body"),e=t.find(".dropdown-wrap").not(".sync-container .dropdown-wrap");e.each(function(){var t=$(this),i=t.attr("role-type"),s=t.find(".dropdown-select,.dropdown-label"),a=s.find("input[readonly]"),n=s.find('input[type="hidden"]'),r="false"!=t.attr("data-fill");i&&"customize-event"==i||(s.on("click",function(i){t.hasClass("dropdown-disabled")||($(i.target).closest(".dropdown-menu-open").length?t.removeClass("dropdown-menu-open"):(e.not(this.parent).removeClass("dropdown-menu-open"),t.toggleClass("dropdown-menu-open")))}),t.on("click","li",function(){var e=n.val();if(!$(this).hasClass("disabled")){if($(this).hasClass("tip-blank"))return void t.removeClass("dropdown-menu-open");a.length&&e!=$(this).attr("data-val")&&!$(this).hasClass("no-set")&&(r&&a.val($(this).text()),a.addClass("sel-active"),t.find(".tip-text").remove(),$(this).parent().find("li").removeClass("cur"),$(this).addClass("cur"),$(this).attr("data-val")&&n.val($(this).attr("data-val")),t.trigger("dropdown.selected")),t.removeClass("dropdown-menu-open")}}))}),$(document).on("click",function(t){$(t.target).parents(".dropdown-wrap").length||(e.removeClass("dropdown-menu-open"),e.trigger("dropdown.close")),t.stopPropagation()}),$(document).on("click",".js-report",function(t){e.removeClass("dropdown-menu-open"),e.trigger("dropdown.close"),t.stopPropagation()})}};if($(function(){DropDown.init()}),"undefined"==typeof jQuery)throw new Error("jquery-confirm requires jQuery");var jconfirm,Jconfirm;!function(t){"use strict";t.fn.confirm=function(e,i){return void 0===e&&(e={}),"string"==typeof e&&(e={content:e,title:i||!1}),t(this).each(function(){var i=t(this);i.on("click",function(s){s.preventDefault();var a=t.extend({},e);i.attr("data-title")&&(a.title=i.attr("data-title")),i.attr("data-content")&&(a.content=i.attr("data-content")),a.$target=i,i.attr("href")&&!e.confirm&&(a.confirm=function(){location.href=i.attr("href")}),t.confirm(a)})}),t(this)},t.confirm=function(t,e){return void 0===t&&(t={}),"string"==typeof t&&(t={content:t,title:e||!1}),jconfirm(t)},t.alert=function(t,e){return void 0===t&&(t={}),"string"==typeof t&&(t={content:t,title:e||!1}),t.cancelButton=!1,jconfirm(t)},jconfirm=function(e){void 0===e&&(e={}),jconfirm.defaults&&t.extend(jconfirm.pluginDefaults,jconfirm.defaults);var e=t.extend({},jconfirm.pluginDefaults,e);return new Jconfirm(e)},Jconfirm=function(e){t.extend(this,e),this._init()},Jconfirm.prototype={_init:function(){var t=this;this._rand=Math.round(99999*Math.random()),this._buildHTML(),this._bindEvents(),setTimeout(function(){t.open(),t._watchContent()},0)},_buildHTML:function(){var e=this;this.animation="anim-"+this.animation.toLowerCase(),this.closeAnimation="anim-"+this.closeAnimation.toLowerCase(),this.theme="jconfirm-"+this.theme.toLowerCase(),"anim-none"==this.animation&&(this.animationSpeed=0),this._lastFocused=t("body").find(":focus"),this.$el=t(this.template).appendTo(this.container).addClass(this.theme),this.$el.find(".jconfirm-box-container").addClass(this.columnClass),this.$el.find(".jconfirm-bg").css(this._getCSS(this.animationSpeed,1)),this.$el.find(".jconfirm-bg").css("opacity",this.opacity),this.$b=this.$el.find(".jconfirm-box").css(this._getCSS(this.animationSpeed,this.animationBounce)).addClass(this.animation),this.$body=this.$b,this.rtl&&this.$el.addClass("rtl"),this._contentReady=t.Deferred(),this._modalReady=t.Deferred(),this.$title=this.$el.find(".title"),this.contentDiv=this.$el.find("div.content"),this.$content=this.contentDiv,this.$contentPane=this.$el.find(".content-pane"),this.$icon=this.$el.find(".icon-c"),this.$closeIcon=this.$el.find(".closeIcon"),this.$contentPane.css(this._getCSS(this.animationSpeed,1)),this.setTitle(),this.setIcon(),this._setButtons(),this.closeIconClass&&this.$closeIcon.html('<i class="'+this.closeIconClass+'"></i>'),e._contentHash=this._hash(e.$content.html()),t.when(this._contentReady,this._modalReady).then(function(){e.setContent(),e.setTitle(),e.setIcon()}),this._getContent(),this._imagesLoaded(),this.autoClose&&this._startCountDown()},_unwatchContent:function(){clearInterval(this._timer)},_hash:function(){if("function"==typeof btoa)return btoa(encodeURIComponent(this.$content.html()))},_watchContent:function(){var t=this;this._timer=setInterval(function(){var e=t._hash(t.$content.html());t._contentHash!=e&&(t._contentHash=e,t.setDialogCenter(),t._imagesLoaded())},this.watchInterval)},_bindEvents:function(){var e=this,i=!1;this.$el.find(".jconfirm-scrollpane").click(function(t){i||(e.backgroundDismiss?(e.cancel(),e.close()):(e.$b.addClass("hilight"),setTimeout(function(){e.$b.removeClass("hilight")},800))),i=!1}),this.$el.find(".jconfirm-box").click(function(t){i=!0}),this.$confirmButton&&this.$confirmButton.click(function(t){t.preventDefault();var i=e.confirm(e.$b);e._stopCountDown(),e.onAction("confirm"),(void 0===i||i)&&e.close()}),this.$cancelButton&&this.$cancelButton.click(function(t){t.preventDefault();var i=e.cancel(e.$b);e._stopCountDown(),e.onAction("cancel"),(void 0===i||i)&&e.close()}),this.$closeButton&&this.$closeButton.click(function(t){t.preventDefault(),e._stopCountDown(),e.cancel(),e.onAction("close"),e.close()}),this.keyboardEnabled&&setTimeout(function(){t(window).on("keyup."+this._rand,function(t){e.reactOnKey(t)})},500),t(window).on("resize."+this._rand,function(){e.setDialogCenter(!0)})},_getCSS:function(t,e){return{"-webkit-transition-duration":t/1e3+"s","transition-duration":t/1e3+"s","-webkit-transition-timing-function":"cubic-bezier(.36,1.1,.2, "+e+")","transition-timing-function":"cubic-bezier(.36,1.1,.2, "+e+")"}},_imagesLoaded:function(){var e=this;t.each(this.$content.find("img:not(.loaded)"),function(i,s){var a=setInterval(function(){"0px"!==t(s).css("height")&&(t(s).addClass("loaded"),e.setDialogCenter(),clearInterval(a))},40)})},_setButtons:function(){this.$btnc=this.$el.find(".buttons"),this.confirmButton&&""!==t.trim(this.confirmButton)&&(this.$confirmButton=t('<button type="button" class="btn">'+this.confirmButton+"</button>").appendTo(this.$btnc).addClass(this.confirmButtonClass)),this.cancelButton&&""!==t.trim(this.cancelButton)&&(this.buttonsReverse?this.$cancelButton=t('<button type="button" class="btn">'+this.cancelButton+"</button>").prependTo(this.$btnc).addClass(this.cancelButtonClass):this.$cancelButton=t('<button type="button" class="btn">'+this.cancelButton+"</button>").appendTo(this.$btnc).addClass(this.cancelButtonClass)),this.buttonOther&&""!==t.trim(this.buttonOther)&&t(this.buttonOther).prependTo(this.$btnc),this.confirmButton||this.cancelButton||this.$btnc.hide(),this.confirmButton||this.cancelButton||null!==this.closeIcon||(this.$closeButton=this.$b.find(".closeIcon").show()),!0===this.closeIcon&&(this.$closeButton=this.$b.find(".closeIcon").show())},setTitle:function(t){this.title=void 0!==t?t:this.title,this.$title.html(this.title||"")},setIcon:function(t){this.title="undefined"!=typeof string?t:this.title,this.$icon.html(this.icon?'<i class="'+this.icon+'"></i>':"")},setContent:function(t){this.content=void 0===t?this.content:t,""==this.content?(this.$content.html(this.content),this.$contentPane.hide()):(this.$content.html(this.content),this.$contentPane.show()),this.$content.hasClass("loading")&&(this.$content.removeClass("loading"),this.$btnc.find("button").prop("disabled",!1))},_getContent:function(e){var i=this;if(e=e||this.content,this._isAjax=!1,this.content)if("string"==typeof this.content)if("url:"===this.content.substr(0,4).toLowerCase()){this._isAjax=!0,this.$content.addClass("loading"),this.$btnc.find("button").prop("disabled",!0);var s=this.content.substring(4,this.content.length);t.get(s).done(function(t){i.content=t,i._contentReady.resolve()}).always(function(t,e,s){"function"==typeof i.contentLoaded&&i.contentLoaded(t,e,s)})}else this.setContent(this.content),this._contentReady.reject();else if("function"==typeof this.content){this.$content.addClass("loading"),this.$btnc.find("button").attr("disabled","disabled");var a=this.content(this);"object"!=typeof a?console.error("The content function must return jquery promise."):"function"!=typeof a.always?console.error("The object returned is not a jquery promise."):(this._isAjax=!0,a.always(function(t,e){i._contentReady.resolve()}))}else console.error("Invalid option for property content, passed: "+typeof this.content);else this.content="",this.setContent(this.content),this._contentReady.reject();this.setDialogCenter()},_stopCountDown:function(){clearInterval(this.timerInterval),this.$cd&&this.$cd.remove()},_startCountDown:function(){var e=this.autoClose.split("|");if(/cancel/.test(e[0])&&"alert"===this.type)return!1;if(/confirm|cancel/.test(e[0])){this.$cd=t('<span class="countdown"></span>').appendTo(this["$"+e[0]+"Button"]);var i=this;i.$cd.parent().click();var s=e[1]/1e3;this.timerInterval=setInterval(function(){i.$cd.html(" ("+(s-=1)+")"),0===s&&(i.$cd.html(""),i.$cd.parent().trigger("click"),clearInterval(i.timerInterval))},1e3)}else console.error("Invalid option "+e[0]+", must be confirm/cancel")},reactOnKey:function(e){var i=t(".jconfirm");if(i.eq(i.length-1)[0]!==this.$el[0])return!1;var s=e.which;if(this.contentDiv.find(":input").is(":focus")&&/13|32/.test(s))return!1;-1!==t.inArray(s,this.cancelKeys)&&(this.$cancelButton?this.$cancelButton.click():this.close()),-1!==t.inArray(s,this.confirmKeys)&&this.$confirmButton&&this.$confirmButton.click()},setDialogCenter:function(){if("none"==this.$contentPane.css("display"))var e=0,i=0;else{var e=this.$content.outerHeight(),i=this.$contentPane.height();0==i&&(i=e)}var s=this.$content.outerWidth();this.$content.css({clip:"rect(0px "+(100+s)+"px "+e+"px -100px)"}),this.$contentPane.css({height:e});var a=t(window).height(),n=this.$b.outerHeight()-i+e,r=(a-n)/2;if(n>a-100){var o={"margin-top":50,"margin-bottom":50};t("body").addClass("jconfirm-noscroll")}else{var o={"margin-top":r};t("body").removeClass("jconfirm-noscroll")}this.$b.css(o)},close:function(){var e=this;if(this.isClosed())return!1;"function"==typeof this.onClose&&this.onClose(),this._unwatchContent(),e._lastFocused.focus(),t(window).unbind("resize."+this._rand),this.keyboardEnabled&&t(window).unbind("keyup."+this._rand),e.$el.find(".jconfirm-bg").removeClass("seen"),t("body").removeClass("jconfirm-noscroll"),this.$b.addClass(this.closeAnimation);var i="anim-none"==this.closeAnimation?0:this.animationSpeed;return setTimeout(function(){e.$el.remove()},25*i/100),jconfirm.record.closed+=1,jconfirm.record.currentlyOpen-=1,!0},open:function(){var t=this;if(this.isClosed())return!1;t.$el.find(".jconfirm-bg").addClass("seen"),this.$b.removeClass(this.animation),this.$b.find("input[autofocus]:visible:first").focus(),jconfirm.record.opened+=1,jconfirm.record.currentlyOpen+=1,"function"==typeof this.onOpen&&this.onOpen();var e="jconfirm-box"+this._rand;return this.$b.attr("aria-labelledby",e).attr("tabindex",-1).focus(),this.$title?this.$title.attr("id",e):this.$content&&this.$content.attr("id",e),setTimeout(function(){t.$b.css({"transition-property":t.$b.css("transition-property")+", margin"}),t._modalReady.resolve()},this.animationSpeed),!0},isClosed:function(){return""===this.$el.css("display")}},jconfirm.pluginDefaults={template:'<div class="jconfirm"><div class="jconfirm-bg"></div><div class="jconfirm-scrollpane"><div class="container"><div class="row"><div class="jconfirm-box-container"><div class="jconfirm-box" role="dialog" aria-labelledby="labelled" tabindex="-1"><div class="closeIcon">&times;</div><div class="title-c"><span class="icon-c"></span><span class="title"></span></div><div class="content-pane"><div class="content"></div></div><div class="buttons"></div><div class="jquery-clear"></div></div></div></div></div></div></div>',title:"提示",content:"确定吗",contentLoaded:function(){},icon:"",opacity:null,confirmButton:"确定",cancelButton:"取消",confirmButtonClass:"btn",cancelButtonClass:"btn btn-slight",buttonsReverse:!1,theme:"white",animation:"scale",closeAnimation:"none",animationSpeed:500,animationBounce:1.2,keyboardEnabled:!1,rtl:!1,confirmKeys:[13],cancelKeys:[27],container:"body",confirm:function(){},cancel:function(){},backgroundDismiss:!0,autoClose:!1,closeIcon:null,closeIconClass:!1,watchInterval:100,columnClass:"pop-container",onOpen:function(){},onClose:function(){},onAction:function(){}},jconfirm.record={opened:0,closed:0,currentlyOpen:0}}(jQuery),jQuery&&function(t){function e(e,a){var n=e?t(this):a,r=t(n.attr("data-jq-dropdown")),o=n.hasClass("jq-dropdown-open");if(e){if(t(e.target).hasClass("jq-dropdown-ignore"))return;e.preventDefault(),e.stopPropagation()}else if(n!==a.target&&t(a.target).hasClass("jq-dropdown-ignore"))return;if(i(),!o&&!n.hasClass("jq-dropdown-disabled")){n.addClass("jq-dropdown-open"),r.data("jq-dropdown-trigger",n).show(),s();var c,l,d=n.find('input[type="text"]'),h=n.find("[name]");d.focus(),r.unbind("click").on("click","[data-jq-value]",function(){l=t(this).attr("data-jq-value"),c=t(this).text(),d.val(c),h.val(l),r.find("[data-jq-value]").removeClass("current"),t(this).addClass("current"),""!=l&&0!=l||d.val("")}),r.trigger("show",{jqDropdown:r,trigger:n})}}function i(e){var i=e?t(e.target).parents().addBack():null;if(i&&i.is(".jq-dropdown")){if(!i.is(".jq-dropdown-menu"))return;if(!i.is("A"))return}t(document).find(".jq-dropdown:visible").each(function(){var e=t(this);e.hide().removeData("jq-dropdown-trigger").trigger("hide",{jqDropdown:e})}),t(document).find(".jq-dropdown-open").removeClass("jq-dropdown-open")}function s(){var e=t(".jq-dropdown:visible").eq(0),i=e.data("jq-dropdown-trigger"),s=i?parseInt(i.attr("data-horizontal-offset")||0,10):null,a=i?parseInt(i.attr("data-vertical-offset")||0,10):null;0!==e.length&&i&&(e.hasClass("jq-dropdown-relative")?e.css({left:e.hasClass("jq-dropdown-anchor-right")?i.position().left-(e.outerWidth(!0)-i.outerWidth(!0))-parseInt(i.css("margin-right"),10)+s:i.position().left+parseInt(i.css("margin-left"),10)+s,top:i.position().top+i.outerHeight(!0)-parseInt(i.css("margin-top"),10)+a}):e.css({left:e.hasClass("jq-dropdown-anchor-right")?i.offset().left-(e.outerWidth()-i.outerWidth())+s:i.offset().left+s,top:i.offset().top+i.outerHeight()+a}))}t.extend(t.fn,{jqDropdown:function(s,a){switch(s){case"show":return e(null,t(this)),t(this);case"hide":return i(),t(this);case"attach":return t(this).attr("data-jq-dropdown",a);case"detach":return i(),t(this).removeAttr("data-jq-dropdown");case"disable":return t(this).addClass("jq-dropdown-disabled");case"enable":return i(),t(this).removeClass("jq-dropdown-disabled")}}}),t(document).on("click.jq-dropdown","[data-jq-dropdown]",e),t(document).on("click.jq-dropdown",i),t(window).on("resize",s)}(jQuery),function(t){function e(){return new Date(Date.UTC.apply(Date,arguments))}var i=function(e,i){var n=this;this.element=t(e),this.container=i.container||"body",this.inDate=i.inDate||[],this.language=i.language||this.element.data("date-language")||"en",this.language=this.language in s?this.language:"en",this.isRTL=s[this.language].rtl||!1,this.formatType=i.formatType||this.element.data("format-type")||"standard",this.format=a.parseFormat(i.format||this.element.data("date-format")||s[this.language].format||a.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.bootcssVer=this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2,this.component=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar").parent():this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar").parent()),this.componentReset=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove").parent():this.element.find(".add-on .icon-remove").parent()),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=i.linkField||this.element.data("link-field")||!1,this.linkFormat=a.parseFormat(i.linkFormat||this.element.data("link-format")||a.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=i.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=i.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=i.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=i.initialDate||new Date,this.minLimitYear=i.minLimitYear||!1,this._attachEvents(),this.formatViewType="datetime","formatViewType"in i?this.formatViewType=i.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in i?this.minView=i.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=a.convertViewMode(this.minView),this.maxView=a.modes.length-1,"maxView"in i?this.maxView=i.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=a.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in i?this.wheelViewModeNavigation=i.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in i?this.wheelViewModeNavigationInverseDirection=i.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in i?this.wheelViewModeNavigationDelay=i.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in i?this.startViewMode=i.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=a.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in i?this.viewSelect=i.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=a.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in i?this.forceParse=i.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse")),this.picker=t(3==this.bootcssVer?a.templateV3:a.template).appendTo(this.isInline?this.element:this.container).on({click:t.proxy(this.click,this),mousedown:t.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(t.fn.mousewheel?this.picker.on({mousewheel:t.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition),this.isRTL&&(this.picker.addClass("datetimepicker-rtl"),3==this.bootcssVer?this.picker.find(".prev span, .next span").toggleClass("glyphicon-arrow-left glyphicon-arrow-right"):this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")),this.minLimitYear&&this.picker.addClass("date-showminyear"),t(document).on("click",function(e){0===t(e.target).closest(".datetimepicker").length&&n.hide()}),this.autoclose=!1,"autoclose"in i?this.autoclose=i.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in i?this.keyboardNavigation=i.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=i.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=i.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(i.weekStart||this.element.data("date-weekstart")||s[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-1/0,this.endDate=1/0,this.daysOfWeekDisabled=[],this.setStartDate(i.startDate||this.element.data("date-startdate")),this.setEndDate(i.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(i.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.timer=null,this.isInline&&this.show()};i.prototype={constructor:i,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{click:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{click:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:t.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]];for(var e,i,s=0;s<this._events.length;s++)e=this._events[s][0],i=this._events[s][1],e.on(i)},_detachEvents:function(){for(var t,e,i=0;i<this._events.length;i++)t=this._events[i][0],e=this._events[i][1],t.off(e);this._events=[]},show:function(e){if(this.picker.is(":visible"))return void this.picker.hide();t(".datetimepicker").hide(),t(".dropdown-select-open").removeClass("dropdown-select-open"),t(".dropdown-menu-open").removeClass("dropdown-menu-open"),this.element.closest(".dropdown-select").addClass("dropdown-select-open"),this.element.closest(".dropdown-wrap").addClass("dropdown-menu-open"),this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.forceParse&&this.update(),this.place(),t(window).on("resize",t.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(e){this.isVisible&&(this.isInline||(this.element.closest(".dropdown-select").removeClass("dropdown-select-open"),this.picker.hide(),t(window).off("resize",this.place),this.viewMode=this.startViewMode,
this.showMode(),this.isInput||t(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date})))},remove:function(){this._detachEvents(),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var t=this.getUTCDate();return new Date(t.getTime()+6e4*t.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(t){this.setUTCDate(new Date(t.getTime()-6e4*t.getTimezoneOffset()))},setUTCDate:function(t){t>=this.startDate&&t<=this.endDate?(this.date=t,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:t,startDate:this.startDate,endDate:this.endDate})},setFormat:function(t){this.format=a.parseFormat(t,this.formatType);var e;this.isInput?e=this.element:this.component&&(e=this.element.find("input")),e&&e.val()&&this.setValue()},setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e):(this.component&&this.element.find("input").val(e),this.element.data("date",e)),this.linkField&&t("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(t){return void 0==t&&(t=this.format),a.formatDate(this.date,t,this.language,this.formatType)},setStartDate:function(t){this.startDate=t||-1/0,this.startDate!==-1/0&&(this.startDate=a.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(t){this.endDate=t||1/0,this.endDate!==1/0&&(this.endDate=a.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this.daysOfWeekDisabled=e||[],t.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=t.map(this.daysOfWeekDisabled,function(t){return parseInt(t,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){var e=0;t("div").each(function(){var i=parseInt(t(this).css("zIndex"),10);i>e&&(e=i)});var i,s,a,n,r=e+10;n=this.container instanceof t?this.container.offset():t(this.container).offset(),this.component?(i=this.component.offset(),a=i.left,"bottom-left"!=this.pickerPosition&&"top-left"!=this.pickerPosition||(a+=this.component.outerWidth()-this.picker.outerWidth())):(i=this.element.offset(),a=i.left),a+220>document.body.clientWidth&&(a=document.body.clientWidth-220),s="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?i.top-this.picker.outerHeight():i.top+this.height,s-=n.top,a-=n.left,this.picker.css({top:s,left:a,zIndex:r})}},update:function(){var t,e=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(t=arguments[0],e=!0):("string"==typeof(t=(this.isInput?this.element.val():this.element.find("input").val())||this.element.data("date")||this.initialDate)||t instanceof String)&&(t=t.replace(/^\s+|\s+$/g,"")),t||(t=new Date,e=!1),this.date=a.parseDate(t,this.format,this.language,this.formatType),e&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):this.viewDate=new Date(this.date),this.fill()},fillDow:function(){for(var t=this.weekStart,e="<tr>";t<this.weekStart+7;)e+='<th class="dow">'+s[this.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datetimepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;e<12;)t+='<span class="month">'+s[this.language].monthsShort[e++]+"</span>";this.picker.find(".datetimepicker-months td").html(t)},fill:function(){if(null!=this.date&&null!=this.viewDate){var i=new Date(this.viewDate),n=i.getUTCFullYear(),r=i.getUTCMonth(),o=i.getUTCDate(),c=i.getUTCHours(),l=i.getUTCMinutes(),d=this.startDate!==-1/0?this.startDate.getUTCFullYear():-1/0,h=this.startDate!==-1/0?this.startDate.getUTCMonth():-1/0,u=this.endDate!==1/0?this.endDate.getUTCFullYear():1/0,p=this.endDate!==1/0?this.endDate.getUTCMonth():1/0,f=new e(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),g=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(s[this.language].months[r]+" "+n),"time"==this.formatViewType){var m=c%12?c%12:12,v=(m<10?"0":"")+m,y=(l<10?"0":"")+l,b=s[this.language].meridiem[c<12?0:1];this.picker.find(".datetimepicker-hours thead th:eq(1)").text(v+":"+y+" "+(b?b.toUpperCase():"")),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(v+":"+y+" "+(b?b.toUpperCase():""))}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(o+" "+s[this.language].months[r]+" "+n),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(o+" "+s[this.language].months[r]+" "+n);this.picker.find("tfoot th.today").html('<div class="today-btn">'+s[this.language].today+"</div>").toggle(!1!==this.todayBtn),this.fillMonths();var C=e(n,r-1,28,0,0,0,0),w=a.getDaysInMonth(C.getUTCFullYear(),C.getUTCMonth());C.setUTCDate(w),C.setUTCDate(w-(C.getUTCDay()-this.weekStart+7)%7);var T=new Date(C);T.setUTCDate(T.getUTCDate()+42),T=T.valueOf();for(var x,k=[],E="";C.valueOf()<T;){var _="";if(C.getUTCDay()==this.weekStart&&k.push("<tr>"),x="",E=C.getUTCDate(),C.getUTCFullYear()<n||C.getUTCFullYear()==n&&C.getUTCMonth()<r?x+=" old":(C.getUTCFullYear()>n||C.getUTCFullYear()==n&&C.getUTCMonth()>r)&&(x+=" new"),this.todayHighlight&&C.getUTCFullYear()==g.getFullYear()&&C.getUTCMonth()==g.getMonth()&&E==g.getDate()&&(x+=" today",E="今日"),C.valueOf()==f&&(x+=" active"),C.valueOf()+864e5<=this.startDate||C.valueOf()>this.endDate||-1!==t.inArray(C.getUTCDay(),this.daysOfWeekDisabled))x+=" disabled";else{var D=""+C.getUTCFullYear()+C.getUTCMonth()+C.getUTCDate();this.inDate.filter(function(t){return""+t.year+t.month+t.day===D}).length&&(_='<i class="indate-dot"></i>')}k.push('<td class="day'+x+'"><em>'+C.getUTCDate()+"</em>"+_+"</td>"),C.getUTCDay()==this.weekEnd&&k.push("</tr>"),C.setUTCDate(C.getUTCDate()+1)}this.picker.find(".datetimepicker-days tbody").empty().append(k.join("")),k=[];for(var I="",S="",M="",$=0;$<24;$++){var P=e(n,r,o,$);x="",P.valueOf()+36e5<=this.startDate||P.valueOf()>this.endDate?x+=" disabled":c==$&&(x+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?(S=$<12?s[this.language].meridiem[0]:s[this.language].meridiem[1],S!=M&&(""!=M&&k.push("</fieldset>"),k.push('<fieldset class="hour"><legend>'+S.toUpperCase()+"</legend>")),M=S,I=$%12?$%12:12,k.push('<span class="hour'+x+" hour_"+($<12?"am":"pm")+'">'+I+"</span>"),23==$&&k.push("</fieldset>")):(I=$+":00",k.push('<span class="hour'+x+'">'+I+"</span>"))}this.picker.find(".datetimepicker-hours td").html(k.join("")),k=[],I="",S="",M="";for(var $=0;$<60;$+=this.minuteStep){var P=e(n,r,o,c,$,0);x="",P.valueOf()<this.startDate||P.valueOf()>this.endDate?x+=" disabled":Math.floor(l/this.minuteStep)==Math.floor($/this.minuteStep)&&(x+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?(S=c<12?s[this.language].meridiem[0]:s[this.language].meridiem[1],S!=M&&(""!=M&&k.push("</fieldset>"),k.push('<fieldset class="minute"><legend>'+S.toUpperCase()+"</legend>")),M=S,I=c%12?c%12:12,k.push('<span class="minute'+x+'">'+I+":"+($<10?"0"+$:$)+"</span>"),59==$&&k.push("</fieldset>")):(I=$+":00",k.push('<span class="minute'+x+'">'+c+":"+($<10?"0"+$:$)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html(k.join(""));var U=this.date.getUTCFullYear(),A=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");U==n&&A.eq(this.date.getUTCMonth()).addClass("active"),(n<d||n>u)&&A.addClass("disabled"),n==d&&A.slice(0,h).addClass("disabled"),n==u&&A.slice(p+1).addClass("disabled"),k="",n=10*parseInt(n/10,10);var L=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(var $=-1;$<11;$++){var j=n;if(this.minLimitYear&&n<this.minLimitYear)return;this.minLimitYear&&n==this.minLimitYear&&(j=n+1+"以前"),k+='<span class="year'+(-1==$||10==$?" old":"")+(U==n?" active":"")+(n<d||n>u?" disabled":"")+'" data-year="'+n+'">'+j+"</span>",n+=1}L.html(k),this.place(),this.updateNavArrows()}},updateNavArrows:function(){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth(),s=t.getUTCDate(),a=t.getUTCHours(),n=this.picker.find(".datetimepicker-years").find(".year").last().hasClass("disabled");switch(this.viewMode){case 0:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&s<=this.startDate.getUTCDate()&&a<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&s>=this.endDate.getUTCDate()&&a>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&s<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&s>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):n?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(e){if(e.preventDefault(),e.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var i=e.originalEvent,s=i.wheelDelta,a=s>0?1:0===s?0:-1;this.wheelViewModeNavigationInverseDirection&&(a=-a),this.showMode(a),setTimeout(t.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(i){i.stopPropagation(),i.preventDefault();var s=t(i.target).closest("span, td, th, legend");if(s.is(".glyphicon")&&(s=t(s).parent().closest("span, td, th, legend")),1==s.length){if(s.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(s[0].nodeName.toLowerCase()){case"th":switch(s[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.picker.find(".prev").css({visibility:"hidden"}),this.picker.find(".next").css({visibility:"hidden"}),this.throttle(function(){var t=a.modes[this.viewMode].navStep*("prev"==s[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,t);break;case 1:this.viewDate=this.moveDate(this.viewDate,t);break;case 2:this.viewDate=this.moveMonth(this.viewDate,t);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,t)}this.fill(),this.element.trigger({type:s[0].className+":"+this.convertViewModeText(this.viewMode),date:this.viewDate,startDate:this.startDate,endDate:this.endDate})},300);break;case"today":var n=new Date;n=e(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),0),n<this.startDate?n=this.startDate:n>this.endDate&&(n=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(n),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!s.is(".disabled")){var r=this.viewDate.getUTCFullYear(),o=this.viewDate.getUTCMonth(),c=this.viewDate.getUTCDate(),l=this.viewDate.getUTCHours(),d=this.viewDate.getUTCMinutes(),h=this.viewDate.getUTCSeconds();if(s.is(".month")?(this.viewDate.setUTCDate(1),o=s.parent().find("span").index(s),c=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(o),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(e(r,o,c,l,d,h,0))):s.is(".year")?(this.viewDate.setUTCDate(1),r=parseInt(s.text(),10)||0,s.text().indexOf("以前")>-1&&(r-=1),this.viewDate.setUTCFullYear(r),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(e(r,o,c,l,d,h,0)),this.minLimitYear&&this.minLimitYear==r&&(this.viewMode=this.startViewMode,this.showMode(0),this._setDate(e(r,0,c,l,d,h,0)),this.fill(),this.hide())):s.is(".hour")?(l=parseInt(s.text(),10)||0,(s.hasClass("hour_am")||s.hasClass("hour_pm"))&&(12==l&&s.hasClass("hour_am")?l=0:12!=l&&s.hasClass("hour_pm")&&(l+=12)),this.viewDate.setUTCHours(l),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(e(r,o,c,l,d,h,0))):s.is(".minute")&&(d=parseInt(s.text().substr(s.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(d),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(e(r,o,c,l,d,h,0))),0!=this.viewMode){var u=this.viewMode;this.minLimitYear&&this.minLimitYear==r?this.showMode(0):this.showMode(-1),this.fill(),u==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(s.is(".day")&&!s.is(".disabled")){var c=parseInt(s.text(),10)||1,r=this.viewDate.getUTCFullYear(),o=this.viewDate.getUTCMonth(),l=this.viewDate.getUTCHours(),d=this.viewDate.getUTCMinutes(),h=this.viewDate.getUTCSeconds();s.is(".old")?0===o?(o=11,r-=1):o-=1:s.is(".new")&&(11==o?(o=0,r+=1):o+=1),this.viewDate.setUTCFullYear(r),this.viewDate.setUTCMonth(o,c),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(e(r,o,c,l,d,h,0))}var u=this.viewMode;this.showMode(-1),this.fill(),u==this.viewMode&&this.autoclose&&this.hide()}}},throttle:function(t,e){var i=this;clearTimeout(this.timer),this.timer=setTimeout(function(){t.call(i)},e)},_setDate:function(t,e){e&&"date"!=e||(this.date=t),e&&"view"!=e||(this.viewDate=t),this.fill(),this.setValue();var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&(i.change(),this.autoclose),this.element.trigger({type:"changeDate",date:this.date})},moveMinute:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCMinutes(i.getUTCMinutes()+e*this.minuteStep),i},moveHour:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCHours(i.getUTCHours()+e),i},moveDate:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCDate(i.getUTCDate()+e),i},moveMonth:function(t,e){if(!e)return t;var i,s,a=new Date(t.valueOf()),n=a.getUTCDate(),r=a.getUTCMonth(),o=Math.abs(e);if(e=e>0?1:-1,1==o)s=-1==e?function(){return a.getUTCMonth()==r}:function(){return a.getUTCMonth()!=i},i=r+e,a.setUTCMonth(i),(i<0||i>11)&&(i=(i+12)%12);else{for(var c=0;c<o;c++)a=this.moveMonth(a,e);i=a.getUTCMonth(),a.setUTCDate(n),s=function(){return i!=a.getUTCMonth()}}for(;s();)a.setUTCDate(--n),a.setUTCMonth(i);return a},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.startDate&&t<=this.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))return void(27==t.keyCode&&this.show());var e,i,s,a=!1;switch(t.keyCode){case 27:this.hide(),t.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;e=37==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),s=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),s=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,e),s=this.moveDate(this.viewDate,e)):1==viewMode?(i=this.moveHour(this.date,e),s=this.moveHour(this.viewDate,e)):0==viewMode&&(i=this.moveMinute(this.date,e),s=this.moveMinute(this.viewDate,e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=s,this.setValue(),this.update(),t.preventDefault(),a=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;e=38==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),s=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),s=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,7*e),s=this.moveDate(this.viewDate,7*e)):1==viewMode?this.showMeridian?(i=this.moveHour(this.date,6*e),s=this.moveHour(this.viewDate,6*e)):(i=this.moveHour(this.date,4*e),s=this.moveHour(this.viewDate,4*e)):0==viewMode&&(i=this.moveMinute(this.date,4*e),s=this.moveMinute(this.viewDate,4*e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=s,this.setValue(),this.update(),t.preventDefault(),a=!0);break;case 13:if(0!=this.viewMode){var n=this.viewMode;this.showMode(-1),this.fill(),n==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();t.preventDefault();break;case 9:this.hide()}if(a){var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change(),this.element.trigger({type:"changeDate",date:this.date})}},showMode:function(t){if(t){var e=Math.max(0,Math.min(a.modes.length-1,this.viewMode+t));e>=this.minView&&e<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:e}),this.viewMode=e)}this.picker.find(">div").hide().filter(".datetimepicker-"+a.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(t){this._setDate(null,"date")},convertViewModeText:function(t){switch(t){case 4:return"decade";case 3:return"year";case 2:return"month";case 1:return"day";case 0:return"hour"}}},t.fn.datetimepicker=function(e){var s=Array.apply(null,arguments);s.shift();var a;return this.each(function(){var n=t(this),r=n.data("datetimepicker"),o="object"==typeof e&&e;if(r||n.data("datetimepicker",r=new i(this,t.extend({},t.fn.datetimepicker.defaults,o))),"string"==typeof e&&"function"==typeof r[e]&&void 0!==(a=r[e].apply(r,s)))return!1}),void 0!==a?a:this},t.fn.datetimepicker.defaults={},t.fn.datetimepicker.Constructor=i;var s=t.fn.datetimepicker.dates={en:{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"至今",suffix:[],meridiem:["上午","下午"]}},a={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4==0&&t%100!=0||t%400==0},getDaysInMonth:function(t,e){return[31,a.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},getDefaultFormat:function(t,e){if("standard"==t)return"input"==e?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==t)return"input"==e?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(t){if("standard"==t)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==t)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(t,e){var i=t.replace(this.validParts(e),"\0").split("\0"),s=t.match(this.validParts(e));if(!i||!i.length||!s||0==s.length)throw new Error("Invalid date format.");return{separators:i,parts:s}},parseDate:function(a,n,r,o){if(a instanceof Date){var c=new Date(a.valueOf()-6e4*a.getTimezoneOffset());return c.setMilliseconds(0),c}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(a)&&(n=this.parseFormat("yyyy-mm-dd",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(a)&&(n=this.parseFormat("yyyy-mm-dd hh:ii",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(a)&&(n=this.parseFormat("yyyy-mm-dd hh:ii:ss",o)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(a)){var l,d,h=/([-+]\d+)([dmwy])/,u=a.match(/([-+]\d+)([dmwy])/g);a=new Date;for(var p=0;p<u.length;p++)switch(l=h.exec(u[p]),d=parseInt(l[1]),l[2]){case"d":a.setUTCDate(a.getUTCDate()+d);break;case"m":a=i.prototype.moveMonth.call(i.prototype,a,d);break;case"w":a.setUTCDate(a.getUTCDate()+7*d);break;case"y":a=i.prototype.moveYear.call(i.prototype,a,d)}return e(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),0)}var f,g,l,u=a&&a.match(this.nonpunctuation)||[],a=new Date(0,0,0,0,0,0,0),m={},v=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],y={hh:function(t,e){return t.setUTCHours(e)},h:function(t,e){return t.setUTCHours(e)},HH:function(t,e){return t.setUTCHours(12==e?0:e)},H:function(t,e){return t.setUTCHours(12==e?0:e)},ii:function(t,e){return t.setUTCMinutes(e)},i:function(t,e){return t.setUTCMinutes(e)},ss:function(t,e){return t.setUTCSeconds(e)},s:function(t,e){return t.setUTCSeconds(e)},yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){for(e-=1;e<0;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!=e;){if(isNaN(t.getUTCMonth()))return t;t.setUTCDate(t.getUTCDate()-1)}return t},d:function(t,e){return t.setUTCDate(e)},p:function(t,e){return t.setUTCHours(1==e?t.getUTCHours()+12:t.getUTCHours())}};if(y.M=y.MM=y.mm=y.m,y.dd=y.d,y.P=y.p,a=e(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds()),u.length==n.parts.length){for(var p=0,b=n.parts.length;p<b;p++){if(f=parseInt(u[p],10),l=n.parts[p],isNaN(f))switch(l){case"MM":g=t(s[r].months).filter(function(){var t=this.slice(0,u[p].length);return t==u[p].slice(0,t.length)}),f=t.inArray(g[0],s[r].months)+1;break;case"M":g=t(s[r].monthsShort).filter(function(){var t=this.slice(0,u[p].length),e=u[p].slice(0,t.length);return t.toLowerCase()==e.toLowerCase()}),f=t.inArray(g[0],s[r].monthsShort)+1;break;case"p":case"P":f=t.inArray(u[p].toLowerCase(),s[r].meridiem)}m[l]=f}for(var C,p=0;p<v.length;p++)(C=v[p])in m&&!isNaN(m[C])&&y[C](a,m[C])}return a},formatDate:function(e,i,n,r){if(null==e)return"";var o;if("standard"==r)o={yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear(),m:e.getUTCMonth()+1,M:s[n].monthsShort[e.getUTCMonth()],MM:s[n].months[e.getUTCMonth()],d:e.getUTCDate(),D:s[n].daysShort[e.getUTCDay()],DD:s[n].days[e.getUTCDay()],p:2==s[n].meridiem.length?s[n].meridiem[e.getUTCHours()<12?0:1]:"",h:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()},2==s[n].meridiem.length?o.H=o.h%12==0?12:o.h%12:o.H=o.h,o.HH=(o.H<10?"0":"")+o.H,o.P=o.p.toUpperCase(),o.hh=(o.h<10?"0":"")+o.h,o.ii=(o.i<10?"0":"")+o.i,o.ss=(o.s<10?"0":"")+o.s,o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;else{if("php"!=r)throw new Error("Invalid format type.");o={y:e.getUTCFullYear().toString().substring(2),Y:e.getUTCFullYear(),F:s[n].months[e.getUTCMonth()],M:s[n].monthsShort[e.getUTCMonth()],n:e.getUTCMonth()+1,t:a.getDaysInMonth(e.getUTCFullYear(),e.getUTCMonth()),j:e.getUTCDate(),l:s[n].days[e.getUTCDay()],D:s[n].daysShort[e.getUTCDay()],w:e.getUTCDay(),N:0==e.getUTCDay()?7:e.getUTCDay(),S:e.getUTCDate()%10<=s[n].suffix.length?s[n].suffix[e.getUTCDate()%10-1]:"",a:2==s[n].meridiem.length?s[n].meridiem[e.getUTCHours()<12?0:1]:"",g:e.getUTCHours()%12==0?12:e.getUTCHours()%12,G:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()},o.m=(o.n<10?"0":"")+o.n,o.d=(o.j<10?"0":"")+o.j,o.A=o.a.toString().toUpperCase(),o.h=(o.g<10?"0":"")+o.g,o.H=(o.G<10?"0":"")+o.G,o.i=(o.i<10?"0":"")+o.i,o.s=(o.s<10?"0":"")+o.s}for(var e=[],c=t.extend([],i.separators),l=0,d=i.parts.length;l<d;l++)c.length&&e.push(c.shift()),e.push(o[i.parts[l]]);return c.length&&e.push(c.shift()),e.join("")},convertViewMode:function(t){switch(t){case 4:case"decade":t=4;break;case 3:case"year":t=3;break;case 2:case"month":t=2;break;case 1:case"day":t=1;break;case 0:case"hour":t=0}return t},headTemplate:'<thead><tr><th class="prev"><i class="fz fz-arrow-left"></i></th><th colspan="5" class="switch"></th><th class="next"><i class="fz fz-arrow-right"></i></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><span class="glyphicon glyphicon-arrow-left"></span> </th><th colspan="5" class="switch"></th><th class="next"><span class="glyphicon glyphicon-arrow-right"></span> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot class="tfoot"><tr><th colspan="7" class="today"></th></tr></tfoot>'};a.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class="table-condensed">'+a.headTemplate+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+"</table></div></div>",a.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+a.headTemplateV3+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+"</table></div></div>",t.fn.datetimepicker.DPGlobal=a,t.fn.datetimepicker.noConflict=function(){return t.fn.datetimepicker=old,this},t(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(e){var i=t(this);i.data("datetimepicker")||(e.preventDefault(),i.datetimepicker("show"))}),t(function(){t('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),function(t){t.Jcrop=function(e,i){function s(t){return Math.round(t)+"px"}function a(t){return L.baseClass+"-"+t}function n(){return t.fx.step.hasOwnProperty("backgroundColor")}function r(e){var i=t(e).offset();return[i.left,i.top]}function o(t){return[t.pageX-A[0],t.pageY-A[1]]}function c(e){"object"!=typeof e&&(e={}),L=t.extend(L,e),t.each(["onChange","onSelect","onRelease","onDblClick"],function(t,e){"function"!=typeof L[e]&&(L[e]=function(){})})}function l(t,e,i){if(A=r(H),ft.setCursor("move"===t?t:t+"-resize"),"move"===t)return ft.activateHandlers(h(e),m,i);var s=ht.getFixed(),a=u(t),n=ht.getCorner(u(a));ht.setPressed(ht.getCorner(a)),ht.setCurrent(n),ft.activateHandlers(d(t,s),m,i)}function d(t,e){return function(i){if(L.aspectRatio)switch(t){case"e":case"w":i[1]=e.y+1;break;case"n":case"s":i[0]=e.x+1}else switch(t){case"e":case"w":i[1]=e.y2;break;case"n":case"s":i[0]=e.x2}ht.setCurrent(i),pt.update()}}function h(t){var e=t;return gt.watchKeys(),function(t){ht.moveOffset([t[0]-e[0],t[1]-e[1]]),e=t,pt.update()}}function u(t){switch(t){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function p(t){return function(e){return!L.disabled&&(!("move"===t&&!L.allowMove)&&(A=r(H),st=!0,l(t,o(e)),e.stopPropagation(),e.preventDefault(),!1))}}function f(t,e,i){var s=t.width(),a=t.height();s>e&&e>0&&(s=e,a=e/t.width()*t.height()),a>i&&i>0&&(a=i,s=i/t.height()*t.width()),et=t.width()/s,it=t.height()/a,t.width(s).height(a)}function g(t){return{x:t.x*et,y:t.y*it,x2:t.x2*et,y2:t.y2*it,w:t.w*et,h:t.h*it}}function m(t){var e=ht.getFixed();e.w>L.minSelect[0]&&e.h>L.minSelect[1]?(pt.enableHandles(),pt.done()):pt.release(),ft.setCursor(L.allowSelect?"crosshair":"default")}function v(t){if(L.disabled)return!1;if(!L.allowSelect)return!1;st=!0,A=r(H),pt.disableHandles(),ft.setCursor("crosshair");var e=o(t);return ht.setPressed(e),pt.update(),ft.activateHandlers(y,m,"touch"===t.type.substring(0,5)),gt.watchKeys(),t.stopPropagation(),t.preventDefault(),!1}function y(t){ht.setCurrent(t),pt.update()}function b(){var e=t("<div></div>").addClass(a("tracker"));return R&&e.css({opacity:0,backgroundColor:"white"}),e}function C(t){Y.removeClass().addClass(a("holder")).addClass(t)}function w(t,e){function i(){window.setTimeout(y,h)}var s=t[0]/et,a=t[1]/it,n=t[2]/et,r=t[3]/it;if(!at){var o=ht.flipCoords(s,a,n,r),c=ht.getFixed(),l=[c.x,c.y,c.x2,c.y2],d=l,h=L.animationDelay,u=o[0]-l[0],p=o[1]-l[1],f=o[2]-l[2],g=o[3]-l[3],m=0,v=L.swingSpeed;s=d[0],a=d[1],n=d[2],r=d[3],pt.animMode(!0);var y=function(){return function(){m+=(100-m)/v,d[0]=Math.round(s+m/100*u),d[1]=Math.round(a+m/100*p),d[2]=Math.round(n+m/100*f),d[3]=Math.round(r+m/100*g),m>=99.8&&(m=100),m<100?(x(d),i()):(pt.done(),pt.animMode(!1),"function"==typeof e&&e.call(mt))}}();i()}}function T(t){x([t[0]/et,t[1]/it,t[2]/et,t[3]/it]),L.onSelect.call(mt,g(ht.getFixed())),pt.enableHandles()}function x(t){ht.setPressed([t[0],t[1]]),ht.setCurrent([t[2],t[3]]),pt.update()}function k(){return g(ht.getFixed())}function E(){return ht.getFixed()}function _(t){c(t),U()}function D(){L.disabled=!0,pt.disableHandles(),pt.setCursor("default"),ft.setCursor("default")}function I(){L.disabled=!1,U()}function S(){pt.done(),ft.activateHandlers(null,null)}function M(){Y.remove(),B.show(),B.css("visibility","visible"),t(e).removeData("Jcrop")}function $(t,e){pt.release(),D();var i=new Image;i.onload=function(){var s=i.width,a=i.height,n=L.boxWidth,r=L.boxHeight;H.width(s).height(a),H.attr("src",t),z.attr("src",t),f(H,n,r),q=H.width(),G=H.height(),z.width(q).height(G),ot.width(q+2*rt).height(G+2*rt),Y.width(q).height(G),ut.resize(q,G),I(),"function"==typeof e&&e.call(mt)},i.src=t}function P(t,e,i){var s=e||L.bgColor;L.bgFade&&n()&&L.fadeTime&&!i?t.animate({backgroundColor:s},{queue:!1,duration:L.fadeTime}):t.css("backgroundColor",s)}function U(t){L.allowResize?t?pt.enableOnly():pt.enableHandles():pt.disableHandles(),ft.setCursor(L.allowSelect?"crosshair":"default"),pt.setCursor(L.allowMove?"move":"default"),L.hasOwnProperty("trueSize")&&(et=L.trueSize[0]/q,it=L.trueSize[1]/G),L.hasOwnProperty("setSelect")&&(T(L.setSelect),pt.done(),delete L.setSelect),ut.refresh(),L.bgColor!=ct&&(P(L.shade?ut.getShades():Y,L.shade?L.shadeColor||L.bgColor:L.bgColor),ct=L.bgColor),lt!=L.bgOpacity&&(lt=L.bgOpacity,L.shade?ut.refresh():pt.setBgOpacity(lt)),Q=L.maxSize[0]||0,X=L.maxSize[1]||0,Z=L.minSize[0]||0,tt=L.minSize[1]||0,L.hasOwnProperty("outerImage")&&(H.attr("src",L.outerImage),delete L.outerImage),pt.refresh()}var A,L=t.extend({},t.Jcrop.defaults),j=navigator.userAgent.toLowerCase(),R=/msie/.test(j),O=/msie [1-6]\./.test(j);"object"!=typeof e&&(e=t(e)[0]),"object"!=typeof i&&(i={}),c(i);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},B=t(e),F=!0;if("IMG"==e.tagName){if(0!=B[0].width&&0!=B[0].height)B.width(B[0].width),B.height(B[0].height);else{var V=new Image;V.src=B[0].src,B.width(V.width),B.height(V.height)}var H=B.clone().removeAttr("id").css(N).show();H.width(B.width()),H.height(B.height()),B.after(H).hide()}else H=B.css(N).show(),F=!1,null===L.shade&&(L.shade=!0);f(H,L.boxWidth,L.boxHeight);var q=H.width(),G=H.height(),Y=t("<div />").width(q).height(G).addClass(a("holder")).css({position:"relative",
backgroundColor:L.bgColor}).insertAfter(B).append(H);L.addClass&&Y.addClass(L.addClass);var z=t("<div />"),W=t("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),K=t("<div />").width("100%").height("100%").css("zIndex",320),J=t("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var t=ht.getFixed();L.onDblClick.call(mt,t)}).insertBefore(H).append(W,K);F&&(z=t("<img />").attr("src",H.attr("src")).css(N).width(q).height(G),W.append(z)),O&&J.css({overflowY:"hidden"});var Q,X,Z,tt,et,it,st,at,nt,rt=L.boundary,ot=b().width(q+2*rt).height(G+2*rt).css({position:"absolute",top:s(-rt),left:s(-rt),zIndex:290}).mousedown(v),ct=L.bgColor,lt=L.bgOpacity;A=r(H);var dt=function(){function t(){var t,e={},i=["touchstart","touchmove","touchend"],s=document.createElement("div");try{for(t=0;t<i.length;t++){var a=i[t];a="on"+a;var n=a in s;n||(s.setAttribute(a,"return;"),n="function"==typeof s[a]),e[i[t]]=n}return e.touchstart&&e.touchend&&e.touchmove}catch(t){return!1}}return{createDragger:function(t){return function(e){return!L.disabled&&(!("move"===t&&!L.allowMove)&&(A=r(H),st=!0,l(t,o(dt.cfilter(e)),!0),e.stopPropagation(),e.preventDefault(),!1))}},newSelection:function(t){return v(dt.cfilter(t))},cfilter:function(t){return t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,t},isSupported:t,support:function(){return!0===L.touchSupport||!1===L.touchSupport?L.touchSupport:t()}()}}(),ht=function(){function t(t){t=r(t),f=u=t[0],g=p=t[1]}function e(t){t=r(t),d=t[0]-f,h=t[1]-g,f=t[0],g=t[1]}function i(){return[d,h]}function s(t){var e=t[0],i=t[1];0>u+e&&(e-=e+u),0>p+i&&(i-=i+p),G<g+i&&(i+=G-(g+i)),q<f+e&&(e+=q-(f+e)),u+=e,f+=e,p+=i,g+=i}function a(t){var e=n();switch(t){case"ne":return[e.x2,e.y];case"nw":return[e.x,e.y];case"se":return[e.x2,e.y2];case"sw":return[e.x,e.y2]}}function n(){if(!L.aspectRatio)return c();var t,e,i,s,a=L.aspectRatio,n=L.minSize[0]/et,r=L.maxSize[0]/et,d=L.maxSize[1]/it,h=f-u,m=g-p,v=Math.abs(h),y=Math.abs(m),b=v/y;return 0===r&&(r=10*q),0===d&&(d=10*G),b<a?(e=g,i=y*a,t=h<0?u-i:i+u,t<0?(t=0,s=Math.abs((t-u)/a),e=m<0?p-s:s+p):t>q&&(t=q,s=Math.abs((t-u)/a),e=m<0?p-s:s+p)):(t=f,s=v/a,e=m<0?p-s:p+s,e<0?(e=0,i=Math.abs((e-p)*a),t=h<0?u-i:i+u):e>G&&(e=G,i=Math.abs(e-p)*a,t=h<0?u-i:i+u)),t>u?(t-u<n?t=u+n:t-u>r&&(t=u+r),e=e>p?p+(t-u)/a:p-(t-u)/a):t<u&&(u-t<n?t=u-n:u-t>r&&(t=u-r),e=e>p?p+(u-t)/a:p-(u-t)/a),t<0?(u-=t,t=0):t>q&&(u-=t-q,t=q),e<0?(p-=e,e=0):e>G&&(p-=e-G,e=G),l(o(u,p,t,e))}function r(t){return t[0]<0&&(t[0]=0),t[1]<0&&(t[1]=0),t[0]>q&&(t[0]=q),t[1]>G&&(t[1]=G),[Math.round(t[0]),Math.round(t[1])]}function o(t,e,i,s){var a=t,n=i,r=e,o=s;return i<t&&(a=i,n=t),s<e&&(r=s,o=e),[a,r,n,o]}function c(){var t,e=f-u,i=g-p;return Q&&Math.abs(e)>Q&&(f=e>0?u+Q:u-Q),X&&Math.abs(i)>X&&(g=i>0?p+X:p-X),tt/it&&Math.abs(i)<tt/it&&(g=i>0?p+tt/it:p-tt/it),Z/et&&Math.abs(e)<Z/et&&(f=e>0?u+Z/et:u-Z/et),u<0&&(f-=u,u-=u),p<0&&(g-=p,p-=p),f<0&&(u-=f,f-=f),g<0&&(p-=g,g-=g),f>q&&(t=f-q,u-=t,f-=t),g>G&&(t=g-G,p-=t,g-=t),u>q&&(t=u-G,g-=t,p-=t),p>G&&(t=p-G,g-=t,p-=t),l(o(u,p,f,g))}function l(t){return{x:t[0],y:t[1],x2:t[2],y2:t[3],w:t[2]-t[0],h:t[3]-t[1]}}var d,h,u=0,p=0,f=0,g=0;return{flipCoords:o,setPressed:t,setCurrent:e,getOffset:i,moveOffset:s,getCorner:a,getFixed:n}}(),ut=function(){function e(t,e){f.left.css({height:s(e)}),f.right.css({height:s(e)})}function i(){return a(ht.getFixed())}function a(t){f.top.css({left:s(t.x),width:s(t.w),height:s(t.y)}),f.bottom.css({top:s(t.y2),left:s(t.x),width:s(t.w),height:s(G-t.y2)}),f.right.css({left:s(t.x2),width:s(q-t.x2)}),f.left.css({width:s(t.x)})}function n(){return t("<div />").css({position:"absolute",backgroundColor:L.shadeColor||L.bgColor}).appendTo(p)}function r(){u||(u=!0,p.insertBefore(H),i(),pt.setBgOpacity(1,0,1),z.hide(),o(L.shadeColor||L.bgColor,1),pt.isAwake()?l(L.bgOpacity,1):l(1,1))}function o(t,e){P(h(),t,e)}function c(){u&&(p.remove(),z.show(),u=!1,pt.isAwake()?pt.setBgOpacity(L.bgOpacity,1,1):(pt.setBgOpacity(1,1,1),pt.disableHandles()),P(Y,0,1))}function l(t,e){u&&(L.bgFade&&!e?p.animate({opacity:1-t},{queue:!1,duration:L.fadeTime}):p.css({opacity:1-t}))}function d(){L.shade?r():c(),pt.isAwake()&&l(L.bgOpacity)}function h(){return p.children()}var u=!1,p=t("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:n(),left:n().height(G),right:n().height(G),bottom:n()};return{update:i,updateRaw:a,getShades:h,setBgColor:o,enable:r,disable:c,resize:e,refresh:d,opacity:l}}(),pt=function(){function e(e){var i=t("<div />").css({position:"absolute",opacity:L.borderOpacity}).addClass(a(e));return W.append(i),i}function i(e,i){var s=t("<div />").mousedown(p(e)).css({cursor:e+"-resize",position:"absolute",zIndex:i}).addClass("ord-"+e);return dt.support&&s.bind("touchstart.jcrop",dt.createDragger(e)),K.append(s),s}function n(t){var e=L.handleSize,s=i(t,k++).css({opacity:L.handleOpacity}).addClass(a("handle"));return e&&s.width(e).height(e),s}function r(t){return i(t,k++).addClass("jcrop-dragbar")}function o(t,e){L.shade||z.css({top:s(-e),left:s(-t)}),J.css({top:s(e),left:s(t)})}function c(t,e){J.width(Math.round(t)).height(Math.round(e))}function l(){var t=ht.getFixed();ht.setPressed([t.x,t.y]),ht.setCurrent([t.x2,t.y2]),d()}function d(t){if(x)return h(t)}function h(t){var e=ht.getFixed();c(e.w,e.h),o(e.x,e.y),L.shade&&ut.updateRaw(e),x||f(),t?L.onSelect.call(mt,g(e)):L.onChange.call(mt,g(e))}function u(t,e,i){(x||e)&&(L.bgFade&&!i?H.animate({opacity:t},{queue:!1,duration:L.fadeTime}):H.css("opacity",t))}function f(){J.show(),L.shade?ut.opacity(lt):u(lt,!0),x=!0}function m(){C(),J.hide(),L.shade?ut.opacity(1):u(1),x=!1,L.onRelease.call(mt)}function v(){I&&K.show()}function y(){if(I=!0,L.allowResize)return K.show(),!0}function C(){I=!1,K.hide()}function w(t){t?(at=!0,C()):(at=!1,y())}function T(){w(!1),l()}var x,k=370,E={},_={},D={},I=!1;L.dragEdges&&t.isArray(L.createDragbars)&&function(t){var e;for(e=0;e<t.length;e++)D[t[e]]=r(t[e])}(L.createDragbars),t.isArray(L.createHandles)&&function(t){var e;for(e=0;e<t.length;e++)_[t[e]]=n(t[e])}(L.createHandles),L.drawBorders&&t.isArray(L.createBorders)&&function(t){var i,s;for(s=0;s<t.length;s++){switch(t[s]){case"n":i="hline";break;case"s":i="hline bottom";break;case"e":i="vline right";break;case"w":i="vline"}E[t[s]]=e(i)}}(L.createBorders),t(document).bind("touchstart.jcrop-ios",function(e){t(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var S=b().mousedown(p("move")).css({cursor:"move",position:"absolute",zIndex:360});return dt.support&&S.bind("touchstart.jcrop",dt.createDragger("move")),W.append(S),C(),{updateVisible:d,update:h,release:m,refresh:l,isAwake:function(){return x},setCursor:function(t){S.css("cursor",t)},enableHandles:y,enableOnly:function(){I=!0},showHandles:v,disableHandles:C,animMode:w,setBgOpacity:u,done:T}}(),ft=function(){function e(e){ot.css({zIndex:450}),e?t(document).bind("touchmove.jcrop",r).bind("touchend.jcrop",c):u&&t(document).bind("mousemove.jcrop",s).bind("mouseup.jcrop",a)}function i(){ot.css({zIndex:290}),t(document).unbind(".jcrop")}function s(t){return d(o(t)),!1}function a(t){return t.preventDefault(),t.stopPropagation(),st&&(st=!1,h(o(t)),pt.isAwake()&&L.onSelect.call(mt,g(ht.getFixed())),i(),d=function(){},h=function(){}),!1}function n(t,i,s){return st=!0,d=t,h=i,e(s),!1}function r(t){return d(o(dt.cfilter(t))),!1}function c(t){return a(dt.cfilter(t))}function l(t){ot.css("cursor",t)}var d=function(){},h=function(){},u=L.trackDocument;return u||ot.mousemove(s).mouseup(a).mouseout(a),H.before(ot),{activateHandlers:n,setCursor:l}}(),gt=function(){function e(){L.keySupport&&(n.show(),n.focus())}function i(t){n.hide()}function s(t,e,i){L.allowMove&&(ht.moveOffset([e,i]),pt.updateVisible(!0)),t.preventDefault(),t.stopPropagation()}function a(t){if(t.ctrlKey||t.metaKey)return!0;nt=!!t.shiftKey;var e=nt?10:1;switch(t.keyCode){case 37:s(t,-e,0);break;case 39:s(t,e,0);break;case 38:s(t,0,-e);break;case 40:s(t,0,e);break;case 27:L.allowSelect&&pt.release();break;case 9:return!0}return!1}var n=t('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),r=t("<div />").css({position:"absolute",overflow:"hidden"}).append(n);return L.keySupport&&(n.keydown(a).blur(i),O||!L.fixedSupport?(n.css({position:"absolute",left:"-20px"}),r.append(n).insertBefore(H)):n.insertBefore(H)),{watchKeys:e}}();dt.support&&ot.bind("touchstart.jcrop",dt.newSelection),K.hide(),U(!0);var mt={setImage:$,animateTo:w,setSelect:T,setOptions:_,tellSelect:k,tellScaled:E,setClass:C,disable:D,enable:I,cancel:S,release:pt.release,destroy:M,focus:gt.watchKeys,getBounds:function(){return[q*et,G*it]},getWidgetSize:function(){return[q,G]},getScaleFactor:function(){return[et,it]},getOptions:function(){return L},ui:{holder:Y,selection:J}};return R&&Y.bind("selectstart",function(){return!1}),B.data("Jcrop",mt),mt},t.fn.Jcrop=function(e,i){var s;return this.each(function(){if(t(this).data("Jcrop")){if("api"===e)return t(this).data("Jcrop");t(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?t.Jcrop.Loader(this,function(){t(this).css({display:"block",visibility:"hidden"}),s=t.Jcrop(this,e),t.isFunction(i)&&i.call(s)}):(t(this).css({display:"block",visibility:"hidden"}),s=t.Jcrop(this,e),t.isFunction(i)&&i.call(s))}),this},t.Jcrop.Loader=function(e,i,s){function a(){r.complete?(n.unbind(".jcloader"),t.isFunction(i)&&i.call(r)):window.setTimeout(a,50)}var n=t(e),r=n[0];n.bind("load.jcloader",a).bind("error.jcloader",function(e){n.unbind(".jcloader"),t.isFunction(s)&&s.call(r)}),r.complete&&t.isFunction(i)&&(n.unbind(".jcloader"),i.call(r))},t.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(t){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery),function(t){var e=0,i=Array.prototype.slice;t.cleanData=function(e){return function(i){var s,a,n;for(n=0;null!=(a=i[n]);n++)try{(s=t._data(a,"events"))&&s.remove&&t(a).triggerHandler("remove")}catch(t){}e(i)}}(t.cleanData),t.widget=function(e,i,s){var a,n,r,o,c={},l=e.split(".")[0];return e=e.split(".")[1],a=l+"-"+e,s||(s=i,i=t.Widget),t.expr[":"][a.toLowerCase()]=function(e){return!!t.data(e,a)},t[l]=t[l]||{},n=t[l][e],r=t[l][e]=function(t,e){return this._createWidget?void(arguments.length&&this._createWidget(t,e)):new r(t,e)},t.extend(r,n,{version:s.version,_proto:t.extend({},s),_childConstructors:[]}),o=new i,o.options=t.widget.extend({},o.options),t.each(s,function(e,s){return t.isFunction(s)?void(c[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},a=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,n=this._superApply;return this._super=t,this._superApply=a,e=s.apply(this,arguments),this._super=i,this._superApply=n,e}}()):void(c[e]=s)}),r.prototype=t.widget.extend(o,{widgetEventPrefix:n?o.widgetEventPrefix||e:e},c,{constructor:r,namespace:l,widgetName:e,widgetFullName:a}),n?(t.each(n._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete n._childConstructors):i._childConstructors.push(r),t.widget.bridge(e,r),r},t.widget.extend=function(e){for(var s,a,n=i.call(arguments,1),r=0,o=n.length;o>r;r++)for(s in n[r])a=n[r][s],n[r].hasOwnProperty(s)&&void 0!==a&&(e[s]=t.isPlainObject(a)?t.isPlainObject(e[s])?t.widget.extend({},e[s],a):t.widget.extend({},a):a);return e},t.widget.bridge=function(e,s){var a=s.prototype.widgetFullName||e;t.fn[e]=function(n){var r="string"==typeof n,o=i.call(arguments,1),c=this;return r?this.each(function(){var i,s=t.data(this,a);return"instance"===n?(c=s,!1):s?t.isFunction(s[n])&&"_"!==n.charAt(0)?(i=s[n].apply(s,o),i!==s&&void 0!==i?(c=i&&i.jquery?c.pushStack(i.get()):i,!1):void 0):t.error("no such method '"+n+"' for "+e+" widget instance"):t.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+n+"'")}):(o.length&&(n=t.widget.extend.apply(null,[n].concat(o))),this.each(function(){var e=t.data(this,a);e?(e.option(n||{}),e._init&&e._init()):t.data(this,a,new s(n,this))})),c}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=e++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=t(),this.hoverable=t(),this.focusable=t(),s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this.options=t.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(e,i){var s,a,n,r=e;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof e)if(r={},s=e.split("."),e=s.shift(),s.length){for(a=r[e]=t.widget.extend({},this.options[e]),n=0;n<s.length-1;n++)a[s[n]]=a[s[n]]||{},a=a[s[n]];if(e=s.pop(),1===arguments.length)return void 0===a[e]?null:a[e];a[e]=i}else{if(1===arguments.length)return void 0===this.options[e]?null:this.options[e];r[e]=i}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!e),e&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(e,i,s){var a,n=this;"boolean"!=typeof e&&(s=i,i=e,e=!1),s?(i=a=t(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,a=this.widget()),t.each(s,function(s,r){function o(){return e||!0!==n.options.disabled&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?n[r]:r).apply(n,arguments):void 0}"string"!=typeof r&&(o.guid=r.guid=r.guid||o.guid||t.guid++);var c=s.match(/^([\w:-]*)\s*(.*)$/),l=c[1]+n.eventNamespace,d=c[2];d?a.delegate(d,l,o):i.bind(l,o)})},_off:function(e,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(i).undelegate(i),this.bindings=t(this.bindings.not(e).get()),this.focusable=t(this.focusable.not(e).get()),this.hoverable=t(this.hoverable.not(e).get())},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var a,n,r=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,s),!(t.isFunction(r)&&!1===r.apply(this.element[0],[i].concat(s))||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,a,n){"string"==typeof a&&(a={effect:a});var r,o=a?!0===a||"number"==typeof a?i:a.effect||i:e;a=a||{},"number"==typeof a&&(a={duration:a}),r=!t.isEmptyObject(a),a.complete=n,a.delay&&s.delay(a.delay),r&&t.effects&&t.effects.effect[o]?s[e](a):o!==e&&s[o]?s[o](a.duration,a.easing,n):s.queue(function(i){t(this)[e](),n&&n.call(s[0]),i()})}}),t.widget}(jQuery),function(t){"use strict";var e=0;t.ajaxTransport("iframe",function(i){if(i.async){var s,a,n,r=i.initialIframeSrc||"javascript:false;";return{send:function(o,c){s=t('<form style="display:none;"></form>'),s.attr("accept-charset",i.formAcceptCharset),n=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+n+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+n+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+n+"_method=PATCH",i.type="POST"),e+=1,a=t('<iframe src="'+r+'" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,n=t.isArray(i.paramName)?i.paramName:[i.paramName];a.unbind("load").bind("load",function(){var e;try{if(e=a.contents(),!e.length||!e[0].firstChild)throw new Error}catch(t){e=void 0}c(200,"success",{iframe:e}),t('<iframe src="'+r+'"></iframe>').appendTo(s),window.setTimeout(function(){s.remove()},0)}),s.prop("target",a.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&t.each(i.formData,function(e,i){t('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(s)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(e=i.fileInput.clone(),i.fileInput.after(function(t){return e[t]}),i.paramName&&i.fileInput.each(function(e){t(this).prop("name",n[e]||i.paramName)}),s.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),i.fileInput.removeAttr("form")),s.submit(),e&&e.length&&i.fileInput.each(function(i,s){var a=t(e[i]);t(s).prop("name",a.prop("name")).attr("form",a.attr("form")),a.replaceWith(s)})}),s.append(a).appendTo(document.body)},abort:function(){a&&a.unbind("load").prop("src",r),s&&s.remove()}}}}),t.ajaxSetup({converters:{"iframe text":function(e){return e&&t(e[0].body).text()},"iframe json":function(e){return e&&t.parseJSON(t(e[0].body).text())},"iframe html":function(e){return e&&t(e[0].body).html()},"iframe xml":function(e){var i=e&&e[0];return i&&t.isXMLDoc(i)?i:t.parseXML(i.XMLDocument&&i.XMLDocument.xml||t(i.body).html())},"iframe script":function(e){return e&&t.globalEval(t(e[0].body).text())}}})}(jQuery),function(t){"use strict";function e(e){var i="dragover"===e;return function(s){s.dataTransfer=s.originalEvent&&s.originalEvent.dataTransfer;var a=s.dataTransfer;a&&-1!==t.inArray("Files",a.types)&&!1!==this._trigger(e,t.Event(e,{delegatedEvent:s}))&&(s.preventDefault(),i&&(a.dropEffect="copy"))}}t.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||t('<input type="file">').prop("disabled")),t.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.widget("blueimp.fileupload",{options:{dropZone:t(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,i){return e=this.messages[e]||e.toString(),i&&t.each(i,function(t,i){e=e.replace("{"+t+"}",i)}),e},formData:function(t){return t.serializeArray()},add:function(e,i){return!e.isDefaultPrevented()&&void((i.autoUpload||!1!==i.autoUpload&&t(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:t.support.blobSlice&&function(){return(this.slice||this.webkitSlice||this.mozSlice).apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,i){var s=t-this.timestamp;return(!this.bitrate||!i||s>i)&&(this.bitrate=8*(e-this.loaded)*(1e3/s),this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"===t.type(e.formData)?e.formData(e.form):t.isArray(e.formData)?e.formData:"object"===t.type(e.formData)?(i=[],t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i):[]},_getTotal:function(e){var i=0;return t.each(e,function(t,e){i+=e.size||1}),i},_initProgressObject:function(e){var i={loaded:0,total:0,bitrate:0};e._progress?t.extend(e._progress,i):e._progress=i},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(e,i){if(e.lengthComputable){var s,a=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&a-i._time<i.progressInterval&&e.loaded!==e.total)return;i._time=a,s=Math.floor(e.loaded/e.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=s-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(a,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=s,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(a,s,i.bitrateInterval),this._trigger("progress",t.Event("progress",{delegatedEvent:e}),i),this._trigger("progressall",t.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(e){var i=this,s=e.xhr?e.xhr():t.ajaxSettings.xhr();s.upload&&(t(s.upload).bind("progress",function(t){var s=t.originalEvent;t.lengthComputable=s.lengthComputable,t.loaded=s.loaded,t.total=s.total,i._onProgress(t,e)}),e.xhr=function(){return s})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(e){var i,s=this,a=e.files[0],n=e.multipart||!t.support.xhrFileUpload,r="array"===t.type(e.paramName)?e.paramName[0]:e.paramName;e.headers=t.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),n&&!e.blob&&this._isInstanceOf("File",a)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(a.name)+'"'),n?t.support.xhrFormDataFileUpload&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:r,value:e.blob}):t.each(e.files,function(s,a){i.push({name:"array"===t.type(e.paramName)&&e.paramName[s]||r,value:a})})):(s._isInstanceOf("FormData",e.formData)?i=e.formData:(i=new FormData,t.each(this._getFormData(e),function(t,e){i.append(e.name,e.value)})),e.blob?i.append(r,e.blob,a.name):t.each(e.files,function(a,n){(s._isInstanceOf("File",n)||s._isInstanceOf("Blob",n))&&i.append("array"===t.type(e.paramName)&&e.paramName[a]||r,n,n.uploadName||n.name)})),e.data=i):(e.contentType=a.type||"application/octet-stream",e.data=e.blob||a),e.blob=null},_initIframeSettings:function(e){var i=t("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&i&&i!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(e){var i=t(e.fileInput),s=e.paramName;return s?t.isArray(s)||(s=[s]):(s=[],i.each(function(){for(var e=t(this),i=e.prop("name")||"files[]",a=(e.prop("files")||[1]).length;a;)s.push(i),a-=1}),s.length||(s=[i.prop("name")||"files[]"])),s},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===t.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var i=t.extend({},this.options,e);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,i,s){var a=t.Deferred(),n=a.promise();return i=i||this.options.context||n,!0===e?a.resolveWith(i,s):!1===e&&a.rejectWith(i,s),n.abort=a.promise,this._enhancePromise(n)},_addConvenienceMethods:function(e,i){var s=this,a=function(e){return t.Deferred().resolveWith(s,e).promise()};i.process=function(e,n){return(e||n)&&(i._processQueue=this._processQueue=(this._processQueue||a([this])).then(function(){return i.errorThrown?t.Deferred().rejectWith(s,[i]).promise():a(arguments)}).then(e,n)),this._processQueue||a([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=!1!==s._trigger("submit",t.Event("submit",{delegatedEvent:e}),this)&&s._onSend(e,this)),this.jqXHR||s._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",s._trigger("fail",null,this),s._getXHRPromise(!1))},i.state=function(){return this.jqXHR?s._getDeferredState(this.jqXHR):this._processQueue?s._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===s._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),i=e&&e.split("-"),s=i&&i.length>1&&parseInt(i[1],10);return s&&s+1},_chunkedUpload:function(e,i){e.uploadedBytes=e.uploadedBytes||0;var s,a,n=this,r=e.files[0],o=r.size,c=e.uploadedBytes,l=e.maxChunkSize||o,d=this._blobSlice,h=t.Deferred(),u=h.promise();return!(!(this._isXHRUpload(e)&&d&&(c||o>l))||e.data)&&(!!i||(c>=o?(r.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",r.error])):(a=function(){var i=t.extend({},e),u=i._progress.loaded;i.blob=d.call(r,c,c+l,r.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+c+"-"+(c+i.chunkSize-1)+"/"+o,n._initXHRData(i),n._initProgressListener(i),s=(!1!==n._trigger("chunksend",null,i)&&t.ajax(i)||n._getXHRPromise(!1,i.context)).done(function(s,r,l){c=n._getUploadedBytes(l)||c+i.chunkSize,u+i.chunkSize-i._progress.loaded&&n._onProgress(t.Event("progress",{lengthComputable:!0,loaded:c-i.uploadedBytes,total:c-i.uploadedBytes}),i),e.uploadedBytes=i.uploadedBytes=c,i.result=s,i.textStatus=r,i.jqXHR=l,n._trigger("chunkdone",null,i),n._trigger("chunkalways",null,i),o>c?a():h.resolveWith(i.context,[s,r,l])}).fail(function(t,e,s){i.jqXHR=t,i.textStatus=e,i.errorThrown=s,n._trigger("chunkfail",null,i),n._trigger("chunkalways",null,i),h.rejectWith(i.context,[t,e,s])})},this._enhancePromise(u),u.abort=function(){return s.abort()},a(),u)))},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(e,i,s,a){var n=a._progress.total,r=a._response;a._progress.loaded<n&&this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:n,total:n}),a),r.result=a.result=e,r.textStatus=a.textStatus=i,r.jqXHR=a.jqXHR=s,this._trigger("done",null,a)},_onFail:function(t,e,i,s){var a=s._response;s.recalculateProgress&&(this._progress.loaded-=s._progress.loaded,this._progress.total-=s._progress.total),a.jqXHR=s.jqXHR=t,a.textStatus=s.textStatus=e,a.errorThrown=s.errorThrown=i,this._trigger("fail",null,s)},_onAlways:function(t,e,i,s){this._trigger("always",null,s)},_onSend:function(e,i){i.submit||this._addConvenienceMethods(e,i);var s,a,n,r,o=this,c=o._getAJAXSettings(i),l=function(){return o._sending+=1,c._bitrateTimer=new o._BitrateTimer,s=s||((a||!1===o._trigger("send",t.Event("send",{delegatedEvent:e}),c))&&o._getXHRPromise(!1,c.context,a)||o._chunkedUpload(c)||t.ajax(c)).done(function(t,e,i){o._onDone(t,e,i,c)}).fail(function(t,e,i){o._onFail(t,e,i,c)}).always(function(t,e,i){if(o._onAlways(t,e,i,c),o._sending-=1,o._active-=1,c.limitConcurrentUploads&&c.limitConcurrentUploads>o._sending)for(var s=o._slots.shift();s;){if("pending"===o._getDeferredState(s)){s.resolve();break}s=o._slots.shift()}0===o._active&&o._trigger("stop")})};return this._beforeSend(e,c),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(n=t.Deferred(),this._slots.push(n),r=n.then(l)):(this._sequence=this._sequence.then(l,l),r=this._sequence),r.abort=function(){return a=[void 0,"abort","abort"],s?s.abort():(n&&n.rejectWith(c.context,a),l())},this._enhancePromise(r)):l()},_onAdd:function(e,i){var s,a,n,r,o=this,c=!0,l=t.extend({},this.options,i),d=i.files,h=d.length,u=l.limitMultiFileUploads,p=l.limitMultiFileUploadSize,f=l.limitMultiFileUploadSizeOverhead,g=0,m=this._getParamName(l),v=0;if(!h)return!1;if(p&&void 0===d[0].size&&(p=void 0),(l.singleFileUploads||u||p)&&this._isXHRUpload(l))if(l.singleFileUploads||p||!u)if(!l.singleFileUploads&&p)for(n=[],s=[],r=0;h>r;r+=1)g+=d[r].size+f,(r+1===h||g+d[r+1].size+f>p||u&&r+1-v>=u)&&(n.push(d.slice(v,r+1)),a=m.slice(v,r+1),a.length||(a=m),s.push(a),v=r+1,g=0);else s=m;else for(n=[],s=[],r=0;h>r;r+=u)n.push(d.slice(r,r+u)),a=m.slice(r,r+u),a.length||(a=m),s.push(a);else n=[d],s=[m];return i.originalFiles=d,t.each(n||d,function(a,r){var l=t.extend({},i);return l.files=n?r:[r],l.paramName=s[a],o._initResponseObject(l),o._initProgressObject(l),o._addConvenienceMethods(e,l),c=o._trigger("add",t.Event("add",{delegatedEvent:e}),l)}),c},_replaceFileInput:function(e){var i=e.fileInput,s=i.clone(!0),a=i.is(document.activeElement);e.fileInputClone=s,t("<form></form>").append(s)[0].reset(),i.after(s).detach(),a&&s.focus(),t.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,e){return e===i[0]?s[0]:e}),i[0]===this.element[0]&&(this.element=s)},_handleFileTreeEntry:function(e,i){var s,a=this,n=t.Deferred(),r=function(t){t&&!t.entry&&(t.entry=e),n.resolve([t])},o=function(t){a._handleFileTreeEntries(t,i+e.name+"/").done(function(t){n.resolve(t)}).fail(r)},c=function(){s.readEntries(function(t){t.length?(l=l.concat(t),c()):o(l)},r)},l=[];return i=i||"",e.isFile?e._file?(e._file.relativePath=i,n.resolve(e._file)):e.file(function(t){t.relativePath=i,n.resolve(t)},r):e.isDirectory?(s=e.createReader(),
c()):n.resolve([]),n.promise()},_handleFileTreeEntries:function(e,i){var s=this;return t.when.apply(t,t.map(e,function(t){return s._handleFileTreeEntry(t,i)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var i=e.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(t.map(i,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var i,s,a=e.prop("webkitEntries")||e.prop("entries");if(a&&a.length)return this._handleFileTreeEntries(a);if(i=t.makeArray(e.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&t.each(i,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(!(s=e.prop("value")))return t.Deferred().resolve([]).promise();i=[{name:s.replace(/^.*\\/,"")}]}return t.Deferred().resolve(i).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var i=this,s={fileInput:t(e.target),form:t(e.target.form)};this._getFileInputFiles(s.fileInput).always(function(a){s.files=a,i.options.replaceFileInput&&i._replaceFileInput(s),!1!==i._trigger("change",t.Event("change",{delegatedEvent:e}),s)&&i._onAdd(e,s)})},_onPaste:function(e){var i=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,s={files:[]};i&&i.length&&(t.each(i,function(t,e){var i=e.getAsFile&&e.getAsFile();i&&s.files.push(i)}),!1!==this._trigger("paste",t.Event("paste",{delegatedEvent:e}),s)&&this._onAdd(e,s))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var i=this,s=e.dataTransfer,a={};s&&s.files&&s.files.length&&(e.preventDefault(),this._getDroppedFiles(s).always(function(s){a.files=s,!1!==i._trigger("drop",t.Event("drop",{delegatedEvent:e}),a)&&i._onAdd(e,a)}))},_onDragOver:e("dragover"),_onDragEnter:e("dragenter"),_onDragLeave:e("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),t.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,i){var s=-1!==t.inArray(e,this._specialOptions);s&&this._destroyEventHandlers(),this._super(e,i),s&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_getRegExp:function(t){var e=t.split("/"),i=e.pop();return e.shift(),new RegExp(e.join("/"),i)},_isRegExpOption:function(e,i){return"url"!==e&&"string"===t.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var e=this,i=this.options,s=this.element.data();t.each(this.element[0].attributes,function(t,a){var n,r=a.name.toLowerCase();/^data-/.test(r)&&(r=r.slice(5).replace(/-[a-z]/g,function(t){return t.charAt(1).toUpperCase()}),n=s[r],e._isRegExpOption(r,n)&&(n=e._getRegExp(n)),i[r]=n)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var i=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,i._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var i,s,a=this,n=t.Deferred(),r=n.promise();return r.abort=function(){return s=!0,i?i.abort():(n.reject(null,"abort","abort"),r)},this._getFileInputFiles(e.fileInput).always(function(t){if(!s){if(!t.length)return void n.reject();e.files=t,i=a._onSend(null,e),i.then(function(t,e,i){n.resolve(t,e,i)},function(t,e,i){n.reject(t,e,i)})}}),this._enhancePromise(r)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}(jQuery),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):e(t.jQuery)}(this,function(t){"use strict";function e(e){if(a.webkit&&!e)return{height:0,width:0};if(!a.data.outer){var i={border:"none","box-sizing":"content-box",height:"200px",margin:"0",padding:"0",width:"200px"};a.data.inner=t("<div>").css(t.extend({},i)),a.data.outer=t("<div>").css(t.extend({left:"-1000px",overflow:"scroll",position:"absolute",top:"-1000px"},i)).append(a.data.inner).appendTo("body")}return a.data.outer.scrollLeft(1e3).scrollTop(1e3),{height:Math.ceil(a.data.outer.offset().top-a.data.inner.offset().top||0),width:Math.ceil(a.data.outer.offset().left-a.data.inner.offset().left||0)}}function i(){var t=e(!0);return!(t.height||t.width)}function s(t){var e=t.originalEvent;return(!e.axis||e.axis!==e.HORIZONTAL_AXIS)&&!e.wheelDeltaX}var a={data:{index:0,name:"scrollbar"},macosx:/mac/i.test(navigator.platform),mobile:/android|webos|iphone|ipad|ipod|blackberry/i.test(navigator.userAgent),overlay:null,scroll:null,scrolls:[],webkit:/webkit/i.test(navigator.userAgent)&&!/edge\/\d+/i.test(navigator.userAgent)};a.scrolls.add=function(t){this.remove(t).push(t)},a.scrolls.remove=function(e){for(;t.inArray(e,this)>=0;)this.splice(t.inArray(e,this),1);return this};var n={autoScrollSize:!0,autoUpdate:!0,debug:!1,disableBodyScroll:!1,duration:200,ignoreMobile:!1,ignoreOverlay:!1,scrollStep:30,showArrows:!1,stepScrolling:!0,scrollx:null,scrolly:null,onDestroy:null,onInit:null,onScroll:null,onUpdate:null},r=function(s){a.scroll||(a.overlay=i(),a.scroll=e(),c(),t(window).resize(function(){var t=!1;if(a.scroll&&(a.scroll.height||a.scroll.width)){var i=e();i.height===a.scroll.height&&i.width===a.scroll.width||(a.scroll=i,t=!0)}c(t)})),this.container=s,this.namespace=".scrollbar_"+a.data.index++,this.options=t.extend({},n,window.jQueryScrollbarOptions||{}),this.scrollTo=null,this.scrollx={},this.scrolly={},s.data(a.data.name,this),a.scrolls.add(this)};r.prototype={destroy:function(){if(this.wrapper){this.container.removeData(a.data.name),a.scrolls.remove(this);var e=this.container.scrollLeft(),i=this.container.scrollTop();this.container.insertBefore(this.wrapper).css({height:"",margin:"","max-height":""}).removeClass("scroll-content scroll-scrollx_visible scroll-scrolly_visible").off(this.namespace).scrollLeft(e).scrollTop(i),this.scrollx.scroll.removeClass("scroll-scrollx_visible").find("div").andSelf().off(this.namespace),this.scrolly.scroll.removeClass("scroll-scrolly_visible").find("div").andSelf().off(this.namespace),this.wrapper.remove(),t(document).add("body").off(this.namespace),t.isFunction(this.options.onDestroy)&&this.options.onDestroy.apply(this,[this.container])}},init:function(e){var i=this,n=this.container,r=this.containerWrapper||n,o=this.namespace,c=t.extend(this.options,e||{}),l={x:this.scrollx,y:this.scrolly},d=this.wrapper,h={scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop()};if(a.mobile&&c.ignoreMobile||a.overlay&&c.ignoreOverlay||a.macosx&&!a.webkit)return!1;if(d)r.css({height:"auto","margin-bottom":-1*a.scroll.height+"px","margin-right":-1*a.scroll.width+"px","max-height":""});else{if(this.wrapper=d=t("<div>").addClass("scroll-wrapper").addClass(n.attr("class")).css("position","absolute"==n.css("position")?"absolute":"relative").insertBefore(n).append(n),n.is("textarea")&&(this.containerWrapper=r=t("<div>").insertBefore(n).append(n),d.addClass("scroll-textarea")),r.addClass("scroll-content").css({height:"auto","margin-bottom":-1*a.scroll.height+"px","margin-right":-1*a.scroll.width+"px","max-height":""}),n.on("scroll"+o,function(e){t.isFunction(c.onScroll)&&c.onScroll.call(i,{maxScroll:l.y.maxScrollOffset,scroll:n.scrollTop(),size:l.y.size,visible:l.y.visible},{maxScroll:l.x.maxScrollOffset,scroll:n.scrollLeft(),size:l.x.size,visible:l.x.visible}),l.x.isVisible&&l.x.scroll.bar.css("left",n.scrollLeft()*l.x.kx+"px"),l.y.isVisible&&l.y.scroll.bar.css("top",n.scrollTop()*l.y.kx+"px")}),d.on("scroll"+o,function(){d.scrollTop(0).scrollLeft(0)}),c.disableBodyScroll){var u=function(t){s(t)?l.y.isVisible&&l.y.mousewheel(t):l.x.isVisible&&l.x.mousewheel(t)};d.on("MozMousePixelScroll"+o,u),d.on("mousewheel"+o,u),a.mobile&&d.on("touchstart"+o,function(e){var i=e.originalEvent.touches&&e.originalEvent.touches[0]||e,s={pageX:i.pageX,pageY:i.pageY},a={left:n.scrollLeft(),top:n.scrollTop()};t(document).on("touchmove"+o,function(t){var e=t.originalEvent.targetTouches&&t.originalEvent.targetTouches[0]||t;n.scrollLeft(a.left+s.pageX-e.pageX),n.scrollTop(a.top+s.pageY-e.pageY),t.preventDefault()}),t(document).on("touchend"+o,function(){t(document).off(o)})})}t.isFunction(c.onInit)&&c.onInit.apply(this,[n])}t.each(l,function(e,a){var r=null,d=1,h="x"===e?"scrollLeft":"scrollTop",u=c.scrollStep,p=function(){var t=n[h]();n[h](t+u),1==d&&t+u>=f&&(t=n[h]()),-1==d&&t+u<=f&&(t=n[h]()),n[h]()==t&&r&&r()},f=0;a.scroll||(a.scroll=i._getScroll(c["scroll"+e]).addClass("scroll-"+e),c.showArrows&&a.scroll.addClass("scroll-element_arrows_visible"),a.mousewheel=function(t){if(!a.isVisible||"x"===e&&s(t))return!0;if("y"===e&&!s(t))return l.x.mousewheel(t),!0;var r=-1*t.originalEvent.wheelDelta||t.originalEvent.detail,o=a.size-a.visible-a.offset;return(r>0&&f<o||r<0&&f>0)&&(f+=r,f<0&&(f=0),f>o&&(f=o),i.scrollTo=i.scrollTo||{},i.scrollTo[h]=f,setTimeout(function(){i.scrollTo&&(n.stop().animate(i.scrollTo,240,"linear",function(){f=n[h]()}),i.scrollTo=null)},1)),t.preventDefault(),!1},a.scroll.on("MozMousePixelScroll"+o,a.mousewheel).on("mousewheel"+o,a.mousewheel).on("mouseenter"+o,function(){f=n[h]()}),a.scroll.find(".scroll-arrow, .scroll-element_track").on("mousedown"+o,function(s){if(1!=s.which)return!0;d=1;var o={eventOffset:s["x"===e?"pageX":"pageY"],maxScrollValue:a.size-a.visible-a.offset,scrollbarOffset:a.scroll.bar.offset()["x"===e?"left":"top"],scrollbarSize:a.scroll.bar["x"===e?"outerWidth":"outerHeight"]()},l=0,g=0;return t(this).hasClass("scroll-arrow")?(d=t(this).hasClass("scroll-arrow_more")?1:-1,u=c.scrollStep*d,f=d>0?o.maxScrollValue:0):(d=o.eventOffset>o.scrollbarOffset+o.scrollbarSize?1:o.eventOffset<o.scrollbarOffset?-1:0,u=Math.round(.75*a.visible)*d,f=o.eventOffset-o.scrollbarOffset-(c.stepScrolling?1==d?o.scrollbarSize:0:Math.round(o.scrollbarSize/2)),f=n[h]()+f/a.kx),i.scrollTo=i.scrollTo||{},i.scrollTo[h]=c.stepScrolling?n[h]()+u:f,c.stepScrolling&&(r=function(){f=n[h](),clearInterval(g),clearTimeout(l),l=0,g=0},l=setTimeout(function(){g=setInterval(p,40)},c.duration+100)),setTimeout(function(){i.scrollTo&&(n.animate(i.scrollTo,c.duration),i.scrollTo=null)},1),i._handleMouseDown(r,s)}),a.scroll.bar.on("mousedown"+o,function(s){if(1!=s.which)return!0;var r=s["x"===e?"pageX":"pageY"],c=n[h]();return a.scroll.addClass("scroll-draggable"),t(document).on("mousemove"+o,function(t){var i=parseInt((t["x"===e?"pageX":"pageY"]-r)/a.kx,10);n[h](c+i)}),i._handleMouseDown(function(){a.scroll.removeClass("scroll-draggable"),f=n[h]()},s)}))}),t.each(l,function(t,e){var i="scroll-scroll"+t+"_visible",s="x"==t?l.y:l.x;e.scroll.removeClass(i),s.scroll.removeClass(i),r.removeClass(i)}),t.each(l,function(e,i){t.extend(i,"x"==e?{offset:parseInt(n.css("left"),10)||0,size:n.prop("scrollWidth"),visible:d.width()}:{offset:parseInt(n.css("top"),10)||0,size:n.prop("scrollHeight"),visible:d.height()})}),this._updateScroll("x",this.scrollx),this._updateScroll("y",this.scrolly),t.isFunction(c.onUpdate)&&c.onUpdate.apply(this,[n]),t.each(l,function(t,e){var i="x"===t?"left":"top",s="x"===t?"outerWidth":"outerHeight",a="x"===t?"width":"height",r=parseInt(n.css(i),10)||0,o=e.size,l=e.visible+r,d=e.scroll.size[s]()+(parseInt(e.scroll.size.css(i),10)||0);c.autoScrollSize&&(e.scrollbarSize=parseInt(d*l/o,10),e.scroll.bar.css(a,e.scrollbarSize+"px")),e.scrollbarSize=e.scroll.bar[s](),e.kx=(d-e.scrollbarSize)/(o-l)||1,e.maxScrollOffset=o-l}),n.scrollLeft(h.scrollLeft).scrollTop(h.scrollTop).trigger("scroll")},_getScroll:function(e){var i={advanced:['<div class="scroll-element">','<div class="scroll-element_corner"></div>','<div class="scroll-arrow scroll-arrow_less"></div>','<div class="scroll-arrow scroll-arrow_more"></div>','<div class="scroll-element_outer">','<div class="scroll-element_size"></div>','<div class="scroll-element_inner-wrapper">','<div class="scroll-element_inner scroll-element_track">','<div class="scroll-element_inner-bottom"></div>',"</div>","</div>",'<div class="scroll-bar">','<div class="scroll-bar_body">','<div class="scroll-bar_body-inner"></div>',"</div>",'<div class="scroll-bar_bottom"></div>','<div class="scroll-bar_center"></div>',"</div>","</div>","</div>"].join(""),simple:['<div class="scroll-element">','<div class="scroll-element_outer">','<div class="scroll-element_size"></div>','<div class="scroll-element_track"></div>','<div class="scroll-bar"></div>',"</div>","</div>"].join("")};return i[e]&&(e=i[e]),e||(e=i.simple),e="string"==typeof e?t(e).appendTo(this.wrapper):t(e),t.extend(e,{bar:e.find(".scroll-bar"),size:e.find(".scroll-element_size"),track:e.find(".scroll-element_track")}),e},_handleMouseDown:function(e,i){var s=this.namespace;return t(document).on("blur"+s,function(){t(document).add("body").off(s),e&&e()}),t(document).on("dragstart"+s,function(t){return t.preventDefault(),!1}),t(document).on("mouseup"+s,function(){t(document).add("body").off(s),e&&e()}),t("body").on("selectstart"+s,function(t){return t.preventDefault(),!1}),i&&i.preventDefault(),!1},_updateScroll:function(e,i){var s=this.container,n=this.containerWrapper||s,r="scroll-scroll"+e+"_visible",o="x"===e?this.scrolly:this.scrollx,c=parseInt(this.container.css("x"===e?"left":"top"),10)||0,l=this.wrapper,d=i.size,h=i.visible+c;i.isVisible=d-h>1,i.isVisible?(i.scroll.addClass(r),o.scroll.addClass(r),n.addClass(r)):(i.scroll.removeClass(r),o.scroll.removeClass(r),n.removeClass(r)),"y"===e&&(s.is("textarea")||d<h?n.css({height:h+a.scroll.height+"px","max-height":"none"}):n.css({"max-height":h+a.scroll.height+"px"})),i.size==s.prop("scrollWidth")&&o.size==s.prop("scrollHeight")&&i.visible==l.width()&&o.visible==l.height()&&i.offset==(parseInt(s.css("left"),10)||0)&&o.offset==(parseInt(s.css("top"),10)||0)||(t.extend(this.scrollx,{offset:parseInt(s.css("left"),10)||0,size:s.prop("scrollWidth"),visible:l.width()}),t.extend(this.scrolly,{offset:parseInt(s.css("top"),10)||0,size:this.container.prop("scrollHeight"),visible:l.height()}),this._updateScroll("x"===e?"y":"x",o))}};var o=r;t.fn.scrollbar=function(e,i){return"string"!=typeof e&&(i=e,e="init"),void 0===i&&(i=[]),t.isArray(i)||(i=[i]),this.not("body, .scroll-wrapper").each(function(){var s=t(this),n=s.data(a.data.name);(n||"init"===e)&&(n||(n=new o(s)),n[e]&&n[e].apply(n,i))}),this},t.fn.scrollbar.options=n;var c=function(){var t=0,e=0;return function(i){var s,n,r,o,l,d,h;for(s=0;s<a.scrolls.length;s++)o=a.scrolls[s],n=o.container,r=o.options,l=o.wrapper,d=o.scrollx,h=o.scrolly,(i||r.autoUpdate&&l&&l.is(":visible")&&(n.prop("scrollWidth")!=d.size||n.prop("scrollHeight")!=h.size||l.width()!=d.visible||l.height()!=h.visible))&&(o.init(),r.debug&&(window.console&&console.log({scrollHeight:n.prop("scrollHeight")+":"+o.scrolly.size,scrollWidth:n.prop("scrollWidth")+":"+o.scrollx.size,visibleHeight:l.height()+":"+o.scrolly.visible,visibleWidth:l.width()+":"+o.scrollx.visible},!0),e++));clearTimeout(t),t=setTimeout(c,300)}}();window.angular&&function(t){t.module("jQueryScrollbar",[]).provider("jQueryScrollbar",function(){var e=n;return{setOptions:function(i){t.extend(e,i)},$get:function(){return{options:t.copy(e)}}}}).directive("jqueryScrollbar",["jQueryScrollbar","$parse",function(t,e){return{restrict:"AC",link:function(i,s,a){var n=e(a.jqueryScrollbar),r=n(i);s.scrollbar(r||t.options).on("$destroy",function(){s.scrollbar("destroy")})}}}])}(window.angular)}),"_PAGE"in window&&_PAGE.token?$.ajaxSettings.beforeSend=function(t,e){t.setRequestHeader("token",_PAGE.token)}:"_PAGE"in window.top&&window.top._PAGE.token&&($.ajaxSettings.beforeSend=function(t,e){t.setRequestHeader("token",window.top._PAGE.token)}),$.ajaxSettings.statusCode={200:function(){},602:function(){window.top.location.href="/logout/"},603:function(){window.top.location.href="/geek/complete/guide.html"}};var mediator=mediator||new EventManger,CoopAssist=function(){var t=null;return{move:function(e,i){t=e,Menu.sideEl.find(".menu-colleague a").attr("data-url","/enterprise/colleague/list.html?uid="+t+"&name="+encodeURIComponent(i)).click()},getId:function(){return t},clear:function(){t=null}}}();!function(){var t,e={get:{remarks:function(t){var e=$.Deferred();return $.get("/enterprise/remark/listdata.json",t).success(function(t){1==t.rescode?(t.data=t.data||[],t.total=t.data.length,e.resolve(t)):(alert(t.resmsg),e.reject(t))}).error(function(){e.reject()}),e},colleague:function(t){var e=$.Deferred();return $.get("/boss/share/geek/matelist.json",t).success(function(t){if(1==t.rescode){var i={page:t.data.page,hasMore:t.data.hasMore,mateList:t.data.mateList,resume:t.resume,history:t.history||{portrait:"/v2/web/boss/images/figure.png",name:""},records:t.records||!0,canShareMsg:t.canShareMsg};e.resolve(i)}else e.reject(t),alert(t.resmsg)}).error(function(){e.reject()}),e}},post:{remarks:function(t){var e=$.Deferred();return $.post("/enterprise/remark/publish.json",t).success(function(t){1==t.rescode?e.resolve(t.data):(alert(t.resmsg),e.reject(t.data))}).error(function(t){e.reject()}),e},remove:function(t){var e=$.Deferred();return $.post("/enterprise/remark/delete.json",t).success(function(t){1==t.rescode?e.resolve(t.resmsg):alert(t.resmsg)}),e},forward:function(t){var e=$.Deferred();return $.post("/chat/shareGeek.json",t).success(function(t){1==t.rescode?e.resolve(t.resmsg):alert(t.resmsg)}),e}}},i=function(t){for(var e=0;e<t.data.length;e++)t.data[e].title=t.data[e].title.replace(/</g,"&#60;").replace(/>/g,"&#62;"),t.data[e].remarks=t.data[e].remarks.replace(/</g,"&#60;").replace(/>/g,"&#62;");return Utemplate('<%if(this.total != 0 && this.total != this.data.length){%><p class="remarks-total"><a href="javascript:;">显示全部（<span><%this.total%></span>条）</a></p><%}%><ul><%for(var i=0;i<this.data.length;i++) {%><li><img src="<%this.data[i].portrait%>"><div><p class="action"><%this.data[i].title%></p><%if(this.data[i].remarks != ""){%><p class="gray"><%this.data[i].remarks%></p><%}%><p class="operat"><%this.data[i].date%><%if(this.data[i].operation) {%><a href="javascript:;" data-id="<%this.data[i].id%>">删除</a><%}%></p></div></li><%}%></ul>',t)},s=function(t){return Utemplate('<div class="coop-portrait"><img src="<%this.history.portrait%>" /><%if(this.history.name == ""){%><%}%><p>转发牛人<span><%if(this.history.name != ""){%>给 <%}%><%this.history.name%></span></p></div><p class="showInput"><a href="javascript:">选择BOSS</a></p><div class="coop-search"><div class="coop-input"><input class="ipt" placeholder="姓名、职位、邮箱" type="text" name=""><i class="coop-icon-search"></i><i class="icon-selecter-close"></i></div><div class="dl-lists"><dl></dl><div class="dl-loadmore">正在加载</div></div></div><textarea placeholder="请输入转发留言"></textarea><ul class="check-list"><%if(this.records && this.canShareMsg){%><li><label class="checkbox"><input type="checkbox" checked name="coop-chat" value="manual"/><span>连同聊天记录一并转发</span></label></li><%}%><%if(this.resume){%><li><label class="checkbox"><input type="checkbox" checked name="coop-resume" value="manual"/><span>将获得的附件简历一并转发</span></label></li><%}%></ul><div style="text-align:center;"><a ka="geek_coop_forward" class="btn btn-forward" style="width:60px;margin-right:0;" href="javascript:;">转发</a></div>',t)},a=function(t){if(t.cooperate<1)return'<div class="coop-forward coop-wrap only"></div><div class="coop-pop-footer"><a ka="geek_coop_forwar_tab" data-wrap="coop-forward" data-wrap="coop-remarks" class="forward active" href="javascript:;">转发给同事</a></div>';return'<div class="coop-intro coop-wrap"><h3>在这里您可以 </h3><p>把ta转发给同事，<br />对ta进行备注并且和同事共享，<br />了解同事是否和ta已经 沟通过。</p><a href="/chat/im?mu=/enterprise/colleague/list.html">管理我的同事<i class="arrow-right"></i></a></div><div class="coop-forward coop-wrap"></div><div class="coop-remarks coop-wrap"><div class="remark-list"></div><div class="remarks-btns remarks-oprate"><a href="javascript:" class="showRemark">写备注</a></div><div class="remarks-submit"><ul><li><img class="cur_portrait" style="margin-top:0;" src=""><div class="remarks-textarea"><textarea placeholder="请输入备注信息"></textarea></div></li></ul><div class="remark-bnts"><span class="gray"><i class="text-count">0</i>/50</span><a ka="geek_coop_remark_save" class="fr btn saveRemark" href="javascript:;">保存</a><a ka="geek_coop_remark_cancel" class="fr btn btn-slight cancelRemark" href="javascript:;">取消</a></div></div></div><div class="coop-pop-footer"><a ka="geek_coop_info_tab" data-wrap="coop-intro" class="descrip" href="javascript:;"></a><a ka="geek_coop_forwar_tab" data-wrap="coop-forward" data-wrap="coop-remarks" class="forward" href="javascript:;">转发给同事</a><a ka="geep_coop_remark_tab" data-wrap="coop-remarks" data-wrap="coop-remarks" class="remark active" href="javascript:;">备注</a></div>'},n=function(t){var t={data:t};return Utemplate('<%if(!this.data){%><dt class="gray blank">没有符合条件的同事</dt><dd class="tip"><span>1. 同事的公司全称需与您一致</span><span>2. 同事需发布至少一个在线职位</span><span>3. 确保你输入的搜索信息与该同事的信息一致</span></dd><%}%><%if(this.data){%><%for(var i=0;i<this.data.length;i++){%><dd data-id="<%this.data[i].encryptUserId%>"><%this.data[i].name%><em class="vline"></em><%this.data[i].title%><em class="vline"></em><%this.data[i].mail%><%if(this.data[i].mail ==""){%>-<%}%></dd><%}%><%}%>',t)},r=function(t){var i=this,s={},a={add:!1,remove:!1},n=function(){return{total:s.data.length,data:s.data.filter(function(t){return t.star||1==t.own})}},r=function(t){for(var e=0;e<s.data.length;e++)s.data[e].id==t&&s.data.splice(e,1)};this.add=function(i){if(a.add)return!1;a.add=!0,e.post.remarks(i).then(function(e){s.data=s.data||[],s.data.push(e),t.publish("REMARKS_CHANGED",{action:"add"}),a.add=!1},function(){a.add=!1})},this.remove=function(i){if(a.remove)return!1;a.remove=!0,e.post.remove(i).then(function(){r(i.remarkId),t.publish("REMARKS_CHANGED",{action:"remove"}),a.remove=!1},function(){a.remove=!1})},this.star=function(t,a,r){if(s.data&&!a)return r(n());e.get.remarks({geek:t.geek}).then(function(e){return 1==e.rescode?(s=e,n().data.length>0?r(n()):i.all(t,!1,r)):r({total:0,data:[]})},function(){return r({error:!0})})},this.all=function(t,e,i){return i({total:s.data.length,data:s.data})}},o=function(e,s){function a(t){var s=$(".remark-list");t&&"add"==t.action&&$(".coop-remarks .remarks-textarea textarea").val("").trigger("input");var a=function(t){t.total>0?$(".icon-coop[data-uid='"+n.geekId+"']").addClass("fill"):$(".icon-coop[data-uid='"+n.geekId+"']").removeClass("fill")};(r?e.star:e.all)(n,!1,function(t){s.empty().html(i(t)),a(t),s.scrollTop(s.find("ul").height())})}var n={},r=!0,o=function(i){i.find(".remark-list");i.on("click",".remarks-total a",function(){r=!1,a()}),i.on("click",".remark-list .operat a",function(){e.remove({remarkId:$(this).attr("data-id"),geek:n.geek})}),i.on("click",".link-op",function(){t.close(),CoopAssist.move($(this).attr("data-id"),$(this).text())}),i.on("click",".showRemark",function(){i.find(".remarks-oprate").hide(),i.find(".remarks-submit").show(),i.find(".remark-list").css("max-height",244).scrollTop(i.find(".remark-list ul").height())}),i.on("click",".cancelRemark",function(){i.find(".remark-list li").length>0&&(i.find(".remarks-oprate").show(),i.find(".remarks-submit").hide(),i.find(".remark-list").css("max-height",364)),i.find(".remarks-textarea textarea").val("").trigger("input")}),i.on("click",".saveRemark",function(){var t=$.trim(i.find(".remarks-textarea textarea").val());if(""==t)return alert("请填写备注信息"),!1;if($(this).hasClass("disabled"))return!1;var s=t.replace(/\n/g,"<br/>").replace(/\s/g,"&nbsp;"),a={remark:s,geek:n.geek};e.add(a)}),i.on("input",".remarks-textarea textarea",function(){var t=PageSet.getLength($(this).val().trim()),e=$(".coop-remarks .text-count");t>50?(e.text(t).addClass("red"),i.find(".saveRemark").addClass("disabled")):(e.text(t).removeClass("red"),i.find(".saveRemark").removeClass("disabled"))})};s.subscribe("REMARKS_CHANGED",a),this.render=function(t,s){n=s,$(".cur_portrait").attr("src",window.top.$(".side-menu .figure img").attr("src")),o(t),e.star(n,!0,function(e){try{var s="funcn_click_"+e.total;_T.sendEvent(s)}catch(t){}return e.error?(t.find(".coop-remarks").html("<p style='padding-bottom: 30px;'>加载错误<br></p>"),!1):0==e.total?($(".coop-pop-footer .descrip").trigger("click"),t.find(".showRemark").trigger("click"),!1):(t.find(".coop-remarks .remark-list").html(i(e)),void $(".remark-list").scrollTop($(".remark-list ul").height()))})}},c=function(){var t,i=!1,a={},r=!1,o=[],c={},l={forward:!1},d=this,h=function(t,e){var i=function(e){var i=e,s=new RegExp(t,"g");return $.each(i,function(e){i[e]=i[e].replace(s,'<u class="h">'+t+"</u>")}),i.join('<em class="vline"></em>')};$.each(e,function(){var t=$(this).html().split('<em class="vline"></em>');t.length>1&&$(this).html(i(t))})},u=function(t){var e=t,i=$(n(e));a.$query&&h(a.$query,i),a.mateList&&a.mateList.length?$(".coop-forward .coop-search dl").append(i):$(".coop-forward .coop-search dl").empty().html(i)},p=function(t){for(var e,i=0;i<o.length;i++)o[i].encryptUserId==t&&(e=o[i]);return e};this.isVisiable=function(t){var e=t.getBoundingClientRect();return e.top>0&&window.innerHeight-e.top>0||e.top<=0&&e.bottom>=0};var f=function(t,e){var i=["正在加载","没有更多了","加载更多"],s=$(".coop-forward .coop-search .dl-loadmore");e?s.hide():s.html(i[t]).show()},g=function(){a.mateList=new Array,a.$query="",d.__isLoading=!1,d.__hasMore=!0,d.__page=1,o=[],$(".coop-forward .coop-search dl").empty()},m=function(){if(d.__hasMore&&!d.__isLoading){f(0,!0),d.__isLoading=!0;var t=$.Deferred(),i={geek:d.geekId,page:d.__page,query:a.$query.toLowerCase()};return e.get.colleague(i).then(function(e){if(t.resolve(e),d.__page=e.page+1,d.__hasMore=e.hasMore,d.__isLoading=!1,r=!1,e.mateList&&e.mateList.length)for(var i=0;i<e.mateList.length;i++)o.push(e.mateList[i]);a=$.extend(a,e)},function(){t.reject(),d.__isLoading=!1}),t}},v=function(){m().then(function(t){u(t.mateList);var e=t.hasMore?2:1;t.mateList?f(e):f(0,!0)})},y=function(i){var i=i.find(".coop-forward");i.off();var s=i.find(".coop-input input");i.on("focus",".coop-input input",function(){r=!0;var t=$(this).val();g(),a.$query=t,v(),i.find(".coop-search .dl-lists").show(),t.length>0?(i.find(".coop-icon-search").hide(),i.find(".icon-selecter-close").show()):(i.find(".coop-icon-search").show(),i.find(".icon-selecter-close").hide())}),i.on("click",".showInput a",function(t){return $(".showInput").hide(),$(".coop-search").show(),$(".coop-search .coop-input input").focus(),t.preventDefault(),!1}),i.on("click",function(){i.find(".showInput").show(),i.find(".coop-search").hide()}),i.on("click",".coop-search",function(t){return t.preventDefault(),!1}),i.on("click",".coop-search dd:not(.tip)",function(t){var e=p($(this).attr("data-id"));return a.history=e,s.val(e.name),i.find(".coop-portrait img").attr("src",e.portrait),i.find(".coop-portrait span").text("给 "+e.name),$(".showInput").show(),$(".coop-search").hide(),t.preventDefault(),!1}),i.on("input",".coop-input input",function(){var t=$(this).val().trim();t.length>0?(i.find(".coop-icon-search").hide(),i.find(".icon-selecter-close").show()):(i.find(".coop-icon-search").show(),i.find(".icon-selecter-close").hide()),g(),a.$query=t,v()}),i.on("click",".icon-selecter-close",function(){i.find(".coop-icon-search").show(),i.find(".icon-selecter-close").hide(),s.val(""),g(),v()}),i.on("click",".btn-forward",function(){if(!a.history.encryptUserId)return alert("请选择一位同事"),!1;if(l.forward)return!1;l.forward=!0;var i=$(".coop-forward textarea").val().trim(),s={toId:a.history.encryptUserId,geekId:c.geekId,expectId:c.expectId,shareNote:i,canShareMsg:$("input[name='coop-chat']").is(":checked")?1:0,shareResume:$("input[name='coop-resume']").is(":checked")?1:0};e.post.forward(s).then(function(){Prompt("转发成功",1),t&&t.close(),l.forward=!1},function(){l.forward=!1})}),i.find(".coop-search .dl-lists").off("scroll").on("scroll",function(){r||(d.timer&&clearTimeout(d.timer),d.timer=setTimeout(function(){var t=$(".coop-forward .coop-search .dl-loadmore").get(0);!d.__isLoading&&d.isVisiable(t)&&d.__hasMore&&v()},200))})};this.render=function(n,r,l){c=$.extend({},r),t=l,d.geekId=c.geek,d.__isLoading=!1,d.__hasMore=!0,d.__page=1,a.$query="",e.get.colleague({geek:c.geek,page:d.__page}).then(function(t){a=$.extend({},t),o=t.mateList,n.find(".coop-forward").html(s(a)),y(n),u(a.mateList);var e=t.hasMore?2:1;t.mateList?f(e):f(0,!0)},function(){n.find(".coop-forward").html("<p style='padding-bottom: 30px;'>加载错误<br></p>")}),i=!0}},l=new EventManger,d=new r(l),h=new o(d,l),u=new c;mediator.subscribe("COOP_POP_INIT",function(e){var i=$.extend({},e);t=$.confirm({title:!1,content:a(i),columnClass:"coop-stage pop-stage prop-pop",closeIcon:!0,cancelButton:!1,confirmButton:!1,onOpen:function(){var t=this,e=this.$content;e.find(".coop-pop-footer a").off("click").on("click",function(){var s=$(this).attr("data-wrap");e.find(".coop-wrap").hide(),$("."+s).show(),e.find(".coop-pop-footer .active").removeClass("active"),$(this).addClass("active"),"coop-forward"==s&&u.render(e,i,t)}),i.cooperate>0?h.render(e,i):u.render(e,i,t)}})}),$(document).ready(function(){$(document).on("click",".icon-coop",function(){var t=$(this);t.closest("#recommend-list").length&&localStorageInstance("recommend-pos",$("#container").scrollTop()),t.attr("data-uid")&&""!=t.attr("data-uid")&&mediator.publish("COOP_POP_INIT",{geek:t.attr("data-eid"),geekId:t.attr("data-eid"),expectId:t.attr("data-expect"),cooperate:parseInt(t.attr("data-cooperate"),10),el:t})})})}();var Counselor=function(){var t,e,i=[],s={},a=0,n=function(t){return("0"+t).substr(-2,2)},r=function(t){var e=new Date(t.time),i={id:t.mid,time:t.time,content:t.body.text,read:!1,date:n(e.getMonth()+1)+"-"+n(e.getDate()),clock:n(e.getHours())+":"+n(e.getMinutes())};return 990===t.from.uid?t.body.text.indexOf("请对我的服务评价")>-1?i.type="grade":i.type="received":i.type="send",i},o=function(t){var e;return e=(new Date).getTime()-t>864e5?"MM-dd hh:mm":"Z hh:mm",Chat.dateFormat(new Date(t),e)},c=function(){if(!i.length)return[];for(var t=i.length>0?i[i.length-1]:i[0],e=[],s=0;s<i.length;s++){var a=i[s];a.time-t.time>3e5&&"time"!=t.type&&e.push({type:"time",style:"time",content:o(a.time)}),t=a,e.push(a)}return e},l={counselor:function(){var t=$.Deferred();return $.get("/chat/query/salesboss.json",function(e){1==e.rescode&&t.resolve(e)}),t}},d={message:function(t){var e=$.Deferred();return $.post("/actionLog/bossmsg2sales.json",{message:t},function(t){1==t.rescode?e.resolve():$.toast({content:t.resmsg,type:"error"})}),e}},h={bar:function(){return'<div class="counselor-bar"><div class="counselor-wrap"><div class="counselor-wrap-tip" ka="counselor-bar"><img src="//static.zhipin.com/v2/web/boss/images/figure-counselor.png"><p class="text-center">招<br>聘<br>助<br>手</p><p class="counselor-message"><i></i></p></div><div class="counselor-message-bar" ka="counselor-message-panel"></div></div></div>'},last:function(t){
return Utemplate('<p class="article"><i class="i-close"></i></p><div class="message-panel"><img src="//static.zhipin.com/v2/web/boss/images/figure-counselor.png"><p class=""><%this.message.content%></p></div><p class="c-line"></p><p class="message-notice"><span class="counter"><%this.total%>条新消息</span><span class="time"><%this.message.date%> <%this.message.clock%></span></p>',t)},chat:function(t){return'<div class="counselor-chat-bar" ><div class="article"><i class="i-close fr"></i><img src="//static.zhipin.com/v2/web/boss/images/figure-counselor.png">'+t.name+'-招聘顾问  400-0655-799</div><div class="counselor-message-list"><ul></ul></div><div class="counselor-chat-input"><a href="javascript:;" class="btn counselor-message-send">发送</a> <textarea class="counselor-chat-message" maxlength="1000" placeholder="输入您的招聘需求"></textarea></div></div>'},grade:function(t){return t.operated?'<li class="received"><p class="text">非常感谢您的评价！</p></li>':'<li><div class="grade"><p>您好，请对我的服务评价</p><p class="grade-item">响应时效：<i></i><i></i><i></i><i></i><i></i></p><p class="grade-item">问题解决：<i></i><i></i><i></i><i></i><i></i></p><p class="grade-submit"><a href="javascript:;" data-id="'+t.id+'" class="disabled">提交</a> </p></div></li>'},time:function(t){return'<li class="time">'+t.content+"</li>"},text:function(t){var e=(""+t.content).replace(/\n/gi,"<br>").replace(/&amp;lt;/g,"&#60;").replace(/&amp;gt;/g,"&#62;");return"send"==t.type?'<li class="send"><p class="text">'+e+"</p></li>":'<li class="received"><p class="text">'+e+"</p></li>"},message:function(){}},u=function(){return i.filter(function(t){return!t.read}).length},p=function(t){$(".counselor-message-list ul").append(t),$(".counselor-message-list").scrollTop($(".counselor-message-list ul").height())},f=function(t,e,s){i.filter(function(e){return e.id==t})[0][e]=s},g=function(){if(i.filter(function(t){return"end"===t.tag}).length)return!1;var t=new Date,e={id:t.getTime(),time:t.getTime(),type:"received",content:"收到，我电话回复您",read:!0,tag:"end",date:n(t.getMonth()+1)+"-"+n(t.getDate()),clock:n(t.getHours())+":"+n(t.getMinutes())};i.push(e),p(h.text(e))};return function(){l.counselor().then(function(t){s.name=t.salesName,$("body").append(h.bar(s))}),$(document).on("click",".counselor-chat-bar .i-close",function(){$(".counselor-chat-bar").remove(),$("body").append(h.bar())}),$(document).on("input",".counselor-chat-bar .counselor-chat-message",function(){e&&(clearTimeout(e),e=setTimeout(g,6e4))}),$(document).on("click",".counselor-chat-bar .counselor-message-send",function(){var t=$(".counselor-chat-bar .counselor-chat-message").val().trim(),s=t.replace(/</g,"&#60;").replace(/>/g,"&#62;"),a=$(".counselor-message-list");if(!s)return $.toast({content:"消息不能为空",type:"error"}),!1;d.message(s).then(function(){var t=new Date,r={id:t.getTime(),time:t.getTime(),type:"send",content:s,read:!0,date:n(t.getMonth()+1)+"-"+n(t.getDate()),clock:n(t.getHours())+":"+n(t.getMinutes())};i.push(r),p(h.text(r)),__conversion("counselor-send"),$(".counselor-chat-bar .counselor-chat-message").val(""),a.scrollTop($(".counselor-message-list ul").height()),e=setTimeout(g,6e4)})}),$(document).on("click",".counselor-message-bar .i-close",function(){$(".counselor-message-bar").fadeOut()});var t=function(){for(var t="",e=c(),i=0;i<e.length;i++){var s=e[i];s.read=!0,"grade"===s.type?t+=h.grade(s):"time"===s.type?t+=h.time(s):t+=h.text(s)}return Chat.sendReadMessage({uid:990,mid:a}),t};$(document).on("click",".counselor-message-list .grade-item i",function(){var t=$(this).parents(".grade");if(t.hasClass("operated"))return!1;$(this).parents(".grade-item").find(".star").removeClass("star"),$(this).addClass("star"),$(this).prevAll("i").addClass("star");var e=t.find(".grade-item");e.eq(0).find(".star").length&&e.eq(1).find(".star").length&&t.find(".grade-submit a").removeClass("disabled")}),$(document).on("click",".counselor-message-list .grade-submit a",function(){var t=$(".counselor-message-list .grade-item");$(this).parents(".grade").addClass("operated"),$(this).addClass("disabled"),__conversion("wangcai_grade_"+t.eq(0).find(".star").length+"_"+t.eq(1).find(".star").length),f($(this).attr("data-id"),"operated",!0)}),$(document).on("click",".counselor-wrap-tip",function(){$(".counselor-bar").remove(),$("body").append(h.chat(s)),$(".counselor-message-list ul").html(t()),$(".counselor-message-list").scrollTop($(".counselor-message-list ul").height())})}(),{received:function(e){var s=r(e);i.push(s);var n=h.last({total:u(),message:s});if(a<s.id&&(a=s.id),$(".counselor-chat-bar").length){var o="grade"===s.type?h.grade(s):h.text(s);p(o)}else $(".counselor-message-bar").html(n).fadeIn(),t&&clearTimeout(t),t=setTimeout(function(){$(".counselor-message-bar").html(n).fadeOut()},5e3);if(u()){var c=u()>10?"10+":u();$(".counselor-message i").text(c)}}}}(),Payment=function(){function t(t){var t=$.extend({article:"",text:"",confirmText:"确定",close:function(){},confirm:function(){}},t),e=function(){var e=this.$content,i=this;e.on("click",".success-confirm",function(){i.close(),t.confirm("confirm")}),e.on("click",".success-cancel",function(){i.close(),t.confirm("close")})};$.confirm({backgroundDismiss:!1,content:r.success(t),confirmButton:!1,cancelButton:!1,buttonsReverse:!0,closeIcon:!1,columnClass:"pop-payment",title:!1,onOpen:e,onClose:t.close,ononfirm:t.confirm})}function e(t,e,i){var s,a=!0,r={orderNo:t.orderNo,detailNo:t.detailNo};t.query&&(r=$.extend(r,t.query));var e=$.extend({success:function(){},fail:function(){}},e),o=function(i){a&&(s.close(),i.ptype=t.data.payType,e.success(i))},c=function(){$(".pop-payment .PaymentCheck").html('<i class="loader-gray-17"></i>正在查询支付结果，请稍后'),n.get.queryStatus(r).then(function(t){if(1!=t.payStatus){$(".pop-payment .PaymentCheck").html('<span class="gray">未支付成功，请您扫码完成支付。</span><a class="PayCheckBtn" href="javascript:">重新查询</a>')}else a=!1,o(t)})},l=function(){n.get.queryStatus(r).then(function(t){1==t.payStatus?(a&&o(t),a=!1):a&&setTimeout(l,3e3)})},d=function(){var t=this.$content;s=this,setTimeout(l,1500),t.on("click",".PayCheckBtn",c)},h=function(){a=!1,e.close&&e.close()},u=function(){};!function(t){$.confirm({content:t,confirmButton:!1,cancelButton:!1,buttonsReverse:!0,closeIcon:!1,columnClass:"pop-payment",title:!1,onOpen:d,onClose:h,confirm:u})}(i)}function i(t,e){var i,o={success:function(){},cancel:function(){},fail:function(){}},e=$.extend(o,e),t=$.extend({recharge:!1},t),c=function(t,e){n.post.purchase(t,e).then(function(n){var r=!!t.condition&&t.condition(n);return 1!=n.rescode?($.toast({type:"error",content:n.resmsg}),!1):r?t.success(n):1==t.data.payType?(i&&i.close(),e.buy&&e.buy({pay:t.amount,orderNo:n.orderNo,balance:t.balance,payType:t.data.payType}),t.success(n)):(t.qrCode=n.qrUrl,t.orderNo=n.orderNo,t.detailNo=n.detailNo,2==t.data.payType?s(t,e):a(t,e),e.buy&&e.buy({pay:t.amount,balance:t.balance,payType:t.data.payType,orderNo:n.orderNo}),void(i&&i.close()))},function(){})},l=function(){var s=this.$content;i=this,s.on("click",".prop-order-type p",function(){if($(this).hasClass("selected")||$(this).hasClass("disabled"))return!1;s.find(".prop-order-type .selected").addClass("disabled").removeClass("selected"),$(this).addClass("selected").addClass("disabled"),t.data.payType=$(this).attr("data-payType"),c(t,e)}),s.on("click",".btn-block",function(){if($(this).hasClass("disabled"))return!1;t.data.payType=1,$(this).addClass("disabled"),c(t,e)}),s.on("click",".item-coupon-list span",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($(".item-coupon-list .selected").removeClass("selected"),$(this).addClass("selected"));var e=$(this).index(),i=t.userCouponList[e];$(this).hasClass("selected")?(t.coupon=i.offBean,t.data.userCouponId=i.encryptId,s.find(".coupon-left").hide(),s.find(".coupon-selected").text("-"+t.coupon+"直豆").show()):(t.coupon=0,t.data.userCouponId="",s.find(".coupon-left").show(),s.find(".coupon-selected").hide());var a=1e3*t.amount,n=1e3*t.coupon;t.pay=a>n?(a-n)/1e3:0,t.pay<=t.balance?(t.data.payType=1,t.cost=0):(t.pay=t.pay-t.balance,t.cost=t.pay),s.find(".pay-amount").text(t.pay+"直豆"),t.cost>0||t.recharge?(s.find(".prop-order-type").show(),s.find(".btn-block").hide()):(s.find(".btn-block").show(),s.find(".prop-order-type").hide())}),s.on("click",".coupon-left",function(){s.find(".item-coupon").toggleClass("unfold")}),s.on("click",".coupon-selected",function(){s.find(".item-coupon").toggleClass("unfold")}),s.on("click",".bead-close",function(){i.close()})},d=function(){return e.fail()},h=function(){},u=function(t){$.confirm({backgroundDismiss:!1,content:t,confirmButton:!1,cancelButton:!1,buttonsReverse:!0,closeIcon:!1,columnClass:"pop-payment",title:!1,onOpen:l,onClose:d,confirm:h})};if($(".pop-payment").length)return!1;if(t.recharge)u(r.recharge(t));else{var p=t.itemId||"",f=$.extend(t.data,{itemId:p}),g=t.prePayUrl||"";n.get.detail(f,g).then(function(i){var s=i.data,a=parseInt(s.remainBean,10),n={couponId:"",itemIcon:s.itemIcon,balance:a,amount:s.payBean,pay:s.payBean,userCouponList:s.userCouponList,description:s.itemDesc?s.itemDesc:t.description},o=s.userCouponList.filter(function(t){return t.selected});t=$.extend(t,n),o.length?(t.coupon=o[0].offBean,t.pay=t.pay>t.coupon?t.pay-t.coupon:0,t.data.userCouponId=o[0].encryptId):t.coupon=0,t.pay<=a?(t.data.payType=1,t.cost=0):(t.pay=t.pay-a,t.cost=t.pay),0==t.amount?c(t,e):u(r.purchase(t))})}}function s(t,i){var s={type:"wx",name:"微信支付",pay:t.pay,qrCode:t.qrCode};e(t,i,r.pay(s)),__conversion("payment_wx")}function a(t,i){var s={type:"zfb",name:"支付宝",pay:t.pay,qrCode:t.qrCode};e(t,i,r.pay(s)),__conversion("payment_zfb")}var n={},r={};return n.get={},n.post={},n.get.detail=function(t,e){var i=$.Deferred(),s="/boss/item/prepay.json";return t.priceId&&(s="/boss/block/prepay.json"),e&&(s=e),$.get(s,t).success(function(t){if(1011==t.code)return window.location.href="/user/login.html?ka=header-login",!1;1==t.rescode?i.resolve(t):$.toast({type:"error",content:t.resmsg})}),i},n.get.queryStatus=function(t){var e=$.Deferred();return $.ajax({method:"get",url:"/boss/item/orderquery.json",data:t,cache:!1,success:function(t){1==t.rescode?e.resolve(t):$.toast({type:"error",content:t.resmsg})}}),e},n.post.purchase=function(t,e){var i=$.Deferred();return $.ajax({method:"post",url:t.url,data:t.data,cache:!1,success:function(t){if(1!=t.rescode)return $.toast({type:"error",content:t.resmsg}),i.reject(t),e.fail();i.resolve(t)},error:function(){return e.fail()}}),i},r.pay=function(t){return Utemplate('<div class="mb-payment"><p class="mb-payment-title"><img src="/v2/web/boss/images/icon-shield.png" />安全支付</p><div class="mb-pay-info"><i class="icon-<%this.type%>"></i><%this.name%><i class="currency">￥</i><i class="amount"><%this.pay%></i></div><div class="qr-code"><img src="<%this.qrCode%>" /></div><div class="mb-payment-result PaymentCheck"><span class="gray">使用<%this.name%>扫码支付</span><a class="PayCheckBtn" href="javascript:">我已支付</a></div></div>',t)},r.purchase=function(t){return Utemplate('<div class="mb-payment"><p class="mb-payment-title"><img src="/v2/web/boss/images/icon-shield.png" /><%if(this.article){%><%this.article%><%}else{%>确认支付<%}%><i class="bead-close"></i></p><dl class="order-detail"><dt><img src="<%this.itemIcon%>"><span class="item-name"><%this.description%></span><span class="fr"><%this.amount%>直豆</span></dt><%if (0 < this.userCouponList.length) {%><dd class="item-coupon <%if(0 < this.coupon){%>unfold<%}%>"><p>优惠券<span class="fr coupon-selected" <%if(0 < this.coupon){%>style="display: block;"<%}%>>-<%this.coupon%>直豆</span><span class="fr coupon-left" <%if(0 < this.coupon){%>style="display: none;"<%}%>><%this.userCouponList.length%>张可用</span></p><div class="item-coupon-list"><%for(var i=0;i<this.userCouponList.length;i++){%><span data-id="<%this.userCouponList[i].encryptId%>" <%if(this.userCouponList[i].selected){%>class="selected"<%}%>>减<%this.userCouponList[i].offBean%>直豆</span><%}%></div></dd><%}%><dd>直豆余额<span class="fr"><%this.balance%>直豆</span></dd><dd>还需支付<span class="fr pay-amount"><%this.pay%>直豆</span></dd></dl><div class="prop-order"><div class="prop-order-type" <%if(0 == this.cost){%>style="display: none;"<%}%>> <div class="prop-type-article">直豆余额不足，请选择支付方式：</div> <p class="fl payment-wx" data-type="wx" data-payType="2"><i class="icon-wx"></i>微信支付</p> <p class="fr payment-zfb" data-type="zfb" data-payType="3"><i class="icon-zfb"></i>支付宝</p> </div><div class="prop-buttons"><button class="btn btn-block"  <%if(0 != this.cost){%>style="display: none;"<%}%>>立即支付</button></div></div></div>',t)},r.recharge=function(t){return Utemplate('<div class="mb-payment"><p class="mb-payment-title"><img src="/v2/web/boss/images/icon-shield.png" />确认支付<i class="bead-close"></i></p><dl class="order-detail"><dt><img src="/v2/web/boss/images/prop/icon-bean.png" /><span class="item-name"><%this.description%></span><span class="fr"><%this.amount%>直豆</span></dt><dd>支付金额<span class="fr pay-amount">￥<%this.pay%></span></dd></dl><div class="prop-order"><div class="prop-order-type"> <div class="prop-type-article">请选择支付方式：</div> <p class="fl payment-wx" data-type="wx" data-payType="2"><i class="icon-wx"></i>微信支付</p> <p class="fr payment-zfb" data-type="zfb" data-payType="3"><i class="icon-zfb"></i>支付宝</p> </div></div></div>',t)},r.success=function(t){return Utemplate('<div class="mb-payment"><p class="mb-payment-title"><img src="/v2/web/boss/images/icon-shield.png" />安全支付</p><div class="pay-info-text"><img src="/v2/web/boss/images/layer/succ.png" /><p class="article"><%this.article%></p><p class="text gray"><%this.text%></p><p><%if(this.cancelText){%><a href="javascript:" class="success-cancel btn"><%this.cancelText%></a><%}%><a href="javascript:" class="success-confirm btn"><%this.confirmText%></a></p></div></div>',t)},{wx:s,zfb:a,success:t,purchase:i,balance:n.get.balance}}(),Purchase=function(){function t(t,e,i){Payment.success({article:t||"购买成功",text:e||"",confirm:function(){i.confirm&&i.confirm()},close:function(){i.close&&i.close()}})}function e(e,i,s){var a=s.action?s.action:"发布",n={ordinary:{1:"火爆职位普通版"+a+"成功！可保持职位在线<%this.description%>，期间每日查看牛人上限<%this.view%>，开聊上限<%this.employ%>。",2:"",3:"火爆职位普通版"+s.action+"成功！可保持职位在线<%this.description%>，期间每日查看牛人上限<%this.view%>，开聊上限<%this.employ%>。",4:"已成功升级至火爆职位畅聊版！当前剩余有效期<%this.restDays%>天，期间每日查看牛人<%this.view%>人，开聊<%this.employ%>人。"},carefree:{1:"火爆职位畅聊版发布成功！可保持职位在线<%this.description%>，期间每日查看牛人<%this.view%>，开聊牛人<%this.employ%>。",2:"",3:"火爆职位畅聊版"+s.action+"成功！可保持职位在线<%this.description%>，期间每日查看牛人<%this.view%>，开聊牛人<%this.employ%>。",4:"已成功升级至火爆职位畅聊版！当前剩余有效期<%this.restDays%>天，期间每日查看牛人<%this.view%>人，开聊<%this.employ%>人。"},experience:{1:"火爆职位普通版发布成功！该职位可免费在线<%this.expiredays%>天，为避免影响招聘，请及时延长招聘时长。",2:"火爆职位普通版发布成功！该职位可免费在线<%this.expiredays%>天，为避免影响招聘，请及时延长招聘时长。",3:"火爆职位普通版发布成功！该职位可免费在线<%this.expiredays%>天，为避免影响招聘，请及时延长招聘时长。",4:"火爆职位普通版发布成功！该职位可免费在线<%this.expiredays%>天，为避免影响招聘，请及时延长招聘时长。",5:"火爆职位普通版发布成功！该职位可免费在线<%this.expiredays%>天，为避免影响招聘，请及时延长招聘时长。"}},r={ordinary:{1:"火爆职位-普通版",2:"",3:"火爆职位-普通版",4:"火爆职位-普通版"},carefree:{1:"火爆职位-畅聊版",2:"",3:"火爆职位-畅聊版",4:"火爆职位-畅聊版"},experience:{1:"火爆职位",2:"",3:"",4:"",5:"火爆职位"}},o={0:{1:"block_sendjob_purchase_hot_",2:"block_extendjob_purchase_hot_",3:"block_openjob_purchase_hot_",4:"block_upgradejob_purchase_hot_"},1:{1:"block_sendjob_purchase_super_",2:"block_extendjob_purchase_super_",3:"block_openjob_purchase_super_",4:"block_upgradejob_purchase_super_"}};try{var c=o[i.hotJobType][i.action]+i.priceId;_T.sendEvent(c)}catch(t){}var a=s.item.type||"ordinary",l=Utemplate(n[a][i.action],s.item),d=r[a][i.action],h=s.action?s.action+"成功":"发布成功",u=function(e){t(h,l,s),"function"==typeof s.success&&s.success(e)},p={url:e,data:i,description:d,amount:s.item.pay,success:u},f={success:function(t){var e={1:"bean",2:"wx",3:"zfb"};window.top.__conversion(o[i.hotJobType][i.action]+e[t.ptype]+"_"+i.priceId),u(t)}};Payment.purchase(p,f)}return{vip:function(t,e){var i=e||{},s=function(){$.toast({type:"success",content:"您已成功购买VIP账号，可在VIP权益页面查看使用明细"}),i.success&&i.success()},a={url:"/boss/item/pay/vipaccount.json",data:t,description:"购买道具：「VIP账号」- 1个月",amount:parseInt(t.amount,10),success:s},n={success:s};Payment.purchase(a,n)},position:e,commercial:function(e,i){var s=11==i.item.business?"普通职位":"火爆职位",a="";i.item&&i.item.categoryList&&i.item.categoryList.filter(function(t){return t.name&&t.name.indexOf("解锁匿名牛人")>-1}).length&&(a="（解锁匿名牛人功能目前只支持6.03以上版本和网页版使用，暂不支持iOS）");var n={1:"免费试用火爆职位",2:s+"-<%this.priceName%>",3:"升级VIP账号",4:"购买聊天加油包",5:"升级VIP账号",6:s+"-<%this.priceName%>",7:"",8:""},r={1:"火爆职位发布成功！该职位可<%this.title%>，为避免影响招聘，请及时延长招聘时长。",2:s+"<%this.priceName%>发布成功！可保持职位在线一个月，期间可<%this.descList[1].bottomDesc%>牛人<%this.descList[1].count%><%this.descList[1].unitDesc%>，<%this.descList[0].bottomDesc%><%this.descList[0].count%><%this.descList[0].unitDesc%>。",3:"您已成功购买VIP账号，可在VIP权益页面查看使用明细"+a,4:"您已成功购买「聊天加油包」，<%this.inDate%>内，每日主动沟通人数<%this.chat%>，赠送主动查看人数<%this.view%>。",5:"您已成功购买VIP账号，可在VIP权益页面查看使用明细"+a,6:s+"<%this.priceName%>发布成功！可保持职位在线<%this.expireName%>，期间可<%this.descList[1].bottomDesc%>牛人<%this.descList[1].count%><%this.descList[1].unitDesc%>，<%this.descList[0].bottomDesc%><%this.descList[0].count%><%this.descList[0].unitDesc%>。",7:"",8:""};4==i.item.cardId&&(i.item.chat=i.item.chatDescList[0],i.item.inDate=i.item.chatDescList[1],i.item.view="+"+2*parseInt(i.item.chat,10)+"次");var o=i.item,c=o.cardId,l=Utemplate(n[c],o),d=Utemplate(r[c],o),h=function(){var e=function(){};i.success?e=i.success:i.confirm&&(e=i.confirm),t(l,d,{confirm:e,close:e})},u={url:"/boss/block/pay.json",data:e,tid:o.p||"",description:l,amount:parseInt(o.beanCount,10),success:h};i.item.article&&(u.article=i.item.article);var p={buy:function(t){var e={action:"confirm-payment",p:"",p2:o.beanCount,p3:t.balance,p4:t.pay,p5:t.pay};Block.action(e)},success:h};Payment.purchase(u,p)}}}(),Prop={getDiscountInfo:function(){var t=$.Deferred();return $.get("/boss/item/recharge/discount/check.json").success(function(e){t.resolve(e)}),t},Url:{positionList:"/boss/data-temp/prop/position.json",topcardPositionList:"/boss/data-temp/prop/position.json",useTopcardPositionList:"/boss/data-temp/prop/position.json",useGeekBomb:"/boss/data-temp/prop/",useGeekPhone:"/boss/data-temp/prop/",buyGeekPhone:"/boss/data-temp/prop/",orderRequest:"/boss/data-temp/prop/orderRequest.json",exchange:"/boss/data-temp/prop/position.json",rechargeBean:"/boss/data-temp/prop/position.json",useTopcardSelectDay:"/boss/data-temp/prop/",topcardSelectDay:"/boss/data-temp/prop/",topcardBuy:"/boss/data-temp/prop/",topcardUse:"/boss/data-temp/prop/"},TRUE_URL:{positionList:"/boss/item/geekBombJobList.json",topcardPositionList:"/boss/item/jobTopJobList.json",useTopcardPositionList:"/boss/item/useJobTopSelJob.json",useGeekBomb:"/boss/item/useGeekBomb/",useGeekPhone:"/boss/useGeekInfoRight/",buyGeekPhone:"/boss/item/buy/othItem/",orderRequest:"/boss/item/orderquery.json",exchange:"/bossweb/redeemCode/exchange.json",rechargeBean:"/boss/item/rechargebean.json",useTopcardSelectDay:"/boss/item/useJobTopSelDay/",topcardSelectDay:"/boss/item/jobTopSelDay/",topcardBuy:"/boss/item/buyJobTop/",topcardUse:"/boss/item/useJobTopBooking/"},getRequestUrl:function(t){var e=!1;return e=!(document.domain.indexOf(".bosszhipin.com")>-1||document.domain.indexOf(".weizhipin.com")>-1)&&"172.16.6.191:8080"==window.location.host,0==e?Prop.TRUE_URL[t]:Prop.Url[t]},Views:{header:{niuren:'<img src="/v2/web/boss/images/layer/niuren.png" alt="牛人" class="title-icon">',topcard:'<img src="/v2/web/boss/images/layer/top-card.png" alt="牛人直通卡" class="title-icon">',zhadan:'<img src="/v2/web/boss/images/layer/zhadan.png" alt="牛人炸弹" class="title-icon">',succ:'<img src="/v2/web/boss/images/layer/succ.png" alt="成功" class="title-icon">'},title:{1:'<p class="prop-title">选择职位<span class="use-num"></span></p>',2:'<p class="prop-title">选择文案</p>',3:'<p class="prop-title prop-date-title">选择置顶日期                <span class="been-use pull-right"><i></i>已占用</span>                <span class="been-reserve pull-right"><i></i>已预定</span>                </p>',4:'<div class="pay-title">                    <span class="">使用微信扫码支付</span>                </div>'},button:{1:'<div class="pay-status-area">                    <a href="javascript:" ka="item_mall_nd_wxPay" class="status-btn">我已完成支付</a>                </div>',2:'<div class="pay-btn-area">                    <a href="" class="left-btn">前往</a>                    <a href="" class="right-btn">关闭</a>                </div>',3:'<div class="btn-area">                    <a href="" class="left-btn">取消</a>                    <a href="" class="right-btn">下一步</a>                    <div class="clear"></div>                </div>',4:'<div class="btn-area">                    <a href="" class="define-btn">知道了</a>                </div>'}},Layer:{createHeader:function(t){return Prop.Views.header[t]},createTitle:function(t){return Prop.Views.title[t]},createSuccMessage:function(t,e){return'<div class="succ-container"><p class="succ-title">'+t+"</p>"+(e?'<p class="succ-desc">'+e+"</p>":"")+"</div>"},createSelectList:function(t){var e="",i="";for(var s in t)0==s&&(e="<dt>                    <p><span>"+t[s].jobName.replace(/\</g,"&lt;").replace(/\>/g,">")+"</span><span>"+t[s].locationName+"</span><span>"+t[s].lowSalary+"-"+t[s].highSalary+'k</span></p>                        <span class="on"><i></i></span>                        <input type="hidden" value="'+t[s].encryptId+'"/>                    </dt>'),i+='<li data-val="'+t[s].encryptId+'"><span>'+t[s].jobName.replace(/\</g,"&lt;").replace(/\>/g,">")+"</span><span>"+t[s].locationName+"</span><span>"+t[s].lowSalary+"-"+t[s].highSalary+"k</span></li>";return i="<dd><ul>"+i+"</ul></dd>",'<div class="select-list"><dl>'+e+i+"</dl></div>"},createRadioList:function(t){return'<div class="radio-list">                        <ul>                            <li class="active" data-id="72"><i></i><p>请查看我发布的'+t.replace(/\</g,"&lt;").replace(/\>/g,">")+'岗位说明，如感兴趣，我们再详细沟通。</p></li>                            <li data-id="73"><i></i><p>你好，我们急招'+t.replace(/\</g,"&lt;").replace(/\>/g,">")+'，如有兴趣希望可以深聊。</p></li>                            <li data-id="74"><i></i><p>你好，系统自动匹配了我的招聘信息给你，如果感兴趣，请回复消息。</p></li>                        </ul>                    </div>'},createDateTime:function(t){return Prop.Layer.createTitle(3)+'<div id="prop-select-date" class="prop-select-date"></div>'+("buy"==t?'<p class="topcard-price">牛人直通卡的价格与您选择的日期有关</p>':"")},createBuyZhiBean:function(t){return window.top.Utemplate('<div class="niuren-buy"><ul><li class="first"><span class="pull-left">充值直豆个数</span><div class="pull-right"><input maxlength="4" type="text" value="100" class="count bean-count"/></div></li><%if(this.discount){%><li class="privilege"><span class="pull-left">iOS用户9折优惠</span><span class="pull-right privilege">-￥10.8</span></li><%}%><li class="money-item"><span class="pull-left">金额</span><span class="pull-right money">￥100</span></li></ul></div>',t)},bindRadioSelect:function(t){t.find("li").click(function(){$(this).addClass("active").siblings("li").removeClass("active")})},alertSuccLayer:function(t,e,i,s){i.$title&&i.$title.html(Prop.Layer.createHeader("succ")),"buy"==s&&e?i.$content.find(".prop-layer").html(Prop.Layer.createSuccMessage(t,e)+Prop.Views.button[2]):i.$content.find(".prop-layer").html(Prop.Layer.createSuccMessage(t,e)+Prop.Views.button[4]),i.$btnc.remove(),i.$content.find(".prop-layer .define-btn").click(function(t){t.preventDefault(),i.close()}),i.$content.find(".prop-layer .pay-btn-area .left-btn, .prop-layer .pay-btn-area .right-btn").click(function(t){window.location.reload()})},createQrcode:function(t){return Prop.Layer.createTitle(4)+'<div class="qrcode-area">                        <img src="'+t+'" alt="二维码">                    </div>'+Prop.Views.button[1]},createAlertLayer:function(t){$.confirm({content:'<p class="sys-msg">'+t+"</p>",cancelButton:!1,confirmButton:"知道了",columnClass:"pop-stage prop-pop",title:!1})}},buyZhiBean:function(t,e){var i,s=this,t=$.extend({discount:!1},t);i=$(".frame-container").length&&-1==$(".frame-container").attr("src").indexOf("wordhr.zhipin.com")&&$(".frame-container").contents().find(".prop-list-right").length?$(".frame-container").contents().find(".prop-list-right"):$("#container").find(".prop-list-right"),showConfirm=function(){$.confirm({content:'<div class="prop-layer">'+s.Layer.createBuyZhiBean(t)+"</div>",cancelButton:"取消",confirmButton:"确认充值",buttonsReverse:!0,columnClass:"pop-stage prop-pop",title:s.Layer.createHeader("zhadan"),onOpen:function(){var e=this;this.$content.find(".money"),Number(i.find(".balance").text());this.$content.find(".count").on("input",function(){$(this).val($(this).val().replace(/\D/g,""));var i=Number($(this).val());t.discount?(e.$content.find(".pull-right.privilege").html("- ￥"+(.1*i).toFixed(2)),e.$content.find(".pull-right.money").html("￥"+(i-.1*i).toFixed(2))):e.$content.find(".pull-right.money").html("￥"+i)}).trigger("input")},confirm:function(){var e=this,s=e.$content.find(".count");if(privilege=(.1*s.val()).toFixed(2),""==s.val()||0==s.val())return s.focus(),!1;var a=parseInt(s.val(),10);t.discount&&(a=(a-privilege).toFixed(2));var n={recharge:!0,url:Prop.getRequestUrl("rechargeBean"),amount:parseInt(s.val(),10),pay:a,description:"直豆充值："+parseInt(s.val(),10)+"个",data:{beanCount:parseInt(s.val(),10)}},r={success:function(s){e.close(),t.discount?window.top.Payment.success({article:"直豆充值成功",text:"本次充值为您节省了"+privilege+"元"}):window.top.Payment.success({article:"直豆充值成功",text:"你可以在 BOSS直聘 APP「钱包」中查看充值明细"}),i.find(".balance").text(s.beanCount)}};window.top.Payment.purchase(n,r)}})}(),"function"==typeof e&&e()}},iosRecharge={buyHandle:function(){$.get("/boss/item/recharge/discount/check.json",function(t){Prop.buyZhiBean({discount:t.discount||!1})})},showPop:function(){PageSet.getTipData(function(t){if(t.rescode&&t[13]){if("true"!=sessionStorage.getItem("showPop"+_PAGE.uid)){$.dialog({title:"",content:'<div class="ios-bg"><a href="javascript:;" class="buy-zhi-bean" ka="myitem-item-buybean">购买直豆</a></div>',confirmText:"",cancelText:"",wrapClass:"prop-ios",onOpen:function(t){t.find(".buy-zhi-bean").click(function(){iosRecharge.buyHandle(),t.remove()})}});({sendData:function(){$.ajax({type:"post",url:"/setting/notify/set.json",dataType:"JSON",data:{type:13},cache:!1,success:function(t){},error:function(){}})}}).sendData()}sessionStorage.setItem("showPop"+_PAGE.uid,"true")}})}};$(function(){"PageSet"in window&&(iosRecharge.showPop(),$(".top-user .recharge-ios").click(function(){$(".frame-container").length&&-1==$(".frame-container").attr("src").indexOf("wordhr.zhipin.com")&&$(".frame-container").contents().find(".dialog-wrap:visible,.jconfirm:visible").remove(),iosRecharge.buyHandle()}))});var Block=function(){function t(t,e){var i=t,s=$.confirm({content:e,title:!1,closeIcon:!0,cancelButton:!!i.cancelText&&i.cancelText,confirmButton:i.confirmText||"确定",confirmButtonClass:"fr",columnClass:"pop-block "+i.style,onOpen:function(){i.ka&&this.$confirmButton.attr("ka",i.ka),i.vka&&__conversion(i.vka),i.open&&i.open(this)},confirm:function(){if(i.next&&i.next(this.$content),!i.next&&i.confirm&&i.confirm(),0==i.autoClose)return!1},cancel:function(t){i.cancel&&t&&i.cancel()},onClose:function(t){i.close&&i.close()}});return $(document).on("_BEFORE_UNLOAD",function(){s.close()}),s}function e(e){var i=e,s=e.content||n({title:i.title,description:i.description});i.style="pop-block-alert",t(i,s)}function i(e,i){var s={},a=function(t,e){var s=i.isEdit?"延长":"发布";t.text("付费"+s+"职位：￥"+e)},r=function(){if("vip"==$(".hot-list-tab .checked").attr("data-cls"))return s.vip.type="vip",s.vip;var t=$("input[name=ordinary]").filter(":checked"),e=t.attr("data-type"),i=t.attr("data-index");return selected=s[e][i],selected.type=e,selected.ba=s.ba,selected},o={open:function(t){var e=t.$content;if(e.on("change","input[name='ordinary']",function(){var i=$(this).attr("data-type"),n=$(this).attr("data-index"),r=s[i][n];a(t.$confirmButton,r.pay),e.find("."+i+"-view").text(r.view),e.find("."+i+"-employ").text(r.employ)}),e.on("click",".hot-list-tab li",function(){$(".hot-list-tab .checked").removeClass("checked"),$(this).addClass("checked"),e.find(".block-storm").removeClass("combination-ord").removeClass("combination-vip").addClass("combination-"+$(this).attr("data-cls")),"ord"==$(this).attr("data-cls")?(t.$confirmButton.removeClass("btn-vip-rose"),e.find("input[name=ordinary]").filter(":checked").trigger("change")):t.$confirmButton.addClass("btn-vip-rose").text("开通VIP帐号")}),$(".hot-list-tab li.checked").length?$(".hot-list-tab li.checked").trigger("click"):e.find("input[name=ordinary]").filter(":checked").trigger("change"),t.$btnc.on("click",".trial a",function(){var e=s.experience;e.type="experience",i.confirm(e),t.close(),__conversion("block_sendjob_purchase_trial")}),s.experience){t.$btnc.append(Utemplate('<p class="trial">您有一次免费体验机会，可免费试用火爆职位普通版<%this.expiredays%>天，<a href="javascript:">点击免费使用</a></p>',s.experience))}},next:function(){var t=r();i.confirm&&i.confirm(t)}};i.canBuyVip?function(){$.when(u({sf:i.sf||"",vipPriceId:i.vipPriceId}),p(e)).then(function(e,a){s=a,s.vip={ba:e.detailPage.ba,vipPriceId:i.vipPriceId,pay:e.detailPage.currentPriceDesc.replace(/[^\d.]/g,"")};var r=$.extend(o,i);t(r,n({title:r.title,description:r.description})+l.storm(e.detailPage,a))})}():function(){var a=function(e){s=e;var a=$.extend(o,i);t(a,n({title:a.title,description:a.description})+c.storm(e))};e.combos?a(e.combos):p(e).then(function(t){a(t)})}()}function s(e,i){var s,a=function(e){s=e;var a=i,o=n({title:a.title,description:a.description})+r(e);a.next=function(){var t=$("input[name=super]").filter(":checked").attr("data-index"),e=s.prices[t];a.confirm(e)},a.open=function(t){var a=t.$content,n=function(t,e){var s=i.isEdit?"延长":"发布";t.text("付费"+s+"职位：￥"+e)},r=i.isEdit?"付费延长职位":"付费发布职位";if(t.$confirmButton.text(r+"：￥"+e.pay),t.$btnc.on("click",".trial a",function(){var e=s.experience;e.type="experience",i.confirm(e),t.close(),__conversion("block_sendjob_purchase_trial")}),a.on("change","input[name='super']",function(){var e=$(this).attr("data-index"),i=s.prices[e];n(t.$confirmButton,i.pay);var r="可保持职位在线"+i.expiredays+"天，期间每日查看详情"+i.view+"，开聊上限为"+i.employ+"。";a.find(".hot-intro").text(r)}),a.find("input[name=super]").filter(":checked").trigger("change"),s.experience){t.$btnc.append(Utemplate('<p class="trial">你有一次免费体验机会，可以免费试用火爆职位限制版 <%this.expiredays%> 天，<a ka="block_sendjob_purchase_super_trial" href="javascript:">点击免费使用</a></p>',s.experience))}},t(a,o)};e.combos?a(e.combos):h(e).then(function(t){a(t)})}function a(e,i){var s=i,a=s.content||o(e);s.style="pop-block-upgrade",s.open=function(t){t.$confirmButton.text("付费升级职位："+e.currentPriceDesc)},t(s,a)}var n=function(t){return Utemplate(' <div class="block-intro"><img src="/v2/web/boss/images/icon-lock-24.png"><dl><dt><%this.title%></dt><dd class="gray"><%this.description%></dd></dl><div class="clear"></div></div>',t)},r=function(t){return-1==t.view?t.view="无上限":t.view=t.view,Utemplate('<div class="hot-list hot-list"><p class="hot-intro">可保持职位在线<%this.description%>，期间每日查看详情<%this.view%>，开聊上限为<%this.employ%>。</p><ul class="ordinary"><%for(var i=0;i<this.prices.length;i++){%><li><label class="radio"><input data-index="<%i%>" type="radio" <%if(i == 0){%>checked<%}%> name="super" value="<%i%>"><span>普通版，<%this.prices[i].description%><%if(this.prices[i].discount){%><em class="discount"><%this.prices[i].discount%></em><%}%><em class="pay">￥<%this.prices[i].pay%>/职位</em></span></label></li><%}%></ul></div>',t)},o=function(t){return t.hlShortDesc.name=function(){var e=t.hlShortDesc,i=e.name;return e.highlightList&&e.highlightList.length&&$.each(e.highlightList,function(t,e){var s=i.substr(e.startIndex,e.endIndex);i=i.replace(s,"<b>"+s+"</b>")}),i}(),
Utemplate('<div class="super-upgrade-panel"><div  class="super-upgrade-description"><span class="icon-lock"></span><div class="description"><h4><%this.title%>普通版，<%this.animationTitle%></h4><p><%this.shortDesc.name%></p><p><%this.hlShortDesc.name%></p></div></div><dl class="super-upgrade-list"><dt>畅聊版<span class="icon-upgrade">升级</span></dt><%for(var i=0;i<this.descList.length;i++){%><dd><%this.descList[i]%><i class="icon-check"></i></dd><%}%><dd><b>升级所需价格：</b><span class="bean-number"><%this.currentPriceDesc%></span><span class="upgrade-discount">限时折扣</span><span class="annotation"><%this.upgradeDesc%></span></dd></dl><p class="notice">*以上价格均为单个职位价格，不同城市不同职类价格有所波动</p></div>',t)},c={vip:function(t){var e={pay:t.currentPriceDesc,list:t.lineList};return Utemplate('<table class="vip-grid"><thead><tr><th>账号权益</th><th style="width: 90px;">认证账号</th><th style="width: 70px;">VIP账号</th></tr></thead><tbody><%for (var i=0;i<this.list.length;i++){%><tr><td><div class="cut-off"><%this.list[i].itemDesc%><i class="gray"><%this.list[i].itemDescHint%></i></div></td><td class="gray"><%this.list[i].curDesc%></td><td class="primrose"><%this.list[i].totalDesc%></td></tr><%}%></tbody></table><div class="vip-counter"><p class="fl">权益总价值<i>限时折扣</i></p><p class="fr primrose">¥<%this.pay%></p></div>',e)},storm:function(t){return Utemplate('<div class="hot-list"><p class="hot-intro ordinary">火爆职位普通版，每日查看详情<span class="ordinary-view"><%this.ordinary[0].view%></span>，开聊<span class="ordinary-employ"><%this.ordinary[0].employ%></span></p><ul class="ordinary"><%for(var i=0;i<this.ordinary.length;i++){%><li><label class="radio"><input data-index="<%i%>" data-type="ordinary" type="radio" <%if(i == 0){%>checked<%}%> name="ordinary" value="0"><span>普通版，<%this.ordinary[i].description%><%if(this.ordinary[i].discount){%><em class="discount"><%this.ordinary[i].discount%></em><%}%><em class="pay">￥<%this.ordinary[i].pay%>/职位</em></span></label></li><%}%></ul><p class="hot-intro ordinary" style="padding-top: 9px;">火爆职位畅聊版，每日查看详情<span class="carefree-view"><%this.carefree[0].view%></span>，开聊<span class="carefree-employ"><%this.carefree[0].employ%></span></p><ul class="ordinary"><%for(var j=0;j<this.carefree.length;j++){%><li><label class="radio"><input data-index="<%j%>" type="radio" data-type="carefree" name="ordinary" value="0"><span>畅聊版，<%this.carefree[j].description%><%if(this.carefree[j].discount){%><em class="discount"><%this.carefree[j].discount%></em><%}%><em class="pay">￥<%this.carefree[j].pay%>/职位</em></span></label></li><%}%></ul>',t)}},l={vip:function(t){return'<div class="vip-ordinary-grid">'+c.vip(t)+"</div>"},storm:function(t,e){return'<div class="block-storm combination-vip"><div class="hot-list-tab"><ul><li data-cls="vip" class="checked">开通VIP</li><li data-cls="ord">单独发布</li></ul></div><div class="vip-wrap">'+c.vip(t)+'</div><div class="ordinary-wrap">'+c.storm(e)+"</div></div>"}},d=function(t){var t=t;return $.isArray(t)?$.each(t,function(e,i){-1==i.view?t[e].view="无上限":t[e].view=i.view+"人",-1==i.employ?t[e].employ="无上限":t[e].employ=i.employ+"人"}):(-1==t.view?t.view="无上限":t.view=t.view+"人",-1==t.employ?t.employ="无上限":t.employ=t.employ+"人"),t},h=function(t){var e=$.Deferred();return $.get("/bossweb/job/superprice.json",t).success(function(t){1==t.rescode&&(t.prices=d(t.prices),t.experience&&(t.experience=d(t.experience)),e.resolve(t))}),e},u=function(t){var e=$.Deferred();return $.get("/bossweb/job/vipaccountprice.json",t).success(function(t){1==t.rescode&&e.resolve(t)}),e},p=function(t){var e=$.Deferred();return t.combos?e.resolve(t.combos):$.get("/bossweb/job/price.json",t).success(function(t){if(1==t.rescode){var i={};i.ordinary=d(t.ordinary),i.carefree=d(t.carefree),t.experience&&(i.experience=d(t.experience)),e.resolve(t)}}),e},f=function(e,i){u(e).then(function(s){var a=i,r=n({title:a.title||"发布普通职位个数已达上限",description:a.description})+l.vip(s.detailPage);a.style="pop-vip",a.cancelText="我再想想",a.confirmText="开通VIP帐号",a.next=function(){i.confirm({ba:s.detailPage.ba,vipPriceId:e.vipPriceId,pay:s.detailPage.currentPriceDesc.replace(/[^\d.]/g,"")})},t(a,r)})},g=function(t){var e=t;return t&&"[object Object]"!==Object.prototype.toString.call(t)&&(e=JSON.parse(decodeURIComponent(t))),e};return{confirm:e,purchase:i,super:s,upgrade:a,vip:f,action:function(t,e){var e=e||{},i=$.extend(t,e);$.ajax({method:"post",url:"/actionLog/common.json",data:{ba:JSON.stringify(i)},cache:!1,success:function(t){},error:function(){}})},formatBA:g}}(),Upgrade=function(){var t=function(t,e){window.top.Purchase.position("/boss/block/pay.json",{priceId:e.priceId,action:4,hotJobType:0,business:e.business||"",targetId:e.targetId,targetType:e.targetType},{item:e,success:t.success,confirm:function(){}})};return{render:function(e,i){var s={cancelText:"我再想想",vka:"block_upgradejob_purchase_hot",cancel:function(){},confirm:function(){i.ba&&Block.action(Block.formatBA(i.ba),{p4:4,p5:i.priceId,action:"user-block-biz-button"}),t({success:function(){}},i)}};window.top.Block.upgrade(e,$.extend(s,i))}}}(),DirectAccessCard=function(){var t={},e={prop:function(t){var e=$.Deferred();return $.get("/boss/item/quicktop/selposition.json?jobId="+t).success(function(t){1==t.rescode?e.resolve(t):$.toast({type:"error",content:t.resmsg})}),e}},i={notice:function(t){return Utemplate('<div class="free-notice-panel"><h4 class="subhead">保存成功</h4><p>您使用免费权益发布了一个普通职位，</p><p>该职位价值50元/月，</p><p>剩余可免费在线普通职位数：<%this.unPubCount%>个。</p><i class="bead-close"></i></div>',t)},recommend:function(t,e){return(e.title?i.notice(e):Utemplate('<div class="brief-panel"><p class="icon-brief icon-success"></p><div class="brief-description"><p class="heading">保存成功</p><p class="position gray"><span class="position-name"><%this.positionName%></span><em class="vline"></em><%this.locationName%><em class="vline"></em><%this.lowSalary%>K-<%this.highSalary%>K</p></div><i class="bead-close"></i></div>',t))+Utemplate('<div class="introduce-panel"><img src="/v2/web/boss/images/prop/promotion.png"><p class="slogan">急聘直通卡限时专享</p><p class="intro-text">置顶职位+邀约投递，立即提升职位招聘效率</p><p class="notice">职位发布24小时内限时购买</p><button class="btn">立即体验</button></div>',t)},card:function(t){return Utemplate('<div class="brief-panel"><p class="icon-brief icon-card"></p><div class="brief-description"><p class="heading">急聘直通卡购买</p><p class="position gray">置顶职位+邀约投递，立即提升职位招聘效率</p></div><i class="card-discount"></i></div><div class="card-description"><p class="position gray">使用职位：<span class="position-name"><%this.job.positionName%></span><em class="vline"></em><%this.job.locationName%><em class="vline"></em><%this.job.lowSalary%>K-<%this.job.highSalary%>K</p><div class="position-category"><div class="position-tip">置顶职类<p class="fr gray">选择更多职类置顶，提升招聘效果，可享额外折扣</p></div><%if(1 < this.positionList.length){%><dl><dt><%this.positionList[0].name%></dt><%for(var i=1; i<this.positionList.length;i++){%><dd><%this.positionList[i].name%></dd><%}%></dl><%}%></div></div>',t)}},s=function(){setTimeout(function(){window.top.location.href="/chat/im?mu=/bossweb/joblist.html"},1e3)},a=function(){var e=$(".direct-card-pop .position-category .selected"),i=e.length>0?e.length:0,s=Math.min(i,t.positionDiscount.length-1),a=t.positionDiscount[s],n=1e3*t.positionList[0].price;e.each(function(e,i){var e=$(this).index();n+=1e3*t.positionList[e].price});var r=Math.floor(n*(1-a)/1e3);return{amount:n/1e3,discount:a,save:e.length>0?Math.ceil(n/1e3-r):0,pay:r}},n=function(){var t=a(),e="选择更多职类置顶，提升招聘效果，可享额外折扣";if(t.discount>0){e="招聘效果提升"+($(".direct-card-pop .position-category .selected").length+1)+"倍 额外立减"+100*t.discount+"% ",$(".direct-card-pop .position-tip .gray").addClass("discount-tip").text(e)}else $(".direct-card-pop .discount-tip").removeClass("discount-tip").text(e);$(".direct-card-pop .dialog-footer  .prop-total").remove();var i='<p class="prop-total">￥<em>'+t.pay;t.save>0&&(i+="</em><span>(已省"+t.save+")</span>"),i+="</p>",$(".direct-card-pop .dialog-footer .btns").append(i)},r=function(t){var e=a(),i=function(){Payment.success({article:"购买成功",text:"即刻置顶职位24小时，邀约匹配牛人投递,可在BOSS直聘APP「我的道具」中查看使用效果",confirm:function(){s()}})},n={url:"/boss/item/pay/quicktop.json",data:t,description:"购买简历直通卡",amount:e.pay,itemId:"b6ed128ee1b8d2841HI~",success:i,close:function(){},cancel:function(){}},r={success:i,close:function(){s()}};Payment.purchase(n,r)},o=function(e){t=$.extend({},e);$.dialog({bind:!0,title:"",closeLayer:!1,content:i.card(e),wrapClass:"direct-card-pop",confirmText:"购买并使用",cancelText:"取消",onOpen:function(t){$(t).on("click",".position-category dd",function(){$(this).toggleClass("selected"),n()}),n()},onConfirm:function(){var e=[];$(".direct-card-pop .position-category .selected").each(function(i,s,a){var n=$(this).index();e.push(t.positionList[n].code)});var i={jobId:t.job.jobId,positionCode:e.join(","),userCouponId:""};r(i),this.close(),__conversion("ermergency_buy")},onClose:function(t){$(t).off("click")},onCancel:function(){s()}})},c=function(t,a){var a=a||{};$.dialog({bind:!0,title:"",closeLayer:!1,content:i.recommend(t,a),wrapClass:"direct-card-pop",confirmText:!1,cancelText:!1,onOpen:function(i){var a=this;$(i).on("click",".bead-close",function(){a.close(),s()}),$(i).on("click",".introduce-panel .btn",function(){a.close(),e.prop(t.jobId).then(function(t){o(t)}),__conversion("ermergency_edit")}),__conversion("ermergency_card")},onClose:function(t){$(t).off("click")}})};return{show:o,notice:function(t){$.dialog({bind:!0,title:"",closeLayer:!1,content:i.notice(t),wrapClass:"direct-card-pop",confirmText:!1,cancelText:!1,onOpen:function(t){var e=this;$(t).on("click",".bead-close",function(){e.close(),s()})},onClose:function(t){$(t).off("click")}})},recommend:c}}(),CommercialGroup=function(){function t(t,e){$.dialog({bind:!0,title:"",content:t.content,confirmText:!1,cancelText:!1,wrapClass:"commercial-group-wrap",inline:!1,onOpen:function(){a(this,t)},onClose:function(){}})}var e={top:function(t){return Utemplate('<div class="commercial-group-top"><h3><%this.title%></h3><span class="gray"><%this.description%></span></div>',t)},footer:function(t){return Utemplate('<div class="commercial-footer"><p class="fl">如企业需要批量采购，请联系客服 <span class="phone">400-065-5799</span></p><span class="btn btn-sure fr"><%this.text%></span><%if(this.cancelText){%><span class="btn btn-outline fr"><%this.cancelText%></span><%}%><div class="combo-account fr"><p class="price"><span class="amount"><%this.beanCount%></span> <span class="unit">直豆</span></p><p class="discount-price"><%this.discountDesc%></p></div></div>',{beanCount:$.isArray(t.priceList)?t.priceList[t.priceList.length-1].beanCount:t.beanCount,discountDesc:t.discountDesc,text:t.button?t.button.text:"立即购买",cancelText:t.cancelText})},trial:function(t){return Utemplate('<div class="commercial-panel trial-panel" data-card-id="1"><p class="subhead"><%this.title%></p><ul class="commercial-item"><%for (var i=0; i<this.categoryList.length; i++) {%><li><p><%this.categoryList[i].bottomDesc%></p><span class="gray"><%this.categoryList[i].count%><%this.categoryList[i].unitDesc%></span></li><%}%></ul><div class="price"><span class="amount"><%this.beanCount%></span><span>直豆</span></div><p class="panel-description"><%this.bottomDesc%></p></div>',t)},vip:function(t){return Utemplate('<div class="commercial-panel vip-panel" data-card-id="3"><p class="subhead"><%this.title%></p><div class="commercial-item" data-price-id="<%this.encryptPriceId%>"><div class=""><div class="price"><span class="amount"><%this.beanCount%></span><span><%this.unitDesc%></span></div><table cellpadding="0" cellspacing="0"><thead><tr><td width="155">权益类型</td><td width="155">免费账号权益</td><td width="155">VIP专享权益</td></tr></thead><tbody><%for (var i=0; i < this.categoryList.length; i++) {%><tr><td><%this.categoryList[i].name%></td><td><%this.categoryList[i].currentRight%></td><td><%this.categoryList[i].vipRight%></td></tr><%}%></tbody></table></div></div><p class="panel-description"><%this.categoryList[0].bottomDesc%></p></div>',t)},flow:function(t){return Utemplate('<div class="commercial-panel flow-prop-panel" data-card-id="4"><p class="subhead"><%this.title%></p><ul><%for(var i=0;i<this.list.length; i++){%><li class="commercial-item"><div class="item-desc"><p>有效期<%this.list[i].inDate%></p><p class="gray"><%this.list[i].chat%></p></div><p class="bean-count"><%this.list[i].beanCount%></p></li><%}%></ul><p class="panel-description"><%this.bottomDesc%></p></div>',{title:t.title,list:function(t){var e=[];return $.each(t,function(t,i){e.push({showType:i.showType,chat:"每日沟通总量"+i.chatDescList[0],inDate:i.chatDescList[1],beanCount:i.chatDescList[2]})}),e}(t.priceList),bottomDesc:t.bottomDesc})},position:function(t){return Utemplate('<div class="commercial-panel position-panel" data-card-id="2"><p class="subhead"><%this.title%></p><div class="position-list"><%for(var i=0; i<this.list.length; i++){%><div class="commercial-item" data-price-id="<%this.list[i].encryptPriceId%>"><table cellpadding="0" cellspacing="0"><thead><tr><td class="t-item"><%this.list[i].priceName%></td><td class="t-detail"><%this.list[i].beanCount%><%this.list[i].unitDesc%></td></tr></thead><tbody><tr><td class="t-item"><%this.list[i].chatDesc%></td><td class="t-detail"><%this.list[i].chat%></td></tr><tr><td class="t-item"><%this.list[i].viewDesc%></td><td class="t-detail"><%this.list[i].view%></td></tr><tr><td class="t-item"><%this.list[i].impDesc%></td><td class="t-detail"><%this.list[i].imp%></td></tr></tbody></table></div><%}%></div><p class="panel-description"><%this.bottomDesc%></p></div>',{title:t.title,list:function(t){var e=[];return $.each(t,function(t,i){e.push({unitDesc:i.unitDesc,priceName:i.priceName,beanCount:i.beanCount,encryptPriceId:i.encryptPriceId,chatDesc:i.descList[0].bottomDesc,viewDesc:i.descList[1].bottomDesc,impDesc:i.length>2?i.descList[2].bottomDesc:"",chat:i.descList[0].count+i.descList[0].unitDesc,view:i.descList[1].count+i.descList[1].unitDesc,imp:i.length>2?i.descList[2].count+i.descList[2].unitDesc:""})}),e}(t.priceList),bottomDesc:t.bottomDesc})},positionItem:function(t,e){return t.isMulti=e,Utemplate('<table><tr><%if (this.isMulti) {%><td class="t-title" width="auto">火爆职位-<%this.priceName%></td><%}%><%for (var i=0; i<this.descList.length; i++){ %><td width="160"><%this.descList[i].count%><%this.descList[i].unitDesc%><br><%this.descList[i].bottomDesc%></td><%}%></tr></table>',t)},superPosition:function(t,i){var s='<div class="commercial-panel super-position-panel" data-card-id="6"><p class="subhead"><%this.title%></p><div class="vip-item">'+e.positionItem(t.priceList[0],i)+'</div><ul class="tap-option"><%for (var i=0; i<this.priceList.length; i++) {%><li class="commercial-item <%if(this.priceList[i].discountShowType == 1){%>discounts<%}%><%if(this.priceList[i].showType == 4){%> selected<%}%>"><%this.priceList[i].expireName%><span class="vip-price"><span class="vip-price-amount"><%this.priceList[i].beanCount%></span><%this.priceList[i].unitDesc%></span></li><%}%></ul><p class="panel-description"><%this.bottomDesc%></p></div>';return t.title=i?"付费发布职位":t.title,Utemplate(s,t)},vipItem:function(t){return Utemplate('<table cellpadding="0" cellspacing="0"><thead><tr><td width="260">权益类型</td><td width="260">免费账号权益</td><td width="155">VIP专享权益</td></tr></thead><tbody><%for (var i=0; i<this.categoryList.length; i++) {%><tr><td><%this.categoryList[i].name%></td><td><%this.categoryList[i].currentRight%></td><td><%this.categoryList[i].vipRight%></td></tr><%}%></tbody></table>',t)},superVip:function(t){var i='<div class="commercial-panel super-vip-panel" data-card-id="5"><p class="subhead"><%this.vipCardList[0].title%></p><div class="vip-item">'+e.vipItem(t.vipCardList[0])+'</div><ul class="tap-option"><%for (var i=0; i<this.vipCardList.length; i++) {%><li class="commercial-item <%if(this.vipCardList[i].discountShowType == 1){%>discounts<%}%><%if(this.vipCardList[i].showType == 4){%> selected<%}%>"><%this.vipCardList[i].expireName%><span class="vip-price"><span class="vip-price-amount"><%this.vipCardList[i].beanCount%></span><%this.vipCardList[i].unitDesc%></span></li><%}%></ul><p class="panel-description"><%this.vipCardList[0].bottomDesc%></p></div>';return t.vipCardList[0].categoryList.filter(function(t){return t.name.indexOf("解锁匿名牛人")>-1}).length&&(t.vipCardList[0].bottomDesc+="（解锁匿名牛人功能目前只支持6.03以上版本和网页版使用，暂不支持iOS）"),Utemplate(i,t)}},i={},s=function(){var t={},e=$(".commercial-group-wrap"),s=e.find(".selected").parents(".commercial-panel").attr("data-card-id"),a=i.cardList.filter(function(t){return t.cardId==s});if(a[0]&&a[0].priceList){var n=e.find(".selected").index();t.combo=a[0].priceList[n],t.combo.cardId=s,t.title=a[0].title}else if(a[0]&&a[0].vipCardList){var n=e.find(".selected").index();t.combo=a[0].vipCardList[n],t.combo.cardId=s,t.title=a[0].title}else t.combo=a[0];return t.card=a[0],t},a=function(t,a){var n=$(".commercial-group-wrap");n.off("click"),n.on("click",".commercial-item",function(){n.find(".selected").removeClass("selected"),$(this).addClass("selected");var t=s();t.combo.discountDesc?n.find(".combo-account .discount-price").text(t.combo.discountDesc):n.find(".combo-account .discount-price").text(""),n.find(".combo-account .amount").text(t.combo.beanCount),t.card.button?n.find(".commercial-footer .btn-sure").text(t.card.button.text):t.combo.button&&n.find(".commercial-footer .btn-sure").text(t.combo.button.text),6==t.card.cardId&&$(".super-position-panel .vip-item").html(e.positionItem(t.combo,i.cardList.length>1)),5==t.card.cardId&&$(".super-vip-panel .vip-item").html(e.vipItem(t.combo))}),n.on("click",".btn-sure",function(){var e=s();t.close(),a.confirm(e.card,e.combo)}),n.on("click",".btn-outline",function(){a.cancel(n),t.close()});var r=n.find(".commercial-panel").eq(0);r.find(".commercial-item.selected").length?r.find(".commercial-item.selected").trigger("click"):r.find(".commercial-item:last").trigger("click")},n=function(t){var i=[],s=t.length>1,a=function(t){return 1==t.cardId?e.trial(t):2==t.cardId?e.position(t):3==t.cardId?e.vip(t):4==t.cardId?e.flow(t):5==t.cardId?e.superVip(t):6==t.cardId?e.superPosition(t,s):void 0};return $.each(t,function(t,e){i.push(a(e))}),'<div class="commerical-group">'+i.join("")+"</div>"};return{block:function(s,a,r){i=$.extend({},s),t({content:e.top({title:s.shortDesc.name,description:s.hlShortDesc?s.hlShortDesc.name:""})+n(s.cardList)+e.footer($.extend(s.cardList[0],{cancelText:r.cancelText})),confirm:function(t,e){if(a&&a(t,e),t.button){var i=getQueryParams(t.button.url),s=Block.formatBA(i.ba);Block.action(s),e.ba=s}},cancel:function(){r.cancel&&r.cancel()}},s)}}}(),CommercialVip=function(){function t(t,e){$(t).on("click",".commercial-props-group li",function(){if(!$(this).hasClass("selected")){$(t).find(".commercial-props-group .selected").removeClass("selected"),$(this).addClass("selected"),n();var e=r();7==e.cardId?$(t).find(".item-description").html(s.key(e)):$(t).find(".item-description").html(s.vip(e))}}),$(t).find(".commercial-props-group li").eq(0).trigger("click"),$(t).on("click",".btn-sure",function(){var i=r();e.confirm(i,i),$(t).remove()})}function e(e,i){$.dialog({bind:!0,title:"",content:e.content,confirmText:!1,cancelText:!1,wrapClass:"commercial-props-wrap",inline:!1,onOpen:function(i){t(i,e)},onClose:function(){}})}function i(t){return'<div class="commercial-props-content">'+s.group(t)+'<div class="item-description">'+s.key(t[0])+"</div></div>"}var s={top:function(t){return Utemplate('<div class="commercial-group-top"><h3><%this.title%></h3><span class="gray"><%this.description%></span></div>',t)},footer:function(t){return Utemplate('<div class="commercial-footer"><span class="btn btn-sure fr"><%this.text%></span><%if(this.cancelText){%><span class="btn btn-outline fr"><%this.cancelText%></span><%}%><div class="commercial-props-account fr"><p class="price"><span class="amount"><%this.beanCount%></span> <span class="unit"><%this.unitDesc%></span></p><p class="discount-price"><%this.discountDesc%></p></div></div>',{beanCount:$.isArray(t.priceList)?t.priceList[t.priceList.length-1].beanCount:t.beanCount,discountDesc:t.discountDesc,text:"立即购买",cancelText:t.cancelText,unitDesc:t.unitDesc})},group:function(t){return Utemplate('<ul class="commercial-props-group"><%for(var i=0; i<this.list.length;i++){%><li data-card-id="<%this.list[i].cardId%>"><h5><%this.list[i].article%></h5><p class="desc"><%this.list[i].description%></p><p class="price"><%this.list[i].price%></p></li><%}%></ul>',{list:t.map(function(t){return 7==t.cardId?{cardId:t.cardId,article:"沟通钥匙",description:"限沟通1位牛人",price:t.beanCount+"直豆/次"}:8==t.cardId?{cardId:t.cardId,article:"VIP账号",description:"专享每日"+t.title.replace(/[^0-9]/gi,"")+"人沟通权益！",price:t.beanCount+"直豆/月"}:t})})},vip:function(t){return Utemplate('<div class="vip-list"><table cellpadding="0" cellspacing="0"><thead><tr><td width="180">权益类型</td><td width="180">免费账号权益</td><td width="180">VIP专享权益</td></tr></thead><tbody><%for (var i=0; i<this.categoryList.length; i++) {%><tr><td><%this.categoryList[i].name%></td><td><%this.categoryList[i].currentRight%></td><td><%this.categoryList[i].vipRight%></td></tr><%}%></tbody></table></div>',t)},key:function(){return'<div class="props-chat-key"><i class="icon-locked"></i><span>一键解锁心仪牛人，沟通畅聊无阻解锁后，该牛人长期沟通有效</span></div>'}},a={},n=function(){var t=$(".commercial-props-wrap .dialog-container"),e=r(),i=7==e.cardId?"直豆/次":"直豆/月",s='<p class="price"><span class="amount">'+e.beanCount+'</span> <span class="unit">'+i+"</span></p>";t.find(".commercial-props-account").html(s)},r=function(){var t=$(".commercial-props-wrap .dialog-container"),e=t.find(".commercial-props-group .selected").attr("data-card-id");return a.cardList.find(function(t){return t.cardId==e})};return{block:function(t,n,r){if(a=t,t.cardList.length<2){var o=t.cardList[0];return o.article="今日沟通人数已达上限<span>购买沟通钥匙，解锁该牛人</span>",n(o,o),!1}e({content:s.top({title:t.shortDesc?t.shortDesc.name:"今日沟通人数已达上限",description:t.hlShortDesc?t.hlShortDesc.name:"购买沟通钥匙，或升级VIP账号"})+i(t.cardList)+s.footer($.extend(t.cardList[0],{cancelText:r.cancelText})),confirm:function(t,e){if(n&&n(t,e),t.button){var i=getQueryParams(t.button.url),s=Block.formatBA(i.ba);Block.action(s),e.ba=s}},cancel:function(){r.cancel&&r.cancel()}},t)}}}(),Commercial=function(){function t(t,e){var i=function(t){var i=e.cardList.filter(function(e){return e.cardId==t})[0];if(!i.priceList)return i;var s=$(".commercial-content:visible").find("input:checked").parents("tr").index();return i.priceList[s]},s=function(t){return t.find(".commercial-tab .selected").length?t.find(".commercial-tab .selected").attr("data-card-id"):e.cardList[0].cardId},a=function(t){var a=s(t),n=e.cardList.filter(function(t){return t.cardId==a})[0],r={discountDesc:i(a).discountDesc,beanCount:i(a).beanCount,confirmText:n.button.text};r.confirmText&&t.find(".commercial-footer .btn-sure").text(r.confirmText);var o="";void 0!=r.beanCount&&(o+='<p class="price">'+r.beanCount+" 直豆</p>"),r.discountDesc&&(o+='<p class="discount-price">'+r.discountDesc+"</p>"),t.find(".commercial-footer .combo-account").html(o)},n=function(t){t.find(".commercial-tab li").off("click").on("click",function(){var e=$(this).index(),i=t.find(".commercial-content").eq(e);t.find(".commercial-tab .selected").removeClass("selected"),$(this).addClass("selected"),t.find(".commercial-content").hide(),i.show(),a(t)}),t.find(".commercial-tab li").eq(0).trigger("click")},r=function(t){t.find(".commercial-content td").off("click").on("click",function(t){var e=$(this).parents("tr").find("label.radio");e.length&&!$.contains(this,t.target)&&e.trigger("click")})},o=function(a){var n=s(a),r=e.cardList.filter(function(t){return t.cardId==n})[0],o=i(n);o.cardId=n,o.title=r.title,t.confirm(r,o)};$.dialog({bind:!0,title:"",content:t.content,confirmText:!1,cancelText:!1,wrapClass:"commercial-wrap",inline:!0,onOpen:function(e){var i=$(e),s=this;n(i),r(i),i.find(".btn-sure").off("click").on("click",function(){o(i),s.close()}),i.find(".btn-outline").off("click").on("click",function(){t.cancel(i),s.close()}),i.find("input[type=radio]").length&&i.find("input[type=radio]").off("change").on("change",function(){a(i)})},onClose:function(){}})}var e={top:function(t){return Utemplate('<div class="commercial-top"><p class="title"><%this.title%></p><%if(this.description != ""){%><p class="description"><%this.description%></p><%}%></div>',t)},footer:function(t){return Utemplate('<div class="commercial-footer"><p class="fl">如企业需要批量采购，请联系客服 <span class="phone">400-065-5799</span></p><span class="btn btn-sure fr"><%this.text%></span><%if(this.cancelText){%><span class="btn btn-outline fr"><%this.cancelText%></span><%}%><div class="combo-account fr"><p class="price"><%this.beanCount%> 直豆</p><p class="discount-price"><%this.discountDesc%></p></div></div>',{beanCount:$.isArray(t.priceList)?t.priceList[t.priceList.length-1].beanCount:t.beanCount,discountDesc:t.discountDesc,text:t.button.text,cancelText:t.cancelText})},tab:function(t){return Utemplate('<ul class="commercial-tab"><%for(var i=0;i<this.list.length;i++){%><li data-card-id="<%this.list[i].cardId%>"><%this.list[i].title%></li><%}%></ul>',{list:t})},trial:function(t){return Utemplate('<div class="commercial-content trial-panel"><ul><%for(var i=0; i<this.categoryList.length; i++){%><li><p class=""><span class="num"><%this.categoryList[i].count%></span><%this.categoryList[i].unitDesc%></p><span class="gray"><%this.categoryList[i].bottomDesc%></span></li><%}%></ul><p class="gray"><%this.bottomDesc%></p></div>',t)},vip:function(t){return t.categoryList.filter(function(t){return t.name.indexOf("解锁匿名牛人")>-1}).length&&(t.bottomDesc+="（解锁匿名牛人功能目前只支持6.03以上版本和网页版使用，暂不支持iOS）"),Utemplate('<div class="commercial-content vip-panel"><table><thead><tr><td class="title">VIP权益</td><td class="own">当前账号</td><td class="vip">VIP账号</td></tr></thead><tbody><%for (var i=0; i<this.categoryList.length; i++) {%><tr><td class="title"><%this.categoryList[i].name%></td><td class="own"><%this.categoryList[i].currentRight%></td><td class="vip"><%this.categoryList[i].vipRight%></td></tr><%}%></tbody></table><p class="gray"><%this.bottomDesc%></p></div>',t)},flow:function(t){return Utemplate('<div class="commercial-content flow-panel"><table><thead><td>每日沟通总量人数</td><td class="tc">赠送主动查看人数</td><td class="tc">有效期</td><td class="tr">价格</td></thead><tbody><%for(var i=0; i<this.list.length; i++){%><tr><td><label class="radio"><input type="radio" name="flowCombo" value="0" checked="checked"><span><%this.list[i].chat%></span><%if(this.list[i].showType == 4){%><i class="icon-rec">荐</i><%}%></label></td><td class="tc"><%this.list[i].view%></td><td class="tc"><%this.list[i].inDate%></td><td class="tr"><%this.list[i].beanCount%></td></tr><%}%></tbody></table><p class="gray"><%this.bottomDesc%></p></div>',{list:function(t){var e=[];return $.each(t,function(t,i){e.push({showType:i.showType,chat:i.chatDescList[0],view:"+"+2*parseInt((i.chatDescList[0]+"").replace(/\D/g,""),10)+"次",inDate:i.chatDescList[1],beanCount:i.chatDescList[2]})}),e}(t.priceList),bottomDesc:t.bottomDesc})},position:function(t){return Utemplate('<div class="commercial-content hot-panel"><table><tbody><%for(var i=0; i<this.list.length; i++){%><tr><td><label class="radio"><input type="radio" name="hotCombo" value="0" checked="checked"><span><%this.list[i].priceName%></span><%if(i==this.list.length-1){%><i class="icon-rec">荐</i><%}%></label></td><td class="tc"><%this.list[i].chat%></td><td class="tc"><%this.list[i].view%></td><td class="price"><%this.list[i].beanCount%>直豆／月</td></tr><%}%></tbody></table><p class="gray"><%this.bottomDesc%></p></div>',{list:function(t){var e=[];return $.each(t,function(t,i){e.push({priceName:i.priceName,beanCount:i.beanCount,chat:i.descList[0].count+i.descList[0].unitDesc+i.descList[0].bottomDesc,view:i.descList[1].count+i.descList[1].unitDesc+i.descList[1].bottomDesc})}),e}(t.priceList),bottomDesc:t.bottomDesc})}},i={vipPrice:function(t){var e=$.Deferred(),t=t||{sf:10};return $.get("/bossweb/vip2/price.json",t,function(t){1==t.rescode?e.resolve(t.blockPageData):$.toast({type:"error",content:t.resmsg})}),e}},s=function(t){return 1==t.cardId?e.trial(t):2==t.cardId?e.position(t):3==t.cardId?e.vip(t):4==t.cardId?e.flow(t):void 0},a=function(t){var i=[],a=[];return t.length<2?s(t[0]):($.each(t,function(t,e){i.push({title:e.title,cardId:e.cardId}),a.push(s(e))}),e.tab(i)+'<div class="combo-group">'+a.join("")+"</div>")},n=function(i,s,n){var n=n||{};if(i.cardList.length<1)return!1;var r=i.cardList[0].cardId,o=i.cardList.find(function(t){return 7===t.cardId});if(i.cardList.length>1||5==r||6==r||o)return o?CommercialVip.block(i,s,n):CommercialGroup.block(i,s,n),!0;t({content:e.top({title:i.shortDesc.name,description:i.hlShortDesc?i.hlShortDesc.name:""})+a(i.cardList)+e.footer($.extend(i.cardList[0],{cancelText:n.cancelText})),confirm:function(t,e){if(s&&s(t,e),t.button){var i=getQueryParams(t.button.url),a=Block.formatBA(i.ba);Block.action(a),e.ba=a}},cancel:function(){n.cancel&&n.cancel()}},i)};return{vip:function(t,e){var s=!1;i.vipPrice(t).then(function(t){n(t,function(t,i){var a=$.extend({isPurchase:!0,business:t.business,targetType:t.targetType},i);window.top.Purchase.commercial({priceId:a.encryptPriceId,targetId:t.encryptTargetId,business:a.business||"",targetType:a.targetType},{item:a,success:function(){!s&&e&&"function"==typeof e&&(e(),s=!0)}})})})},block:n}}(),SearchChatingCard=function(){function t(){function i(){var t=$(".commercial-props-wrap .dialog-container"),e=t.find(".commercial-props-group .selected").attr("data-card"),i=o();__conversion("chat"===e?"buy-chating-card":"buy-geek-call");var s=function(){n.option.success({card:e,left:n.option.left,chat:n.option.data.searchChatCard.chatCount})},a={url:"/boss/item/buy/othItem/"+i.id+".json",amount:parseInt(i.price,10),itemId:i.id,data:{},success:s};"call"==e&&(a.data.buyCount=i.count);var r={success:s};Payment.purchase(a,r)}function s(t,s){var a=$(t);a.on("click",".commercial-props-group li",function(){a.find(".commercial-props-group .selected").removeClass("selected"),$(this).addClass("selected");var t=n.option.data,i=$(this).attr("data-card"),s="call"==i?t.geekRights:t.searchChatCard;"call"==i?a.find(".item-description").html(e.call(n.option.left,s)):a.find(".item-description").html(e.chat(s)),c()}),a.on("click",".item-call-list p",function(){a.find(".item-call-list .selected").removeClass("selected"),$(this).addClass("selected"),c()}),a.on("click",".btn-sure",function(){var t=$(".commercial-props-wrap .dialog-container"),e=t.find(".commercial-props-group .selected").attr("data-card");n.option.left>0&&"call"==e?(n.option.success({card:e,left:n.option.left}),__conversion("use-geek-call")):i(),s.close()}),c()}function a(t,e){$.dialog({bind:!0,title:"",content:t.content,confirmText:!1,cancelText:!1,wrapClass:"commercial-props-wrap",inline:!1,onOpen:function(t){s(t,this)},onClose:function(){}})}var n=this,r=function(t){t.left=n.option.left;var i=t.left>0?"call":"chat",s="call"===i?t.geekRights:t.searchChatCard,r="call"===i?e.call(n.option.left,s):e.chat(s),o=e.group(i,t);a({content:e.top()+'<div class="commercial-props-content">'+o+'<div class="item-description">'+r+"</div></div>"+e.footer(n.option.left,s),confirm:function(t,e){},cancel:function(){option.cancel&&option.cancel()}},t)},o=function(){var t=$(".commercial-props-wrap .dialog-container"),e=t.find(".commercial-props-group .selected").attr("data-card"),i="call"==e?n.option.data.geekRights:n.option.data.searchChatCard;return $.isArray(i)?i[t.find(".item-call-list .selected").length?t.find(".item-call-list .selected").index():i.length-1]:i},c=function(){var t=$(".commercial-props-wrap .dialog-container"),e=t.find(".commercial-props-group .selected").attr("data-card"),i=o(),s=i.economize?parseInt(i.economize,10):0,a='<p class="price"><span class="amount">'+i.price+'</span> <span class="unit">直豆</span></p>';if("call"==e&&n.option.left>0)return t.find(".commercial-props-account").html(""),t.find(".btn-sure").text("立即使用"),
!1;t.find(".btn-sure").text("立即购买"),s&&(a+='<p class="discount-price">'+(s+parseInt(i.price,10))+"直豆</p>"),t.find(".commercial-props-account").html(a)};n.include=function(t){n.option=t;var e=t.data;return!!(e.geekRights&&e.searchChatCard&&e.canBuySearchCard)&&(r(e),!0)},t=function(){return n}}var e={top:function(t){return Utemplate('<div class="commercial-group-top"><h3>请选择道具</h3></div>',t)},footer:function(t,e){var i=function(){if($.isArray(e)){var i=e.length-1;return e[i].showPrice=t<0,e[i]}return e.showPrice=!0,e}();return Utemplate('<div class="commercial-footer"><span class="btn btn-sure fr"><%this.text%></span><%if(this.cancelText){%><span class="btn btn-outline fr"><%this.cancelText%></span><%}%><div class="commercial-props-account fr"><%if(this.showPrice){%><p class="price"><span class="amount"><%this.beanCount%></span> <span class="unit"><%this.unitDesc%></span></p><p class="discount-price"><%this.discountDesc%></p><%}%></div></div>',{beanCount:i.price,discountDesc:i.economize||"",text:i.button?i.button.text:"立即购买",cancelText:e.cancelText,unitDesc:"直豆",showPrice:i.showPrice})},group:function(t,e){return e.card=t,Utemplate('<ul class="commercial-props-group"><li <%if(this.card == "call"){%>class="selected"<%}%> data-card="call"><h5>牛人电话</h5><p class="desc">联络心仪牛人<br>48小时 不成功退道具</p><%if(0 < this.left){%><p class="left">剩余<%this.left%>个</p><%}else{%><p class="price"><%this.geekRightPrice%>直豆/次</p><%}%></li><li <%if(this.card != "call"){%>class="selected"<%}%> data-card="chat"><h5>搜索畅聊卡</h5><p class="desc">搜索达人必备<%this.searchChatCard.chatCount%>次沟通权益<br>一键解锁立即沟通</p><p class="price"><%this.searchChatCard.price%>直豆/月</p></li></ul>',e)},chat:function(t){return'<div class="search-desc-list"><dl><dd><i class="card-free"></i></dd><dt>30天畅聊</dt><dd>30日内畅聊'+t.chatCount+'位匿名牛人，搜索/推荐匿名牛人均可使用</dd></dl><dl><dd><i class="card-resume"></i></dd><dt>快速获取简历</dt><dd>短信通知牛人直接索要简历<br>同意投递自动发送至邮箱</dd></dl><dl><dd><i class="card-chat"></i></dd><dt>立即联络匿名牛人</dt><dd>直接对心仪匿名牛人开始沟通，不消耗每日沟通权益</dd></dl><p class="card-ios-notice">该道具目前只支持网页版和安卓6.09版本以上用户使用</p></div>'},call:function(t,e){return Utemplate('<div class="search-desc-list"><dl><dd><i class="card-geek"></i></dd><dt>精准搜索大牛</dt><dd>搜索公司/职位/技能，多维度精准定位你的心仪牛人</dd></dl><dl><dd><i class="card-call"></i></dd><dt>快速获取电话、简历</dt><dd>直接向牛人发送投递邀请，投递后电话简历直接发送至邮箱</dd></dl><dl><dd><i class="card-back"></i></dd><dt>不成功退道具</dt><dd>如牛人拒绝投递或48小时内无答复，将退还您的道具</dd></dl></div><%if(this.left == 0){%><div class="item-call-list"><%for(var i=0; i<this.list.length; i++){%><p <%if(i == (this.list.length - 1)){%>class="selected icon-discount"<%}%> ><%this.list[i].count%>次<i class="vline"></i><%this.list[i].price%>直豆</p><%}%></div><%}%>',{left:t,list:e})}};return new t}(),PropShop=function(){function t(){var e=this,i={props:function(t){return Utemplate('<div class="icon-top-call"></div><div class="prop-cont prop-sells"><ul><%for(var i=0;i<this.geekRights.length; i++){%><li data-id="<%this.geekRights[i].id%>" class="<%if(this.geekRights[i].count == 10){%>selected hot<%}%>" ><span class="text-orange fr">￥<%this.geekRights[i].price%></span><p class="fl">购买<%this.geekRights[i].count%>个牛人电话<%if(this.geekRights[i].economize!=0){%><span class="gray">（节省￥<%this.geekRights[i].economize%>）</span><%}%></p></li><%}%></ul><div class="sells-pay"></div></div>',t)},consume:function(t){return Utemplate('<div><p class="icon-top-call"></p></div><div class="prop-chat"><h3>使用牛人电话道具联系牛人</h3><p class="gray">请选择与牛人沟通的职位</p><div class="dropdown-wrap J_stickPosition"><span class="dropdown-select"><i class="icon-select-arrow"></i><input type="text" placeholder="待沟通的职位" class="ipt sel-active" readonly=""><p class="input-mask"><%this.job.jobName%><i class="vline"></i><%this.job.lowSalary%>-<%this.job.highSalary%>K</p><input type="hidden" value="<%this.job.encryptId%>"></span><div class="dropdown-menu"><ul><%for(var i=0;i<this.jobs.length;i++){%><li data-id="<%this.jobs[i].encryptId%>"><%this.jobs[i].jobName%><i class="vline"></i><%this.jobs[i].lowSalary%>-<%this.jobs[i].highSalary%>K</li><%}%></ul></div></div></div>',t)}},s={props:function(){var t=$.Deferred();return $.get("/boss/item/getGeekInfoRightAndBeanCount.json",function(e){t.resolve(e)}),t},job:function(t){var e=$.Deferred();return $.get("/boss/item/getJobByGeekId.json",t,function(t){e.resolve(t)}),e},jobList:function(){var t=$.Deferred();return $.get("/chat/user/joblist.json",function(e){t.resolve(e.data)}),t},consume:function(t,e){var i=$.Deferred();return $.get("/boss/item/useGeekInfoRight/"+t+".json",e,function(t){i.resolve(t)}),i}};e.consume=function(t,e){$.when(s.jobList(),s.job(t)).then(function(a,n){n.jobs=a,$.dialog({bind:!0,title:"",closeText:!1,content:i.consume(n),confirmText:"联系牛人",cancelText:!1,wrapClass:"prop-item-chat",onOpen:function(t){DropDown.init($(t)),$(t).on("click",".dropdown-menu li",function(){$(t).find(".input-mask").html($(this).html()),$(t).find(".J_stickPosition input[type=hidden]").val($(this).attr("data-id"))})},onConfirm:function(i){var a=$(i).find(".J_stickPosition input[type=hidden]").val();$(i).find(".btn-sure").addClass("disabled"),s.consume(a,t).then(function(t){e.success&&e.success(t),$(i).remove()})}})})},e.buy=function(t){var t=t||{},e=function(e){var s=function(){var t=$(".prop-item-call .selected").attr("data-id");return e.geekRights.find(function(e){return e.id==t})};$.dialog({bind:!0,title:"",closeText:!1,content:i.props(e),confirmText:"购买",cancelText:!1,wrapClass:"prop-item-call",onOpen:function(t){var i=function(){var i=s(),a=parseInt(i.price,10),n='<p class="fr">需要支付：<em class="text-orange">¥'+(e.beanCount>a?0:a-e.beanCount)+"</em></p><p><span>金额：¥"+a+"</span><span>余额：¥"+e.beanCount+"</span></p>";$(t).find(".sells-pay").html(n)};$(t).on("click",".prop-sells li",function(){$(t).find(".selected").removeClass("selected"),$(this).addClass("selected"),i()}),i()},onConfirm:function(e){var i=s(),a=t.success||function(t){},n={url:"/boss/item/buy/othItem/"+i.id+".json",amount:i.price,description:"购买道具：「牛人电话」- "+i.count+" 个",data:{buyCount:1},itemId:i.id,success:a},r={success:a};this.close(),window.top.Payment.purchase(n,r)}})};t.props?e(t.props):s.props().then(function(t){e(t)})},t=function(){return e}}return{geekPropCall:new t}}();Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){var i;if(null==this)throw new TypeError('"this" is null or not defined');var s=Object(this),a=s.length>>>0;if(0===a)return-1;var n=0|e;if(n>=a)return-1;for(i=Math.max(n>=0?n:a-Math.abs(n),0);i<a;){if(i in s&&s[i]===t)return i;i++}return-1}),Array.prototype.isArray||(Array.prototype.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var chatUserModel,chatUserView,chatUserPresenter;!function(){function t(e){var i=this,a=[];i.connect=function(t){Array.isArray(t)&&(a=a.concat(t))},i.add=function(t){a.push(t)},i.filter=function(t,e){var i=s.filter(),a=i.top.length;if(!t)return e({top:i.top,list:i.normal.slice(0,100-a)});var n=[],r=[].concat(t),o=function(t){for(var e=r.length;e--;)r[e]==t&&r.splice(e,1)};return $.each(i,function(t,e){r.indexOf(e.uid)>-1&&(n.push(e),o(e.uid))}),{group:n,exclusive:r}},i.aggregator=new EventManger,t=function(){return i}}function e(t,e){function i(t){var e=$(".condition-filter dl"),i=$(".chat-container .op-category .cur"),s=$(".top-chat .dropdown-select").attr("data-jobid"),a={page:0,status:i.attr("data-status")?i.attr("data-status"):"",origin:i.attr("data-origin")?i.attr("data-origin"):"-1",jobid:s||"-1",rank:1,salary:e.eq(0).find(".cur").attr("data-salary"),experience:e.eq(1).find(".cur").attr("data-experience"),degree:e.eq(2).find(".cur").attr("data-degree")};Chat.filterParms=a,Chat.groupStatus=a.status,t&&t.find(".icon-category-refresh").addClass("loading-category-refresh"),Chat.usersInitStatus&&Chat.getFilterUsers(a,null,!1)}var n=[],r=$(".chat-container"),o=e;this.toggleStick=function(){var t=$(".user-list .cur"),e=t.parents("ul").hasClass("top-list"),i=e?n.top:n.list,a=i[t.index()];a.isTop=Number(!e),s.setStatus(a.uid,a),o.toggleStick(t,e)},this.filter=function(){},this.flushJob=function(){Chat.filterRadio=!1,Chat.filterGroup=!1,$(".top-chat .dropdown-menu li:first-child").length?$(".top-chat .dropdown-menu li:first-child").trigger("click"):i()},this.batch=function(t,e){$.each(t,function(t,i){Chat.usersData[i].relationType=e,o.batch(i,e)})},this.setStatus=function(t,e,i){var s=void 0==i||i;e&&(Chat.usersData[t].relationType=e,o.transformation(e,t,s))},this.viewed=function(t){o.viewed(t)},this.init=function(t){o.render()};var c=function(){if(($(this).attr("data-status")||$(this).attr("data-origin"))&&!$(this).hasClass("cur")){Chat.curUserData&&Chat.setDraft(Chat.curUserData.uid),r.find(".op-category .cur").removeClass("cur"),$(this).addClass("cur"),i();var t=$(this).attr("data-status");o=-1!=t&&t?5==t?a.factory("news"):a.factory("other"):a.factory("all"),Chat.chatEl.hide(),Chat.welcomeEl.show()}},l=function(){$(this).parents("dl").find(".cur").removeClass("cur"),$(this).addClass("cur");var t=Chat.containerChat.find(".sel-filter");t.find(".filter-cancel").length||(t.prepend('<span class="filter-cancel" ka="main_filter_cancel"><i class="icon-category-filter"></i>取消筛选</span>'),t.find(".dropdown-select").html("&nbsp;")),i()},d=function(){if(r.find(".group-more .dropdown-wrap").removeClass(".dropdown-menu-open"),$(this).attr("data-val")){Chat.curUserData&&Chat.setDraft(Chat.curUserData.uid),o=a.factory("all"),r.find(".group-btns.group-more .btn-filtered").remove();var t='<a href="javascript:;" class="cur btn-filtered" data-origin="'+$(this).attr("data-val")+'">'+$(this).text()+"</a>",e=r.find(".group-btns.group-more");r.find(".op-category .group-btns .cur").removeClass("cur"),$(t).insertBefore(e.find(".dropdown-wrap")),i()}},h=function(){$(".top-chat .dropdown-select").text($(this).text()).attr("data-jobid",$(this).attr("data-jobid")),r.find(".op-category .group-btns .cur").removeClass("cur"),r.find(".op-category .group-btns a").eq(0).addClass("cur"),r.find(".condition-filter .cur").removeClass("cur"),r.find(".filter-cancel").trigger("click"),i(),o=a.factory("all")},u=function(){r.find(".condition-filter .cur").removeClass("cur"),r.find(".condition-filter dl").each(function(){$(this).find("a:first-child").addClass("cur")});var t=Chat.containerChat.find(".sel-filter");t.find(".filter-cancel").remove(),t.find(".dropdown-select").html('<span class="dropdown-select"><i class="icon-category-filter"></i>筛选</span>'),i()},p=function(t,e){e&&"flush"==e.action&&$(".top-chat .dropdown-menu li:first-child").trigger("click"),setTimeout(function(){Chat.batchHandle.close()},10)};!function(){r.on("click",".op-category .group-btns a",c),r.on("click",".condition-filter dd a",l),r.on("click",".group-more li",d),r.on("click",".sel-refresh",function(){if(Chat.filterGroup)return!1;i($(this));try{_T.sendEvent("Chat_refresh_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view)}catch(t){}}),r.on("click",".filter-cancel",u),$(".top-chat .dropdown-menu li").on("click",h),$(document).on("MENU_ROUTE_CHAT",p)}()}function i(){$(".chat-container");this.aggregator=new EventManger,this.toggleStick=function(t,e){var i=Number(e),s=t.clone();t.remove(),$(".user-list ul").eq(i).prepend(s)},this.batch=function(t){},this.viewed=function(t,e){};this.getTemplate=function(t){return""},this.render=function(t){},this.renderUser=function(){}}var s=function(){var t={},e=function(e){var i=!1;return $.each(t,function(t,s){if(s.uid==e)return i=t,!0}),i},i=function(e){if(!Array.isArray(e))return t},s=function(t,e){},a=function(e,i){t={top:e,normal:i}};return{push:s,filter:i,setStatus:function(i,s){var a=e(i),n=$.extend({},t[a],s);t[a]=n},enqueue:a}}(),a=function(){var t={},e={6:'<p class="deal-layer icon-commun"><i></i>沟通中</p>',7:'<p class="deal-layer icon-pass"><i></i>合适</p>',8:'<p class="deal-layer icon-fail"><i></i>不合适</p>',99:'<p class="deal-layer icon-read"><i></i>待处理</p>'},s={6:"cur user-communication",7:"cur user-pass",8:"cur user-fail",99:"cur"},a={"-1":"全部",1:"新",5:"待处理的",6:"沟通中的",7:"合适的",8:"不合适的"},n=function(){Chat.userList.find("li").length<1&&(Chat.userList.find(".user-blank").remove(),Chat.userList.append('<div class="user-blank"><p>暂无'+a[Chat.groupStatus]+"牛人</p></div>"))},r=function(t,i,a,r){var o=a?Chat.userList.find("a[data-uid="+a+"]").parent("li"):Chat.userList.find(".cur");o.find(".deal-layer").length||(o.prepend(e[t]),o.attr("class",s[t])),o.addClass("dealSlideRight"),setTimeout(function(){var t=o.next().length?"next":"up";o.slideUp(function(){i&&Chat.curUserData.uid==a&&(Chat.chatEl.hide(),Chat.welcomeEl.show(),Chat.changeUserView(o,t)),o.remove(),n()})},500)};return t.all=function(){i.call(this,arguments),this.effect={},this.transformation=function(t,e){Chat.usersData[e];if(8==t)r(t,!0,e);else{Chat.userList.find("a[data-uid="+e+"]").parent("li").attr("class",s[t])}},this.batch=function(t,e){var i=Chat.userList.find("a[data-uid="+t+"]").parents("li");if(8==e)return void i.remove();i.hasClass("cur")?i.attr("class",s[e]):i.attr("class",s[e]).removeClass("cur")}},t.undisposed=function(){i.call(this,arguments),this.effect={}},t.news=function(){i.call(this,arguments),this.effect={},this.transformation=function(t,e){r(t,!0,e),Chat.newGeek.indexOf(e)>-1&&Chat.newGeek.splice(Chat.newGeek.indexOf(e),1),Chat.totalNewGeek(),Chat.groupHistory[5]=void 0},this.batch=function(t,e){var i=Chat.userList.find("a[data-uid="+t+"]").parents("li");i.hasClass("cur")&&(Chat.chatEl.hide(),Chat.welcomeEl.show()),i.remove(),Chat.newGeek.indexOf(t)>-1&&Chat.newGeek.splice(Chat.newGeek.indexOf(t),1),Chat.totalNewGeek(),n()},this.viewed=function(t){var e=Chat.userList.find("a[data-uid="+t+"]").parents("li"),i=Chat.userList.find(".notice-badge:last").closest("li");e.length&&e.hasClass("modify")&&(e.removeClass("modify"),function(){var t=e.prev().index()==i.index();return i.length&&!t}()&&function(t){var e=t.clone().css({height:"0",overflow:"hidden"}),s=i.height();e.insertAfter(i),e.animate({height:s},150),t.animate({height:0,overflow:"hidden"},150,function(){t.remove()})}(e))}},t.appropriate=function(){i.call(this,arguments),this.effect={}},t.inappropriate=function(){i.call(this,arguments),this.effect={}},t.inContact=function(){i.call(this,arguments),this.effect={}},t.other=function(){i.call(this,arguments),this.transformation=function(t,e,i){r(t,i,e)},this.batch=function(t,e){var i=Chat.userList.find("a[data-uid="+t+"]").parents("li");i.hasClass("cur")&&(Chat.chatEl.hide(),Chat.welcomeEl.show()),i.remove()}},{factory:function(e){return new t[e]}}}();chatUserModel=new t,chatUserView=a.factory("all"),chatUserPresenter=new e(chatUserModel,chatUserView),chatUserPresenter.init()}();var ChatGroups=function(){function t(){var t=this,s=[],a=[];t.list=[],t.messages=[],t.between=function(t,e){return e&&t?a.filter(function(i){return t<=i.lastTS&&e>i.lastTS}):a},t.tops=function(){return t.list.filter(function(t){return 1==t.isTop}).sort(e)},t.add=function(e){t.list.push(e),a.push(e)},t.get=function(e){return t.list.find(function(t){return t.groupId==e||t.encryptGid==e})},t.getGroupList=function(e){i.list(1).then(function(i){if(i&&i.length){var n=i.filter(function(t){return t.isTop}),r=i.filter(function(t){return!t.isTop});s=n,a=a.concat(r),t.list=i}e(i);for(var o=0;o<t.messages.length;o++)Chat.countGroupMessage(t.messages[o],{source:"presence"})})},t.pushMessage=function(e){t.messages.push(e)}}var e=function(t,e){return e.isTop-t.isTop||e.lastTS-t.lastTS},i={list:function(t){var e=$.Deferred();return $.get("/group/chat/groupInfoList.json?page="+t,function(t){e.resolve(t.data)}),e}};return new t}(),GroupMessage=function(){var t=function(t){var e={1:"text",2:"sound",3:"image",18:"jobShare",19:"resumeShare",20:"sticker"};return e[t.body.type]&&3!==t.body.templated&&3!==t.body.templateId?e[t.body.type]:"system"},e=function(t){var e={1:"text",2:"text",3:"image",18:"text",19:"text",20:"image"};return 3===t.body.templated||3===t.body.templateId?"system":e[t.body.type]},i=function(t,e){var i="";if("jobShare"===t){var s="string"==typeof e.body.jobShare?JSON.parse(e.body.jobShare):e.body.jobShare;i="[Ta分享了<"+s.position+">职位，具体请在手机查看]"}if("resumeShare"===t){var s="string"==typeof e.body.resumeShare?JSON.parse(e.body.resumeShare):e.body.resumeShare;i="[Ta分享了<"+s.user.name+">的简历，具体请在手机查看]"}return"sound"===t&&(i="[语音消息]请在手机上收听"),e.body.text&&(i=e.body.text),"image"===t&&(i="发来一张图片"),"sticker"===t&&(i="[动画表情]"),i.replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\n/g,"<br/>").replace(/\\n/g,"<br/>").replace(/&amp;middot;/g,"&#183;").replace(/&amp;lt;/g,"&#60;").replace(/&amp;gt;/g,"&#62;").replace(/&lt;/g,"&#60;").replace(/&gt;/g,"&#62;").replace(/&middot;/g,"")},s=function(t,e){if("image"===t)return"string"==typeof e.body.image?JSON.parse(e.body.image):e.body.image;if("sticker"===t){if("string"==typeof e.body.sticker)return JSON.parse(e.body.sticker);var i=e.body.sticker.image;return{origUrl:i.originImage.url,origWidth:i.originImage.width,origHeight:i.originImage.height}}return{}},a=function(t,e){return e.isSelf||e.from?e.from:{uid:e.fromId,name:e.from?e.from.name:e.name,avatar:e.from?e.from.avatarUrl:e.avatarUrl,position:e.position,company:e.company}};return{formate:function(n){if(!$.isArray(n))return[];var r=0,o=n.map(function(n){var o=t(n),c=a(0,n);return(r>n.messageId||0==r)&&(r=n.messageId),{type:o,name:c.name,avatar:c.avatar+"?x-oss-process=image/resize,w_60,limit_0",isSelf:_PAGE.uid==c.uid,action:_PAGE.uid==c.uid||n.isSelf?"sent":"received",text:Emotion.textCodeToImg(i(o,n)),originalText:i(o,n),style:e(n),image:s(o,n),company:c.company,position:c.position||"",isAdmin:n.isAdmin,certification:n.certification,time:n.time,messageId:n.messageId,fromId:c.uid,toId:n.to?n.to.uid:n.toId}});return Chat.curUserData.maxMsgId=r,o.filter(function(t){return(t.text||"image"==t.type)&&t.type})}}}();!function(t,e){"function"==typeof define&&define.amd?define([],function(){(t.dcodeIO=t.dcodeIO||{}).Long=e()}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()}(this,function(){"use strict";function t(t,e,i){this.low=0|t,this.high=0|e,this.unsigned=!!i}function e(t){return!0===(t&&t.__isLong__)}function i(t,e){var i,s,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(s=c[t])?s:(i=a(t,(0|t)<0?-1:0,!0),n&&(c[t]=i),i)):(t|=0,(n=-128<=t&&t<128)&&(s=o[t])?s:(i=a(t,t<0?-1:0,!1),n&&(o[t]=i),i))}function s(t,e){if(isNaN(t)||!isFinite(t))return e?g:f;if(e){if(t<0)return g;if(t>=h)return C}else{if(t<=-u)return w;if(t+1>=u)return b}return t<0?s(-t,e).neg():a(t%d|0,t/d|0,e)}function a(e,i,s){return new t(e,i,s)}function n(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return f;if("number"==typeof e?(i=e,e=!1):e=!!e,(i=i||10)<2||36<i)throw RangeError("radix");var a;if((a=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===a)return n(t.substring(1),e,i).neg();for(var r=s(l(i,8)),o=f,c=0;c<t.length;c+=8){var d=Math.min(8,t.length-c),h=parseInt(t.substring(c,c+d),i);if(d<8){var u=s(l(i,d));o=o.mul(u).add(s(h))}else o=o.mul(r),o=o.add(s(h))}return o.unsigned=e,o}function r(e){return e instanceof t?e:"number"==typeof e?s(e):"string"==typeof e?n(e):a(e.low,e.high,e.unsigned)}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),t.isLong=e;var o={},c={};t.fromInt=i,t.fromNumber=s,t.fromBits=a;var l=Math.pow;t.fromString=n,t.fromValue=r;var d=4294967296,h=d*d,u=h/2,p=i(1<<24),f=i(0);t.ZERO=f;var g=i(0,!0);t.UZERO=g;var m=i(1);t.ONE=m;var v=i(1,!0);t.UONE=v;var y=i(-1);t.NEG_ONE=y;var b=a(-1,2147483647,!1);t.MAX_VALUE=b;var C=a(-1,-1,!0);t.MAX_UNSIGNED_VALUE=C;var w=a(0,-2147483648,!1);t.MIN_VALUE=w;var T=t.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var e=s(t),i=this.div(e),a=i.mul(e).sub(this);return i.toString(t)+a.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var n=s(l(t,6),this.unsigned),r=this,o="";;){var c=r.div(n),d=r.sub(c.mul(n)).toInt()>>>0,h=d.toString(t);if(r=c,r.isZero())return h+o;for(;h.length<6;)h="0"+h;o=""+h+o}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;e>0&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},T.isZero=function(){return 0===this.high&&0===this.low},T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return e(t)||(t=r(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.greaterThan=function(t){return this.comp(t)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return this.comp(t)>=0},T.gte=T.greaterThanOrEqual,T.compare=function(t){if(e(t)||(t=r(t)),this.eq(t))return 0;var i=this.isNegative(),s=t.isNegative();return i&&!s?-1:!i&&s?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(m)},T.neg=T.negate,T.add=function(t){e(t)||(t=r(t));var i=this.high>>>16,s=65535&this.high,n=this.low>>>16,o=65535&this.low,c=t.high>>>16,l=65535&t.high,d=t.low>>>16,h=65535&t.low,u=0,p=0,f=0,g=0;return g+=o+h,f+=g>>>16,g&=65535,f+=n+d,p+=f>>>16,f&=65535,p+=s+l,u+=p>>>16,p&=65535,u+=i+c,u&=65535,a(f<<16|g,u<<16|p,this.unsigned)},T.subtract=function(t){return e(t)||(t=r(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){if(this.isZero())return f;if(e(t)||(t=r(t)),t.isZero())return f;if(this.eq(w))return t.isOdd()?w:f;if(t.eq(w))return this.isOdd()?w:f;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(p)&&t.lt(p))return s(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,n=65535&this.high,o=this.low>>>16,c=65535&this.low,l=t.high>>>16,d=65535&t.high,h=t.low>>>16,u=65535&t.low,g=0,m=0,v=0,y=0;return y+=c*u,v+=y>>>16,y&=65535,v+=o*u,m+=v>>>16,v&=65535,v+=c*h,m+=v>>>16,v&=65535,m+=n*u,g+=m>>>16,m&=65535,m+=o*h,g+=m>>>16,m&=65535,m+=c*d,g+=m>>>16,m&=65535,g+=i*u+n*h+o*d+c*l,g&=65535,a(v<<16|y,g<<16|m,this.unsigned)},T.mul=T.multiply,T.divide=function(t){if(e(t)||(t=r(t)),t.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?g:f;var i,a,n;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return g;if(t.gt(this.shru(1)))return v;n=g}else{if(this.eq(w)){if(t.eq(m)||t.eq(y))return w;if(t.eq(w))return m;return i=this.shr(1).div(t).shl(1),i.eq(f)?t.isNegative()?m:y:(a=this.sub(t.mul(i)),n=i.add(a.div(t)))}if(t.eq(w))return this.unsigned?g:f;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=f}for(a=this;a.gte(t);){i=Math.max(1,Math.floor(a.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(i)/Math.LN2),c=o<=48?1:l(2,o-48),d=s(i),h=d.mul(t);h.isNegative()||h.gt(a);)i-=c,d=s(i,this.unsigned),h=d.mul(t);d.isZero()&&(d=m),n=n.add(d),a=a.sub(h)}return n},T.div=T.divide,T.modulo=function(t){return e(t)||(t=r(t)),this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.not=function(){return a(~this.low,~this.high,this.unsigned)},T.and=function(t){return e(t)||(t=r(t)),a(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return e(t)||(t=r(t)),a(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return e(t)||(t=r(t)),a(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):a(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?a(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):a(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;if(t<32){return a(this.low>>>t|i<<32-t,i>>>t,this.unsigned)}return 32===t?a(i,0,this.unsigned):a(i>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&t,t>>>8&255,t>>>16&255,t>>>24&255]},T.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e]},t}),function(t,e){"function"==typeof define&&define.amd?define(["chat-long.js"],function(){(t.dcodeIO=t.dcodeIO||{}).ByteBuffer=e(t.dcodeIO.Long)}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=function(){var t;try{t=require("long")}catch(t){}return e(t)}():(t.dcodeIO=t.dcodeIO||{}).ByteBuffer=e(t.dcodeIO.Long)}(this,function(t){"use strict";function e(t){var e=0;return function(){return e<t.length?t.charCodeAt(e++):null}}function i(){var t=[],e=[];return function(){if(0===arguments.length)return e.join("")+c.apply(String,t);t.length+arguments.length>1024&&(e.push(c.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}}function s(t,e,i,s,a){var n,r,o=8*a-s-1,c=(1<<o)-1,l=c>>1,d=-7,h=i?a-1:0,u=i?-1:1,p=t[e+h];for(h+=u,n=p&(1<<-d)-1,p>>=-d,d+=o;d>0;n=256*n+t[e+h],h+=u,d-=8);for(r=n&(1<<-d)-1,n>>=-d,d+=s;d>0;r=256*r+t[e+h],h+=u,d-=8);if(0===n)n=1-l;else{if(n===c)return r?NaN:1/0*(p?-1:1);r+=Math.pow(2,s),n-=l}return(p?-1:1)*r*Math.pow(2,n-s)}function a(t,e,i,s,a,n){var r,o,c,l=8*n-a-1,d=(1<<l)-1,h=d>>1,u=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=s?0:n-1,f=s?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,r=d):(r=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-r))<1&&(r--,c*=2),e+=r+h>=1?u/c:u*Math.pow(2,1-h),e*c>=2&&(r++,c/=2),r+h>=d?(o=0,r=d):r+h>=1?(o=(e*c-1)*Math.pow(2,a),r+=h):(o=e*Math.pow(2,h-1)*Math.pow(2,a),r=0));a>=8;t[i+p]=255&o,p+=f,o/=256,a-=8);for(r=r<<a|o,l+=a;l>0;t[i+p]=255&r,p+=f,r/=256,l-=8);t[i+p-f]|=128*g}var n=function(t,e,i){if(void 0===t&&(t=n.DEFAULT_CAPACITY),void 0===e&&(e=n.DEFAULT_ENDIAN),void 0===i&&(i=n.DEFAULT_NOASSERT),!i){if((t|=0)<0)throw RangeError("Illegal capacity");e=!!e,i=!!i}this.buffer=0===t?o:new ArrayBuffer(t),this.view=0===t?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=t,this.littleEndian=e,this.noAssert=i};n.VERSION="5.0.1",n.LITTLE_ENDIAN=!0,n.BIG_ENDIAN=!1,n.DEFAULT_CAPACITY=16,n.DEFAULT_ENDIAN=n.BIG_ENDIAN,n.DEFAULT_NOASSERT=!1,n.Long=t||null;var r=n.prototype;r.__isByteBuffer__,Object.defineProperty(r,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var o=new ArrayBuffer(0),c=String.fromCharCode;n.accessor=function(){return Uint8Array},n.allocate=function(t,e,i){return new n(t,e,i)},n.concat=function(t,e,i,s){"boolean"!=typeof e&&"string"==typeof e||(s=i,i=e,e=void 0);for(var a,r=0,o=0,c=t.length;o<c;++o)n.isByteBuffer(t[o])||(t[o]=n.wrap(t[o],e)),(a=t[o].limit-t[o].offset)>0&&(r+=a);if(0===r)return new n(0,i,s);var l,d=new n(r,i,s);for(o=0;o<c;)l=t[o++],(a=l.limit-l.offset)<=0||(d.view.set(l.view.subarray(l.offset,l.limit),d.offset),d.offset+=a);return d.limit=d.offset,d.offset=0,d},n.isByteBuffer=function(t){return!0===(t&&t.__isByteBuffer__)},n.type=function(){return ArrayBuffer},n.wrap=function(t,e,i,s){if("string"!=typeof e&&(s=i,i=e,e=void 0),"string"==typeof t)switch(void 0===e&&(e="utf8"),e){case"base64":return n.fromBase64(t,i);case"hex":return n.fromHex(t,i);case"binary":return n.fromBinary(t,i);case"utf8":return n.fromUTF8(t,i);case"debug":return n.fromDebug(t,i);default:throw Error("Unsupported encoding: "+e)}if(null===t||"object"!=typeof t)throw TypeError("Illegal buffer");var a;if(n.isByteBuffer(t))return a=r.clone.call(t),a.markedOffset=-1,a;if(t instanceof Uint8Array)a=new n(0,i,s),t.length>0&&(a.buffer=t.buffer,a.offset=t.byteOffset,a.limit=t.byteOffset+t.byteLength,a.view=new Uint8Array(t.buffer));else if(t instanceof ArrayBuffer)a=new n(0,i,s),t.byteLength>0&&(a.buffer=t,a.offset=0,a.limit=t.byteLength,a.view=t.byteLength>0?new Uint8Array(t):null);else{if("[object Array]"!==Object.prototype.toString.call(t))throw TypeError("Illegal buffer");a=new n(t.length,i,s),a.limit=t.length;for(var o=0;o<t.length;++o)a.view[o]=t[o]}return a},r.writeBitSet=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if(!(t instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var s,a=e,n=t.length,r=n>>3,o=0;for(e+=this.writeVarint32(n,e);r--;)s=1&!!t[o++]|(1&!!t[o++])<<1|(1&!!t[o++])<<2|(1&!!t[o++])<<3|(1&!!t[o++])<<4|(1&!!t[o++])<<5|(1&!!t[o++])<<6|(1&!!t[o++])<<7,this.writeByte(s,e++);if(o<n){var c=0;for(s=0;o<n;)s|=(1&!!t[o++])<<c++;this.writeByte(s,e++)}return i?(this.offset=e,this):e-a},r.readBitSet=function(t){var e=void 0===t;e&&(t=this.offset);var i,s=this.readVarint32(t),a=s.value,n=a>>3,r=0,o=[];for(t+=s.length;n--;)i=this.readByte(t++),o[r++]=!!(1&i),o[r++]=!!(2&i),o[r++]=!!(4&i),o[r++]=!!(8&i),o[r++]=!!(16&i),o[r++]=!!(32&i),o[r++]=!!(64&i),o[r++]=!!(128&i);if(r<a){var c=0;for(i=this.readByte(t++);r<a;)o[r++]=!!(i>>c++&1)}return e&&(this.offset=t),o},r.readBytes=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+"+t+") <= "+this.buffer.byteLength)}var s=this.slice(e,e+t);return i&&(this.offset+=t),s},r.writeBytes=r.append,r.writeInt8=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=1,this.view[e]=t,i&&(this.offset+=1),this},r.writeByte=r.writeInt8,r.readInt8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var i=this.view[t];return 128==(128&i)&&(i=-(255-i+1)),e&&(this.offset+=1),i},r.readByte=r.readInt8,r.writeUint8=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=1;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=1,
this.view[e]=t,i&&(this.offset+=1),this},r.writeUInt8=r.writeUint8,r.readUint8=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var i=this.view[t];return e&&(this.offset+=1),i},r.readUInt8=r.readUint8,r.writeInt16=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),i&&(this.offset+=2),this},r.writeShort=r.writeInt16,r.readInt16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[t],i|=this.view[t+1]<<8):(i=this.view[t]<<8,i|=this.view[t+1]),32768==(32768&i)&&(i=-(65535-i+1)),e&&(this.offset+=2),i},r.readShort=r.readInt16,r.writeUint16=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=2;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=2,this.littleEndian?(this.view[e+1]=(65280&t)>>>8,this.view[e]=255&t):(this.view[e]=(65280&t)>>>8,this.view[e+1]=255&t),i&&(this.offset+=2),this},r.writeUInt16=r.writeUint16,r.readUint16=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+2) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[t],i|=this.view[t+1]<<8):(i=this.view[t]<<8,i|=this.view[t+1]),e&&(this.offset+=2),i},r.readUInt16=r.readUint16,r.writeInt32=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),i&&(this.offset+=4),this},r.writeInt=r.writeInt32,r.readInt32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0),i|=0,e&&(this.offset+=4),i},r.readInt=r.readInt32,r.writeUint32=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=4,this.littleEndian?(this.view[e+3]=t>>>24&255,this.view[e+2]=t>>>16&255,this.view[e+1]=t>>>8&255,this.view[e]=255&t):(this.view[e]=t>>>24&255,this.view[e+1]=t>>>16&255,this.view[e+2]=t>>>8&255,this.view[e+3]=255&t),i&&(this.offset+=4),this},r.writeUInt32=r.writeUint32,r.readUint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var i=0;return this.littleEndian?(i=this.view[t+2]<<16,i|=this.view[t+1]<<8,i|=this.view[t],i+=this.view[t+3]<<24>>>0):(i=this.view[t+1]<<16,i|=this.view[t+2]<<8,i|=this.view[t+3],i+=this.view[t]<<24>>>0),e&&(this.offset+=4),i},r.readUInt32=r.readUint32,t&&(r.writeInt64=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),i+=8;var a=this.buffer.byteLength;i>a&&this.resize((a*=2)>i?a:i),i-=8;var n=e.low,r=e.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=r>>>24&255,this.view[i+2]=r>>>16&255,this.view[i+1]=r>>>8&255,this.view[i]=255&r):(this.view[i]=r>>>24&255,this.view[i+1]=r>>>16&255,this.view[i+2]=r>>>8&255,this.view[i+3]=255&r,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),s&&(this.offset+=8),this},r.writeLong=r.writeInt64,r.readInt64=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var s=0,a=0;this.littleEndian?(s=this.view[e+2]<<16,s|=this.view[e+1]<<8,s|=this.view[e],s+=this.view[e+3]<<24>>>0,e+=4,a=this.view[e+2]<<16,a|=this.view[e+1]<<8,a|=this.view[e],a+=this.view[e+3]<<24>>>0):(a=this.view[e+1]<<16,a|=this.view[e+2]<<8,a|=this.view[e+3],a+=this.view[e]<<24>>>0,e+=4,s=this.view[e+1]<<16,s|=this.view[e+2]<<8,s|=this.view[e+3],s+=this.view[e]<<24>>>0);var n=new t(s,a,!1);return i&&(this.offset+=8),n},r.readLong=r.readInt64,r.writeUint64=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e)),i+=8;var a=this.buffer.byteLength;i>a&&this.resize((a*=2)>i?a:i),i-=8;var n=e.low,r=e.high;return this.littleEndian?(this.view[i+3]=n>>>24&255,this.view[i+2]=n>>>16&255,this.view[i+1]=n>>>8&255,this.view[i]=255&n,i+=4,this.view[i+3]=r>>>24&255,this.view[i+2]=r>>>16&255,this.view[i+1]=r>>>8&255,this.view[i]=255&r):(this.view[i]=r>>>24&255,this.view[i+1]=r>>>16&255,this.view[i+2]=r>>>8&255,this.view[i+3]=255&r,i+=4,this.view[i]=n>>>24&255,this.view[i+1]=n>>>16&255,this.view[i+2]=n>>>8&255,this.view[i+3]=255&n),s&&(this.offset+=8),this},r.writeUInt64=r.writeUint64,r.readUint64=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var s=0,a=0;this.littleEndian?(s=this.view[e+2]<<16,s|=this.view[e+1]<<8,s|=this.view[e],s+=this.view[e+3]<<24>>>0,e+=4,a=this.view[e+2]<<16,a|=this.view[e+1]<<8,a|=this.view[e],a+=this.view[e+3]<<24>>>0):(a=this.view[e+1]<<16,a|=this.view[e+2]<<8,a|=this.view[e+3],a+=this.view[e]<<24>>>0,e+=4,s=this.view[e+1]<<16,s|=this.view[e+2]<<8,s|=this.view[e+3],s+=this.view[e]<<24>>>0);var n=new t(s,a,!0);return i&&(this.offset+=8),n},r.readUInt64=r.readUint64),r.writeFloat32=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=4;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=4,a(this.view,t,e,this.littleEndian,23,4),i&&(this.offset+=4),this},r.writeFloat=r.writeFloat32,r.readFloat32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var i=s(this.view,t,this.littleEndian,23,4);return e&&(this.offset+=4),i},r.readFloat=r.readFloat32,r.writeFloat64=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t)throw TypeError("Illegal value: "+t+" (not a number)");if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}e+=8;var s=this.buffer.byteLength;return e>s&&this.resize((s*=2)>e?s:e),e-=8,a(this.view,t,e,this.littleEndian,52,8),i&&(this.offset+=8),this},r.writeDouble=r.writeFloat64,r.readFloat64=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+8) <= "+this.buffer.byteLength)}var i=s(this.view,t,this.littleEndian,52,8);return e&&(this.offset+=8),i},r.readDouble=r.readFloat64,n.MAX_VARINT32_BYTES=5,n.calculateVarint32=function(t){return t>>>=0,t<128?1:t<16384?2:t<1<<21?3:t<1<<28?4:5},n.zigZagEncode32=function(t){return((t|=0)<<1^t>>31)>>>0},n.zigZagDecode32=function(t){return t>>>1^-(1&t)|0},r.writeVarint32=function(t,e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+0) <= "+this.buffer.byteLength)}var s,a=n.calculateVarint32(t);e+=a;var r=this.buffer.byteLength;for(e>r&&this.resize((r*=2)>e?r:e),e-=a,t>>>=0;t>=128;)s=127&t|128,this.view[e++]=s,t>>>=7;return this.view[e++]=t,i?(this.offset=e,this):a},r.writeVarint32ZigZag=function(t,e){return this.writeVarint32(n.zigZagEncode32(t),e)},r.readVarint32=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var i,s=0,a=0;do{if(!this.noAssert&&t>this.limit){var n=Error("Truncated");throw n.truncated=!0,n}i=this.view[t++],s<5&&(a|=(127&i)<<7*s),++s}while(0!=(128&i));return a|=0,e?(this.offset=t,a):{value:a,length:s}},r.readVarint32ZigZag=function(t){var e=this.readVarint32(t);return"object"==typeof e?e.value=n.zigZagDecode32(e.value):e=n.zigZagDecode32(e),e},t&&(n.MAX_VARINT64_BYTES=10,n.calculateVarint64=function(e){"number"==typeof e?e=t.fromNumber(e):"string"==typeof e&&(e=t.fromString(e));var i=e.toInt()>>>0,s=e.shiftRightUnsigned(28).toInt()>>>0,a=e.shiftRightUnsigned(56).toInt()>>>0;return 0==a?0==s?i<16384?i<128?1:2:i<1<<21?3:4:s<16384?s<128?5:6:s<1<<21?7:8:a<128?9:10},n.zigZagEncode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftLeft(1).xor(e.shiftRight(63)).toUnsigned()},n.zigZagDecode64=function(e){return"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned()),e.shiftRightUnsigned(1).xor(e.and(t.ONE).toSigned().negate()).toSigned()},r.writeVarint64=function(e,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"==typeof e)e=t.fromNumber(e);else if("string"==typeof e)e=t.fromString(e);else if(!(e&&e instanceof t))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=t.fromNumber(e,!1):"string"==typeof e?e=t.fromString(e,!1):!1!==e.unsigned&&(e=e.toSigned());var a=n.calculateVarint64(e),r=e.toInt()>>>0,o=e.shiftRightUnsigned(28).toInt()>>>0,c=e.shiftRightUnsigned(56).toInt()>>>0;i+=a;var l=this.buffer.byteLength;switch(i>l&&this.resize((l*=2)>i?l:i),i-=a,a){case 10:this.view[i+9]=c>>>7&1;case 9:this.view[i+8]=9!==a?128|c:127&c;case 8:this.view[i+7]=8!==a?o>>>21|128:o>>>21&127;case 7:this.view[i+6]=7!==a?o>>>14|128:o>>>14&127;case 6:this.view[i+5]=6!==a?o>>>7|128:o>>>7&127;case 5:this.view[i+4]=5!==a?128|o:127&o;case 4:this.view[i+3]=4!==a?r>>>21|128:r>>>21&127;case 3:this.view[i+2]=3!==a?r>>>14|128:r>>>14&127;case 2:this.view[i+1]=2!==a?r>>>7|128:r>>>7&127;case 1:this.view[i]=1!==a?128|r:127&r}return s?(this.offset+=a,this):a},r.writeVarint64ZigZag=function(t,e){return this.writeVarint64(n.zigZagEncode64(t),e)},r.readVarint64=function(e){var i=void 0===e;if(i&&(e=this.offset),!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: "+e+" (not an integer)");if((e>>>=0)<0||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var s=e,a=0,n=0,r=0,o=0;if(o=this.view[e++],a=127&o,128&o&&(o=this.view[e++],a|=(127&o)<<7,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],a|=(127&o)<<14,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],a|=(127&o)<<21,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],n=127&o,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],n|=(127&o)<<7,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],n|=(127&o)<<14,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],n|=(127&o)<<21,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],r=127&o,(128&o||this.noAssert&&void 0===o)&&(o=this.view[e++],r|=(127&o)<<7,128&o||this.noAssert&&void 0===o))))))))))throw Error("Buffer overrun");var c=t.fromBits(a|n<<28,n>>>4|r<<24,!1);return i?(this.offset=e,c):{value:c,length:e-s}},r.readVarint64ZigZag=function(e){var i=this.readVarint64(e);return i&&i.value instanceof t?i.value=n.zigZagDecode64(i.value):i=n.zigZagDecode64(i),i}),r.writeCString=function(t,i){var s=void 0===i;s&&(i=this.offset);var a,n=t.length;if(!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");for(a=0;a<n;++a)if(0===t.charCodeAt(a))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}n=d.calculateUTF16asUTF8(e(t))[1],i+=n+1;var r=this.buffer.byteLength;return i>r&&this.resize((r*=2)>i?r:i),i-=n+1,d.encodeUTF16toUTF8(e(t),function(t){this.view[i++]=t}.bind(this)),this.view[i++]=0,s?(this.offset=i,this):n},r.readCString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var s,a=t,n=-1;return d.decodeUTF8toUTF16(function(){if(0===n)return null;if(t>=this.limit)throw RangeError("Illegal range: Truncated data, "+t+" < "+this.limit);return n=this.view[t++],0===n?null:n}.bind(this),s=i(),!0),e?(this.offset=t,s()):{string:s(),length:t-a}},r.writeIString=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var a,n=i;a=d.calculateUTF16asUTF8(e(t),this.noAssert)[1],i+=4+a;var r=this.buffer.byteLength;if(i>r&&this.resize((r*=2)>i?r:i),i-=4+a,this.littleEndian?(this.view[i+3]=a>>>24&255,this.view[i+2]=a>>>16&255,this.view[i+1]=a>>>8&255,this.view[i]=255&a):(this.view[i]=a>>>24&255,this.view[i+1]=a>>>16&255,this.view[i+2]=a>>>8&255,this.view[i+3]=255&a),i+=4,d.encodeUTF16toUTF8(e(t),function(t){this.view[i++]=t}.bind(this)),i!==n+4+a)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+4+a));return s?(this.offset=i,this):i-n},r.readIString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+4) <= "+this.buffer.byteLength)}var i=t,s=this.readUint32(t),a=this.readUTF8String(s,n.METRICS_BYTES,t+=4);return t+=a.length,e?(this.offset=t,a.string):{string:a.string,length:t-i}},n.METRICS_CHARS="c",n.METRICS_BYTES="b",r.writeUTF8String=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var a,n=i;a=d.calculateUTF16asUTF8(e(t))[1],i+=a;var r=this.buffer.byteLength;return i>r&&this.resize((r*=2)>i?r:i),i-=a,d.encodeUTF16toUTF8(e(t),function(t){this.view[i++]=t}.bind(this)),s?(this.offset=i,this):i-n},r.writeString=r.writeUTF8String,n.calculateUTF8Chars=function(t){return d.calculateUTF16asUTF8(e(t))[0]},n.calculateUTF8Bytes=function(t){return d.calculateUTF16asUTF8(e(t))[1]},n.calculateString=n.calculateUTF8Bytes,r.readUTF8String=function(t,e,s){"number"==typeof e&&(s=e,e=void 0);var a=void 0===s;if(a&&(s=this.offset),void 0===e&&(e=n.METRICS_CHARS),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");if(t|=0,"number"!=typeof s||s%1!=0)throw TypeError("Illegal offset: "+s+" (not an integer)");if((s>>>=0)<0||s+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+s+" (+0) <= "+this.buffer.byteLength)}var r,o=0,c=s;if(e===n.METRICS_CHARS){if(r=i(),d.decodeUTF8(function(){return o<t&&s<this.limit?this.view[s++]:null}.bind(this),function(t){++o,d.UTF8toUTF16(t,r)}),o!==t)throw RangeError("Illegal range: Truncated data, "+o+" == "+t);return a?(this.offset=s,r()):{string:r(),length:s-c}}if(e===n.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof s||s%1!=0)throw TypeError("Illegal offset: "+s+" (not an integer)");if((s>>>=0)<0||s+t>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+s+" (+"+t+") <= "+this.buffer.byteLength)}var l=s+t;if(d.decodeUTF8toUTF16(function(){return s<l?this.view[s++]:null}.bind(this),r=i(),this.noAssert),s!==l)throw RangeError("Illegal range: Truncated data, "+s+" == "+l);return a?(this.offset=s,r()):{string:r(),length:s-c}}throw TypeError("Unsupported metrics: "+e)},r.readString=r.readUTF8String,r.writeVString=function(t,i){var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var a,r,o=i;a=d.calculateUTF16asUTF8(e(t),this.noAssert)[1],r=n.calculateVarint32(a),i+=r+a;var c=this.buffer.byteLength;if(i>c&&this.resize((c*=2)>i?c:i),i-=r+a,i+=this.writeVarint32(a,i),d.encodeUTF16toUTF8(e(t),function(t){this.view[i++]=t}.bind(this)),i!==o+a+r)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+a+r));return s?(this.offset=i,this):i-o},r.readVString=function(t){var e=void 0===t;if(e&&(t=this.offset),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+1) <= "+this.buffer.byteLength)}var i=t,s=this.readVarint32(t),a=this.readUTF8String(s.value,n.METRICS_BYTES,t+=s.length);return t+=a.length,e?(this.offset=t,a.string):{string:a.string,length:t-i}},r.append=function(t,e,i){"number"!=typeof e&&"string"==typeof e||(i=e,e=void 0);var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof n||(t=n.wrap(t,e));var a=t.limit-t.offset;if(a<=0)return this;i+=a;var r=this.buffer.byteLength;return i>r&&this.resize((r*=2)>i?r:i),i-=a,this.view.set(t.view.subarray(t.offset,t.limit),i),t.offset+=a,s&&(this.offset+=a),this},r.appendTo=function(t,e){return t.append(this,e),this},r.assert=function(t){return this.noAssert=!t,this},r.capacity=function(){return this.buffer.byteLength},r.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},r.clone=function(t){var e=new n(0,this.littleEndian,this.noAssert);return t?(e.buffer=new ArrayBuffer(this.buffer.byteLength),e.view=new Uint8Array(e.buffer)):(e.buffer=this.buffer,e.view=this.view),e.offset=this.offset,e.markedOffset=this.markedOffset,e.limit=this.limit,e},r.compact=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(0===t&&e===this.buffer.byteLength)return this;var i=e-t;if(0===i)return this.buffer=o,this.view=null,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=0,this;var s=new ArrayBuffer(i),a=new Uint8Array(s);return a.set(this.view.subarray(t,e)),this.buffer=s,this.view=a,this.markedOffset>=0&&(this.markedOffset-=t),this.offset=0,this.limit=i,this},r.copy=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}if(t===e)return new n(0,this.littleEndian,this.noAssert);var i=e-t,s=new n(i,this.littleEndian,this.noAssert);return s.offset=0,s.limit=i,s.markedOffset>=0&&(s.markedOffset-=t),this.copyTo(s,0,t,e),s},r.copyTo=function(t,e,i,s){var a,r;if(!this.noAssert&&!n.isByteBuffer(t))throw TypeError("Illegal target: Not a ByteBuffer");if(e=(r=void 0===e)?t.offset:0|e,i=(a=void 0===i)?this.offset:0|i,s=void 0===s?this.limit:0|s,e<0||e>t.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+e+" <= "+t.buffer.byteLength);if(i<0||s>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var o=s-i;return 0===o?t:(t.ensureCapacity(e+o),t.view.set(this.view.subarray(i,s),e),a&&(this.offset+=o),r&&(t.offset+=o),this)},r.ensureCapacity=function(t){var e=this.buffer.byteLength;return e<t?this.resize((e*=2)>t?e:t):this},r.fill=function(t,e,i){var s=void 0===e;if(s&&(e=this.offset),"string"==typeof t&&t.length>0&&(t=t.charCodeAt(0)),void 0===e&&(e=this.offset),void 0===i&&(i=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal value: "+t+" (not an integer)");if(t|=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal end: Not an integer");if(i>>>=0,e<0||e>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+i+" <= "+this.buffer.byteLength)}if(e>=i)return this;for(;e<i;)this.view[e++]=t;return s&&(this.offset=e),this},r.flip=function(){return this.limit=this.offset,this.offset=0,this},r.mark=function(t){if(t=void 0===t?this.offset:t,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal offset: "+t+" (not an integer)");if((t>>>=0)<0||t+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+t+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=t,this},r.order=function(t){if(!this.noAssert&&"boolean"!=typeof t)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!t,this},r.LE=function(t){return this.littleEndian=void 0===t||!!t,this},r.BE=function(t){return this.littleEndian=void 0!==t&&!t,this},r.prepend=function(t,e,i){"number"!=typeof e&&"string"==typeof e||(i=e,e=void 0);var s=void 0===i;if(s&&(i=this.offset),!this.noAssert){if("number"!=typeof i||i%1!=0)throw TypeError("Illegal offset: "+i+" (not an integer)");if((i>>>=0)<0||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}t instanceof n||(t=n.wrap(t,e));var a=t.limit-t.offset;if(a<=0)return this;var r=a-i;if(r>0){var o=new ArrayBuffer(this.buffer.byteLength+r),c=new Uint8Array(o);c.set(this.view.subarray(i,this.buffer.byteLength),a),this.buffer=o,this.view=c,this.offset+=r,this.markedOffset>=0&&(this.markedOffset+=r),this.limit+=r,i+=r}else{new Uint8Array(this.buffer)}return this.view.set(t.view.subarray(t.offset,t.limit),i-a),t.offset=t.limit,s&&(this.offset-=a),this},r.prependTo=function(t,e){return t.prepend(this,e),this},r.printDebug=function(t){"function"!=typeof t&&(t=console.log.bind(console)),t(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},r.remaining=function(){return this.limit-this.offset},r.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},r.resize=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal capacity: "+t+" (not an integer)");if((t|=0)<0)throw RangeError("Illegal capacity: 0 <= "+t)}if(this.buffer.byteLength<t){var e=new ArrayBuffer(t),i=new Uint8Array(e);i.set(this.view),this.buffer=e,this.view=i}return this},r.reverse=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}return t===e?this:(Array.prototype.reverse.call(this.view.subarray(t,e)),this)},r.skip=function(t){if(!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal length: "+t+" (not an integer)");t|=0}var e=this.offset+t;if(!this.noAssert&&(e<0||e>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+t+" <= "+this.buffer.byteLength);return this.offset=e,this},r.slice=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var i=this.clone();return i.offset=t,i.limit=e,i},r.toBuffer=function(t){var e=this.offset,i=this.limit;if(!this.noAssert){if("number"!=typeof e||e%1!=0)throw TypeError("Illegal offset: Not an integer");if(e>>>=0,"number"!=typeof i||i%1!=0)throw TypeError("Illegal limit: Not an integer");if(i>>>=0,e<0||e>i||i>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+i+" <= "+this.buffer.byteLength)}if(!t&&0===e&&i===this.buffer.byteLength)return this.buffer;if(e===i)return o;var s=new ArrayBuffer(i-e);return new Uint8Array(s).set(new Uint8Array(this.buffer).subarray(e,i),0),s},r.toArrayBuffer=r.toBuffer,r.toString=function(t,e,i){if(void 0===t)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof t&&(t="utf8",e=t,i=e),t){case"utf8":return this.toUTF8(e,i);case"base64":return this.toBase64(e,i);case"hex":return this.toHex(e,i);case"binary":return this.toBinary(e,i);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+t)}};var l=function(){for(var t={},e=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],s=0,a=e.length;s<a;++s)i[e[s]]=s;return t.encode=function(t,i){for(var s,a;null!==(s=t());)i(e[s>>2&63]),a=(3&s)<<4,null!==(s=t())?(a|=s>>4&15,i(e[63&(a|s>>4&15)]),a=(15&s)<<2,null!==(s=t())?(i(e[63&(a|s>>6&3)]),i(e[63&s])):(i(e[63&a]),i(61))):(i(e[63&a]),i(61),i(61))},t.decode=function(t,e){function s(t){throw Error("Illegal character code: "+t)}for(var a,n,r;null!==(a=t());)if(n=i[a],void 0===n&&s(a),null!==(a=t())&&(r=i[a],void 0===r&&s(a),e(n<<2>>>0|(48&r)>>4),null!==(a=t()))){if(void 0===(n=i[a])){if(61===a)break;s(a)}if(e((15&r)<<4>>>0|(60&n)>>2),null!==(a=t())){if(void 0===(r=i[a])){if(61===a)break;s(a)}e((3&n)<<6>>>0|r)}}},t.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)},t}();r.toBase64=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),t|=0,e|=0,t<0||e>this.capacity||t>e)throw RangeError("begin, end");var s;return l.encode(function(){return t<e?this.view[t++]:null}.bind(this),s=i()),s()},n.fromBase64=function(t,i){if("string"!=typeof t)throw TypeError("str");var s=new n(t.length/4*3,i),a=0;return l.decode(e(t),function(t){s.view[a++]=t}),s.limit=a,s},n.btoa=function(t){return n.fromBinary(t).toBase64()},n.atob=function(t){return n.fromBase64(t).toBinary()},r.toBinary=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),t|=0,e|=0,t<0||e>this.capacity()||t>e)throw RangeError("begin, end");if(t===e)return"";for(var i=[],s=[];t<e;)i.push(this.view[t++]),i.length>=1024&&(s.push(String.fromCharCode.apply(String,i)),i=[]);return s.join("")+String.fromCharCode.apply(String,i)},n.fromBinary=function(t,e){if("string"!=typeof t)throw TypeError("str");for(var i,s=0,a=t.length,r=new n(a,e);s<a;){if((i=t.charCodeAt(s))>255)throw RangeError("illegal char code: "+i);r.view[s++]=i}return r.limit=a,r},r.toDebug=function(t){for(var e,i=-1,s=this.buffer.byteLength,a="",n="",r="";i<s;){if(-1!==i&&(e=this.view[i],a+=e<16?"0"+e.toString(16).toUpperCase():e.toString(16).toUpperCase(),
t&&(n+=e>32&&e<127?String.fromCharCode(e):".")),++i,t&&i>0&&i%16==0&&i!==s){for(;a.length<51;)a+=" ";r+=a+n+"\n",a=n=""}i===this.offset&&i===this.limit?a+=i===this.markedOffset?"!":"|":i===this.offset?a+=i===this.markedOffset?"[":"<":i===this.limit?a+=i===this.markedOffset?"]":">":a+=i===this.markedOffset?"'":t||0!==i&&i!==s?" ":""}if(t&&" "!==a){for(;a.length<51;)a+=" ";r+=a+n+"\n"}return t?r:a},n.fromDebug=function(t,e,i){for(var s,a,r=t.length,o=new n((r+1)/3|0,e,i),c=0,l=0,d=!1,h=!1,u=!1,p=!1,f=!1;c<r;){switch(s=t.charAt(c++)){case"!":if(!i){if(h||u||p){f=!0;break}h=u=p=!0}o.offset=o.markedOffset=o.limit=l,d=!1;break;case"|":if(!i){if(h||p){f=!0;break}h=p=!0}o.offset=o.limit=l,d=!1;break;case"[":if(!i){if(h||u){f=!0;break}h=u=!0}o.offset=o.markedOffset=l,d=!1;break;case"<":if(!i){if(h){f=!0;break}h=!0}o.offset=l,d=!1;break;case"]":if(!i){if(p||u){f=!0;break}p=u=!0}o.limit=o.markedOffset=l,d=!1;break;case">":if(!i){if(p){f=!0;break}p=!0}o.limit=l,d=!1;break;case"'":if(!i){if(u){f=!0;break}u=!0}o.markedOffset=l,d=!1;break;case" ":d=!1;break;default:if(!i&&d){f=!0;break}if(a=parseInt(s+t.charAt(c++),16),!i&&(isNaN(a)||a<0||a>255))throw TypeError("Illegal str: Not a debug encoded string");o.view[l++]=a,d=!0}if(f)throw TypeError("Illegal str: Invalid symbol at "+c)}if(!i){if(!h||!p)throw TypeError("Illegal str: Missing offset or limit");if(l<o.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+l+" < "+r)}return o},r.toHex=function(t,e){if(t=void 0===t?this.offset:t,e=void 0===e?this.limit:e,!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}for(var i,s=new Array(e-t);t<e;)i=this.view[t++],i<16?s.push("0",i.toString(16)):s.push(i.toString(16));return s.join("")},n.fromHex=function(t,e,i){if(!i){if("string"!=typeof t)throw TypeError("Illegal str: Not a string");if(t.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var s,a=t.length,r=new n(a/2|0,e),o=0,c=0;o<a;o+=2){if(s=parseInt(t.substring(o,o+2),16),!i&&(!isFinite(s)||s<0||s>255))throw TypeError("Illegal str: Contains non-hex characters");r.view[c++]=s}return r.limit=c,r};var d=function(){var t={};return t.MAX_CODEPOINT=1114111,t.encodeUTF8=function(t,e){var i=null;for("number"==typeof t&&(i=t,t=function(){return null});null!==i||null!==(i=t());)i<128?e(127&i):i<2048?(e(i>>6&31|192),e(63&i|128)):i<65536?(e(i>>12&15|224),e(i>>6&63|128),e(63&i|128)):(e(i>>18&7|240),e(i>>12&63|128),e(i>>6&63|128),e(63&i|128)),i=null},t.decodeUTF8=function(t,e){for(var i,s,a,n,r=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(i=t());)if(0==(128&i))e(i);else if(192==(224&i))null===(s=t())&&r([i,s]),e((31&i)<<6|63&s);else if(224==(240&i))(null===(s=t())||null===(a=t()))&&r([i,s,a]),e((15&i)<<12|(63&s)<<6|63&a);else{if(240!=(248&i))throw RangeError("Illegal starting byte: "+i);(null===(s=t())||null===(a=t())||null===(n=t()))&&r([i,s,a,n]),e((7&i)<<18|(63&s)<<12|(63&a)<<6|63&n)}},t.UTF16toUTF8=function(t,e){for(var i,s=null;;){if(null===(i=null!==s?s:t()))break;i>=55296&&i<=57343&&null!==(s=t())&&s>=56320&&s<=57343?(e(1024*(i-55296)+s-56320+65536),s=null):e(i)}null!==s&&e(s)},t.UTF8toUTF16=function(t,e){var i=null;for("number"==typeof t&&(i=t,t=function(){return null});null!==i||null!==(i=t());)i<=65535?e(i):(i-=65536,e(55296+(i>>10)),e(i%1024+56320)),i=null},t.encodeUTF16toUTF8=function(e,i){t.UTF16toUTF8(e,function(e){t.encodeUTF8(e,i)})},t.decodeUTF8toUTF16=function(e,i){t.decodeUTF8(e,function(e){t.UTF8toUTF16(e,i)})},t.calculateCodePoint=function(t){return t<128?1:t<2048?2:t<65536?3:4},t.calculateUTF8=function(t){for(var e,i=0;null!==(e=t());)i+=e<128?1:e<2048?2:e<65536?3:4;return i},t.calculateUTF16asUTF8=function(e){var i=0,s=0;return t.UTF16toUTF8(e,function(t){++i,s+=t<128?1:t<2048?2:t<65536?3:4}),[i,s]},t}();return r.toUTF8=function(t,e){if(void 0===t&&(t=this.offset),void 0===e&&(e=this.limit),!this.noAssert){if("number"!=typeof t||t%1!=0)throw TypeError("Illegal begin: Not an integer");if(t>>>=0,"number"!=typeof e||e%1!=0)throw TypeError("Illegal end: Not an integer");if(e>>>=0,t<0||t>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+t+" <= "+e+" <= "+this.buffer.byteLength)}var s;try{d.decodeUTF8toUTF16(function(){return t<e?this.view[t++]:null}.bind(this),s=i())}catch(i){if(t!==e)throw RangeError("Illegal range: Truncated data, "+t+" != "+e)}return s()},n.fromUTF8=function(t,i,s){if(!s&&"string"!=typeof t)throw TypeError("Illegal str: Not a string");var a=new n(d.calculateUTF16asUTF8(e(t),!0)[1],i,s),r=0;return d.encodeUTF16toUTF8(e(t),function(t){a.view[r++]=t}),a.limit=r,a},n}),function(t,e){"function"==typeof define&&define.amd?define(["chat-bytebuffer.js"],function(){(t.dcodeIO=t.dcodeIO||{}).ProtoBuf=e(t.dcodeIO.ByteBuffer)}):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=e(require("bytebuffer"),!0):(t.dcodeIO=t.dcodeIO||{}).ProtoBuf=e(t.dcodeIO.ByteBuffer)}(this,function(t,e){"use strict";var i={};return i.ByteBuffer=t,i.Long=t.Long||null,i.VERSION="5.0.1",i.WIRE_TYPES={},i.WIRE_TYPES.VARINT=0,i.WIRE_TYPES.BITS64=1,i.WIRE_TYPES.LDELIM=2,i.WIRE_TYPES.STARTGROUP=3,i.WIRE_TYPES.ENDGROUP=4,i.WIRE_TYPES.BITS32=5,i.PACKABLE_WIRE_TYPES=[i.WIRE_TYPES.VARINT,i.WIRE_TYPES.BITS64,i.WIRE_TYPES.BITS32],i.TYPES={int32:{name:"int32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},uint64:{name:"uint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.UZERO:void 0},sint64:{name:"sint64",wireType:i.WIRE_TYPES.VARINT,defaultValue:i.Long?i.Long.ZERO:void 0},bool:{name:"bool",wireType:i.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:i.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:i.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:i.WIRE_TYPES.BITS64,defaultValue:i.Long?i.Long.ZERO:void 0},float:{name:"float",wireType:i.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:i.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:i.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:i.WIRE_TYPES.STARTGROUP,defaultValue:null}},i.MAP_KEY_TYPES=[i.TYPES.int32,i.TYPES.sint32,i.TYPES.sfixed32,i.TYPES.uint32,i.TYPES.fixed32,i.TYPES.int64,i.TYPES.sint64,i.TYPES.sfixed64,i.TYPES.uint64,i.TYPES.fixed64,i.TYPES.bool,i.TYPES.string,i.TYPES.bytes],i.ID_MIN=1,i.ID_MAX=536870911,i.convertFieldsToCamelCase=!1,i.populateAccessors=!0,i.populateDefaults=!0,i.Util=function(){var t={};return t.IS_NODE=!("object"!=typeof process||process+""!="[object process]"||process.browser),t.XHR=function(){for(var t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=null,i=0;i<t.length;i++){try{e=t[i]()}catch(t){continue}break}if(!e)throw Error("XMLHttpRequest is not supported");return e},t.fetch=function(e,i){if(i&&"function"!=typeof i&&(i=null),t.IS_NODE){var s=require("fs");if(i)s.readFile(e,function(t,e){i(t?null:""+e)});else try{return s.readFileSync(e)}catch(t){return null}}else{var a=t.XHR();if(a.open("GET",e,!!i),a.setRequestHeader("Accept","text/plain"),"function"==typeof a.overrideMimeType&&a.overrideMimeType("text/plain"),!i)return a.send(null),200==a.status||0==a.status&&"string"==typeof a.responseText?a.responseText:null;if(a.onreadystatechange=function(){4==a.readyState&&i(200==a.status||0==a.status&&"string"==typeof a.responseText?a.responseText:null)},4==a.readyState)return;a.send(null)}},t.toCamelCase=function(t){return t.replace(/_([a-zA-Z])/g,function(t,e){return e.toUpperCase()})},t}(),i.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},i.DotProto=function(t,e){function i(t,i){var s=-1,a=1;if("-"==t.charAt(0)&&(a=-1,t=t.substring(1)),e.NUMBER_DEC.test(t))s=parseInt(t);else if(e.NUMBER_HEX.test(t))s=parseInt(t.substring(2),16);else{if(!e.NUMBER_OCT.test(t))throw Error("illegal id value: "+(a<0?"-":"")+t);s=parseInt(t.substring(1),8)}if(s=a*s|0,!i&&s<0)throw Error("illegal id value: "+(a<0?"-":"")+t);return s}function s(t){var i=1;if("-"==t.charAt(0)&&(i=-1,t=t.substring(1)),e.NUMBER_DEC.test(t))return i*parseInt(t,10);if(e.NUMBER_HEX.test(t))return i*parseInt(t.substring(2),16);if(e.NUMBER_OCT.test(t))return i*parseInt(t.substring(1),8);if("inf"===t)return i*(1/0);if("nan"===t)return NaN;if(e.NUMBER_FLT.test(t))return i*parseFloat(t);throw Error("illegal number value: "+(i<0?"-":"")+t)}function a(t,e,i){void 0===t[e]?t[e]=i:(Array.isArray(t[e])||(t[e]=[t[e]]),t[e].push(i))}var n={},r=function(t){this.source=t+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},o=r.prototype;o._readString=function(){var t='"'===this._stringOpen?e.STRING_DQ:e.STRING_SQ;t.lastIndex=this.index-1;var i=t.exec(this.source);if(!i)throw Error("unterminated string");return this.index=t.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,i[1]},o.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var t,i,s;do{for(t=!1;e.WHITESPACE.test(s=this.source.charAt(this.index));)if("\n"===s&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,t=!0}else{if("*"!==(s=this.source.charAt(this.index)))return"/";do{if("\n"===s&&++this.line,++this.index===this.source.length)return null;i=s,s=this.source.charAt(this.index)}while("*"!==i||"/"!==s);++this.index,t=!0}}while(t);if(this.index===this.source.length)return null;var a=this.index;if(e.DELIM.lastIndex=0,!e.DELIM.test(this.source.charAt(a++)))for(;a<this.source.length&&!e.DELIM.test(this.source.charAt(a));)++a;var n=this.source.substring(this.index,this.index=a);return'"'!==n&&"'"!==n||(this._stringOpen=n),n},o.peek=function(){if(0===this.stack.length){var t=this.next();if(null===t)return null;this.stack.push(t)}return this.stack[0]},o.skip=function(t){var e=this.next();if(e!==t)throw Error("illegal '"+e+"', '"+t+"' expected")},o.omit=function(t){return this.peek()===t&&(this.next(),!0)},o.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},n.Tokenizer=r;var c=function(t){this.tn=new r(t),this.proto3=!1},l=c.prototype;return l.parse=function(){var t,i,s={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},a=!0;try{for(;t=this.tn.next();)switch(t){case"package":if(!a||null!==s.package)throw Error("unexpected 'package'");if(t=this.tn.next(),!e.TYPEREF.test(t))throw Error("illegal package name: "+t);this.tn.skip(";"),s.package=t;break;case"import":if(!a)throw Error("unexpected 'import'");t=this.tn.peek(),("public"===t||(i="weak"===t))&&this.tn.next(),t=this._readString(),this.tn.skip(";"),i||s.imports.push(t);break;case"syntax":if(!a)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(s.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(s,null),a=!1;break;case"enum":this._parseEnum(s),a=!1;break;case"option":this._parseOption(s);break;case"service":this._parseService(s);break;case"extend":this._parseExtend(s);break;default:throw Error("unexpected '"+t+"'")}}catch(t){throw t.message="Parse error at line "+this.tn.line+": "+t.message,t}return delete s.name,s},c.parse=function(t){return new c(t).parse()},l._readString=function(){var t,e,i="";do{if("'"!==(e=this.tn.next())&&'"'!==e)throw Error("illegal string delimiter: "+e);i+=this.tn.next(),this.tn.skip(e),t=this.tn.peek()}while('"'===t||'"'===t);return i},l._readValue=function(t){var i=this.tn.peek();if('"'===i||"'"===i)return this._readString();if(this.tn.next(),e.NUMBER.test(i))return s(i);if(e.BOOL.test(i))return"true"===i.toLowerCase();if(t&&e.TYPEREF.test(i))return i;throw Error("illegal value: "+i)},l._parseOption=function(t,i){var s=this.tn.next(),a=!1;if("("===s&&(a=!0,s=this.tn.next()),!e.TYPEREF.test(s))throw Error("illegal option name: "+s);var n=s;a&&(this.tn.skip(")"),n="("+n+")",s=this.tn.peek(),e.FQTYPEREF.test(s)&&(n+=s,this.tn.next())),this.tn.skip("="),this._parseOptionValue(t,n),i||this.tn.skip(";")},l._parseOptionValue=function(t,i){var s=this.tn.peek();if("{"!==s)a(t.options,i,this._readValue(!0));else for(this.tn.skip("{");"}"!==(s=this.tn.next());){if(!e.NAME.test(s))throw Error("illegal option name: "+i+"."+s);this.tn.omit(":")?a(t.options,i+"."+s,this._readValue(!0)):this._parseOptionValue(t,i+"."+s)}},l._parseService=function(t){var i=this.tn.next();if(!e.NAME.test(i))throw Error("illegal service name at line "+this.tn.line+": "+i);var s=i,a={name:s,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if("option"===i)this._parseOption(a);else{if("rpc"!==i)throw Error("illegal service token: "+i);this._parseServiceRPC(a)}this.tn.omit(";"),t.services.push(a)},l._parseServiceRPC=function(t){var i=this.tn.next();if(!e.NAME.test(i))throw Error("illegal rpc service method name: "+i);var s=i,a={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(a.request_stream=!0,i=this.tn.next()),!e.TYPEREF.test(i))throw Error("illegal rpc service request type: "+i);if(a.request=i,this.tn.skip(")"),i=this.tn.next(),"returns"!==i.toLowerCase())throw Error("illegal rpc service request type delimiter: "+i);if(this.tn.skip("("),i=this.tn.next(),"stream"===i.toLowerCase()&&(a.response_stream=!0,i=this.tn.next()),a.response=i,this.tn.skip(")"),"{"===(i=this.tn.peek())){for(this.tn.next();"}"!==(i=this.tn.next());){if("option"!==i)throw Error("illegal rpc service token: "+i);this._parseOption(a)}this.tn.omit(";")}else this.tn.skip(";");void 0===t.rpc&&(t.rpc={}),t.rpc[s]=a},l._parseMessage=function(t,s){var a=!!s,n=this.tn.next(),r={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!e.NAME.test(n))throw Error("illegal "+(a?"group":"message")+" name: "+n);for(r.name=n,a&&(this.tn.skip("="),s.id=i(this.tn.next()),r.isGroup=!0),n=this.tn.peek(),"["===n&&s&&this._parseFieldOptions(s),this.tn.skip("{");"}"!==(n=this.tn.next());)if(e.RULE.test(n))this._parseMessageField(r,n);else if("oneof"===n)this._parseMessageOneOf(r);else if("enum"===n)this._parseEnum(r);else if("message"===n)this._parseMessage(r);else if("option"===n)this._parseOption(r);else if("service"===n)this._parseService(r);else if("extensions"===n)r.hasOwnProperty("extensions")?r.extensions=r.extensions.concat(this._parseExtensionRanges()):r.extensions=this._parseExtensionRanges();else if("reserved"===n)this._parseIgnored();else if("extend"===n)this._parseExtend(r);else{if(!e.TYPEREF.test(n))throw Error("illegal message token: "+n);if(!this.proto3)throw Error("illegal field rule: "+n);this._parseMessageField(r,"optional",n)}return this.tn.omit(";"),t.messages.push(r),r},l._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},l._parseMessageField=function(t,s,a){if(!e.RULE.test(s))throw Error("illegal message field rule: "+s);var n,r={rule:s,type:"",name:"",options:{},id:0};if("map"===s){if(a)throw Error("illegal type: "+a);if(this.tn.skip("<"),n=this.tn.next(),!e.TYPE.test(n)&&!e.TYPEREF.test(n))throw Error("illegal message field type: "+n);if(r.keytype=n,this.tn.skip(","),n=this.tn.next(),!e.TYPE.test(n)&&!e.TYPEREF.test(n))throw Error("illegal message field: "+n);if(r.type=n,this.tn.skip(">"),n=this.tn.next(),!e.NAME.test(n))throw Error("illegal message field name: "+n);r.name=n,this.tn.skip("="),r.id=i(this.tn.next()),n=this.tn.peek(),"["===n&&this._parseFieldOptions(r),this.tn.skip(";")}else if("group"===(a=void 0!==a?a:this.tn.next())){var o=this._parseMessage(t,r);if(!/^[A-Z]/.test(o.name))throw Error("illegal group name: "+o.name);r.type=o.name,r.name=o.name.toLowerCase(),this.tn.omit(";")}else{if(!e.TYPE.test(a)&&!e.TYPEREF.test(a))throw Error("illegal message field type: "+a);if(r.type=a,n=this.tn.next(),!e.NAME.test(n))throw Error("illegal message field name: "+n);r.name=n,this.tn.skip("="),r.id=i(this.tn.next()),n=this.tn.peek(),"["===n&&this._parseFieldOptions(r),this.tn.skip(";")}return t.fields.push(r),r},l._parseMessageOneOf=function(t){var i=this.tn.next();if(!e.NAME.test(i))throw Error("illegal oneof name: "+i);var s,a=i,n=[];for(this.tn.skip("{");"}"!==(i=this.tn.next());)s=this._parseMessageField(t,"optional",i),s.oneof=a,n.push(s.id);this.tn.omit(";"),t.oneofs[a]=n},l._parseFieldOptions=function(t){this.tn.skip("[");for(var e=!0;"]"!==this.tn.peek();)e||this.tn.skip(","),this._parseOption(t,!0),e=!1;this.tn.next()},l._parseEnum=function(t){var s={name:"",values:[],options:{}},a=this.tn.next();if(!e.NAME.test(a))throw Error("illegal name: "+a);for(s.name=a,this.tn.skip("{");"}"!==(a=this.tn.next());)if("option"===a)this._parseOption(s);else{if(!e.NAME.test(a))throw Error("illegal name: "+a);this.tn.skip("=");var n={name:a,id:i(this.tn.next(),!0)};a=this.tn.peek(),"["===a&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),s.values.push(n)}this.tn.omit(";"),t.enums.push(s)},l._parseExtensionRanges=function(){var e,i,a,n=[];do{for(i=[];;){switch(e=this.tn.next()){case"min":a=t.ID_MIN;break;case"max":a=t.ID_MAX;break;default:a=s(e)}if(i.push(a),2===i.length)break;if("to"!==this.tn.peek()){i.push(a);break}this.tn.next()}n.push(i)}while(this.tn.omit(","));return this.tn.skip(";"),n},l._parseExtend=function(t){var i=this.tn.next();if(!e.TYPEREF.test(i))throw Error("illegal extend reference: "+i);var s={ref:i,fields:[]};for(this.tn.skip("{");"}"!==(i=this.tn.next());)if(e.RULE.test(i))this._parseMessageField(s,i);else{if(!e.TYPEREF.test(i))throw Error("illegal extend token: "+i);if(!this.proto3)throw Error("illegal field rule: "+i);this._parseMessageField(s,"optional",i)}return this.tn.omit(";"),t.messages.push(s),s},l.toString=function(){return"Parser at line "+this.tn.line},n.Parser=c,n}(i,i.Lang),i.Reflect=function(e){function i(i){if("string"==typeof i&&(i=e.TYPES[i]),void 0===i.defaultValue)throw Error("default value for type "+i.name+" is not supported");return i==e.TYPES.bytes?new t(0):i.defaultValue}function s(t,i){if(t&&"number"==typeof t.low&&"number"==typeof t.high&&"boolean"==typeof t.unsigned&&t.low===t.low&&t.high===t.high)return new e.Long(t.low,t.high,void 0===i?t.unsigned:i);if("string"==typeof t)return e.Long.fromString(t,i||!1,10);if("number"==typeof t)return e.Long.fromNumber(t,i||!1);throw Error("not convertible to Long")}function a(t,i){var s=i.readVarint32(),n=7&s,r=s>>>3;switch(n){case e.WIRE_TYPES.VARINT:do{s=i.readUint8()}while(128==(128&s));break;case e.WIRE_TYPES.BITS64:i.offset+=8;break;case e.WIRE_TYPES.LDELIM:s=i.readVarint32(),i.offset+=s;break;case e.WIRE_TYPES.STARTGROUP:a(r,i);break;case e.WIRE_TYPES.ENDGROUP:if(r===t)return!1;throw Error("Illegal GROUPEND after unknown group: "+r+" ("+t+" expected)");case e.WIRE_TYPES.BITS32:i.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+t+": "+n)}return!0}var n={},r=function(t,e,i){this.builder=t,this.parent=e,this.name=i,this.className},o=r.prototype;o.fqn=function(){for(var t=this.name,e=this;;){if(null==(e=e.parent))break;t=e.name+"."+t}return t},o.toString=function(t){return(t?this.className+" ":"")+this.fqn()},o.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},n.T=r;var c=function(t,e,i,s,a){r.call(this,t,e,i),this.className="Namespace",this.children=[],this.options=s||{},this.syntax=a||"proto2"},l=c.prototype=Object.create(r.prototype);l.getChildren=function(t){if(null==(t=t||null))return this.children.slice();for(var e=[],i=0,s=this.children.length;i<s;++i)this.children[i]instanceof t&&e.push(this.children[i]);return e},l.addChild=function(t){var e;if(e=this.getChild(t.name))if(e instanceof u.Field&&e.name!==e.originalName&&null===this.getChild(e.originalName))e.name=e.originalName;else{if(!(t instanceof u.Field&&t.name!==t.originalName&&null===this.getChild(t.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+t.name);t.name=t.originalName}this.children.push(t)},l.getChild=function(t){for(var e="number"==typeof t?"id":"name",i=0,s=this.children.length;i<s;++i)if(this.children[i][e]===t)return this.children[i];return null},l.resolve=function(t,e){var i="string"==typeof t?t.split("."):t,s=this,a=0;if(""===i[a]){for(;null!==s.parent;)s=s.parent;a++}var r;do{do{if(!(s instanceof n.Namespace)){s=null;break}if(!(r=s.getChild(i[a]))||!(r instanceof n.T)||e&&!(r instanceof n.Namespace)){s=null;break}s=r,a++}while(a<i.length);if(null!=s)break;if(null!==this.parent)return this.parent.resolve(t,e)}while(null!=s);return s},l.qn=function(t){var e=[],i=t;do{e.unshift(i.name),i=i.parent}while(null!==i);for(var s=1;s<=e.length;s++){var a=e.slice(e.length-s);if(t===this.resolve(a,t instanceof n.Namespace))return a.join(".")}return t.fqn()},l.build=function(){for(var t,e={},i=this.children,s=0,a=i.length;s<a;++s)(t=i[s])instanceof c&&(e[t.name]=t.build());return Object.defineProperty&&Object.defineProperty(e,"$options",{value:this.buildOpt()}),e},l.buildOpt=function(){for(var t={},e=Object.keys(this.options),i=0,s=e.length;i<s;++i){var a=e[i],n=this.options[e[i]];t[a]=n}return t},l.getOption=function(t){return void 0===t?this.options:void 0!==this.options[t]?this.options[t]:null},n.Namespace=c;var d=function(t,i,s,a,n){if(this.type=t,this.resolvedType=i,this.isMapKey=s,this.syntax=a,this.name=n,s&&e.MAP_KEY_TYPES.indexOf(t)<0)throw Error("Invalid map key type: "+t.name)},h=d.prototype;d.defaultFieldValue=i,h.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},h.verifyValue=function(i){function a(t,e){throw Error("Illegal value for "+n.toString(!0)+" of type "+n.type.name+": "+t+" ("+e+")")}var n=this;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:return("number"!=typeof i||i===i&&i%1!=0)&&a(typeof i,"not an integer"),i>4294967295?0|i:i;case e.TYPES.uint32:case e.TYPES.fixed32:return("number"!=typeof i||i===i&&i%1!=0)&&a(typeof i,"not an integer"),i<0?i>>>0:i;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:if(e.Long)try{return s(i,!1)}catch(t){a(typeof i,t.message)}else a(typeof i,"requires Long.js");case e.TYPES.uint64:case e.TYPES.fixed64:if(e.Long)try{return s(i,!0)}catch(t){a(typeof i,t.message)}else a(typeof i,"requires Long.js");case e.TYPES.bool:return"boolean"!=typeof i&&a(typeof i,"not a boolean"),i;case e.TYPES.float:case e.TYPES.double:return"number"!=typeof i&&a(typeof i,"not a number"),i;case e.TYPES.string:return"string"==typeof i||i&&i instanceof String||a(typeof i,"not a string"),""+i;case e.TYPES.bytes:return t.isByteBuffer(i)?i:t.wrap(i,"base64");case e.TYPES.enum:var r=this.resolvedType.getChildren(e.Reflect.Enum.Value);for(c=0;c<r.length;c++){if(r[c].name==i)return r[c].id;if(r[c].id==i)return r[c].id}if("proto3"===this.syntax)return("number"!=typeof i||i===i&&i%1!=0)&&a(typeof i,"not an integer"),(i>4294967295||i<0)&&a(typeof i,"not in range for uint32"),i;a(i,"not a valid enum value");case e.TYPES.group:case e.TYPES.message:if(i&&"object"==typeof i||a(typeof i,"object expected"),i instanceof this.resolvedType.clazz)return i;if(i instanceof e.Builder.Message){var o={};for(var c in i)i.hasOwnProperty(c)&&(o[c]=i[c]);i=o}return new this.resolvedType.clazz(i)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+i+" (undefined type "+this.type+")")},h.calculateLength=function(i,s){if(null===s)return 0;var a;switch(this.type){case e.TYPES.int32:return s<0?t.calculateVarint64(s):t.calculateVarint32(s);case e.TYPES.uint32:return t.calculateVarint32(s);case e.TYPES.sint32:return t.calculateVarint32(t.zigZagEncode32(s));case e.TYPES.fixed32:case e.TYPES.sfixed32:case e.TYPES.float:return 4;case e.TYPES.int64:case e.TYPES.uint64:return t.calculateVarint64(s);case e.TYPES.sint64:return t.calculateVarint64(t.zigZagEncode64(s));case e.TYPES.fixed64:case e.TYPES.sfixed64:return 8;case e.TYPES.bool:return 1;case e.TYPES.enum:return t.calculateVarint32(s);case e.TYPES.double:return 8;case e.TYPES.string:return a=t.calculateUTF8Bytes(s),t.calculateVarint32(a)+a;case e.TYPES.bytes:if(s.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+s.remaining()+" bytes remaining");return t.calculateVarint32(s.remaining())+s.remaining();case e.TYPES.message:return a=this.resolvedType.calculate(s),t.calculateVarint32(a)+a;case e.TYPES.group:return(a=this.resolvedType.calculate(s))+t.calculateVarint32(i<<3|e.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+s+" (unknown type)")},h.encodeValue=function(i,s,a){if(null===s)return a;switch(this.type){case e.TYPES.int32:s<0?a.writeVarint64(s):a.writeVarint32(s);break;case e.TYPES.uint32:a.writeVarint32(s);break;case e.TYPES.sint32:a.writeVarint32ZigZag(s);break;case e.TYPES.fixed32:a.writeUint32(s);break;case e.TYPES.sfixed32:a.writeInt32(s);break;case e.TYPES.int64:case e.TYPES.uint64:a.writeVarint64(s);break;case e.TYPES.sint64:a.writeVarint64ZigZag(s);break;case e.TYPES.fixed64:a.writeUint64(s);break;case e.TYPES.sfixed64:a.writeInt64(s);break;case e.TYPES.bool:"string"==typeof s?a.writeVarint32("false"===s.toLowerCase()?0:!!s):a.writeVarint32(s?1:0);break;case e.TYPES.enum:a.writeVarint32(s);break;case e.TYPES.float:a.writeFloat32(s);break;case e.TYPES.double:a.writeFloat64(s);break;case e.TYPES.string:a.writeVString(s);break;case e.TYPES.bytes:if(s.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+s.remaining()+" bytes remaining");var n=s.offset;a.writeVarint32(s.remaining()),a.append(s),s.offset=n;break;case e.TYPES.message:var r=(new t).LE();this.resolvedType.encode(s,r),a.writeVarint32(r.offset),a.append(r.flip());break;case e.TYPES.group:this.resolvedType.encode(s,a),a.writeVarint32(i<<3|e.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+s+" (unknown type)")}return a},h.decode=function(t,i,s){if(i!=this.type.wireType)throw Error("Unexpected wire type for element");var a,n;switch(this.type){case e.TYPES.int32:return 0|t.readVarint32();case e.TYPES.uint32:return t.readVarint32()>>>0;case e.TYPES.sint32:return 0|t.readVarint32ZigZag();case e.TYPES.fixed32:return t.readUint32()>>>0;case e.TYPES.sfixed32:return 0|t.readInt32();case e.TYPES.int64:return t.readVarint64();case e.TYPES.uint64:return t.readVarint64().toUnsigned();case e.TYPES.sint64:return t.readVarint64ZigZag();case e.TYPES.fixed64:return t.readUint64();case e.TYPES.sfixed64:return t.readInt64();case e.TYPES.bool:return!!t.readVarint32();case e.TYPES.enum:return t.readVarint32();case e.TYPES.float:return t.readFloat();case e.TYPES.double:return t.readDouble();case e.TYPES.string:return t.readVString();case e.TYPES.bytes:if(n=t.readVarint32(),t.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+t.remaining());return a=t.clone(),a.limit=a.offset+n,t.offset+=n,a;case e.TYPES.message:return n=t.readVarint32(),this.resolvedType.decode(t,n);case e.TYPES.group:return this.resolvedType.decode(t,-1,s)}throw Error("[INTERNAL] Illegal decode type")},h.valueFromString=function(i){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return this.verifyValue(parseInt(i));case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return this.verifyValue(i);case e.TYPES.bool:return"true"===i;case e.TYPES.string:return this.verifyValue(i);case e.TYPES.bytes:return t.fromBinary(i)}},h.valueToString=function(t){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===e.TYPES.bytes?t.toString("binary"):t.toString()},n.Element=d;var u=function(t,e,i,s,a,n){c.call(this,t,e,i,s,n),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!a,this._fields=null,this._fieldsById=null,this._fieldsByName=null},p=u.prototype=Object.create(c.prototype);p.build=function(i){if(this.clazz&&!i)return this.clazz;var s=function(e,i){function s(i,a,n,r){if(null===i||"object"!=typeof i){if(r&&r instanceof e.Reflect.Enum){var o=e.Reflect.Enum.getName(r.object,i);if(null!==o)return o}return i}if(t.isByteBuffer(i))return a?i.toBase64():i.toBuffer();if(e.Long.isLong(i))return n?i.toString():e.Long.fromValue(i);var c;if(Array.isArray(i))return c=[],i.forEach(function(t,e){c[e]=s(t,a,n,r)}),c;if(c={},i instanceof e.Map){for(var l=i.entries(),d=l.next();!d.done;d=l.next())c[i.keyElem.valueToString(d.value[0])]=s(d.value[1],a,n,i.valueElem.resolvedType);return c}var h=i.$type,u=void 0;for(var p in i)i.hasOwnProperty(p)&&(h&&(u=h.getChild(p))?c[p]=s(i[p],a,n,u.resolvedType):c[p]=s(i[p],a,n));return c}var a=i.getChildren(e.Reflect.Message.Field),n=i.getChildren(e.Reflect.Message.OneOf),r=function(s,o){e.Builder.Message.call(this);for(var c=0,l=n.length;c<l;++c)this[n[c].name]=null;for(c=0,l=a.length;c<l;++c){var d=a[c];this[d.name]=d.repeated?[]:d.map?new e.Map(d):null,!d.required&&"proto3"!==i.syntax||null===d.defaultValue||(this[d.name]=d.defaultValue)}if(arguments.length>0){var h;if(1!==arguments.length||null===s||"object"!=typeof s||!("function"!=typeof s.encode||s instanceof r)||Array.isArray(s)||s instanceof e.Map||t.isByteBuffer(s)||s instanceof ArrayBuffer||e.Long&&s instanceof e.Long)for(c=0,l=arguments.length;c<l;++c)void 0!==(h=arguments[c])&&this.$set(a[c].name,h);else this.$set(s)}},o=r.prototype=Object.create(e.Builder.Message.prototype);o.add=function(t,s,a){var n=i._fieldsByName[t];if(!a){if(!n)throw Error(this+"#"+t+" is undefined");if(!(n instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+n.toString(!0));if(!n.repeated)throw Error(this+"#"+t+" is not a repeated field");s=n.verifyValue(s,!0)}return null===this[t]&&(this[t]=[]),this[t].push(s),this},o.$add=o.add,o.set=function(t,s,a){if(t&&"object"==typeof t){a=s;for(var n in t)t.hasOwnProperty(n)&&void 0!==(s=t[n])&&this.$set(n,s,a);return this}var r=i._fieldsByName[t];if(a)this[t]=s;else{
if(!r)throw Error(this+"#"+t+" is not a field: undefined");if(!(r instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+r.toString(!0));this[r.name]=s=r.verifyValue(s)}if(r&&r.oneof){var o=this[r.oneof.name];null!==s?(null!==o&&o!==r.name&&(this[o]=null),this[r.oneof.name]=r.name):o===t&&(this[r.oneof.name]=null)}return this},o.$set=o.set,o.get=function(t,s){if(s)return this[t];var a=i._fieldsByName[t];if(!(a&&a instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: undefined");if(!(a instanceof e.Reflect.Message.Field))throw Error(this+"#"+t+" is not a field: "+a.toString(!0));return this[a.name]},o.$get=o.get;for(var c=0;c<a.length;c++){var l=a[c];l instanceof e.Reflect.Message.ExtensionField||i.builder.options.populateAccessors&&function(t){var e=t.originalName.replace(/(_[a-zA-Z])/g,function(t){return t.toUpperCase().replace("_","")});e=e.substring(0,1).toUpperCase()+e.substring(1);var s=t.originalName.replace(/([A-Z])/g,function(t){return"_"+t}),a=function(e,i){return this[t.name]=i?e:t.verifyValue(e),this},n=function(){return this[t.name]};null===i.getChild("set"+e)&&(o["set"+e]=a),null===i.getChild("set_"+s)&&(o["set_"+s]=a),null===i.getChild("get"+e)&&(o["get"+e]=n),null===i.getChild("get_"+s)&&(o["get_"+s]=n)}(l)}o.encode=function(e,s){"boolean"==typeof e&&(s=e,e=void 0);var a=!1;e||(e=new t,a=!0);var n=e.littleEndian;try{return i.encode(this,e.LE(),s),(a?e.flip():e).LE(n)}catch(t){throw e.LE(n),t}},r.encode=function(t,e,i){return new r(t).encode(e,i)},o.calculate=function(){return i.calculate(this)},o.encodeDelimited=function(e,s){var a=!1;e||(e=new t,a=!0);var n=(new t).LE();return i.encode(this,n,s).flip(),e.writeVarint32(n.remaining()),e.append(n),a?e.flip():e},o.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toArrayBuffer()),t}},o.toArrayBuffer=o.encodeAB,o.encodeNB=function(){try{return this.encode().toBuffer()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBuffer()),t}},o.toBuffer=o.encodeNB,o.encode64=function(){try{return this.encode().toBase64()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toBase64()),t}},o.toBase64=o.encode64,o.encodeHex=function(){try{return this.encode().toHex()}catch(t){throw t.encoded&&(t.encoded=t.encoded.toHex()),t}},o.toHex=o.encodeHex,o.toRaw=function(t,e){return s(this,!!t,!!e,this.$type)},o.encodeJSON=function(){return JSON.stringify(s(this,!0,!0,this.$type))},r.decode=function(e,s,a){"string"==typeof s&&(a=s,s=-1),"string"==typeof e?e=t.wrap(e,a||"base64"):t.isByteBuffer(e)||(e=t.wrap(e));var n=e.littleEndian;try{var r=i.decode(e.LE(),s);return e.LE(n),r}catch(t){throw e.LE(n),t}},r.decodeDelimited=function(e,s){if("string"==typeof e?e=t.wrap(e,s||"base64"):t.isByteBuffer(e)||(e=t.wrap(e)),e.remaining()<1)return null;var a=e.offset,n=e.readVarint32();if(e.remaining()<n)return e.offset=a,null;try{var r=i.decode(e.slice(e.offset,e.offset+n).LE());return e.offset+=n,r}catch(t){throw e.offset+=n,t}},r.decode64=function(t){return r.decode(t,"base64")},r.decodeHex=function(t){return r.decode(t,"hex")},r.decodeJSON=function(t){return new r(JSON.parse(t))},o.toString=function(){return i.toString()};return Object.defineProperty&&(Object.defineProperty(r,"$options",{value:i.buildOpt()}),Object.defineProperty(o,"$options",{value:r.$options}),Object.defineProperty(r,"$type",{value:i}),Object.defineProperty(o,"$type",{value:i})),r}(e,this);this._fields=[],this._fieldsById={},this._fieldsByName={};for(var a,n=0,r=this.children.length;n<r;n++)if((a=this.children[n])instanceof y||a instanceof u||a instanceof w){if(s.hasOwnProperty(a.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+a.toString(!0)+" cannot override static property '"+a.name+"'");s[a.name]=a.build()}else if(a instanceof u.Field)a.build(),this._fields.push(a),this._fieldsById[a.id]=a,this._fieldsByName[a.name]=a;else if(!(a instanceof u.OneOf||a instanceof C))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[n].toString(!0));return this.clazz=s},p.encode=function(t,e,i){for(var s,a,n=null,r=0,o=this._fields.length;r<o;++r)s=this._fields[r],a=t[s.name],s.required&&null===a?null===n&&(n=s):s.encode(i?a:s.verifyValue(a),e,t);if(null!==n){var c=Error("Missing at least one required field for "+this.toString(!0)+": "+n);throw c.encoded=e,c}return e},p.calculate=function(t){for(var e,i,s=0,a=0,n=this._fields.length;a<n;++a){if(e=this._fields[a],i=t[e.name],e.required&&null===i)throw Error("Missing at least one required field for "+this.toString(!0)+": "+e);s+=e.calculate(i,t)}return s},p.decode=function(t,i,s){"number"!=typeof i&&(i=-1);for(var n,r,o,c,l=t.offset,d=new this.clazz;t.offset<l+i||-1===i&&t.remaining()>0;){if(n=t.readVarint32(),r=7&n,o=n>>>3,r===e.WIRE_TYPES.ENDGROUP){if(o!==s)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+o+" ("+(s?s+" expected":"not a group")+")");break}if(c=this._fieldsById[o]){if(c.repeated&&!c.options.packed)d[c.name].push(c.decode(r,t));else if(c.map){var h=c.decode(r,t);d[c.name].set(h[0],h[1])}else if(d[c.name]=c.decode(r,t),c.oneof){var u=d[c.oneof.name];null!==u&&u!==c.name&&(d[u]=null),d[c.oneof.name]=c.name}}else switch(r){case e.WIRE_TYPES.VARINT:t.readVarint32();break;case e.WIRE_TYPES.BITS32:t.offset+=4;break;case e.WIRE_TYPES.BITS64:t.offset+=8;break;case e.WIRE_TYPES.LDELIM:var p=t.readVarint32();t.offset+=p;break;case e.WIRE_TYPES.STARTGROUP:for(;a(o,t););break;default:throw Error("Illegal wire type for unknown field "+o+" in "+this.toString(!0)+"#decode: "+r)}}for(var f=0,g=this._fields.length;f<g;++f)if(c=this._fields[f],null===d[c.name])if("proto3"===this.syntax)d[c.name]=c.defaultValue;else{if(c.required){var m=Error("Missing at least one required field for "+this.toString(!0)+": "+c.name);throw m.decoded=d,m}e.populateDefaults&&null!==c.defaultValue&&(d[c.name]=c.defaultValue)}return d},n.Message=u;var f=function(t,i,s,a,n,o,c,l,d,h){r.call(this,t,i,o),this.className="Message.Field",this.required="required"===s,this.repeated="repeated"===s,this.map="map"===s,this.keyType=a||null,this.type=n,this.resolvedType=null,this.id=c,this.options=l||{},this.defaultValue=null,this.oneof=d||null,this.syntax=h||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof u.ExtensionField||(this.name=e.Util.toCamelCase(this.name))},g=f.prototype=Object.create(r.prototype);g.build=function(){this.element=new d(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new d(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=d.defaultFieldValue(this.type)},g.verifyValue=function(t,i){function s(t,e){throw Error("Illegal value for "+a.toString(!0)+" of type "+a.type.name+": "+t+" ("+e+")")}i=i||!1;var a=this;if(null===t)return this.required&&s(typeof t,"required"),"proto3"===this.syntax&&this.type!==e.TYPES.message&&s(typeof t,"proto3 field without field presence cannot be null"),null;var n;if(this.repeated&&!i){Array.isArray(t)||(t=[t]);var r=[];for(n=0;n<t.length;n++)r.push(this.element.verifyValue(t[n]));return r}return this.map&&!i?t instanceof e.Map?t:(t instanceof Object||s(typeof t,"expected ProtoBuf.Map or raw object for map field"),new e.Map(this,t)):(!this.repeated&&Array.isArray(t)&&s(typeof t,"no array expected"),this.element.verifyValue(t))},g.hasWirePresence=function(t,i){if("proto3"!==this.syntax)return null!==t;if(this.oneof&&i[this.oneof.name]===this.name)return!0;switch(this.type){case e.TYPES.int32:case e.TYPES.sint32:case e.TYPES.sfixed32:case e.TYPES.uint32:case e.TYPES.fixed32:return 0!==t;case e.TYPES.int64:case e.TYPES.sint64:case e.TYPES.sfixed64:case e.TYPES.uint64:case e.TYPES.fixed64:return 0!==t.low||0!==t.high;case e.TYPES.bool:return t;case e.TYPES.float:case e.TYPES.double:return 0!==t;case e.TYPES.string:return t.length>0;case e.TYPES.bytes:return t.remaining()>0;case e.TYPES.enum:return 0!==t;case e.TYPES.message:return null!==t;default:return!0}},g.encode=function(i,s,a){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return s;try{if(this.repeated){var n;if(this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){s.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),s.ensureCapacity(s.offset+=1);var r=s.offset;for(n=0;n<i.length;n++)this.element.encodeValue(this.id,i[n],s);var o=s.offset-r,c=t.calculateVarint32(o);if(c>1){var l=s.slice(r,s.offset);r+=c-1,s.offset=r,s.append(l)}s.writeVarint32(o,r-c)}else for(n=0;n<i.length;n++)s.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i[n],s)}else this.map?i.forEach(function(i,a,n){var r=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,a)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i);s.writeVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),s.writeVarint32(r),s.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,a,s),s.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,i,s)},this):this.hasWirePresence(i,a)&&(s.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,i,s))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+t+")")}return s},g.calculate=function(i,s){if(i=this.verifyValue(i),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===i||this.repeated&&0==i.length)return 0;var a=0;try{if(this.repeated){var n,r;if(this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(a+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),r=0,n=0;n<i.length;n++)r+=this.element.calculateLength(this.id,i[n]);a+=t.calculateVarint32(r),a+=r}else for(n=0;n<i.length;n++)a+=t.calculateVarint32(this.id<<3|this.type.wireType),a+=this.element.calculateLength(this.id,i[n])}else this.map?i.forEach(function(i,s,n){var r=t.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,s)+t.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,i);a+=t.calculateVarint32(this.id<<3|e.WIRE_TYPES.LDELIM),a+=t.calculateVarint32(r),a+=r},this):this.hasWirePresence(i,s)&&(a+=t.calculateVarint32(this.id<<3|this.type.wireType),a+=this.element.calculateLength(this.id,i))}catch(t){throw Error("Illegal value for "+this.toString(!0)+": "+i+" ("+t+")")}return a},g.decode=function(t,i,s){var a,n;if(!(!this.map&&t==this.type.wireType||!s&&this.repeated&&this.options.packed&&t==e.WIRE_TYPES.LDELIM||this.map&&t==e.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+t+" ("+this.type.wireType+" expected)");if(t==e.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&e.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!s){n=i.readVarint32(),n=i.offset+n;for(var r=[];i.offset<n;)r.push(this.decode(this.type.wireType,i,!0));return r}if(this.map){var o=d.defaultFieldValue(this.keyType);if(a=d.defaultFieldValue(this.type),n=i.readVarint32(),i.remaining()<n)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+n+" required but got only "+i.remaining());var c=i.clone();for(c.limit=c.offset+n,i.offset+=n;c.remaining()>0;){var l=c.readVarint32();t=7&l;var h=l>>>3;if(1===h)o=this.keyElement.decode(c,t,h);else{if(2!==h)throw Error("Unexpected tag in map field key/value submessage");a=this.element.decode(c,t,h)}}return[o,a]}return this.element.decode(i,t,this.id)},n.Message.Field=f;var m=function(t,e,i,s,a,n,r){f.call(this,t,e,i,null,s,a,n,r),this.extension};m.prototype=Object.create(f.prototype),n.Message.ExtensionField=m;var v=function(t,e,i){r.call(this,t,e,i),this.fields=[]};n.Message.OneOf=v;var y=function(t,e,i,s,a){c.call(this,t,e,i,s,a),this.className="Enum",this.object=null};y.getName=function(t,e){for(var i,s=Object.keys(t),a=0;a<s.length;++a)if(t[i=s[a]]===e)return i;return null},(y.prototype=Object.create(c.prototype)).build=function(t){if(this.object&&!t)return this.object;for(var i=new e.Builder.Enum,s=this.getChildren(y.Value),a=0,n=s.length;a<n;++a)i[s[a].name]=s[a].id;return Object.defineProperty&&Object.defineProperty(i,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=i},n.Enum=y;var b=function(t,e,i,s){r.call(this,t,e,i),this.className="Enum.Value",this.id=s};b.prototype=Object.create(r.prototype),n.Enum.Value=b;var C=function(t,e,i,s){r.call(this,t,e,i),this.field=s};C.prototype=Object.create(r.prototype),n.Extension=C;var w=function(t,e,i,s){c.call(this,t,e,i,s),this.className="Service",this.clazz=null};(w.prototype=Object.create(c.prototype)).build=function(i){return this.clazz&&!i?this.clazz:this.clazz=function(e,i){for(var s=function(t){e.Builder.Service.call(this),this.rpcImpl=t||function(t,e,i){setTimeout(i.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},a=s.prototype=Object.create(e.Builder.Service.prototype),n=i.getChildren(e.Reflect.Service.RPCMethod),r=0;r<n.length;r++)!function(e){a[e.name]=function(s,a){try{try{s=e.resolvedRequestType.clazz.decode(t.wrap(s))}catch(t){if(!(t instanceof TypeError))throw t}if(null===s||"object"!=typeof s)throw Error("Illegal arguments");s instanceof e.resolvedRequestType.clazz||(s=new e.resolvedRequestType.clazz(s)),this.rpcImpl(e.fqn(),s,function(t,s){if(t)return void a(t);null===s&&(s="");try{s=e.resolvedResponseType.clazz.decode(s)}catch(t){}if(!(s&&s instanceof e.resolvedResponseType.clazz))return void a(Error("Illegal response type received in service method "+i.name+"#"+e.name));a(null,s)})}catch(t){setTimeout(a.bind(this,t),0)}},s[e.name]=function(t,i,a){new s(t)[e.name](i,a)},Object.defineProperty&&(Object.defineProperty(s[e.name],"$options",{value:e.buildOpt()}),Object.defineProperty(a[e.name],"$options",{value:s[e.name].$options}))}(n[r]);return Object.defineProperty&&(Object.defineProperty(s,"$options",{value:i.buildOpt()}),Object.defineProperty(a,"$options",{value:s.$options}),Object.defineProperty(s,"$type",{value:i}),Object.defineProperty(a,"$type",{value:i})),s}(e,this)},n.Service=w;var T=function(t,e,i,s){r.call(this,t,e,i),this.className="Service.Method",this.options=s||{}};(T.prototype=Object.create(r.prototype)).buildOpt=l.buildOpt,n.Service.Method=T;var x=function(t,e,i,s,a,n,r,o){T.call(this,t,e,i,o),this.className="Service.RPCMethod",this.requestName=s,this.responseName=a,this.requestStream=n,this.responseStream=r,this.resolvedRequestType=null,this.resolvedResponseType=null};return x.prototype=Object.create(T.prototype),n.Service.RPCMethod=x,n}(i),i.Builder=function(t,e,i){function s(t){t.messages&&t.messages.forEach(function(e){e.syntax=t.syntax,s(e)}),t.enums&&t.enums.forEach(function(e){e.syntax=t.syntax})}var a=function(t){this.ns=new i.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=t||{}},n=a.prototype;return a.isMessage=function(t){return"string"==typeof t.name&&(void 0===t.values&&void 0===t.rpc)},a.isMessageField=function(t){return"string"==typeof t.rule&&"string"==typeof t.name&&"string"==typeof t.type&&void 0!==t.id},a.isEnum=function(t){return"string"==typeof t.name&&!(void 0===t.values||!Array.isArray(t.values)||0===t.values.length)},a.isService=function(t){return!("string"!=typeof t.name||"object"!=typeof t.rpc||!t.rpc)},a.isExtend=function(t){return"string"==typeof t.ref},n.reset=function(){return this.ptr=this.ns,this},n.define=function(t){if("string"!=typeof t||!e.TYPEREF.test(t))throw Error("illegal namespace: "+t);return t.split(".").forEach(function(t){var e=this.ptr.getChild(t);null===e&&this.ptr.addChild(e=new i.Namespace(this,this.ptr,t)),this.ptr=e},this),this},n.create=function(e){if(!e)return this;if(Array.isArray(e)){if(0===e.length)return this;e=e.slice()}else e=[e];for(var s=[e];s.length>0;){if(e=s.pop(),!Array.isArray(e))throw Error("not a valid namespace: "+JSON.stringify(e));for(;e.length>0;){var n=e.shift();if(a.isMessage(n)){var r=new i.Message(this,this.ptr,n.name,n.options,n.isGroup,n.syntax),o={};n.oneofs&&Object.keys(n.oneofs).forEach(function(t){r.addChild(o[t]=new i.Message.OneOf(this,r,t))},this),n.fields&&n.fields.forEach(function(t){if(null!==r.getChild(0|t.id))throw Error("duplicate or invalid field id in "+r.name+": "+t.id);if(t.options&&"object"!=typeof t.options)throw Error("illegal field options in "+r.name+"#"+t.name);var e=null;if("string"==typeof t.oneof&&!(e=o[t.oneof]))throw Error("illegal oneof in "+r.name+"#"+t.name+": "+t.oneof);t=new i.Message.Field(this,r,t.rule,t.keytype,t.type,t.name,t.id,t.options,e,n.syntax),e&&e.fields.push(t),r.addChild(t)},this);var c=[];if(n.enums&&n.enums.forEach(function(t){c.push(t)}),n.messages&&n.messages.forEach(function(t){c.push(t)}),n.services&&n.services.forEach(function(t){c.push(t)}),n.extensions&&("number"==typeof n.extensions[0]?r.extensions=[n.extensions]:r.extensions=n.extensions),this.ptr.addChild(r),c.length>0){s.push(e),e=c,c=null,this.ptr=r,r=null;continue}c=null}else if(a.isEnum(n))r=new i.Enum(this,this.ptr,n.name,n.options,n.syntax),n.values.forEach(function(t){r.addChild(new i.Enum.Value(this,r,t.name,t.id))},this),this.ptr.addChild(r);else if(a.isService(n))r=new i.Service(this,this.ptr,n.name,n.options),Object.keys(n.rpc).forEach(function(t){var e=n.rpc[t];r.addChild(new i.Service.RPCMethod(this,r,t,e.request,e.response,!!e.request_stream,!!e.response_stream,e.options))},this),this.ptr.addChild(r);else{if(!a.isExtend(n))throw Error("not a valid definition: "+JSON.stringify(n));if(r=this.ptr.resolve(n.ref,!0))n.fields.forEach(function(e){if(null!==r.getChild(0|e.id))throw Error("duplicate extended field id in "+r.name+": "+e.id);if(r.extensions){var s=!1;if(r.extensions.forEach(function(t){e.id>=t[0]&&e.id<=t[1]&&(s=!0)}),!s)throw Error("illegal extended field id in "+r.name+": "+e.id+" (not within valid ranges)")}var a=e.name;this.options.convertFieldsToCamelCase&&(a=t.Util.toCamelCase(a));var n=new i.Message.ExtensionField(this,r,e.rule,e.type,this.ptr.fqn()+"."+a,e.id,e.options),o=new i.Extension(this,this.ptr,e.name,n);n.extension=o,this.ptr.addChild(o),r.addChild(n)},this);else if(!/\.?google\.protobuf\./.test(n.ref))throw Error("extended message "+n.ref+" is not defined")}n=null,r=null}e=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},n.import=function(e,i){var a="/";if("string"==typeof i){if(t.Util.IS_NODE&&(i=require("path").resolve(i)),!0===this.files[i])return this.reset();this.files[i]=!0}else if("object"==typeof i){var n=i.root;t.Util.IS_NODE&&(n=require("path").resolve(n)),(n.indexOf("\\")>=0||i.file.indexOf("\\")>=0)&&(a="\\");var r=n+a+i.file;if(!0===this.files[r])return this.reset();this.files[r]=!0}if(e.imports&&e.imports.length>0){var o,c=!1;"object"==typeof i?(this.importRoot=i.root,c=!0,o=this.importRoot,i=i.file,(o.indexOf("\\")>=0||i.indexOf("\\")>=0)&&(a="\\")):"string"==typeof i?this.importRoot?o=this.importRoot:i.indexOf("/")>=0?""===(o=i.replace(/\/[^\/]*$/,""))&&(o="/"):i.indexOf("\\")>=0?(o=i.replace(/\\[^\\]*$/,""),a="\\"):o=".":o=null;for(var l=0;l<e.imports.length;l++)if("string"==typeof e.imports[l]){if(!o)throw Error("cannot determine import root");var d=e.imports[l];if("google/protobuf/descriptor.proto"===d)continue;if(d=o+a+d,!0===this.files[d])continue;/\.proto$/i.test(d)&&!t.DotProto&&(d=d.replace(/\.proto$/,".json"));var h=t.Util.fetch(d);if(null===h)throw Error("failed to import '"+d+"' in '"+i+"': file not found");/\.json$/i.test(d)?this.import(JSON.parse(h+""),d):this.import(t.DotProto.Parser.parse(h),d)}else i?/\.(\w+)$/.test(i)?this.import(e.imports[l],i.replace(/^(.+)\.(\w+)$/,function(t,e,i){return e+"_import"+l+"."+i})):this.import(e.imports[l],i+"_import"+l):this.import(e.imports[l]);c&&(this.importRoot=null)}e.package&&this.define(e.package),e.syntax&&s(e);var u=this.ptr;return e.options&&Object.keys(e.options).forEach(function(t){u.options[t]=e.options[t]}),e.messages&&(this.create(e.messages),this.ptr=u),e.enums&&(this.create(e.enums),this.ptr=u),e.services&&(this.create(e.services),this.ptr=u),e.extends&&this.create(e.extends),this.reset()},n.resolveAll=function(){var s;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof i.Namespace)this.ptr.children.forEach(function(t){this.ptr=t,this.resolveAll()},this);else if(this.ptr instanceof i.Message.Field){if(e.TYPE.test(this.ptr.type))this.ptr.type=t.TYPES[this.ptr.type];else{if(!e.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(s=(this.ptr instanceof i.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=s,s instanceof i.Enum){if(this.ptr.type=t.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==s.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(s instanceof i.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=s.isGroup?t.TYPES.group:t.TYPES.message}}if(this.ptr.map){if(!e.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=t.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof t.Reflect.Service.Method){if(!(this.ptr instanceof t.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((s=this.ptr.parent.resolve(this.ptr.requestName,!0))&&s instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=s,!((s=this.ptr.parent.resolve(this.ptr.responseName,!0))&&s instanceof t.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=s}else if(!(this.ptr instanceof t.Reflect.Message.OneOf||this.ptr instanceof t.Reflect.Extension||this.ptr instanceof t.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},n.build=function(t){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!t)return this.result;for(var e="string"==typeof t?t.split("."):t,i=this.result,s=0;s<e.length;s++){if(!i[e[s]]){i=null;break}i=i[e[s]]}return i},n.lookup=function(t,e){return t?this.ns.resolve(t,e):this.ns},n.toString=function(){return"Builder"},a.Message=function(){},a.Enum=function(){},a.Service=function(){},a}(i,i.Lang,i.Reflect),i.Map=function(t,e){function i(t){var e=0;return{next:function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}}var s=function(t,i){if(!t.map)throw Error("field is not a map");if(this.field=t,this.keyElem=new e.Element(t.keyType,null,!0,t.syntax),this.valueElem=new e.Element(t.type,t.resolvedType,!1,t.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),i)for(var s=Object.keys(i),a=0;a<s.length;a++){var n=this.keyElem.valueFromString(s[a]),r=this.valueElem.verifyValue(i[s[a]]);this.map[this.keyElem.valueToString(n)]={key:n,value:r}}},a=s.prototype;return a.clear=function(){this.map={}},a.delete=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t)),i=e in this.map;return delete this.map[e],i},a.entries=function(){for(var t,e=[],s=Object.keys(this.map),a=0;a<s.length;a++)e.push([(t=this.map[s[a]]).key,t.value]);return i(e)},a.keys=function(){for(var t=[],e=Object.keys(this.map),s=0;s<e.length;s++)t.push(this.map[e[s]].key);return i(t)},a.values=function(){for(var t=[],e=Object.keys(this.map),s=0;s<e.length;s++)t.push(this.map[e[s]].value);return i(t)},a.forEach=function(t,e){for(var i,s=Object.keys(this.map),a=0;a<s.length;a++)t.call(e,(i=this.map[s[a]]).value,i.key,this)},a.set=function(t,e){var i=this.keyElem.verifyValue(t),s=this.valueElem.verifyValue(e);return this.map[this.keyElem.valueToString(i)]={key:i,value:s},this},a.get=function(t){var e=this.keyElem.valueToString(this.keyElem.verifyValue(t));if(e in this.map)return this.map[e].value},a.has=function(t){return this.keyElem.valueToString(this.keyElem.verifyValue(t))in this.map},s}(0,i.Reflect),i.loadProto=function(t,e,s){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(s=e,e=void 0),i.loadJson(i.DotProto.Parser.parse(t),e,s)},i.protoFromString=i.loadProto,i.loadProtoFile=function(t,e,s){if(e&&"object"==typeof e?(s=e,e=null):e&&"function"==typeof e||(e=null),e)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(a){if(null===a)return void e(Error("Failed to fetch file"));try{e(null,i.loadProto(a,s,t))}catch(t){e(t)}});var a=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===a?null:i.loadProto(a,s,t)},i.protoFromFile=i.loadProtoFile,i.newBuilder=function(t){return t=t||{},void 0===t.convertFieldsToCamelCase&&(t.convertFieldsToCamelCase=i.convertFieldsToCamelCase),void 0===t.populateAccessors&&(t.populateAccessors=i.populateAccessors),new i.Builder(t)},i.loadJson=function(t,e,s){return("string"==typeof e||e&&"string"==typeof e.file&&"string"==typeof e.root)&&(s=e,e=null),e&&"object"==typeof e||(e=i.newBuilder()),"string"==typeof t&&(t=JSON.parse(t)),e.import(t,s),e.resolveAll(),e},i.loadJsonFile=function(t,e,s){if(e&&"object"==typeof e?(s=e,e=null):e&&"function"==typeof e||(e=null),e)return i.Util.fetch("string"==typeof t?t:t.root+"/"+t.file,function(a){if(null===a)return void e(Error("Failed to fetch file"));try{e(null,i.loadJson(JSON.parse(a),s,t))}catch(t){e(t)}});var a=i.Util.fetch("object"==typeof t?t.root+"/"+t.file:t);return null===a?null:i.loadJson(JSON.parse(a),s,t)},i}),"undefined"==typeof Paho&&(Paho={}),Paho.MQTT=function(t){function e(t,e){var i=e,s=t[e],n=s>>4,r=s&=15;e+=1;var o,d=0,h=1;do{if(e==t.length)return[null,i];o=t[e++],d+=(127&o)*h,h*=128}while(0!=(128&o));var u=e+d;if(u>t.length)return[null,i];var p=new v(n);switch(ChatWebsocket.settings.onlineDebug&&console.log("decodeType:"+n+" "+new Date+" "+(new Date).getTime()),n){case l.CONNACK:1&t[e++]&&(p.sessionPresent=!0),p.returnCode=t[e++];break;case l.PUBLISH:var f=r>>1&3,g=a(t,e);e+=2;var m=c(t,e,g);e+=g,f>0&&(p.messageIdentifier=a(t,e),e+=2);var y=new Paho.MQTT.Message(t.subarray(e,u));1==(1&r)&&(y.retained=!0),8==(8&r)&&(y.duplicate=!0),y.qos=f,y.destinationName=m,p.payloadMessage=y;break;case l.PUBACK:case l.PUBREC:case l.PUBREL:case l.PUBCOMP:case l.UNSUBACK:p.messageIdentifier=a(t,e);break;case l.SUBACK:p.messageIdentifier=a(t,e),e+=2,p.returnCode=t.subarray(e,u)}return[p,u]}function i(t,e,i){return e[i++]=t>>8,e[i++]=t%256,i}function s(t,e,s,a){return a=i(e,s,a),o(t,s,a),a+e}function a(t,e){return 256*t[e]+t[e+1]}function n(t){var e=new Array(1),i=0;do{var s=t%128;t>>=7,t>0&&(s|=128),e[i++]=s}while(t>0&&i<4);return e}function r(t){for(var e=0,i=0;i<t.length;i++){var s=t.charCodeAt(i);s>2047?(55296<=s&&s<=56319&&(i++,e++),e+=3):s>127?e+=2:e++}return e}function o(t,e,i){for(var s=i,a=0;a<t.length;a++){var n=t.charCodeAt(a);if(55296<=n&&n<=56319){var r=t.charCodeAt(++a);if(isNaN(r))throw new Error(f(u.MALFORMED_UNICODE,[n,r]));n=r-56320+(n-55296<<10)+65536}n<=127?e[s++]=n:n<=2047?(e[s++]=n>>6&31|192,e[s++]=63&n|128):n<=65535?(e[s++]=n>>12&15|224,e[s++]=n>>6&63|128,e[s++]=63&n|128):(e[s++]=n>>18&7|240,e[s++]=n>>12&63|128,e[s++]=n>>6&63|128,e[s++]=63&n|128)}return e}function c(t,e,i){for(var s,a="",n=e;n<e+i;){var r=t[n++];if(r<128)s=r;else{var o=t[n++]-128;if(o<0)throw new Error(f(u.MALFORMED_UTF,[r.toString(16),o.toString(16),""]));if(r<224)s=64*(r-192)+o;else{var c=t[n++]-128;if(c<0)throw new Error(f(u.MALFORMED_UTF,[r.toString(16),o.toString(16),c.toString(16)]));if(r<240)s=4096*(r-224)+64*o+c;else{var l=t[n++]-128;if(l<0)throw new Error(f(u.MALFORMED_UTF,[r.toString(16),o.toString(16),c.toString(16),l.toString(16)]));if(!(r<248))throw new Error(f(u.MALFORMED_UTF,[r.toString(16),o.toString(16),c.toString(16),l.toString(16)]));s=262144*(r-240)+4096*o+64*c+l}}}s>65535&&(s-=65536,a+=String.fromCharCode(55296+(s>>10)),s=56320+(1023&s)),a+=String.fromCharCode(s)}return a}var l={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},d=function(t,e){for(var i in t)if(t.hasOwnProperty(i)){if(!e.hasOwnProperty(i)){var s="Unknown property, "+i+". Valid properties are:";for(var i in e)e.hasOwnProperty(i)&&(s=s+" "+i);throw new Error(s)}if(typeof t[i]!==e[i])throw new Error(f(u.INVALID_TYPE,[typeof t[i],i]))}},h=function(t,e){return function(){return t.apply(e,arguments)}},u={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},p={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},f=function(t,e){var i=t.text;if(e)for(var s,a,n=0;n<e.length;n++)if(s="{"+n+"}",(a=i.indexOf(s))>0){var r=i.substring(0,a),o=i.substring(a+s.length);i=r+e[n]+o}return i},g=[0,6,77,81,73,115,100,112,3],m=[0,4,77,81,84,84,4],v=function(t,e){this.type=t;for(var i in e)e.hasOwnProperty(i)&&(this[i]=e[i])};v.prototype.encode=function(){var t=(15&this.type)<<4,e=0,a=new Array,o=0;switch(void 0!=this.messageIdentifier&&(e+=2),this.type){case l.CONNECT:switch(this.mqttVersion){case 3:e+=g.length+3;break;case 4:e+=m.length+3}if(e+=r(this.clientId)+2,void 0!=this.willMessage){e+=r(this.willMessage.destinationName)+2;var c=this.willMessage.payloadBytes;c instanceof Uint8Array||(c=new Uint8Array(h)),e+=c.byteLength+2}void 0!=this.userName&&(e+=r(this.userName)+2),void 0!=this.password&&(e+=r(this.password)+2);break;case l.SUBSCRIBE:t|=2;for(var d=0;d<this.topics.length;d++)a[d]=r(this.topics[d]),e+=a[d]+2;e+=this.requestedQos.length;break;case l.UNSUBSCRIBE:t|=2;for(var d=0;d<this.topics.length;d++)a[d]=r(this.topics[d]),e+=a[d]+2;break;case l.PUBREL:t|=2;break;case l.PUBLISH:this.payloadMessage.duplicate&&(t|=8),t=t|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(t|=1),o=r(this.payloadMessage.destinationName),e+=o+2;var h=this.payloadMessage.payloadBytes;e+=h.byteLength,h instanceof ArrayBuffer?h=new Uint8Array(h):h instanceof Uint8Array||(h=new Uint8Array(h.buffer));break;case l.DISCONNECT:}var u=n(e),p=u.length+1,f=new ArrayBuffer(e+p),v=new Uint8Array(f);if(v[0]=t,v.set(u,1),
this.type==l.PUBLISH)p=s(this.payloadMessage.destinationName,o,v,p);else if(this.type==l.CONNECT){switch(this.mqttVersion){case 3:v.set(g,p),p+=g.length;break;case 4:v.set(m,p),p+=m.length}var y=0;this.cleanSession&&(y=2),void 0!=this.willMessage&&(y|=4,y|=this.willMessage.qos<<3,this.willMessage.retained&&(y|=32)),void 0!=this.userName&&(y|=128),void 0!=this.password&&(y|=64),v[p++]=y,p=i(this.keepAliveInterval,v,p)}switch(void 0!=this.messageIdentifier&&(p=i(this.messageIdentifier,v,p)),this.type){case l.CONNECT:p=s(this.clientId,r(this.clientId),v,p),void 0!=this.willMessage&&(p=s(this.willMessage.destinationName,r(this.willMessage.destinationName),v,p),p=i(c.byteLength,v,p),v.set(c,p),p+=c.byteLength),void 0!=this.userName&&(p=s(this.userName,r(this.userName),v,p)),void 0!=this.password&&(p=s(this.password,r(this.password),v,p));break;case l.PUBLISH:v.set(h,p);break;case l.SUBSCRIBE:for(var d=0;d<this.topics.length;d++)p=s(this.topics[d],a[d],v,p),v[p++]=this.requestedQos[d];break;case l.UNSUBSCRIBE:for(var d=0;d<this.topics.length;d++)p=s(this.topics[d],a[d],v,p)}return f};var y=function(t,e,i){this._client=t,this._window=e,this._keepAliveInterval=1e3*i,this.isReset=!1;var s=new v(l.PINGREQ).encode(),a=function(t){return function(){return n.apply(t)}},n=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(s),this.timeout=this._window.setTimeout(a(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(u.PING_TIMEOUT.code,f(u.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(a(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},b=function(t,e,i,s,a){this._window=e,i||(i=30);this.timeout=setTimeout(function(t,e,i){return function(){return t.apply(e,i)}}(s,t,a),1e3*i),this.cancel=function(){this._window.clearTimeout(this.timeout)}},C=function(e,i,s,a,n){if(!("WebSocket"in t&&null!==t.WebSocket))throw new Error(f(u.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in t&&null!==t.localStorage))throw new Error(f(u.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in t&&null!==t.ArrayBuffer))throw new Error(f(u.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",e,i,s,a,n),this.host=i,this.port=s,this.path=a,this.uri=e,this.clientId=n,this._localKey=i+":"+s+("/mqtt"!=a?":"+a:"")+":"+n+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var r in localStorage)0!=r.indexOf("Sent:"+this._localKey)&&0!=r.indexOf("Received:"+this._localKey)||this.restore(r)};C.prototype.host,C.prototype.port,C.prototype.path,C.prototype.uri,C.prototype.clientId,C.prototype.socket,C.prototype.connected=!1,C.prototype.maxMessageIdentifier=65536,C.prototype.connectOptions,C.prototype.hostIndex,C.prototype.onConnectionLost,C.prototype.onMessageDelivered,C.prototype.onMessageArrived,C.prototype.traceFunction,C.prototype._msg_queue=null,C.prototype._connectTimeout,C.prototype.sendPinger=null,C.prototype.receivePinger=null,C.prototype.receiveBuffer=null,C.prototype._traceBuffer=null,C.prototype._MAX_TRACE_ENTRIES=100,C.prototype.connect=function(t){var e=this._traceMask(t,"password");this._trace("Client.connect",e,this.socket,this.connected),this.connectOptions=t,t.uris?(this.hostIndex=0,this._doConnect(t.uris[0])):this._doConnect(this.uri)},C.prototype.subscribe=function(t,e){if(this._trace("Client.subscribe",t,e),!this.connected)throw new Error(f(u.INVALID_STATE,["not connected"]));var i=new v(l.SUBSCRIBE);i.topics=[t],void 0!=e.qos?i.requestedQos=[e.qos]:i.requestedQos=[0],e.onSuccess&&(i.onSuccess=function(t){e.onSuccess({invocationContext:e.invocationContext,grantedQos:t})}),e.onFailure&&(i.onFailure=function(t){e.onFailure({invocationContext:e.invocationContext,errorCode:t})}),e.timeout&&(i.timeOut=new b(this,window,e.timeout,e.onFailure,[{invocationContext:e.invocationContext,errorCode:u.SUBSCRIBE_TIMEOUT.code,errorMessage:f(u.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},C.prototype.unsubscribe=function(t,e){if(this._trace("Client.unsubscribe",t,e),!this.connected)throw new Error(f(u.INVALID_STATE,["not connected"]));var i=new v(l.UNSUBSCRIBE);i.topics=[t],e.onSuccess&&(i.callback=function(){e.onSuccess({invocationContext:e.invocationContext})}),e.timeout&&(i.timeOut=new b(this,window,e.timeout,e.onFailure,[{invocationContext:e.invocationContext,errorCode:u.UNSUBSCRIBE_TIMEOUT.code,errorMessage:f(u.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(i),this._schedule_message(i)},C.prototype.send=function(t){if(this._trace("Client.send",t),!this.connected)throw new Error(f(u.INVALID_STATE,["not connected"]));wireMessage=new v(l.PUBLISH),wireMessage.payloadMessage=t,t.qos>0?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},C.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw new Error(f(u.INVALID_STATE,["not connecting or connected"]));wireMessage=new v(l.DISCONNECT),this._notify_msg_sent[wireMessage]=h(this._disconnected,this),this._schedule_message(wireMessage)},C.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var t in this._sentMessages)this._trace("_sentMessages ",t,this._sentMessages[t]);for(var t in this._receivedMessages)this._trace("_receivedMessages ",t,this._receivedMessages[t]);return this._traceBuffer}},C.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@")},C.prototype.stopTrace=function(){delete this._traceBuffer},C.prototype._doConnect=function(t){if(this.connectOptions.useSSL){var e=t.split(":");e[0]="wss",t=e.join(":")}this.connected=!1,this.connectOptions.mqttVersion,this.socket=new WebSocket(t),this.socket.binaryType="arraybuffer",this.socket.onopen=h(this._on_socket_open,this),this.socket.onmessage=h(this._on_socket_message,this),this.socket.onerror=h(this._on_socket_error,this),this.socket.onclose=h(this._on_socket_close,this),this.sendPinger=new y(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new y(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new b(this,window,this.connectOptions.timeout,this._disconnected,[u.CONNECT_TIMEOUT.code,f(u.CONNECT_TIMEOUT)])},C.prototype._schedule_message=function(t){this._msg_queue.push(t),this.connected&&this._process_queue()},C.prototype.store=function(t,e){var i={type:e.type,messageIdentifier:e.messageIdentifier,version:1};switch(e.type){case l.PUBLISH:e.pubRecReceived&&(i.pubRecReceived=!0),i.payloadMessage={};for(var s="",a=e.payloadMessage.payloadBytes,n=0;n<a.length;n++)a[n]<=15?s=s+"0"+a[n].toString(16):s+=a[n].toString(16);i.payloadMessage.payloadHex=s,i.payloadMessage.qos=e.payloadMessage.qos,i.payloadMessage.destinationName=e.payloadMessage.destinationName,e.payloadMessage.duplicate&&(i.payloadMessage.duplicate=!0),e.payloadMessage.retained&&(i.payloadMessage.retained=!0),0==t.indexOf("Sent:")&&(void 0===e.sequence&&(e.sequence=++this._sequence),i.sequence=e.sequence);break;default:throw Error(f(u.INVALID_STORED_DATA,[key,i]))}localStorage.setItem(t+this._localKey+e.messageIdentifier,JSON.stringify(i))},C.prototype.restore=function(t){var e=localStorage.getItem(t),i=JSON.parse(e),s=new v(i.type,i);switch(i.type){case l.PUBLISH:for(var a=i.payloadMessage.payloadHex,n=new ArrayBuffer(a.length/2),r=new Uint8Array(n),o=0;a.length>=2;){var c=parseInt(a.substring(0,2),16);a=a.substring(2,a.length),r[o++]=c}var d=new Paho.MQTT.Message(r);d.qos=i.payloadMessage.qos,d.destinationName=i.payloadMessage.destinationName,i.payloadMessage.duplicate&&(d.duplicate=!0),i.payloadMessage.retained&&(d.retained=!0),s.payloadMessage=d;break;default:throw Error(f(u.INVALID_STORED_DATA,[t,e]))}0==t.indexOf("Sent:"+this._localKey)?(s.payloadMessage.duplicate=!0,this._sentMessages[s.messageIdentifier]=s):0==t.indexOf("Received:"+this._localKey)&&(this._receivedMessages[s.messageIdentifier]=s)},C.prototype._process_queue=function(){for(var t=null,e=this._msg_queue.reverse();t=e.pop();)this._socket_send(t),this._notify_msg_sent[t]&&(this._notify_msg_sent[t](),delete this._notify_msg_sent[t])},C.prototype._requires_ack=function(t){var e=Object.keys(this._sentMessages).length;if(e>this.maxMessageIdentifier)throw Error("Too many messages:"+e);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;t.messageIdentifier=this._message_identifier,this._sentMessages[t.messageIdentifier]=t,t.type===l.PUBLISH&&this.store("Sent:",t),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},C.prototype._on_socket_open=function(){var t=new v(l.CONNECT,this.connectOptions);t.clientId=this.clientId,this._socket_send(t)},C.prototype._on_socket_message=function(t){this._trace("Client._on_socket_message",t.data),this.receivePinger.reset();for(var e=this._deframeMessages(t.data),i=0;i<e.length;i+=1)this._handleMessage(e[i])},C.prototype._deframeMessages=function(t){var i=new Uint8Array(t);if(this.receiveBuffer){var s=new Uint8Array(this.receiveBuffer.length+i.length);s.set(this.receiveBuffer),s.set(i,this.receiveBuffer.length),i=s,delete this.receiveBuffer}try{for(var a=0,n=[];a<i.length;){var r=e(i,a),o=r[0];if(a=r[1],null===o)break;n.push(o)}a<i.length&&(this.receiveBuffer=i.subarray(a))}catch(t){return void this._disconnected(u.INTERNAL_ERROR.code,f(u.INTERNAL_ERROR,[t.message,t.stack.toString()]))}return n},C.prototype._handleMessage=function(t){this._trace("Client._handleMessage",t);try{switch(t.type){case l.CONNACK:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var e in this._sentMessages){var i=this._sentMessages[e];localStorage.removeItem("Sent:"+this._localKey+i.messageIdentifier)}this._sentMessages={};for(var e in this._receivedMessages){var s=this._receivedMessages[e];localStorage.removeItem("Received:"+this._localKey+s.messageIdentifier)}this._receivedMessages={}}if(0!==t.returnCode){this._disconnected(u.CONNACK_RETURNCODE.code,f(u.CONNACK_RETURNCODE,[t.returnCode,p[t.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var a=new Array;for(var n in this._sentMessages)this._sentMessages.hasOwnProperty(n)&&a.push(this._sentMessages[n]);for(var a=a.sort(function(t,e){return t.sequence-e.sequence}),r=0,o=a.length;r<o;r++){var i=a[r];if(i.type==l.PUBLISH&&i.pubRecReceived){var c=new v(l.PUBREL,{messageIdentifier:i.messageIdentifier});this._schedule_message(c)}else this._schedule_message(i)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case l.PUBLISH:this._receivePublish(t);break;case l.PUBACK:var i=this._sentMessages[t.messageIdentifier];i&&(delete this._sentMessages[t.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+t.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage));break;case l.PUBREC:var i=this._sentMessages[t.messageIdentifier];if(i){i.pubRecReceived=!0;var c=new v(l.PUBREL,{messageIdentifier:t.messageIdentifier});this.store("Sent:",i),this._schedule_message(c)}break;case l.PUBREL:var s=this._receivedMessages[t.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+t.messageIdentifier),s&&(this._receiveMessage(s),delete this._receivedMessages[t.messageIdentifier]);var d=new v(l.PUBCOMP,{messageIdentifier:t.messageIdentifier});this._schedule_message(d);break;case l.PUBCOMP:var i=this._sentMessages[t.messageIdentifier];delete this._sentMessages[t.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+t.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(i.payloadMessage);break;case l.SUBACK:var i=this._sentMessages[t.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),128===t.returnCode[0]?i.onFailure&&i.onFailure(t.returnCode):i.onSuccess&&i.onSuccess(t.returnCode),delete this._sentMessages[t.messageIdentifier]);break;case l.UNSUBACK:var i=this._sentMessages[t.messageIdentifier];i&&(i.timeOut&&i.timeOut.cancel(),i.callback&&i.callback(),delete this._sentMessages[t.messageIdentifier]);break;case l.PINGRESP:this.sendPinger.reset();break;case l.DISCONNECT:this._disconnected(u.INVALID_MQTT_MESSAGE_TYPE.code,f(u.INVALID_MQTT_MESSAGE_TYPE,[t.type]));break;default:this._disconnected(u.INVALID_MQTT_MESSAGE_TYPE.code,f(u.INVALID_MQTT_MESSAGE_TYPE,[t.type]))}}catch(t){return void this._disconnected(u.INTERNAL_ERROR.code,f(u.INTERNAL_ERROR,[t.message,t.stack.toString()]))}},C.prototype._on_socket_error=function(t){this._disconnected(u.SOCKET_ERROR.code,f(u.SOCKET_ERROR,[t.data]))},C.prototype._on_socket_close=function(){this._disconnected(u.SOCKET_CLOSE.code,f(u.SOCKET_CLOSE))},C.prototype._socket_send=function(t){if(1==t.type){var e=this._traceMask(t,"password");this._trace("Client._socket_send",e)}else this._trace("Client._socket_send",t);this.socket.send(t.encode()),ChatWebsocket.settings.onlineDebug&&console.log("sendType:"+t.type+" "+new Date+" "+(new Date).getTime()),this.sendPinger.reset()},C.prototype._receivePublish=function(t){switch(t.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(t);break;case 1:var e=new v(l.PUBACK,{messageIdentifier:t.messageIdentifier});this._schedule_message(e),this._receiveMessage(t);break;case 2:this._receivedMessages[t.messageIdentifier]=t,this.store("Received:",t);var i=new v(l.PUBREC,{messageIdentifier:t.messageIdentifier});this._schedule_message(i);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},C.prototype._receiveMessage=function(t){this.onMessageArrived&&this.onMessageArrived(t.payloadMessage)},C.prototype._disconnected=function(t,e){this._trace("Client._disconnected",t,e),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===t&&(t=u.OK.code,e=f(u.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:t,errorMessage:e})):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:t,errorMessage:e}))},C.prototype._trace=function(){if(this.traceFunction){for(var t in arguments)void 0!==arguments[t]&&(arguments[t]=JSON.stringify(arguments[t]));var e=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:e})}if(null!==this._traceBuffer)for(var t=0,i=arguments.length;t<i;t++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===t?this._traceBuffer.push(arguments[t]):void 0===arguments[t]?this._traceBuffer.push(arguments[t]):this._traceBuffer.push("  "+JSON.stringify(arguments[t]))},C.prototype._traceMask=function(t,e){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=s==e?"******":t[s]);return i};var w=function(t,e,i,s){var a;if("string"!=typeof t)throw new Error(f(u.INVALID_TYPE,[typeof t,"host"]));if(2==arguments.length){s=e,a=t;var n=a.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!n)throw new Error(f(u.INVALID_ARGUMENT,[t,"host"]));t=n[4]||n[2],e=parseInt(n[7]),i=n[8]}else{if(3==arguments.length&&(s=i,i="/mqtt"),"number"!=typeof e||e<0)throw new Error(f(u.INVALID_TYPE,[typeof e,"port"]));if("string"!=typeof i)throw new Error(f(u.INVALID_TYPE,[typeof i,"path"]));var r=-1!=t.indexOf(":")&&"["!=t.slice(0,1)&&"]"!=t.slice(-1);a="ws://"+(r?"["+t+"]":t)+":"+e+i}for(var o=0,c=0;c<s.length;c++){var l=s.charCodeAt(c);55296<=l&&l<=56319&&c++,o++}if("string"!=typeof s||o>65535)throw new Error(f(u.INVALID_ARGUMENT,[s,"clientId"]));var h=new C(a,t,e,i,s);this._getHost=function(){return t},this._setHost=function(){throw new Error(f(u.UNSUPPORTED_OPERATION))},this._getPort=function(){return e},this._setPort=function(){throw new Error(f(u.UNSUPPORTED_OPERATION))},this._getPath=function(){return i},this._setPath=function(){throw new Error(f(u.UNSUPPORTED_OPERATION))},this._getURI=function(){return a},this._setURI=function(){throw new Error(f(u.UNSUPPORTED_OPERATION))},this._getClientId=function(){return h.clientId},this._setClientId=function(){throw new Error(f(u.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return h.onConnectionLost},this._setOnConnectionLost=function(t){if("function"!=typeof t)throw new Error(f(u.INVALID_TYPE,[typeof t,"onConnectionLost"]));h.onConnectionLost=t},this._getOnMessageDelivered=function(){return h.onMessageDelivered},this._setOnMessageDelivered=function(t){if("function"!=typeof t)throw new Error(f(u.INVALID_TYPE,[typeof t,"onMessageDelivered"]));h.onMessageDelivered=t},this._getOnMessageArrived=function(){return h.onMessageArrived},this._setOnMessageArrived=function(t){if("function"!=typeof t)throw new Error(f(u.INVALID_TYPE,[typeof t,"onMessageArrived"]));h.onMessageArrived=t},this._getTrace=function(){return h.traceFunction},this._setTrace=function(t){if("function"!=typeof t)throw new Error(f(u.INVALID_TYPE,[typeof t,"onTrace"]));h.traceFunction=t},this.connect=function(t){if(t=t||{},d(t,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number"}),void 0===t.keepAliveInterval&&(t.keepAliveInterval=60),t.mqttVersion>4||t.mqttVersion<3)throw new Error(f(u.INVALID_ARGUMENT,[t.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===t.mqttVersion?(t.mqttVersionExplicit=!1,t.mqttVersion=4):t.mqttVersionExplicit=!0,void 0===t.password&&void 0!==t.userName)throw new Error(f(u.INVALID_ARGUMENT,[t.password,"connectOptions.password"]));if(t.willMessage){if(!(t.willMessage instanceof T))throw new Error(f(u.INVALID_TYPE,[t.willMessage,"connectOptions.willMessage"]));if(t.willMessage.stringPayload,void 0===t.willMessage.destinationName)throw new Error(f(u.INVALID_TYPE,[typeof t.willMessage.destinationName,"connectOptions.willMessage.destinationName"]))}if(void 0===t.cleanSession&&(t.cleanSession=!0),t.hosts){if(!(t.hosts instanceof Array))throw new Error(f(u.INVALID_ARGUMENT,[t.hosts,"connectOptions.hosts"]));if(t.hosts.length<1)throw new Error(f(u.INVALID_ARGUMENT,[t.hosts,"connectOptions.hosts"]));for(var e=!1,s=0;s<t.hosts.length;s++){if("string"!=typeof t.hosts[s])throw new Error(f(u.INVALID_TYPE,[typeof t.hosts[s],"connectOptions.hosts["+s+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(t.hosts[s])){if(0==s)e=!0;else if(!e)throw new Error(f(u.INVALID_ARGUMENT,[t.hosts[s],"connectOptions.hosts["+s+"]"]))}else if(e)throw new Error(f(u.INVALID_ARGUMENT,[t.hosts[s],"connectOptions.hosts["+s+"]"]))}if(e)t.uris=t.hosts;else{if(!t.ports)throw new Error(f(u.INVALID_ARGUMENT,[t.ports,"connectOptions.ports"]));if(!(t.ports instanceof Array))throw new Error(f(u.INVALID_ARGUMENT,[t.ports,"connectOptions.ports"]));if(t.hosts.length!=t.ports.length)throw new Error(f(u.INVALID_ARGUMENT,[t.ports,"connectOptions.ports"]));t.uris=[];for(var s=0;s<t.hosts.length;s++){if("number"!=typeof t.ports[s]||t.ports[s]<0)throw new Error(f(u.INVALID_TYPE,[typeof t.ports[s],"connectOptions.ports["+s+"]"]));var n=t.hosts[s],r=t.ports[s],o=-1!=n.indexOf(":");a="ws://"+(o?"["+n+"]":n)+":"+r+i,t.uris.push(a)}}}h.connect(t)},this.subscribe=function(t,e){if("string"!=typeof t)throw new Error("Invalid argument:"+t);if(e=e||{},d(e,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),e.timeout&&!e.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if(void 0!==e.qos&&0!==e.qos&&1!==e.qos&&2!==e.qos)throw new Error(f(u.INVALID_ARGUMENT,[e.qos,"subscribeOptions.qos"]));h.subscribe(t,e)},this.unsubscribe=function(t,e){if("string"!=typeof t)throw new Error("Invalid argument:"+t);if(e=e||{},d(e,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),e.timeout&&!e.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");h.unsubscribe(t,e)},this.send=function(t,e,i,s){var a;if(0==arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(t instanceof T)&&"string"!=typeof t)throw new Error("Invalid argument:"+typeof t);if(a=t,void 0===a.destinationName)throw new Error(f(u.INVALID_ARGUMENT,[a.destinationName,"Message.destinationName"]));h.send(a)}else a=new T(e),a.destinationName=t,arguments.length>=3&&(a.qos=i),arguments.length>=4&&(a.retained=s),h.send(a)},this.disconnect=function(){h.disconnect()},this.getTraceLog=function(){return h.getTraceLog()},this.startTrace=function(){h.startTrace()},this.stopTrace=function(){h.stopTrace()},this.isConnected=function(){return h.connected}};w.prototype={get host(){return this._getHost()},set host(t){this._setHost(t)},get port(){return this._getPort()},set port(t){this._setPort(t)},get path(){return this._getPath()},set path(t){this._setPath(t)},get clientId(){return this._getClientId()},set clientId(t){this._setClientId(t)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(t){this._setOnConnectionLost(t)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(t){this._setOnMessageDelivered(t)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(t){this._setOnMessageArrived(t)},get trace(){return this._getTrace()},set trace(t){this._setTrace(t)}};var T=function(t){var e;if(!("string"==typeof t||t instanceof ArrayBuffer||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array))throw f(u.INVALID_ARGUMENT,[t,"newPayload"]);e=t,this._getPayloadString=function(){return"string"==typeof e?e:c(e,0,e.length)},this._getPayloadBytes=function(){if("string"==typeof e){var t=new ArrayBuffer(r(e)),i=new Uint8Array(t);return o(e,i,0),i}return e};var i=void 0;this._getDestinationName=function(){return i},this._setDestinationName=function(t){if("string"!=typeof t)throw new Error(f(u.INVALID_ARGUMENT,[t,"newDestinationName"]));i=t};var s=0;this._getQos=function(){return s},this._setQos=function(t){if(0!==t&&1!==t&&2!==t)throw new Error("Invalid argument:"+t);s=t};var a=!1;this._getRetained=function(){return a},this._setRetained=function(t){if("boolean"!=typeof t)throw new Error(f(u.INVALID_ARGUMENT,[t,"newRetained"]));a=t};var n=!1;this._getDuplicate=function(){return n},this._setDuplicate=function(t){n=t}};return T.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(t){this._setDestinationName(t)},get qos(){return this._getQos()},set qos(t){this._setQos(t)},get retained(){return this._getRetained()},set retained(t){this._setRetained(t)},get duplicate(){return this._getDuplicate()},set duplicate(t){this._setDuplicate(t)}},{Client:w,Message:T}}(window);var Proto=ProtobufMessage.prototype;Proto.init=function(){if("undefined"==typeof dcodeIO||!dcodeIO.ProtoBuf)throw new Error("ProtoBuf.js is not present. Please see www/index.html for manual setup instructions.");var t=dcodeIO.ProtoBuf;Proto.chatProto=t.loadProtoFile(INTERFACE_URLS.chatProtoUrl),Proto.createMessage.init()},Proto.decode=function(t){return Proto.createMessage.build.chatProtocol.decode(t)},Proto.createMessage={init:function(){this.build={chatProtocol:Proto.chatProto.build("TechwolfChatProtocol"),message:Proto.chatProto.build("TechwolfMessage"),messageSync:Proto.chatProto.build("TechwolfMessage"),messageRead:Proto.chatProto.build("TechwolfMessageRead"),presence:Proto.chatProto.build("TechwolfPresence"),user:Proto.chatProto.build("TechwolfUser"),body:Proto.chatProto.build("TechwolfMessageBody"),clientInfo:Proto.chatProto.build("TechwolfClientInfo")}},model:{chatProtocol:function(t){var e=new Proto.createMessage.build.chatProtocol;return e.setType(t),e},message:function(t,e,i,s,a){var n=new Proto.createMessage.build.message;return n.setType(t),n.setMid(e,!0),n.setCmid(e,!0),n.setFrom(i),n.setTo(s),n.setBody(a),n},messageSync:function(t,e){var i=new Proto.createMessage.build.messageSync;return i.setClientMid(t,!0),i.setServerMid(e,!0),i},messageRead:function(t,e){var i=new Proto.createMessage.build.messageRead;return i.setUserId(t,!0),i.setMessageId(e,!0),i.setReadTime((new Date).getTime(),!0),i},presence:function(t){var e=new Proto.createMessage.build.presence,i=new Proto.createMessage.build.clientInfo,s=t.clientInfo;return e.setUid(_PAGE.uid,!0),e.setType(t.type),e.setLastMessageId(t.lastMessageId,!0),i.setVersion(s.version),i.setSystem(s.system),i.setSystemVersion(s.systemVersion),i.setModel(s.model),i.setUniqid(s.uniqid),i.setNetwork(s.network),i.setAppid(s.appid),i.setPlatform(s.platform),i.setChannel(s.channel),i.setSsid(s.ssid),i.setBssid(s.bssid),i.setLongitude(s.longitude),i.setLatitude(s.latitude),e.setClientInfo(i,!0),e},user:function(t,e){var i=new Proto.createMessage.build.user;return i.setUid(0,!0),t&&i.setName(e),i},body:function(t,e){var i=new Proto.createMessage.build.body;return i.setType(t),i.setTemplateId(e),i}},text:function(t){var e=this.model,i=e.user(),s=e.user(t.to.uid,t.to.encryptUid),a=e.body(1,1);a.setText(t.body.text);var n=e.message(t.type||1,t.tempID,i,s,a),r=e.chatProtocol(1);return r.setMessages([n]),r},graphic:function(t){var e=this.model,i=e.user(),s=e.user(t.to.uid,t.to.encryptUid),a=e.body(20,1);a.setText(t.body.text),a.setSticker(t.body.sticker);var n=e.message(t.type||1,t.tempID,i,s,a),r=e.chatProtocol(1);return r.setMessages([n]),r},sync:function(t){var e=this.model,i=e.messageSync(t.clientMid,t.serverMid),s=e.chatProtocol(5);return s.setMessageSync([i]),s},read:function(t){var e=this.model,i=e.messageRead(t.uid,t.mid),s=e.chatProtocol(6);return s.setMessageRead([i]),s},presence:function(t){var e=this.model,i=e.presence(t),s=e.chatProtocol(2);return s.setPresence(i),s}};var Emotion={data:["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","愉快","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","悠闲","奋斗","咒骂","疑问","嘘","晕","疯了","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","开心","满意","不高兴","生病","笑哭","不说话","幽灵","恶魔","高兴","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","面条","猪头","玫瑰","凋谢","嘴唇","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK"],init:function(){Emotion.getRecebtEmtion();var t,e,i="",s=Publisher.editor.find(".emotion");if(!s.length){for(t=0;t<Emotion.data.length;t++)e=Emotion.data[t],i+='<li><button class="emoj emoj-'+(t+1)+'" data-key="['+e+']" title="'+e+'"></button></li>';var a='<div class="emotion"><div class="emotion-box"><ul class="hide animoji-box"></ul><ul class="loaded">'+i+'</ul><ul class="hide animoji-box"></ul><ul class="hide animoji-box"></ul><ul class="hide animoji-box"></ul></div><div class="emotion-tab">'+Emotion.getEmotionTabView()+"</div></div>";Publisher.editor.append(a),Emotion.showEmotion();var n=Publisher.editor.find(".emotion .emotion-box");Publisher.editor.find(".emotion .emotion-tab").find(".emotion-sort").on("click",function(){var t=$(this),e=t.index(),i=n.find("ul").eq(e);i.hasClass("loaded")&&0!=e||i.html(Emotion.getEmotionListView(e)).addClass("loaded"),i.removeClass("hide").siblings().addClass("hide"),t.addClass("selected").siblings().removeClass("selected");var s=["recent_emoji","face_emoji","my_emoji","zhizhi_emoji","bird_emoji"];try{_T.sendEvent(s[e])}catch(t){}}),$(document).on("click",function(t){$(t.target).hasClass("btn-emotion")||$(t.target).parents(".emotion").length||Emotion.hideEmotion()}),Publisher.editor.find(".emotion").on("click",".emoj",function(){var t=$(this);Emotion.chooseEmotion(t)}),Publisher.editor.find(".emotion").on("click",".animoji",function(){var t=$(this);Emotion.chooseAnimojiEmotion(t)})}s.show()},emotionTypeData:[{type:"recent",className:"emotion-recent",data:[]},{type:"default",className:"emotion-default"},{packId:0,type:"like",className:"emotion-like",data:[]},{packId:1,type:"zhi",className:"emotion-zhi",data:[]},{packId:2,type:"veteran",className:"emotion-veteran",data:[]}],getEmotionTabView:function(){var t="",e=Emotion.emotionTypeData;return $.each(e,function(e,i){t+='<div class="emotion-sort '+(1==e?"selected":"")+'"><button class="'+i.className+'"></button></div>'}),t},getEmotionListView:function(t){var e="",i=Emotion.emotionTypeData[t].data;if(i.length)for(var s=0;s<i.length;s++){var a="";3!=t&&4!=t||(a="<span>"+i[s].name+"</span>"),e+='<li class="animoji-item"><button data-width="'+i[s].origWidth+'" data-height="'+i[s].origHeight+'" data-url="'+i[s].origUrl+'" data-packId="'+i[s].packId+'" data-sid="'+i[s].itemId+'" class="animoji" title="'+i[s].name+'"><img src="'+i[s].tinyUrl+'"/></button>'+a+"</li>"}return e},showEmotion:function(){Publisher.editor.find(".emotion").show()},hideEmotion:function(){Publisher.editor.find(".emotion").hide()},textCodeToImg:function(t){if(!t)return"";var e,i=t.match(/\[[a-zA-Z\u4e00-\u9fa5]{1,3}\]/g);if(!i)return t;for(e=0;e<i.length;e++){var s,a=i[e].replace(/[\[\]]/g,""),n=Emotion.data.indexOf(a);n>-1&&(s='<i class="emoj emoj-'+(n+1)+'" title="'+a+'"></i>'),s&&(t=t.replace(i[e],s))}return t},getRecebtEmtion:function(){var t=[],e=_PAGE.uid+"emotionsBoss";window.localStorage&&window.localStorage.getItem(e)&&(t=JSON.parse(window.localStorage.getItem(e))),Emotion.emotionTypeData[0].data=t},chooseEmotion:function(t){var e=t,i=e.attr("class").split("emoj-")[1];Publisher.editorInput.focus();var s="https://static.zhipin.com/library/emotions/Expression_"+i+"@2x.png";Publisher.editorInput.find("img:not(.emoj-insert)");Publisher.inserCurosrHtml(s,e.attr("data-key")),Emotion.hideEmotion(),Publisher.submitBtn.removeClass("btn-disabled");try{_T.sendEvent("send_emoji_face_"+i)}catch(t){}},chooseAnimojiEmotion:function(t){if(!t.hasClass("disabled")){t.addClass("disabled");var e=t.attr("data-packId"),i=t.attr("data-sid"),s=t.attr("title"),a=t.attr("data-url"),n=t.find("img").attr("src"),r=Number(t.attr("data-width")),o=Number(t.attr("data-height")),c={packId:e,sid:i,name:s,image:{originImage:{height:o,width:r,url:a}}};Publisher.sendText(null,"[动画表情]",c),Emotion.hideEmotion(),t.removeClass("disabled");for(var l=Emotion.emotionTypeData[0].data,d={packId:e,itemId:i,name:s,origUrl:a,tinyUrl:n,origWidth:r,origHeight:o},h=0;h<l.length;h++)d.itemId==l[h].itemId&&l.splice(h,1);l.unshift(d),l.length>8&&l.splice(8,10);var u=_PAGE.uid+"emotionsBoss";window.localStorage&&window.localStorage.setItem(u,JSON.stringify(l)),Emotion.emotionTypeData[0].data=l;var p=t.parents("ul").index(),f=["recent","face","my","zhizhi","bird"];try{_T.sendEvent("send_emoji_face_"+f[p])}catch(t){}}},storeEmotion:function(t){if(!t.hasClass("disabled")){t.addClass("disabled")
;var e=t.attr("data-sid"),i=Publisher.editor.find(".emotion .emotion-box ul").eq(2);$.ajax({type:"get",url:"/sticker/favorite.json",data:{itemId:e},success:function(s){1==s.code?($.toast({content:"添加成功",type:"success"}),i.length&&Emotion.getSticker(i),Chat.chatListCon.find('span.btn-sore[data-sid="'+e+'"]').remove(),Chat.storedEmtions.push({itemId:e}),t.addClass("hidden")):($.toast({content:s.message,type:"error"}),0==s.code&&"用户已经添加该表情"==s.message&&(Chat.chatListCon.find('span.btn-sore[data-sid="'+e+'"]').remove(),Chat.storedEmtions.push({itemId:e})),8e3!=s.code&&t.addClass("hidden")),t.removeClass("disabled")},error:function(){t.removeClass("disabled")}});try{_T.sendEvent("add_emoji")}catch(t){}}},getSticker:function(t){var e=$.Deferred();return $.ajax({type:"get",url:"/sticker/get.json",success:function(i){if(1==i.code){var s=i.result.packs;$.each(s,function(t,i){var s=i.packId+2;Emotion.emotionTypeData[s].data=i.items,0==i.packId&&e.resolve(i.items)}),t&&t.html(Emotion.getEmotionListView(2)).addClass("loaded")}}}),e}},InterviewTemplate=function(){var t=function(t){return Utemplate('<form class="form-check interview-wrap interview-invitation"><input type="hidden" name="_token" value=""><div class="interview-article">发送面试邀请</div><%if(this.brokenAppointment){%><div class="interview-notice"><i class="icon-unbelievable"></i>该牛人近期有面试爽约的不良记录，请注意！</div><%}else{%><div class="interview-notice"><i class="icon-believable"></i>对方没有面试爽约的不良记录，请放心约面试</div><%}%><table class="data-manage"><tr class="interview-position"><td class="t"><i class="icon-interview icon-position"></i></td><td><div class="dropdown-wrap dropdown-position"><input type="hidden" value="0" name="jobid" class="required" data-blank="必填"><span class="dropdown-select">选择职位</span><div class="dropdown-menu"><ul></ul></div></div></td></tr><tr><td class="t"><i class="icon-interview icon-time"></i></td><td><div class="dropdown-wrap dropdown-hour"><span class="dropdown-select"><input type="text" class="ipt ipt-datetimepicker" name="date" data-type="y-m-d" data-format="yyyy-mm-dd" placeholder="选择面试时间" readonly autocomplete="off"></span></div><div class="dropdown-wrap dropdown-minute" data-fill="false"><span class="dropdown-select"><input type="text" placeholder="请选择" value="9:00" class="ipt" readonly><input type="hidden" value="9" name="hour" class="required" data-blank="必填"><input type="hidden" value="0" name="minute" class="required" data-blank="必填"></span><div class="dropdown-menu"><ul></ul></div></div></td></tr><tr class="interview-address"><td class="t"><i class="icon-interview icon-address"></i></td><td><p class="tip-address">请先选择职位</p></td></tr><tr><td class="t t-top"><i class="icon-interview icon-description"></i></td><td><textarea name="other" class="ipt ipt-area" placeholder="选填，最多140字"></textarea></td></tr></table></form><div class=""></div>',t)},e=function(t){return Utemplate('<div class="interview-wrap <%this.style%>"><div class="interview-article"><%this.article%></div><table class="data-manage"><tbody><tr><td class="t"><i class="icon-interview icon-position"></i></td><td><%this.interviewInfo.jobName%></td></tr><tr><td class="t"><i class="icon-interview icon-time"></i></td><td><%this.interviewInfo.time%></td></tr><tr class="interview-address"><td class="t"><i class="icon-interview icon-address"></i></td><td><p class="tip-address"><%this.interviewInfo.jobAddress%></p></td></tr><%if(this.interviewInfo.addition != ""){%><tr><td class="t"><i class="icon-interview icon-description"></i></td><td><div class="interview-addition"><%this.interviewInfo.addition%></div></td></tr><%}%></tbody></table><%if(this.canInvite){%><div><span ka="chat_interview_resend" class="btn btn-block J_reInvite">重新发送面试邀请</span></div><%}%><div class="interview-page-footer gray">在BOSS直聘APP管理我的面试</div></div>',t)},i=function(t){return Utemplate('<div class="interview-hint"><dl><dt><%this.article%></dt><dd class="gray"><%this.description%></dd></dl></div>',t)};return{invitation:t,condition:e,hint:function(){return'<div class="interview-hint"><p class="article">约面试·诚信协议</p><ul class="gray"><li>面试开始8小时前，双方都可以申请取消，如不取消，请保证 按时出席，不许爽约 </li><li>如果对方爽约，您可以一键投诉对方 </li><li>任何一方爽约，会打［不良记录］并公示</li></ul></div>'},warning:i}}(),Publisher={init:function(){Publisher.editor=$(".chat-editor"),Publisher.editorControls=Publisher.editor.find(".chat-controls"),Publisher.editorInput=Publisher.editor.find(".chat-message"),Publisher.editorPlaceholder=Publisher.editor.find(".chat-placholder"),Publisher.submitBtn=Publisher.editor.find(".btn-send"),Publisher.menuWrap=$(".chat-container .data-menu"),_PAGE.runChat&&(Publisher.editor.find(".chat-op").removeAttr("ka"),Publisher.editorInput.removeAttr("ka")),Publisher.editorControls.on("mouseover","a",function(t){$(t.target).hasClass("tips")||$(t.target).parents().hasClass("tips")||$(this).find("span").show()}),Publisher.editorControls.on("mouseleave","a",function(){$(this).find("span").hide()}),Publisher.editorControls.on("click","a",function(t){var e=$(this);if(!$(this).parent().hasClass("links"))switch($(this).attr("class")){case"btn-emotion":e.find("span").hide(),Emotion.init();break;case"btn-dict":e.find("span").hide(),Publisher.showSentence(e);break;case"btn-transmit-resume":e.find("span").hide(),e.find(".tips").hide(),Publisher.showTransmitCode(e);break;case"btn-position":e.find("span").hide(),e.find(".tips").hide(),Publisher.showPosition($(t.target));break;case"btn-contact":Publisher.showExchangePhone(e);break;case"btn-weixin":Publisher.showExchangeWeixin(e);break;case"btn-resume":Publisher.showExchangeResume(e);break;case"btn-transmit":$.dialog({title:"",content:'<div class="transmit-con"><div class="transmit-title">把<span class="text-blue"></span>推荐给同事</div><div class="transmit-list"><ul></ul></div><div class="transmit-op"><p><textarea class="ipt ipt-area" name="shareNote">此人文武双全，你一定要看看啊！</textarea></p><p class="tip-text"><label class="checkbox"><input type="checkbox" name="canShareMsg" /><span>连同聊天记录一并转发</span></label></p></div></div>',closeText:!0,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-chat-default dialog-chat-transmit",lock:!0,element:e,onOpen:function(t){var e=t,i=e.find(".transmit-list ul");e.find(".transmit-title .text-blue").text(Chat.curUserData.name),i.html('<li class="loading-tips"><i class="icon-toast-loading"></i><span>加载同事数据中</span></li>'),$.ajax({type:"GET",url:"/chat/brandUserList.json",dataType:"JSON",data:{geek:Chat.curUserData.encryptUid,page:1,pageSize:100},success:function(s){var a,n,s=s,r="";if(1==s.rescode)if(s.canShareMsg||(t.find(".checkbox").hide(),t.find('input[name="canShareMsg"]').attr("checked",!1)),a=s.data,a.length){for(n=0;n<a.length;n++)r+='<li data-uid="'+a[n].encryptUserId+'"><img src="'+a[n].tiny+'" /><span class="name">'+a[n].name+"</span></li>";i.find(".loading-tips").remove(),i.append(r),e.find(".dialog-container").css({"margin-top":-e.find(".dialog-container").outerHeight()/2+"px"}),e.find(".dialog-container").height()>window.innerHeight-40&&(t.css({position:"absolute"}),e.find(".dialog-container").css({top:$(window).scrollTop()+"px","margin-top":"44px"}))}else i.find(".loading-tips").html("暂无同事");else i.find(".loading-tips").html("暂无同事")},error:function(t){$.toast({content:"获取同事数据失败，请稍后再试",type:"error"})}}),i.on("click","li",function(){var t=$(this);t.attr("data-uid");t.hasClass("loading-tips")||(t.parent().find("li").removeClass("checked"),t.find(".fz-check").length||t.append('<i class="fz fz-check"></i>'),t.addClass("checked"))})},onConfirm:function(t){var e=t,i=e.find(".transmit-list li.checked"),s=i.attr("data-uid"),a=e.find('input[name="canShareMsg"]:checked'),n=a.length?1:0,r=e.find('textarea[name="shareNote"]').val(),o=e.find(".btn-sure");return s?""==r?($.toast({content:"请填写推荐评语",type:"warning"}),!1):(o.css("pointer-events","none"),$.ajax({type:"POST",url:"/chat/shareGeek.json",dataType:"JSON",data:{toId:s,geekId:Chat.curUserData.encryptUid,shareNote:r,expectId:Chat.curUserData.infoData.expectId,canShareMsg:n},success:function(t){var t=t;1==t.rescode?$.toast({content:"转发成功",type:"success"}):$.toast({content:"转发失败",type:"error"}),o.css("pointer-events","initial")},error:function(t){$.toast({content:"发送失败",type:"error"}),o.css("pointer-events","initial")}}),void t.remove()):($.toast({content:"请选择同事",type:"warning"}),!1)},onClose:function(t){}});break;case"btn-interview":Publisher.interview(e,"dialog-up-default")}});var t="按Enter键发送，按Ctrl+Enter键换行";isIE&&(t="按Enter键发送",Publisher.editor.find(".chat-op .tip").text(t)),Publisher.editorInput.on("keyup",function(t){var e=Publisher.htmlConverToMessage($(this).html());return""!=e.replace(/[\n\s]/g,"")?void Publisher.submitBtn.removeClass("btn-disabled"):void Publisher.submitBtn.addClass("btn-disabled")});try{document.execCommand("AutoUrlDetect",!1,!1)}catch(t){}Publisher.editorInput.on("paste",function(t){var e=null;if(e=window.clipboardData&&clipboardData.setData?window.clipboardData.getData("text"):(t.originalEvent||t).clipboardData.getData("text/plain"),document.body.createTextRange){if(document.selection)textRange=document.selection.createRange();else if(window.getSelection){var i=window.getSelection(),s=i.getRangeAt(0),a=document.createElement("span");a.innerHTML="&#FEFF;",s.deleteContents(),s.insertNode(a),textRange=document.body.createTextRange(),textRange.moveToElementText(a),a.parentNode.removeChild(a)}textRange.text=e,textRange.collapse(!1),textRange.select()}else document.execCommand("insertText",!1,e),""!=e&&Publisher.submitBtn.removeClass("btn-disabled");t.preventDefault()}),Publisher.editorInput.bind("keydown",function(t){13==t.which&&(t.ctrlKey||t.shiftKey?(t.ctrlKey||t.shiftKey)&&document.execCommand("insertText",!1,"\n"):(Publisher.sendText(),t.preventDefault())),""!=Publisher.editorInput.html()&&Publisher.editorPlaceholder.hide()}),Publisher.editorInput.bind("focus",function(t){Publisher.editorPlaceholder.hide()}),Publisher.editorInput.bind("blur",function(t){""!=Publisher.editorInput.html()&&"<br>"!=Publisher.editorInput.html()||Publisher.editorPlaceholder.show()}),Publisher.editorInput.on("click",function(){if(_PAGE.runChat)try{_T.sendEvent("Geekchat_input_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}catch(t){}}),Publisher.editorPlaceholder.on("click",function(){Publisher.editorPlaceholder.hide(),Publisher.editorInput.focus()}),Publisher.editorControls.on("click",function(t){$(t.target).closest("a").length||(Publisher.editorPlaceholder.hide(),Publisher.editorInput.focus())}),Publisher.editorControls.find("a").each(function(){var t=$(this).attr("ka"),e=t.split("_")[2];_PAGE.runChat&&$(this).data("optype",e).removeAttr("ka")}).on("click",function(){var t=$(this).data("optype");if(_PAGE.runChat&&!Chat.curUserData.groupId)try{_T.sendEvent("Geekchat_"+t+"_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}catch(t){}else __conversion("group_chat_enmoji")}),Publisher.submitBtn.on("click",function(t){Publisher.sendText()}),$(document).on("click",function(t){$(t.target).hasClass("btn-dict")||$(t.target).parents(".sentence-pannel").length||Publisher.editor.find(".sentence-pannel").remove()}),$(window).on("resize",function(){$(".dialog-around-default").is(":visible")&&$(".dialog-around-default").hide()})},interviewNotice:function(t,e){$.dialog({title:"",content:t.content,confirmText:t.confirmText,cancelText:t.cancelText||"我再想想",wrapClass:"dialog-wrap prop-consume interview-hint-wrap",inline:!0,onOpen:function(){},onConfirm:function(t){return t.remove(),e()},onClose:function(){}})},invitation:function(t,e,i){var s=function(t){for(var t=t||[],e=0;e<t.length;e++){var i=t[e],s=new Date(i.appointTime);i.year=s.getUTCFullYear(),i.month=s.getUTCMonth(),i.day=s.getUTCDate(),i.time=s.getHours()+":"+("0"+s.getMinutes()).substr(-2,2),i.date=i.year+"-"+("0"+(i.month+1)).substr(-2,2)+"-"+i.day}return t};$.get("/bossweb/interview/valid/list.json",function(a){var n=s(a.interviewList);$.dialog({title:"",content:InterviewTemplate.invitation(i),closeText:!1,confirmText:"发送",cancelText:"取消",preKa:"",wrapClass:"dialog-around-default dialog-chat-default dialog-interview-default "+e,position:"around",inline:!1,lock:!0,element:t,opacityLock:!0,onOpen:function(t){Publisher.invitationOpen(t,n)},onConfirm:function(t){Publisher.invitationConfirm(t,i,n)},onClose:function(t){}})})},invitationOpen:function(t,e){Chat.jobData={},_self=t;var i=function(){var t=new Date,e=$('.interview-invitation input[name="date"]').val(),i=t.getFullYear()+("0"+(t.getMonth()+1)).substr(-2,2)+("0"+t.getDate()).substr(-2,2);return e.replace(/-/g,"")===i},s=function(t){if(!i())return!0;var e=new Date,s=("0"+e.getHours()).substr(-2,2)+("0"+e.getMinutes()).substr(-2,2),a=parseInt(s,10)+200,s=parseInt(t.replace(":",""),10);return s>a},a=function(t){var e=["8:00","8:30","9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30"],i="",a=0;$.each(e,function(e,a){if(s(a)){i+="<li><span>"+a+"</span>";t.filter(function(t){return t.time==a}).length&&(i+="已约面试"),i+="</li>"}}),$(".interview-wrap .dropdown-minute .dropdown-menu ul").empty().html(i);var n=$(".interview-wrap .dropdown-minute .dropdown-menu li"),a=e.indexOf(n.eq(0).text())>2?0:2;n.eq(a).click()};if(t.find(".ipt-datetimepicker").length){var n=new Date;parseInt(n.getHours()+""+n.getMinutes())>1830&&n.setDate(n.getDate()+1),nowYear=n.getFullYear(),nowMonth=n.getMonth()+1,nowThisDate=n.getDate(),t.find(".ipt-datetimepicker").each(function(){var t=$(this),i=$(this).attr("data-format")||"yyyy-mm-dd";t.datetimepicker({format:i,startView:2,minView:2,inDate:e,autoclose:1,startDate:nowYear+"-"+nowMonth+"-"+nowThisDate,todayBtn:0}).on("changeDate",function(){t.closest(".dropdown-wrap").removeClass("dropdown-menu-open");var i=$('.interview-invitation input[name="date"]').val(),s=e.filter(function(t){return t.date==i});a(s)})}),$(window).one("resize",function(){t.next(".datetimepicker").remove()}),a([])}$.ajax({type:"GET",url:"/chat/user/joblist.json",dataType:"JSON",data:null,success:function(t){var e,t=t,i="",s=_self.find('input[name="jobid"]');if(1==t.rescode){for(e=0;e<t.data.length;e++)i+="<li "+(0==e?' class="cur"':"")+' data-val="'+t.data[e].jobId+'">'+filterXss(t.data[e].jobName)+"</li>",Chat.jobData[t.data[e].jobId]||(Chat.jobData[t.data[e].jobId]={}),Chat.jobData[t.data[e].jobId].jobName=filterXss(t.data[e].jobName),Chat.jobData[t.data[e].jobId].address=filterXss(t.data[e].address),0==e&&(_self.find(".tip-address").html(filterXss(t.data[e].address)),s.val(t.data[e].jobId),s.parent().find(".dropdown-select").text(Chat.jobData[t.data[e].jobId].jobName));t.data.length<1&&(i='<li class="disabled">没有在线职位</li>'),s.closest(".dropdown-wrap").find("ul").html(i),s.val(),s.closest(".dropdown-wrap").find("li").on("click",function(){var t=$(this).attr("data-val");_self.find(".tip-address").html(Chat.jobData[t].address),$(this).closest(".dropdown-position").find(".dropdown-select").text($(this).text()),$(this).parent().find("li").removeClass("cur"),$(this).addClass("cur")}),_self.find('input[name="hour"]').closest(".dropdown-wrap").on("click","li",function(){var t=$(this).find("span").text(),e=t.split(":");$(this).closest(".dropdown-wrap").find('input[name="hour"]').val(e[0]),$(this).closest(".dropdown-wrap").find('input[name="minute"]').val(e[1]),$(this).closest(".dropdown-wrap").find('input[type="text"]').val(t)})}},error:function(t){}}),DropDown.init(t),_self.find(".data-manage .tip-text .name").text(Chat.curUserData.name),$(t).on("click",".dropdown-position li",function(){$(t).find('input[name="jobid"]').val($(this).attr("data-val"))})},invitationConfirm:function(t,e,i){var s=t,a=s.find('input[name="jobid"]').val(),n=s.find('input[name="date"]').val(),r=s.find('input[name="hour"]').val(),o=s.find('input[name="minute"]').val(),c=s.find('textarea[name="other"]').val();if(""==a||"0"==a)return $.toast({content:"请选择职位",type:"warning"}),!1;if(""==n)return $.toast({content:"请选择面试时间",type:"warning"}),!1;if(""==r||""==o)return $.toast({content:"请选择时段",type:"warning"}),!1;if(c.length>140)return $.toast({content:"附加说明最多140字",type:"warning"}),!1;var l=function(){$.ajax({type:"POST",url:"/bossweb/interview/invite.json",dataType:"JSON",data:{jobname:Chat.jobData[a].jobName,jobid:a,date:n,hour:r,minute:o,address:Chat.jobData[a].address,other:c,uid:Chat.curUserData.uid,name:Chat.curUserData.name,sendmsg:0},success:function(t){var t=t;1==t.rescode?(Chat.usersData[Chat.curUserData.uid].isCloseInterview=!0,s.remove()):3==t.rescode?(Chat.usersData[Chat.curUserData.uid].isCloseInterview=!0,Chat.showSystemMessage(Chat.curUserData.uid,t.resmsg),Publisher.editorControls.find(".btn-interview").addClass("disabled"),s.remove()):$.toast({content:t.resmsg,type:"error"})},error:function(t){$.toast({content:"操作失败，请稍后再试",type:"error"})}})},d=function(){var t=r+":"+o,s=i.filter(function(e){return e.date==n&&e.time==t});if(e.brokenAppointment)Publisher.interviewNotice({title:"",content:InterviewTemplate.warning({article:"注意对方存在不良面试记录",description:"对方近期出现过面试爽约的不良记录，如您要给对方发送 面试要求，建议在面试前与对方再次确认。"}),confirmText:"发送面试邀请"},function(){l()});else if(s.length){var a=s[0];Publisher.interviewNotice({title:"",content:InterviewTemplate.warning({article:"面试时间冲突提醒",description:"你在 "+(a.month+1)+"月 "+a.day+" 日 "+a.time+" 已约 "+a.geekName+" 面试 "+a.jobName+" 职位，建议合理安排面试日程，避免时间冲突。"}),cancelText:"重选时间",confirmText:"继续"},function(){l()})}else l()};return function(){e.interviewCount<1||e.bossBrokenAppointment?Publisher.interviewNotice({title:"",content:InterviewTemplate.hint(),confirmText:"接受"},function(){d()}):d()}(),!1},interviewPublish:function(t,e,i){$.dialog({title:"",content:InterviewTemplate.condition(i),closeText:!1,confirmText:!1,cancelText:!1,preKa:"",wrapClass:"dialog-around-default dialog-chat-default dialog-interview-default "+e,position:"around",inline:!1,lock:!0,element:t,opacityLock:!0,onOpen:function(e){e.on("click",".J_reInvite",function(){e.remove();var s=t.hasClass("btn-interview")?"dialog-up-default":"dialog-down-default interview-message-dialog";Publisher.invitation(t,s,i)})},onConfirm:function(){},onClose:function(t){}})},interview:function(t,e){var i={"-1":"",0:"interview-waitreply",1:"interview-success",2:"interview-cancel",3:"interview-cancel",4:"interview-success",5:"interview-cancel",6:"interview-cancel",7:"",8:"interview-success",9:"interview-fail",10:"interview-fail"},s={0:"等待对方接受",1:"等待面试",2:"对方取消拒绝",3:"面试已取消",4:"面试已完成",5:"超时未接受",6:"面试已收回",7:"",8:"面试达成",9:"对方面试爽约",10:"面试爽约"},a=function(t){var e=new Date(t);return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日  "+e.getHours()+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())},n=function(t){try{_T.sendEvent(t)}catch(t){}};(function(){var t=$.Deferred();return $.get("/bossweb/interview/info.json",{geekId:Chat.curUserData.uid}).success(function(e){1==e.rescode?t.resolve(e):$.toast({type:"error",content:e.resmsg})}),t})().then(function(r){if("-1"==r.status){Publisher.invitation(t,e,r);var o=r.brokenAppointment?"green":"red";n("chat_interview_click_"+o)}else r.style=i[r.status],r.article=s[r.status],r.interviewInfo.time=a(r.interviewInfo.appointmentTime),Publisher.interviewPublish(t,e,r),n("chat_interview_click")})},htmlConverToMessage:function(t){var e=$("<div><div/>"),i=[];return e.append(t),e.find("img").each(function(){$(this).replaceWith($(this).data("key"))}),e.find("div").each(function(){i.push($(this).text())}),e.contents().filter(function(){return 1==this.nodeType}).end().filter("div").remove(),$.trim(e.text()+i.join("\n"))},inserCurosrHtml:function(t,e){var i=Publisher.editorInput.get(0);Publisher.editorInput.text().length;if("getSelection"in window){var s=window.getSelection();if(s&&1===s.rangeCount){i.focus();var a=s.getRangeAt(0),n=new Image;n.src=t,n.setAttribute("data-key",e),n.className="emoj-insert",n.setAttribute("title",e.replace("[","").replace("]","")),a.deleteContents(),a.insertNode(n),a.collapse(!1),s.removeAllRanges(),s.addRange(a)}}else if("selection"in document){i.focus();var a=document.selection.createRange();a.pasteHTML('<img class="emoj-insert" data-key="'+e+'" title="'+e.replace("[","").replace("]","")+'" src="'+t+'">'),i.focus()}},sendText:function(t,e,i){if(Chat.chatEl.find(".msg-item-unlock").length)return Chat.unlockMessages({from:"send"}),!1;var e=e,s="",t=t||Chat.curUserData,i=i||null;if(e)s=e;else{if(Publisher.editorInput.hasClass("btn-disabled"))return!1;s=Publisher.htmlConverToMessage(Publisher.editorInput.html());try{_T.sendEvent("Geekchat_send_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+t.uid)}catch(t){}if(""==s.replace(/[\n\s]/g,""))return Publisher.editorInput.html(""),!1;if(s.length>1e3)return alert("您输入的内容过长，请删减后再发送"),!1}var a=(new Date).getTime();if(Chat.sendTextMessage({tempID:_PAGE.uid+a,isSelf:!0,from:{uid:Chat.myselfData.uid,name:Chat.myselfData.name,avatar:Chat.myselfData.face},to:{uid:t.uid||t.groupId,encryptUid:t.encryptUid||(t.encryptGid?t.encryptGid:"")},time:a,body:{type:i?20:1,text:s,sticker:i},mSource:"server",typeSource:"newSubmit",type:Chat.curUserData.groupId?2:1}),t.relationType&&[6,7,8].indexOf(t.relationType)<0){var n=t.uid;Chat.usersData[n].relationType=6,Chat.userList.length&&Chat.userList.find(".cur").attr("class","user-communication cur")}e||(Publisher.editorInput.html(""),Publisher.submitBtn.addClass("btn-disabled"),Publisher.editorPlaceholder.show())},showSentence:function(t){var e='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><div class="sentence-blank">加载中...</div></div>',s=Publisher.editorInput.get(0);$.ajax({url:"/setting/replyword/list.json",type:"GET",data:null,dataType:"JSON",timeout:3e4,success:function(t){var a="",n=t.replyWords;if(t.rescode){if(n&&n.length){for(i=0;i<n.length;i++)a+="<li>"+filterXss(n[i])+"</li>";e='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><ul>'+a+"</ul></div>"}else e='<div class="sentence-pannel"><h3 class="title"><a href="javascript:;" class="link-set">设置</a>常用语</h3><div class="sentence-blank"><a href="javascript:;" class="link-add">+添加常用语</a></div></div>';$(e).appendTo(Publisher.editor).show(),Publisher.editor.find(".sentence-pannel li").on("click",function(){Publisher.editorInput.html(Publisher.editorInput.html()+$(this).text()),Publisher.editor.find(".sentence-pannel").hide(),Publisher.submitBtn.removeClass("btn-disabled"),Publisher.setCursorEnd(s)}),Publisher.editor.on("click",".sentence-pannel .link-set, .sentence-pannel .link-add",function(){Menu.sideEl.find(".menu-account a").attr("data-url","/boss/account/management?type=3").click(),setTimeout(function(){Menu.sideEl.find(".menu-account a").attr("data-url","/boss/account/management")},200)})}},error:function(t){}})},showTransmitCode:function(t){var e=Chat.curUserData.encryptUid,i=Chat.curUserData.infoData.expectId,s=Chat.curUserData.jobId,a=$(".chat-controls .btn-transmit-resume");try{_T.sendEvent("wx_share")}catch(t){}$.ajax({url:"/boss/share/geek.json",type:"GET",data:{geekId:e,expectId:i,jobId:s},dataType:"JSON",timeout:3e4,success:function(t){if(t.rescode){try{_T.sendEvent("wx_share_qr")}catch(t){}a.find(".transmit-code").remove();var e='<div class="transmit-code"><img src="'+t.qrUrl+'"><sapn>微信扫码  转发同事</span></div>';$(e).appendTo(a).show(),$(document).click(function(t){$(t.target).hasClass("transmit-code")||$(t.target).parents().hasClass("transmit-code")||a.find(".transmit-code").hide()})}else $.toast({content:"获取二维码失败，请稍后再试",type:"error"})}})},showPosition:function(t){if(t.hasClass("btn-position")){var e=Publisher.editorControls.find(".btn-position");"show"==e.attr("link-show")&&$.ajax({url:"/setting/notify/set.json",data:{type:18},type:"post",success:function(t){t.rescode&&(e.find(".tips").hide(),e.attr("link-show","none"))}});(function(){var t=$.Deferred();return $.get("/chat/online/joblist.json",{geekId:Chat.curUserData.uid},function(e){1==e.rescode?t.resolve(e):$.toast(e.msg,"error")}),t})().then(function(e){if(e.data.length){for(var i=e.data,s="",a="<p>"+i[0].positionName+" "+i[0].locationName+" "+i[0].lowSalary+"K-"+i[0].highSalary+"K </p>",n=1;n<i.length;n++)s+='<li data-id="'+i[n].encryptId+'" data-name="'+i[n].positionName+'" data-city="'+i[n].locationName+'">'+i[n].positionName+" "+i[n].locationName+" "+i[n].lowSalary+"K-"+i[n].highSalary+"K </li>";var r='<div class="chat-position-menu"><div>当前职位'+a+"</div><ul> "+s+"</ul></div>";t.find(".chat-position-menu").remove(),t.append(r),t.find(".chat-position-menu").show(),t.off("click").on("click",".chat-position-menu li",function(t){t.stopPropagation(),Publisher.changePosition($(this))})}}),$(document).on("click",function(e){$(e.target).hasClass("chat-position-menu")||$(e.target).parents().hasClass("chat-position-menu")||t.find(".chat-position-menu").hide()})}},changePosition:function(t){var e=t.attr("data-id"),i=t.attr("data-name"),s=(t.attr("data-city"),{jobId:e,geekId:Chat.curUserData.uid}),a=Chat.chatList.find(".chat-info .tip-text .link-job");$.post("/chat/send/jobcard.json",s,function(s){1==s.rescode?(t.parents(".chat-position-menu").hide(),a.attr("data-jobid",e),a.html(i)):$.toast(s.msg,"error")})},showExchangeWeixin:function(t){$.dialog({title:"确认与对方交换微信吗？",content:"",closeText:!1,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-icons-default dialog-alert-default dialog-around-default dialog-up-default dialog-operate-wrap",position:"around",lock:!0,element:t,opacityLock:!0,onOpen:function(t){t.find(".dialog-container").css({"margin-left":"-150px"})},onConfirm:function(t){Chat.exchangeWeixin(2,{from:{uid:Chat.curUserData.uid}}),t.remove()},onClose:function(t){}})},showExchangePhone:function(t){$.dialog({title:"确认与对方交换电话吗？",content:"",closeText:!1,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-icons-default dialog-alert-default dialog-around-default dialog-up-default dialog-operate-wrap",position:"around",lock:!0,element:t,opacityLock:!0,onOpen:function(t){t.find(".dialog-container").css({"margin-left":"-150px"})},onConfirm:function(t){Chat.exchangePhone(2,{from:{uid:Chat.curUserData.uid}}),t.remove()},onClose:function(t){}})},showExchangeResume:function(t){var t=t;t.hasClass("btn-resume"),$.dialog({title:"确定向牛人索取简历吗？",content:"",closeText:!1,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-icons-default dialog-alert-default dialog-around-default dialog-operate-wrap",position:"around",lock:!0,element:t,opacityLock:!0,onOpen:function(e){t.closest(".toggle-type").length?e.find(".dialog-container").css({"margin-left":"-117px","margin-top":"36px"}):(e.addClass("dialog-up-default"),e.find(".dialog-container").css({"margin-left":"-150px"}))},onConfirm:function(t){Chat.exchangeResume(2,{from:{uid:Chat.curUserData.uid}}),t.remove()},onClose:function(t){}})},setCursorEnd:function(t){if(window.getSelection){t.focus();var e=window.getSelection();e.selectAllChildren(t),e.collapseToEnd()}else if(document.selection){var e=document.selection.createRange();e.moveToElementText(t),e.collapse(!1),e.select()}}};noticeSwitch={init:function(){var t=this;window.noticeIsClose=!!localStorageInstance("noticeisclose")&&Boolean(localStorageInstance("noticeisclose")),window.noticeAudioIsClose=!!localStorageInstance("noticeaudioisclose")&&Boolean(localStorageInstance("noticeaudioisclose")),this.box=$(".aside_nav_bar .btool"),this.setBox=this.box.find(".setbox"),this.box.find(".btn_settings").bind("click",function(e){t.setBox.is(":hidden")?(t.setBox.show(),bindObjOutsiteClick(t.setBox)):(t.setBox.hide(),unbindObjOutsiteClick(t.setBox)),e.preventDefault()}),window.noticeIsClose&&this.setBox.find(".desk").addClass("off").text("打开桌面通知"),window.noticeAudioIsClose&&this.setBox.find(".audio").addClass("off").text("打开声音提醒"),this.setBox.find(".desk").bind("click",function(t){window.noticeIsClose?(window.noticeIsClose=!1,$(this).removeClass("off").text("关闭桌面通知")):(window.noticeIsClose=!0,$(this).addClass("off").text("打开桌面通知")),localStorageInstance("noticeisclose",window.noticeIsClose),t.preventDefault()}),this.setBox.find(".audio").bind("click",function(t){window.noticeAudioIsClose?(window.noticeAudioIsClose=!1,$(this).removeClass("off").text("关闭声音提醒")):(window.noticeAudioIsClose=!0,$(this).addClass("off").text("打开声音提醒")),localStorageInstance("noticeaudioisclose",window.noticeAudioIsClose),t.preventDefault()})}},$(function(){noticeSwitch.init()}),pageTitleStatus={status:null,ani:null,aniTime:500,set:function(t){var e=this,i="data:image/ico;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAABILAAASCwAAAAAAAAAAAAC6wk3/usJN/7rCTf+6wk3/usFN/7nBS/+6wEz/usFL/7rAS/+5wU3/u8JP/7vBTf+6wk3/usJN/7rCTf+6wk3/u8JP/7vCT/+7wk//u8JP/7vDUP+8xFP/u8JR/7zCT/+8wlD/usFM/7e/Rf+8wk7/u8JP/7vCT/+7wk//u8JP/7rCTv+6wk7/u8JQ/7a+Q//S143/9/ju//f57v/6+vX/+fv1//Dy3v/R1Yz/usBK/7rCTv+6wk7/usJO/7rCTv+7w07/u8NO/7zEUf+2v0H/19uZ///////o6sX/3eGl/+Hksv/29+v//////9XZk/+4wEX/vMRQ/7vDTv+7w07/vcRP/73ET/++xVL/uMBD/9bblv//////y9B5/7K7Nv+4vkH/wshf//n68//z9eP/vcRR/73ETv+9xE//vcRP/7zET/+8xE//vcVS/7jAQ//X25b//////9DVhv+7wkr/vsZT/7rARf/t79X//Pz3/7/GVv+7w03/vcRQ/7zET/++xE//vsRP/7/FUv+6wUP/19uX///////P1IL/ucFE/7zDTf/N0nv//////+3w0v+9xE3/vsVQ/77FUP++xE//vsVQ/77FUP+/xlP/usFE/9jcmf//////9PXk/+/x2f/x8t7//P36//T15P/Kz3D/vMNK/7/GUv++xVD/vsVQ/77GUf++xlH/v8dU/7rCRf/Y3Zj///////T25P/v8dj/+Pnu//3+/f/T2Iz/usJE/7/HU/++xlH/vsZR/77GUf+/x1H/v8dR/8DIVP+7xET/2N2Y///////Q1oT/u8NG/8HHVf/s7cr//f79/8jOaf+9xkz/v8hS/7/HUf+/x1H/wMlQ/8DJUP/ByVP/u8VE/9nel///////0deE/77GSf+7w0H/0daE///////Y3Zj/u8VE/8HJU//AyVD/wMlQ/8DIU//AyFP/wclW/7zER//Z3Zf//////9LYhv+/xkr/xMpa/+frwf//////1dqQ/7zFSP/ByVb/wMhT/8DIU//ByVL/wclS/8HKVf+8xUb/3OCf///////8/Pf/+frz//39+///////7vDT/8LKV//AyVH/wclT/8HJUv/ByVL/wclT/8HJU//BylT/v8hN/87Udv/i5a7/4eWr/+Hlr//i5a3/2dyT/8TKVv/ByE//wcpU/8HJU//ByVP/wclT/8HKVP/BylT/wcpT/8LKVP/Ax03/vMVF/73FRf+9xUT/vcVE/7/HR//CyVP/wspU/8HKU//CylT/wcpU/8HKVP/Cy1P/wstT/8LLU//Cy1P/xcpV/8TMV//Fy1f/xMxW/8TLV//Ey1b/wspU/8PLU//Cy1P/wstT/8LLU//Cy1P/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==";if(faviconUrlNew="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAC6wk3/usJN/7rCTf+6wk3/usFN/7nBS/+6wEz/usFL/7rAS/+5wU3/u8JP/7vBTf+6wk3/usJN/7rCTf+6wk3/u8JP/7vCT/+7wk//u8JP/7vDUP+8xFP/u8JR/7zCT/+8wlD/usFM/7e/Rf+8wk7/u8JP/7vCT/+7wk//u8JP/7rCTv+6wk7/u8JQ/7a+Q//S143/9/ju//f57v/6+vX/+fv1//Dy3v/R1Yz/usBK/7rCTv+6wk7/usJO/7rCTv+7w07/u8NO/7zEUf+2v0H/19uZ///////o6sX/3eGl/+Hksv/29+v//////9XZk/+4wEX/vMRQ/7vDTv+7w07/vcRP/73ET/++xVL/uMBD/9bblv//////y9B5/7K7Nv+4vkH/wshf//n68//z9eP/vcRR/73ETv+9xE//vcRP/7zET/+8xE//vcVS/7jAQ//X25b//////9DVhv+7wkr/vsZT/7rARf/t79X//Pz3/7/GVv+7w03/vcRQ/7zET/++xE//vsRP/7/FUv+6wUP/19uX///////P1IL/ucFE/7zDTf/N0nv//////+3w0v+9xE3/vsVQ/77FUP++xE//vsVQ/77FUP+/xlP/usFE/9jcmf//////9PXk/+/x2f/x8t7//P36//T15P/Kz3D/vMNK/7/GUv++xVD/vsVQ/77GUf++xlH/v8dU/7rCRf/Y3Zj///////T25P/v8dj/+Pnu//3+/f/T2Iz/usJE/7/HU/++xlH/vsZR/77GUf+/x1H/v8dR/8DIVP+7xET/2N2Y///////Q1oT/u8NG/8HHVf/s7cr//f79/8jOaf+9xkz/v8hS/7/HUf+/x1H/wMlQ/8DJUP/ByVP/u8VE/9nel///////0deE/77GSf+7w0H/0daE///////Y3Zj/u8VE/8HJU//AyVD/wMlQ/8DIU//AyFP/wclW/7zER//Z3Zf//////9LYhv+/xkr/xMpa/+frwf//////vMGb/zI3w/8IDOn/MzjG/6mwZv/ByVL/wclS/8HKVf+8xUb/3OCf///////8/Pf/+frz//39+///////7vDT/zQ4x/8AA/D/AAPw/wAD8P8wNcj/wclT/8HJU//BylT/v8hN/87Udv/i5a7/4eWr/+Hlr//i5a3/2dyT/8TKVv8JDOj/AAPw/wAD8P8AA/D/BQjs/8HKVP/BylT/wcpT/8LKVP/Ax03/vMVF/73FRf+9xUT/vcVE/7/HR//CyVP/NDjG/wAD8P8AA/D/AAPw/zA1yf/Cy1P/wstT/8LLU//Cy1P/xcpV/8TMV//Fy1f/xMxW/8TLV//Ey1b/wspU/6yzZf80Ocb/CQzp/zQ5xv+rs2X/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==",isIE&&(i=_PAGE.assetUrl+"images/1.5/favicon.ico",faviconUrlNew=_PAGE.assetUrl+"images/1.5/favicon1.ico"),this.favicon||($("#favicon").length?this.favicon=$("#favicon"):this.favicon=$('<link rel="icon" id="favicon" type="image/x-icon">').attr("href",i).appendTo("html>head")),this.text="",t){if(this.text="("+t+")",
document.title="BOSS直聘"+this.text,!this.ani){var s=!0;this.ani=setInterval(function(){e.favicon.attr("href",s?i:faviconUrlNew),s=!s},this.aniTime)}}else this.ani&&(clearInterval(this.ani),this.ani=null),e.favicon.attr("href",i),document.title="BOSS直聘"},clear:function(){this.status&&(this.status=null),this.ani&&clearInterval(this.ani)}},chatNotification={data:{},dataArray:[],dataHistory:[],show:function(t,e,i){if(!(_PAGE.debug&&this.num||(this.num=!0,window.noticeIsClose||window.isFocus))){window.isIE||window.noticeAudioIsClose||this.audio||(this.audio=document.createElement("audio"),this.audio.src="https://img.bosszhipin.com/audio/message.mp3",this.audio.preload="auto",this.audio.load());var s=this;this.Notification=window.Notification||window.mozNotification||window.webkitNotification,this.Notification&&("granted"==this.Notification.permission?s.handler(t,e,i):this.Notification.requestPermission(function(a){if("granted"!==a)return!1;s.handler(t,e,i)}))}},handler:function(t,e,i){var s=this,a=this.formatMessage(i);if(a){window.noticeAudioIsClose||this.audio.play();var n=new this.Notification(t,{body:this.formatText(a),icon:e,tag:"replace",renotify:!0});this.data[i.mid]=n,this.dataArray.push(i.mid),n.onclick=function(){if(i.isSelf)var t=i.to.uid;else var t=i.from.uid;"undefined"!=typeof DeskNotice&&DeskNotice.messageCard(),$(".menu-chat").hasClass("cur")||$(".menu-chat a").click();try{_T.sendEvent("notice_window_click_"+t)}catch(t){}n.close(),window.focus()},n.onerror=function(){},n.onshow=function(){"undefined"!=typeof DeskNotice&&DeskNotice.messageNotice(),setTimeout(function(){n.close()},5e3)},n.onclose=function(){delete s.data[i.mid];for(var t=0;t<s.dataArray.length;t++)s.dataArray[t]==i.mid&&s.dataArray.splice(t,1)}}},messageTypes:{text:{types:[1,1,1],result:function(t){return t.isSelf?null:t.body.text}},voice:{types:[1,2],result:function(t){return t.isSelf?null:"[收到语音消息，请登录APP端查收]"}},image:{types:[1,3],result:function(t){return t.isSelf?null:"[收到图片消息，请登录APP端查收]"}},redEnvelope:{types:[3,10],result:function(t){if(!t.isSelf)return"[收到红包消息，请登录APP端查收]"}},getSystemText:{types:[3,1,1],result:function(t){return t.isSelf?null:t.body.text}},getSystemMessage:{types:[3,1],result:function(t){return t.body.text}},interview:{types:[1,7,4],result:function(t){return null}},dialogMessage:{types:[1,7,0],result:function(t){return t.body.dialog.title&&t.body.dialog.title.indexOf("面试邀请")>-1?null:t.isSelf?null:t.body.dialog.text}},dialogWeixin:{types:[1,7,1],result:function(t){return t.isSelf?null:t.body.dialog.text}},dialogResume:{types:[1,7,2],result:function(t){return t.isSelf?null:t.body.dialog.text}},agreeInterview:{types:[3,4,47],result:function(t){return t.from.name+"接受了您的面试邀请。"}}},formatMessage:function(t){var e=this;for(var i in this.messageTypes){var s=this.messageTypes[i],a=s.types;if(a[0]==t.type&&a[1]==t.body.type)if(1==a[0]&&7==a[1]){if(a[2]==t.body.dialog.type)return s.result.call(e,t)}else if(3==a[0]&&4==a[1]){if(a[2]==t.body.action.aid)return s.result.call(e,t)}else{if(3!=a.length)return s.result.call(e,t);if(a[2]==t.body.templateId)return s.result.call(e,t)}}return null},formatText:function(t){return t=t.replace(/&nbsp;/gi," ").replace(/\[[a-zA-Z\u4e00-\u9fa5]{1,3}\]/g,"[表情]"),t.match(/./g).length>18&&(t=t.substring(0,18)+"..."),t}};var Chat={init:function(){Chat.homeUrl="/user/login.html",Chat.containerEl=$("#container"),Chat.containerChat=$(".chat-container"),Chat.userList=Chat.containerChat.find(".user-list"),Chat.resumeContainer=Chat.containerChat.find(".resume-container"),Chat.attachContainer=Chat.containerChat.find(".attachment-container"),Chat.chatBox=$(".chat-box"),Chat.chatList=$(".chat-list"),Chat.chatListCon=Chat.chatList.find("ul"),Chat.chatEl=Chat.containerChat.find(".chat-wrap"),Chat.welcomeEl=$(".chat-weclcome"),Chat.tabcontentEls=Chat.chatEl.find(".chat-tab-content"),Chat.opTopEls=$(".detail-top .op"),Chat.setTopEl=Chat.opTopEls.find(".op-settop"),Chat.editorEl=$(".chat-editor"),Chat.toggleTypeEl=$(".toggle-type"),Chat.usersInitStatus=!1,Chat.messageStatusData={},Chat.messageStatusDataTemp={},Chat.unReadMessage={},Chat.receiveMaxId=-1,Chat.mids={},Chat.usersDataDelete={},Chat.usersData={},Chat.newGeek=[],Chat.usersID=[],Chat.filterRadio=!1,Chat.filterGroup=!1,Chat.tops=[],Chat.notification={1:[],5:[],6:[],7:[],8:[]},Chat.prevUid="",Chat.drafts=[],Chat.groupStatus=-1,Chat.groupHistory={},Chat.groupLastModify={},Chat.xhrs={},Chat.batchHandle=Chat.batchUserHandle(),Chat.websocketConnected=!1,Chat.chatHistoryData={},Chat.usersTempData=[],Chat.userFilterTempData=[],Chat.users=Chat.userList.find("li"),Chat.userlistPageTotal=100,Chat.userListMain=Chat.userList.find(".main-list"),Chat.userListTop=Chat.userList.find(".top-list"),Chat.tipsContainer=$(".chat-container .data-tips"),Chat.detailContainer=$(".chat-container .detail-box"),Chat.offlineMessages=[],Chat.ControlsEl=Chat.chatBox.find(".chat-controls"),Chat.directionEl=$(".chat-sider"),Chat.chatList.prepend('<div class="pre-loading"><span class="loading-more"><i></i><i></i><i></i></span></div>'),Chat.hisLoading=Chat.chatList.find(".pre-loading"),Chat.curUserData={},Chat.usersDataForJob={},Chat.unreadCountBox=$(".menu-chat-badge"),Chat.unreadMessageCount=0,Chat.newNumber=0,Chat.propMessages=[],PageSet.hasShowReplyTip=!1,Chat.outputData={30:{count:0},31:{count:0},35:{count:0}},Chat.chatUserCount=0,Chat.userlistMoreEl=Chat.userList.find(".loadmore"),Chat.userlistPage=1,Chat.userlistRenderPage=0,Chat.userlistMore=!1,Chat.getUserList(Chat.userlistPage),Chat.isLoading=!1,Emotion.getSticker().then(function(t){Chat.storedEmtions=t}),Chat.filterParms={page:0,status:"",origin:"",jobid:"",salary:0,experience:0,degree:0},Chat.myselfData={uid:_PAGE.uid,name:_PAGE.name,face:_PAGE.face,email:_PAGE.email},chatNotification.chat=this,Chat.containerChat.find(".sec-operate").addClass("operate-disabed").on("click",function(){if($(this).hasClass("operate-disabed"))return!1}),Chat.containerChat.find(".sec-operate").on("click",".dropdown-select",function(t){return $(this).closest(".sec-operate").hasClass("operate-disabed")&&$(this).parent().removeClass("dropdown-menu-open"),!1}),localStorageInstance("recommend-pos")&&localStorageInstance("recommend-pos",""),Menu.isSuportCalc||($("body").addClass("no-calc"),Chat.containerChat.find(".sec-content").css("height",$(window).height()-132+"px"),Chat.userList.css("height",$(window).height()-176+"px"),Chat.chatList.css("height",$(window).height()-329+"px"),Chat.containerChat.find(".data-tips").css("height",$(window).height()-132+"px"),Chat.containerChat.find(".resume-container").css("height",$(window).height()-236+"px"),Chat.containerChat.find(".attachment-container").css("height",$(window).height()-236+"px")),_PAGE.runChat&&"172.16.0.44"!=window.location.host&&(Chat.protobufMessage=new ProtobufMessage(this),ChatWebsocket.init()),"undefined"!=typeof DeskNotice&&$(".top-user .link-signout").on("click",function(){DeskNotice.messageLogout()}),$("#container").scrollbar();var t=Chat.userlistMoreEl.get(0);Chat.userList.on("scroll",function(){Chat.userFilterTempData&&(Chat.userlistTimer&&clearTimeout(Chat.userlistTimer),Chat.userlistTimer=setTimeout(function(){!Chat.isLoading&&isVisiable(t)&&!Chat.userlistMoreEl.hasClass("disabled")&&Chat.userlistMoreEl.is(":visible")&&(Chat.userlistRenderPage++,Chat.renderUserList(Chat.userFilterTempData,Chat.userlistRenderPage))},200))}),Chat.userlistMoreEl.on("click",function(){$(this).hasClass("disabled")||(Chat.userlistRenderPage++,Chat.renderUserList(Chat.userFilterTempData,Chat.userlistRenderPage))}),Chat.containerChat.find(".op-category .group-more").on("click","li",function(){$(this).hasClass("item-help")&&Chat.showOperateHelp($(this))}),$("#unrecognized-tip").length?(setTimeout(function(){Chat.sendKaEvent("go_certi_block")},2e3),$.dialog({title:"",content:$("#unrecognized-tip").prop("outerHTML"),confirmText:"",cancelText:"",closeText:!1,closeLayer:!1,element:$("#unrecognized-tip"),wrapClass:"dialog-unrecognized",lock:!0,onOpen:function(t){var e=t.find(".img-wrap");e.html('<img src="'+e.attr("data-url")+'">')},onConfirm:function(t){},onClose:function(t){}})):$("#approveBag").length&&$.dialog({title:"",content:$("#approveBag").prop("outerHTML"),confirmText:"领取权益礼包",cancelText:"",closeText:!1,closeLayer:!1,wrapClass:"dialog-approve-bag",lock:!0,onOpen:function(t){},onConfirm:function(t){$.get("/bossweb/vip/receivedailygift.json").success(function(){}),t.remove(),$.toast({type:"success",content:"领取成功！"})},onClose:function(t){}});var e=function(){Chat.chatEl.find(".chat-list").css("visibility","hidden"),Chat.chatEl.find(".chat-wrap-mask").remove(),Chat.chatEl.append($('<div class="chat-wrap-mask"></div>'))};if(Chat.userList.on("click","li a",function(t){t.preventDefault();var i=$(this),s=Chat.getGroupStatus();if(s){var a=Chat.groupHistory[s],n=$(this).attr("data-uid"),r=Chat.usersData[n]?Chat.usersData[n]:ChatGroups.get(n);if(!r)return;Chat.groupHistory[s]=n,!Chat.groupLastModify[s]||Chat.groupLastModify[s]==n||-1!=s&&5!=s||(chatUserPresenter.setStatus(Chat.groupLastModify[s],6,!1),Chat.groupLastModify[s]=void 0,Chat.usersData[n].relationType=6),r.newMsgCount&&5==s&&$(this).parent("li").addClass("modify"),chatUserPresenter.viewed(a,n)}Chat.renderTimer&&clearTimeout(Chat.renderTimer),Chat.renderTimer=setTimeout(function(){e(),1==i.attr("data-group")?(Chat.renderGroupBox(i),Chat.chatEl.addClass("chat-group-wrap"),__conversion("group_chat_"+i.attr("data-uid"))):(Chat.chatEl.removeClass("chat-group-wrap"),Chat.renderBox(i.attr("data-uid"),i.attr("data-eid"),i,null,t))},50),Chat.prevUid=Chat.curUserData.uid?Chat.curUserData.uid:Chat.curUserData.groupId}),Chat.setTopEl.on("click",function(t){var e=$(this);Chat.setTop(e)}),Chat.chatEl.on("click",".msg-item-unlock",function(){Chat.unlockMessages({from:"received"})}),Chat.toggleTypeEl.on("click","span",function(t){var i=$(this),s=i.index();if(!i.parent().hasClass("dropdown-wrap")){if(2==s&&i.hasClass("gray"))return void i.parent().find(".dropdown-wrap").show();i.parent().children().removeClass("cur"),i.addClass("cur"),Chat.containerChat.find(".sel-type").removeClass("dropdown-open"),Chat.tabcontentEls.removeClass("show-box"),Chat.tabcontentEls.eq(s).addClass("show-box"),"chat-box"==i.attr("data-target")&&Publisher.editorInput.focus(),0!=s||t.isTrigger||Chat.sendKaEvent("Geekshow_tab_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid),s>0?Chat.chatEl.find(".detail-bottom").show():Chat.chatEl.find(".detail-bottom").hide(),1==s&&(e(),Resume.loadDetail(Chat.userList.find(".cur a").attr("href"),Chat.resumeContainer,t.isTrigger)),2==s&&(e(),Resume.loadAttachment(i.attr("data-url")+Chat.userList.find(".cur a").attr("data-eid")+".json",Chat.attachContainer,t.isTrigger))}}),Chat.toggleTypeEl.on("click",'li[data-type="resume"]',function(){Publisher.showExchangeResume($(this).closest(".dropdown-wrap").find(".dropdown-label"))}),Chat.opTopEls.on("click",".dropdown-label",function(){Chat.getTopInfo($(this))}),Chat.containerChat.on("click",".detail-bottom .btn, .detail-bottom .btns a, .chat-controls .links a",function(){if($(this).hasClass("link-chat")&&Chat.toggleTypeEl.find("span[data-target=chat-box]").trigger("click"),!$(this).hasClass("cur"))return $(this).hasClass("link-fail")?void Chat.mismatching($(this)):void Chat.workflowTip($(this))}),$(document).on("click",function(t){0==$(t.target).parents(".dropdown-open").length&&$(".dropdown-open").removeClass("dropdown-open")}),Chat.chatListCon.on("click",".img-tiny",function(){$(this).attr("data-large")&&Chat.viewLargeImage($(this))}),Chat.chatListCon.on("click",".btn-store",function(){var t=$(this);Emotion.storeEmotion(t)}),Chat.chatListCon.on("click",".item-file .text",function(){Chat.viewFullResume($(this).find("p").attr("data-origin"))}),Chat.chatEl.on("click",".link-job",function(){var t=$(this),e=t.attr("data-jobid"),i="/bossweb/job/"+e+".html";$.toast({content:"正在加载职位详情...",type:"loading"});var s=function(e){window.top.$.dialog({title:"",content:e,closeText:!0,confirmText:"确定",cancelText:!1,wrapClass:"dialog-layer-full dialog-resume-full pop-position-detail",lock:!0,onOpen:function(e){e.find(".dialog-footer .btns").prepend(t.closest("li").find(".icon-coop").clone()),e.find(".dialog-con").on("click",function(t){$(t.target).parents(".dialog-con").length||e.remove()})},onConfirm:function(t){t.remove()}})};$.get(i).success(function(t,e,i){var a;a="error"==e?'<div class="data-tips"><div class="data-blank"><i class="tip-errordata"></i><b>数据加载出错</b></div></div>':t,setTimeout(function(){$("#toast").remove(),a='<div class="resume-dialog">'+a+"</div>",s(a)},500)})}),Chat.directionEl.on("click","a",function(){Chat.changeUserView($(this))}),Chat.resumeContainer.on("click",".link-getphone",function(){var t=$(this);t.hasClass("disabled")||$.confirm({content:"确认与对方交换电话吗？",title:"温馨提示",closeIcon:!0,columnClass:"",onOpen:function(){},confirm:function(){Chat.exchangePhone(2,{from:{uid:Chat.curUserData.uid}}),t.text("已发出请求").addClass("disabled")},error:function(t){}})}),Chat.chatEl.on("click",".item-base img, .item-friend .figure img",function(){if(Chat.curUserData.groupId)return!1;var t=!!Chat.curUserData.groupId,e=t?Chat.curUserData.groupId:Chat.curUserData.uid,i=Chat.usersData[e]?Chat.usersData[e].infoData.largeAvatar:$(this).attr("src").replace("_s",""),s=Chat.usersData[e]?Chat.usersData[e].infoData.name:$(this).parents("li").find(".item-name").text(),a='<div class="figure-preview"><div class="figure-mask">'+s+'</div><img src="'+i+'" /></div>';$.dialog({title:"",content:a,confirmText:!1,cancelText:!1,preKa:"",wrapClass:"dialog-figure-preview",lock:!0,opacityLock:!0,onOpen:function(t){},onConfirm:function(t){},onClose:function(t){}})}),window.localStorage)for(var i=0;i<localStorage.length;i++)localStorage.key(i).indexOf("/chatws:ws-")>-1&&localStorage.removeItem(localStorage.key(i));Chat.initSearch(),Chat.initGroupChat(),Chat.chatEl.on("click",".show-item",function(){$(this).hide(),$(this).parents(".item-container").addClass("item-all")}),PageSet.getTipData(function(t){t.rescode&&t[18]&&(Chat.chatEl.find(".btn-position").attr("link-show","show"),Chat.chatEl.find(".btn-position .tips").show())}),Chat.chatEl.find(".btn-position .tips em").on("click",function(t){try{_T.sendEvent("pop_position_sure")}catch(t){}t.stopPropagation();var e=$(this);$.ajax({url:"/setting/notify/set.json",data:{type:18},type:"post",success:function(t){t.rescode&&e.parents(".tips").hide()}})})},XssText:function(t){return(""+t).replace(/</g,"&#60;").replace(/>/g,"&#62;").replace(/\n/g,"<br/>").replace(/\\n/g,"<br/>").replace(/&amp;middot;/g,"&#183;").replace(/&amp;lt;/g,"&#60;").replace(/&amp;gt;/g,"&#62;").replace(/&lt;/g,"&#60;").replace(/&gt;/g,"&#62;").replace(/&middot;/g,"")},mismatching:function(t){var e=function(t){return Utemplate('<div class="subhead"><h4>觉得「<%this.name%>」不合适？</h4><p class="gray">选择不合适的原因，以减少此类求职者的推荐</p></div><ul><%for(var i=0;i<this.list.length;i++){%><li data-reason="<%this.list[i].reasonType%>"><%this.list[i].notifyDesc%><%if(this.list[i].sendMsg != 0 && this.list[i].msgContent){%><i class="icon-config"></i><%}%><%if(this.list[i].sendMsg != 0 && this.list[i].msgContent){%><div class="config-text"><%this.list[i].msgContent%></div><%}%></li><%}%></ul>',{name:Chat.curUserData.name,list:t})};t.addClass("unfold"),function(){var t=$.Deferred();return $.get("/setting/notokreason.json",function(e){t.resolve(e.data)}),t}().then(function(i){console.log(),$.dialog({title:"",content:e(i),closeText:!1,confirmText:!1,cancelText:!1,preKa:"",wrapClass:"dialog-around-default dialog-up-default dialog-link-fail",position:"around",lock:!0,element:t,opacityLock:!0,onOpen:function(e){e.find("li").on("click",function(){t.attr("data-reason",$(this).attr("data-reason")),Chat.workflowTip(t,null,$(this).attr("data-reason")),e.remove(),t.removeClass("unfold")})},onClose:function(){t.removeClass("unfold")}})})},getGroupStatus:function(){return Chat.containerChat.find(".op-category .cur").attr("data-status")},getQueryParams:function(){var t=$(".top-chat .dropdown-select"),e=Chat.containerChat.find(".op-category .cur"),i=$(".condition-filter dl");return{status:e.attr("data-status")||"-1",origin:e.attr("data-origin")||"-1",jobid:t.attr("data-jobid")||"-1",salary:i.eq(0).find(".cur").attr("data-salary"),experience:i.eq(1).find(".cur").attr("data-experience"),degree:i.eq(2).find(".cur").attr("data-degree")}},getDraft:function(t){Chat.drafts=function(){var t=sessionStorage.getItem("__Chat__Drafts");return""==t||null==t||void 0==t?[]:$.parseJSON(t)}();var e=Chat.drafts.filter(function(e){return e.uid==t});return e.length?e[0]:{}},setDraft:function(t){var t=t||Chat.prevUid,e=Publisher.editorInput.html(),i=Publisher.htmlConverToMessage(e).replace(/</g,"&#60;").replace(/>/g,"&#62;");if(t){var s=Chat.getDraft(t);if(s.uid){var a=Chat.drafts.indexOf(s);Chat.drafts.splice(a,1)}if(t&&i&&""!=$.trim(i)){Chat.drafts.push({uid:t,text:i,content:e});var n=Chat.userList.find('a[data-uid="'+t+'"]').find(".title .draft");n.length||(n=$('<p class="draft"></p>'),Chat.userList.find('a[data-uid="'+t+'"]').find(".title").append(n)),n.html("<i></i>"+i)}!t||i&&""!=i||Chat.userList.find('a[data-uid="'+t+'"]').find(".title .draft").remove(),sessionStorage.setItem("__Chat__Drafts",__stringify(Chat.drafts))}},addTip:function(){var t=Chat.containerChat.find(".op-category .cur"),e=t.attr("data-status")?t.attr("data-status"):101,i=t.attr("data-status")?t.attr("data-status"):"10"+t.attr("data-origin"),s={"-1":"在「<span>全部</span>」中，可以找到近30天的联系人",1:"首次给你发消息的牛人可以方便的在「<span>新牛人</span>」中统一处理",5:"「<span>新牛人</span>」中包含所有你未回复的牛人",6:"和你聊过的牛人，将会自动归档在「<span>沟通中</span>」方便你继续沟通哦～",7:"聊得来的牛人很可贵，把他们标记为「<span>合适</span>」吧",8:"被标记为「<span>不合适</span>」的牛人，你将不会再收到Ta的新消息提示",101:'来自同事推荐等功能全部收集在「<span><i class="icon-category-vdot"></i></span>」里面，进去看看吧'},a=Chat.filterRadio?" selected":"",n=Chat.filterGroup?"selected":"",r=ChatGroups.list.length?'<span class="group-check '+n+'"><i class="icon-check"></i>群聊</span>':'<span class="group-check '+n+'" style="display: none;"><i class="icon-check"></i>群聊</span>',o={"-1":"全部"+r+'<span class="unread-check'+a+'"><i class="icon-check"></i>待回复牛人</span>',1:"新牛人",5:"新牛人",6:"沟通中牛人",7:"合适牛人",8:"不合适牛人",101:"牛人发起的",102:"我发起的",103:"同事推荐",104:"有附件简历的"},c="<p><b>Tips：</b>"+s[e]+"</p>";Chat.detailContainer.find(".welcome-tips").empty().append(c),Chat.containerChat.find(".chat-search .article").empty().html(o[i])},scrollToByUser:function(t){var e=Chat.userList.find("a[data-uid="+t+"]"),i=Chat.containerChat.find(".op-category .cur").attr("data-status");if(!e.length&&1!=i){var s=Chat.renderUser(Chat.usersData[t]);Chat.userListMain.append(s),e=Chat.userList.find("a[data-uid="+t+"]")}e.trigger("click"),e.closest(".main-list").length&&Chat.userList.find(".top-list li").length?Chat.userList.scrollTop(e.parent().height()*(e.parent().index()+Chat.userList.find(".top-list li").length)):Chat.userList.scrollTop(e.parent().height()*e.parent().index())},toggleGroupList:function(t,e){var i=0,s=[],a=[];if(e.length)for(i=0;i<e.length;i++){var n=e[i];n>1e3&&!Chat.usersdata[n]?s.push(n):n>1e3&&a.indexOf(n)<0&&a.push()}if(result.data.length){var i,e=result.data;for(i=0;i<e.length;i++)e[i]>1e3&&!Chat.usersData[e[i]]?ids.push(e[i]):e[i]>1e3&&!existObj[e[i]]&&(existIds.push(e[i]),existObj[e[i]]=Chat.usersData[e[i]],existArr.push(Chat.usersData[e[i]]));Chat.getAddUsers(ids,existIds,existArr,toggle),Chat.tipsContainer.html("").hide(),Chat.userList.show(),Chat.containerChat.find(".chat-search").show(),$(".chat-container .scroll-wrapper").show(),Chat.detailContainer.show(),Chat.userList.find(".user-blank").remove();var t=Chat.containerChat.find(".op-category .cur").attr("data-status");if(t&&Chat.groupHistory[t]){var n=Chat.groupHistory[t];Chat.userList.find("a[data-uid="+n+"]");Chat.scrollToByUser(n)}Chat.containerChat.find(".sel-batch").removeClass("disabled")}else{Chat.userList.find("ul").empty();var r=Chat.containerChat.find(".op-category .cur").text().replace("的","");Chat.containerChat.find(".op-category .cur").text().replace("的","");-1!=Chat.groupStatus||Chat.containerChat.find(".op-category .cur").parent().hasClass("group-more")?1==Chat.groupStatus||5==Chat.groupStatus?r="新":r+="的":r="",Chat.userList.find(".user-blank").remove(),Chat.userList.append('<div class="user-blank"><p>暂无'+r+"牛人</p></div>"),Chat.userList.find(".loadmore").hide(),Chat.containerChat.find(".sel-batch").addClass("disabled")}Chat.addTip(),Chat.chatEl.hide(),Chat.welcomeEl.show(),setTimeout(function(){Chat.containerChat.find(".loading-category-refresh").removeClass("loading-category-refresh")},300)},tabEmpty:function(){var t=Chat.containerChat.find(".op-category .cur").text().replace("的","");Chat.containerChat.find(".op-category .cur").text().replace("的","");-1!=Chat.groupStatus||Chat.containerChat.find(".op-category .cur").parent().hasClass("group-more")?1==Chat.groupStatus||5==Chat.groupStatus?t="新":t+="的":t="",Chat.userList.find(".user-blank").remove(),Chat.userList.append('<div class="user-blank"><p>暂无'+t+"牛人</p></div>"),Chat.userList.find(".loadmore").hide(),Chat.containerChat.find(".sel-batch").addClass("disabled")},getUsersId:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].uid);return e},getFilterUsers:function(t,e){Chat.curUserData={};var i=t,s=INTERFACE_URLS.chatFilterUsersUrl,a=[],n=[];existObj={},existArr=[];var r=function(t){var e=8==Chat.getGroupStatus();return t.filter(function(t){return!e&&!Chat.usersData[t]||8==Chat.usersData[t].relationType===e})},o=function(){var t=Chat.getQueryParams(),e=!0;return $.each(t,function(t,i){i&&0!=i&&"-1"!=i&&(e=!1)}),e},c=function(t){var i=(t.data,r(t.data));if(o()&&ChatGroups.list.length&&"-1"==Chat.getGroupStatus()&&Chat.renderUserList(i,1),i.length||ChatGroups.list.length&&o()&&!Chat.filterRadio){if(t.isGroup)return Chat.addTip(),Chat.renderGroupList(),Chat.userList.find(".user-blank").remove(),Chat.chatEl.hide(),Chat.welcomeEl.show(),!0;var s;for(s=0;s<i.length;s++)if(i[s]>1e3&&!Chat.usersData[i[s]])a.push(i[s]);else if(i[s]>1e3&&!existObj[i[s]]){var c,l=i[s];if(t.workdata){var d=t.workdata.filter(function(t){return t.geek==l});c=$.extend(Chat.usersData[l],d[0])}else c=Chat.usersData[l];n.push(l),existObj[l]=c,existArr.push(c)}Chat.usersInitStatus&&Chat.getAddUsers(a,n,existArr,e),Chat.tipsContainer.html("").hide(),Chat.userList.show(),Chat.containerChat.find(".chat-search").show(),$(".chat-container .scroll-wrapper").show(),Chat.detailContainer.show(),Chat.userList.find(".user-blank").remove();var h=Chat.getGroupStatus();if(h&&Chat.groupHistory[h]){var u=Chat.groupHistory[h],p=Chat.userList.find("a[data-uid="+u+"]"),f=Chat.usersData[u]?Chat.usersData[u]:ChatGroups.get(u);!p.length||h!=f.relationType&&-1!=h||Chat.scrollToByUser(u)}Chat.containerChat.find(".sel-batch").removeClass("disabled")}else{Chat.userList.find("ul").empty();var g=Chat.containerChat.find(".op-category .cur").text().replace("的","");Chat.containerChat.find(".op-category .cur").text().replace("的","");-1!=Chat.groupStatus||Chat.containerChat.find(".op-category .cur").parent().hasClass("group-more")?1==Chat.groupStatus||5==Chat.groupStatus?g="新":g+="的":g="",Chat.filterRadio&&(g="待回复"),Chat.userList.find(".user-blank").remove(),Chat.filterGroup&&"-1"==Chat.getGroupStatus()?Chat.userList.append('<div class="user-blank"><p>暂未加入群聊</p></div>'):Chat.userList.append('<div class="user-blank"><p>暂无'+g+"牛人</p></div>"),Chat.userList.find(".loadmore").hide(),Chat.containerChat.find(".sel-batch").addClass("disabled")}Chat.addTip(),Chat.chatEl.hide(),Chat.welcomeEl.show(),setTimeout(function(){Chat.containerChat.find(".loading-category-refresh").removeClass("loading-category-refresh")},300)};if("-1"==i.status&&Chat.filterRadio){var l=Chat.usersID.filter(function(t){var e=Chat.usersData[t.uid],i=e.infoData||{};return e.newMsgCount>0||i.newMsgCount>0});return c({data:Chat.getUsersId(l)}),!0}if("-1"==i.status&&Chat.filterGroup)return c({isGroup:!0,data:ChatGroups.list.sort(function(t,e){return e.isTop-t.isTop||e.lastTS-t.lastTS})}),!0;1==i.status?c({data:Chat.newGeek}):$.ajax({type:"GET",url:s,dataType:"JSON",cache:!1,data:i,success:function(t){t.rescode&&c(t)},error:function(t){Chat.userList.find("ul").empty(),Chat.userList.find(".user-blank").remove(),Chat.userList.append('<div class="user-blank"><p>加载出错，请稍后再试</p></div>'),Chat.userList.find(".loadmore").hide()}})},removeToast:function(t){$("#toast").addClass("slideUp"),setTimeout(function(){$("#toast").remove()},t)},batchUserStatus:function(t,e,i){var s=$.Deferred();(new Date).getTime();return $.ajax({url:"/chat/relation/groupset.json",type:"POST",data:{geekId:i.join(","),relationType:t},dataType:"JSON",timeout:5e3,success:function(t){(new Date).getTime();1==t.rescode?s.resolve():$.toast({content:t.msg,type:"error"})},error:function(){$.toast({content:"批量操作失败",type:"error"})}}),s},batchReadMessage:function(t){Chat.containerChat.find(".op-category .cur").attr("data-status");$.each(t,function(t,e){var i=Chat.usersData[e];i.maxMessageId&&(ChatWebsocket.sendReadMessage({uid:e,mid:i.maxMessageId}),Chat.clearMessageCount(i,i.newMsgCount))});var e=-1==Chat.getGroupStatus()?800:1200;setTimeout(function(){Chat.batchHandle.close()},e)},batchUserHandle:function(){var t=function(){return'<div class="batch-operate"><div class="batch-title-box"><div class="batch-title"><em class="batch-cancel">取消</em></div></div><div class="batch-operate-wrap"><div class="batch-operate-box"><img src="/v2/web/boss/images/icon-batch-default.png"><p class="batch-number">已选择<span>0</span>位牛人</p><ul><li class="batch-action batch-link" data-action="6"><i></i>沟通中</li><li class="batch-action batch-like" data-action="7"><i></i>合适</li><li class="batch-action batch-unlike" data-action="8"><i></i>不合适</li><li class="batch-action batch-read"><i></i>已读</li></ul></div></div></div>'},e={6:'<p class="deal-layer icon-commun"><i></i>沟通中</p>',7:'<p class="deal-layer icon-pass"><i></i>合适</p>',8:'<p class="deal-layer icon-fail"><i></i>不合适</p>'},i={6:"user-communication",7:"user-pass",8:"user-fail"},s={"-1":"全部",1:"新",5:"新",6:"沟通中的",7:"合适的",8:"不合适的"},a=function(t,a){var n=t,r=i[a]||"";n.attr("class",r),n.find(".deal-layer").length||n.prepend(e[a]),n.addClass("dealSlideRight"),setTimeout(function(){n.slideUp(function(){n.remove(),Chat.userList.find("li").length<1&&(Chat.userList.find(".user-blank").remove(),Chat.userList.append('<div class="user-blank"><p>暂无'+s[Chat.groupStatus]+"牛人</p></div>"))})},500)},n=function(t,e){var s=i[e]||"",n=Chat.containerChat.find(".op-category .cur").attr("data-status"),r=!1;return-1!=n&&void 0!=n||8==e||!Chat.containerChat.find(".batch-wrap").is(":visible")?($.each(t,function(t,i){a($(i),e)}),r=!0):$(t).attr("class",s),r},r=function(){var t=Chat.containerChat.find(".batch-wrap");$(document).off("keydown",c),Chat.containerChat.find(".op-category").animate({marginTop:0,opacity:1},300),t.find(".batch-title").animate({marginTop:42,opacity:0},300),Chat.containerChat.find(".batch-wrap").off("click").animate({opacity:0},500,function(){Chat.containerChat.find(".batch-wrap").remove()}),$(".batch-layer").remove()},o=function(){var t=$(".batch-list").find("li.selected").length;$(".batch-wrap").find(".batch-number span").text(t)},c=function(t){var e=Chat.containerChat.find(".batch-wrap"),i=Chat.userList.scrollTop()/76,s=Chat.userList.height()/76,a=Math.round(i)-1,n=Math.floor(s);e.find(".selected").removeClass("selected"),a<0&&(a=0,n-=1,e.find("li").eq(0).addClass("selected")),e.find("li").filter(":gt("+a+")").filter(":lt("+n+")").addClass("selected "),Chat.containerChat.find(".batch-list .user-list").scrollTop(Chat.userList.scrollTop()),o()},l=function(){if($(this).hasClass("disabled"))return!1;var t=$(".batch-wrap"),e=$(this).attr("data-action"),i=$(this).clone(),s=i.find("span").remove().end().text(),a=t.find(".batch-list .selected"),r=[],o=[],c=800;if(a.length){$.each(a,function(t,e){var i=$(e).find("a:first-child");r.push(i.attr("data-uid")),o.push(i.attr("data-eid"))}),e&&Chat.batchUserStatus(e,r,o).then(function(){$.each(r,function(t,e){Chat.usersData[e].newMsgCount>0&&Chat.subtractPoint(Chat.usersData[e])}),chatUserPresenter.batch(r,e);var t=n(a,e);c=t?1200:800,$.each(r,function(t,e){Chat.newGeek.indexOf(e)>-1&&(Chat.newGeek.splice(Chat.newGeek.indexOf(e),1),Chat.totalNewGeek())}),$.toast({content:"已置为"+s.replace("置为",""),type:"success"})}),Chat.batchReadMessage(r);var l=["nread","ntochat","npass","nfail"],d=e?e-5:0;Chat.sendKaEvent("Geekdeal_"+l[d]+"_"+a.length+"_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view)}},d=function(){if(!$(this).hasClass("disabled")){var e=$('<div class="batch-wrap"></div>'),i=$('<div class="batch-list"><div class="batch-title-box"><div class="batch-title"><i class="icon-operate"></i>批量处理</div></div><div class="batch-user-wrap scrollbar-macosx"><div class="user-list"><ul></ul></div></div></div>'),s=t();$("body").append('<div class="batch-layer"></div>'),i.find("ul").append(Chat.userListTop.children().not(".group-item").clone()).append(Chat.userListMain.children().not(".group-item").clone()),i.prepend(Chat.containerChat.find(".chat-search").clone()),i.find(".cur").removeClass("cur"),i.find(".notice-badge").remove(),e.append(i).append(s),e.on("click",".user-list li a",function(t){($(".batch-list").find("li.selected").length>1||!$(this).parents("li").hasClass("selected"))&&($(this).parents("li").toggleClass("selected"),o()),t.preventDefault()}),e.on("click",".batch-cancel",r),e.on("click",".batch-action",l),Chat.containerChat.find(".sec-content").append(e),Menu.isSuportCalc?Chat.containerChat.find(".batch-list .user-list").scrollbar():(Chat.containerChat.find(".batch-user-wrap").css("height",$(window).height()-132+"px"),Chat.containerChat.find(".batch-list .user-list").css("height",$(window).height()-176+"px")),c(),Chat.containerChat.find(".op-category").animate({marginTop:-49,opacity:0},200),e.find(".batch-title").animate({marginTop:0,opacity:1},300);var a=$(".batch-operate-wrap .batch-action[data-action="+Chat.groupStatus+"]");a&&a.addClass("disabled"),Chat.sendKaEvent("Chat_batch_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view)}};return Chat.containerChat.on("click",".sel-batch",d),{close:r,render:d}},initSearch:function(){var t,e="",i=Chat.containerChat.find(".chat-search"),s=Chat.containerChat.find(".chat-search .ipt"),a=Chat.containerChat.find(".chat-search .chat-search-list"),n=Chat.containerChat.find(".chat-search .chat-search-input"),r=function(){if(i.removeClass("fold").addClass("unfold"),n.animate({width:"100%"},200),""==$.trim(s.val())){var t=ChatGroups.list.length?"搜索联系人、群聊":"搜索联系人";Chat.containerChat.find(".chat-search .chat-search-list").empty().html('<p class="chat-search-empty">'+t+"</p>"),Menu.isSuportCalc||Chat.containerChat.find(".chat-search .chat-search-list").css("height",$(window).height()-176+"px")}},o=function(){s.val(""),i.removeClass("unfold").addClass("fold"),n.animate({width:"46px"},200)},c=function(t){var e=Utemplate('<%if(this.list.length == 0){%><p class="chat-search-empty">没有搜索结果</p><%}%><ul><%for(var i=0; i < this.list.length; i++){%><li <%if(this.list[i].isGroup){%>class="group-item"<%}%> ><a href="javascript:;" data-uid="<%this.list[i].uid%>"><div class="figure"><img src="<%this.list[i].avatar%>" alt=""></div> <div class="text"> <div class="title"><span class="name"><%this.list[i].name%></span></div><p class="gray"><%this.list[i].lastMsg%></p> </div> </a></li><%}%></ul>',{list:t});a.empty().html(e),__conversion("chat_search_"+encodeURIComponent(s.val()))},l=function(t){t.stopPropagation(),Chat.groupHistory[-1]=$(this).find("a").attr("data-uid"),chatUserPresenter.flushJob(),o()},d=function(){var i=$(this).val().trim();clearTimeout(t),t=setTimeout(function(){i!=e&&""!=i||(i.length>0?c(Chat.searchUserByName(i)):a.empty().html('<p class="chat-search-empty">搜索联系人、群聊</p>').show())},300),e=i},h=function(){$(document).on("click",o),i.on("input",".ipt",d),i.on("focus",".ipt",r),i.on("click",".chat-search-list li",l),i.on("click",".icon-chat-search",function(){
i.find(".ipt").focus()}),n.on("click",".icon-chat-search-clear",function(t){t.stopPropagation(),o()}),i.on("mouseover mouseout",".chat-search-input",function(t){i.hasClass("unfold")||("mouseover"==t.type?n.css({width:"88px"}):n.css({width:"46px"}))}),i.on("click",".chat-search-article",function(t){t.stopPropagation()}),i.on("click",".unread-check",function(){Chat.groupHistory[-1]=null,Chat.filterRadio=!Chat.filterRadio,Chat.filterGroup=!1,Chat.filterRadio||Chat.filterGroup?Chat.containerChat.find(".op-filter").addClass("disabled"):Chat.containerChat.find(".op-filter").removeClass("disabled"),Chat.filterRadio?(Chat.getFilterUsers({status:"-1"},!1),$(this).addClass("selected")):chatUserPresenter.flushJob(),__conversion("chat_filter_all_unread")}),i.on("click",".group-check",function(){Chat.groupHistory[-1]=null,Chat.filterGroup=!Chat.filterGroup,$(this).toggleClass("selected"),Chat.filterRadio=!1,Chat.filterRadio||Chat.filterGroup?Chat.containerChat.find(".op-filter").addClass("disabled"):Chat.containerChat.find(".op-filter").removeClass("disabled"),Chat.getFilterUsers({status:"-1"},!1),__conversion("chat_filter_all_group")})};!function(){var t=ChatGroups.list.length?'<span class="group-check"><i class="icon-check"></i>群聊</span>':'<span class="group-check" style="display: none;"><i class="icon-check"></i>群聊</span>',e='<div class="chat-search fold"> <div class="chat-search-article"><p class="article">全部'+t+'<span class="unread-check"><i class="icon-check"></i>待回复牛人</span></p> <p class="chat-search-input"> <i class="icon-chat-search"></i> <input class="ipt" type="text" name="" placeholder="搜索" /> <i class="icon-chat-search-clear icon-close"></i></p> </div><div class="chat-search-list user-list"><p class="chat-search-empty">搜索联系人、群聊</p></div></div>';Chat.containerChat.find(".sec-content").prepend(e),i=Chat.containerChat.find(".chat-search"),s=Chat.containerChat.find(".chat-search .ipt"),a=Chat.containerChat.find(".chat-search .chat-search-list"),n=Chat.containerChat.find(".chat-search .chat-search-input"),h()}()},lightKeyword:function(t,e){var i=""+e,s=(e+"").toLowerCase(),a=(t+"").toLowerCase(),n=s.indexOf(a),r=a.length,s=i.substr(0,n)+'<u class="h">'+i.substr(n,r)+"</u>"+i.substr(n+r);return s},searchUserByName:function(t){var e=function(){var e=$.trim((t+"").toLowerCase()),i=Chat.usersID.filter(function(t){return $.trim((t.name+"").toLowerCase()).indexOf(e)>-1}),s=ChatGroups.list.filter(function(t){return $.trim((t.name+"").toLowerCase()).indexOf(e)>-1});return i.concat(s)};return function(){var i=[].concat(e()),s=[];return $.each(i,function(e,i){var a=Chat.usersData[i.uid]?Chat.usersData[i.uid]:i;s.push({avatar:i.avatar||i.avatarUrl,lastMsg:a.lastMsg,name:Chat.lightKeyword(t,i.name),uid:i.uid||i.groupId,isGroup:void 0!=i.groupId})}),s}()},getAddUsers:function(t,e,i,s){var a=[],t=t;if(!t.length)return void Chat.filterUserListData(a,i,s);$.ajax({type:"GET",url:INTERFACE_URLS.chatAddUsersUrl,dataType:"JSON",cache:!1,data:"friendIds="+t,success:function(t){if(t.status&&t.data.length){var e,n=t.data;for(e=0;e<n.length;e++)Chat.usersData[n[e].uid]||(n[e].fromSource="list",Chat.usersData[n[e].uid]=n[e],Chat.usersData[n[e].uid].fromSource="list",Chat.usersData[n[e].uid].newMsgCount=0,Chat.usersData[n[e].uid].infoData={},Chat.usersData[n[e].uid].lastMsg=n[e].lastMsg),Chat.usersTempData.length||(Chat.usersTempData[0]=[]),Chat.usersTempData[0].unshift(n[e]),a.push(n[e])}Chat.filterUserListData(a,i,s)},error:function(t){}})},concatGroup:function(t,e,i){var s=function(t,e){return t.lastTS=void 0!=t.lastTS?t.lastTS:0,e.lastTS=void 0!=e.lastTS?e.lastTS:0,e.isTop-t.isTop||e.lastTS-t.lastTS};if(Chat.filterRadio)return t;var a=Chat.getQueryParams(),n=!0,r=[];if($.each(a,function(t,e){e&&0!=e&&"-1"!=e&&(n=!1)}),Chat.filterGroup&&n&&0==e)return ChatGroups.list.sort(s);if(!$.isArray(t)&&i&&0==e)return ChatGroups.list.sort(s);if(!$.isArray(t))return t;if(n&&t.length){0!=e&&1!=e||(r=ChatGroups.tops());var o=t[0].lastTS,c=t.length>1&&!i?t[t.length-1].lastTS:0;r=r.concat(ChatGroups.between(c,o)),t=t.concat(r).sort(s)}return t},filterUserListData:function(t,e,i){var t=t||[],s=[],e=e;if(s=t.length>0?t.concat(e):e,s.sort(function(t,e){return e.isTop-t.isTop||e.lastTS-t.lastTS}),s.length){var a,n=0,r=[];for(a=0;a<s.length;a++)a>0&&a%Chat.userlistPageTotal==0&&n++,void 0===r[n]&&(r[n]=[]),r[n].push(s[a]);var o=Chat.groupHistory[-1],c=Chat.usersData[o];Chat.containerChat.find(".chat-search .unread-check").hasClass("selected");"-1"==Chat.getGroupStatus()&&c&&o&&r.length&&r[0].indexOf(o)<0&&r[0].push(c),Chat.userlistRenderPage=0,Chat.userListMain.html(""),Chat.userListTop.html(""),Chat.renderUserList(r,0),Chat.userFilterTempData=r,i&&(Chat.resetRules(i),Chat.renderBox(i.uid,i.eid,null,{back:!0}))}},resetRules:function(t,e){var i=Chat.containerChat.find(".data-tab"),s=Chat.containerChat.find(".menu-status"),a=Chat.containerChat.find(".sel-type"),n=Chat.containerChat.find(".sel-filter"),r=Chat.containerChat.find(".sec-filter");i.find("a").removeClass("cur").eq(0).addClass("cur"),s.find("p").eq(0).addClass("show").siblings().removeClass("show"),s.find("p").eq(0).find("a").removeClass("cur").eq(0).addClass("cur"),a.removeClass("dropdown-open"),e?(a.find("a").removeClass("cur"),a.find(".label-text b").addClass("red").text(a.find('a[data-jobid="'+e+'"]').addClass("cur").text())):(a.find(".label-text b").removeClass("red").text("全部职位"),a.find("a").removeClass("cur").eq(0).addClass("cur")),Chat.containerChat.removeClass("show-chat-filter"),n.removeClass("filter-open"),n.find(".label-text b").removeClass("red").text("筛选"),r.find("a").removeClass("cur"),r.find("dl").each(function(){$(this).find("a").eq(0).addClass("cur")}),setTimeout(function(){Chat.containerChat.find(".sel-filter .label-text").attr("ka","main_filter")},10)},setUserTempData:function(t,e){var t=t||[],e=e;if(tempArr=[],t.length>0?tempArr=t.concat(e):tempArr=e,tempArr.length){var i,s=0,a=[];for(i=0;i<tempArr.length;i++)i>0&&i%Chat.userlistPageTotal==0&&s++,void 0===a[s]&&(a[s]=[]),a[s].push(tempArr[i])}return Chat.userFilterTempData=tempArr,tempArr},getUserList:function(t){var t=t;Chat.isLoading=!0,$.ajax({type:"GET",url:INTERFACE_URLS.userlistUrl,dataType:"JSON",timeout:6e4,data:"page="+t,success:function(e){if(e.status&&e.data&&e.data.length){var i,s=e.data,a=[],n={};for(i=0;i<s.length;i++)s[i].uid>1e3&&!Chat.usersData[s[i].uid]||Chat.usersData[s[i].uid]&&!Chat.usersData[s[i].uid].infoData?(n[i]=s[i],n[i].fromSource="list",n[i].infoData={},1!=s[i].newGeek&&5!=s[i].relationType||n[i].newMsgCount&&Chat.notification[5].push(s[i].uid),Chat.usersData[s[i].uid]||(Chat.usersData[s[i].uid]=s[i]),$.extend(Chat.usersData[s[i].uid],n[i]),Chat.addToUserList(s[i].uid),s[i].isTop?Chat.tops.push(s[i]):a.push(s[i])):s[i].uid>1e3&&Chat.usersData[s[i].uid]&&!Chat.usersData[s[i].uid].encryptUid&&(n[i].encryptUid=s[i].encryptUid,$.extend(Chat.usersData[s[i].uid],n[i])),void 0===Chat.usersData[s[i].uid].newMsgCount&&(Chat.usersData[s[i].uid].newMsgCount=0);n={},Chat.usersTempData.push(a),Chat.userFilterTempData=Chat.usersTempData,t++,Chat.getUserList(t)}else 1==t?ChatGroups.getGroupList(function(t){t&&t.length?(Chat.renderChatBox(),Chat.checkUnreadMessage(),Chat.containerChat.find(".group-check").show()):(Chat.tipsContainer.html('<div class="data-blank"><i class="tip-nodata"></i><b>没有相关数据</b>'+(VersionStatus.isHunter?"":'<p><a href="/chat/im?mu=recommend" class="btn link-topage">前往推荐牛人</a></p>')+"</div>").show(),Chat.userList.parent(".scroll-wrapper").hide(),Chat.detailContainer.hide(),Chat.containerChat.find(".sec-operate").removeClass("operate-disabed"),Chat.containerChat.find(".group-check").hide()),Chat.usersInitStatus=!0}):(Chat.usersTempData.length&&(Chat.userFilterTempData[0]=Chat.userFilterTempData[0].concat(Chat.tops),ChatGroups.getGroupList(function(t){Chat.renderChatBox(),Chat.checkUnreadMessage(),!t||!t.length>0?Chat.containerChat.find(".group-check").hide():Chat.containerChat.find(".group-check").show(),Chat.usersInitStatus=!0})),Chat.totalNewGeek());e.status||Chat.sendKaEvent("friend_load_error_"+t),Chat.isLoading=!1},error:function(t){Chat.isLoading=!1,$.toast({content:"联系人加载失败，请刷新页面再试",type:"error"}),Chat.sendKaEvent("friend_load_error")}})},renderChatBox:function(){Chat.tipsContainer.html("").hide(),Chat.userList.show(),Chat.containerChat.find(".chat-search").show(),Chat.userList.parent(".scroll-wrapper").show(),Chat.detailContainer.show(),Chat.renderUserList(Chat.userFilterTempData,0),Chat.userList.find("li").length&&Chat.userlistMoreEl.show(),Menu.isSuportCalc&&Chat.userList.scrollbar(),Chat.containerChat.find(".sec-operate").removeClass("operate-disabed")},isGroupChat:function(t){return t.groupId},getGroupItem:function(t){if(Chat.userList.find("a[data-uid="+t.groupId+"]").length&&!Chat.filterGroup)return"";var e=1==t.isSilent?"item-silent":"";t.name=Chat.XssText(t.name),t.lastMsg=t.lastMsg?Chat.XssText(t.lastMsg):"",t.newMsgCount=t.newMsgCount>0?t.newMsgCount:"";var i=t.userId!=t.groupId&&t.userId!=_PAGE.uid&&t.userName?t.userName+"：":"";t.groupId!=Chat.curUserData.groupId&&1==t.isSilent&&t.newMsgCount&&(i='<span class="silent-number">[<span>'+t.newMsgCount+"条</span>]</span>"+i);var s='<li class="'+e+' group-item"><a data-uid="<%this.groupId%>" data-group="1" href="javascript:;"><div class="figure"><img src="<%this.avatarUrl%>?x-oss-process=image/resize,w_60,limit_0"></div><div class="text"><div class="title"><span class="time"><%this.lastTime%></span><span class="name"><%this.name%></span><p class="gray">'+i+'<%this.lastMsg%></p><span class="notice-badge"><%this.newMsgCount%></span></div><span class="silent-badge"></span>'+function(){var e=Chat.getDraft(t.groupId);return e.text&&""!=e.text?'<p class="draft"><i></i>'+e.text+"</p>":""}()+"</div></a> </li>";return Utemplate(s,t)},renderUser:function(t){if(Chat.isGroupChat(t))return Chat.getGroupItem(t);var e=function(e){var i=t.uid,s=Chat.usersData[i],a=s.infoData||{};return"encryptUid"!=e||s.infoData?s[e]?s[e]:a[e]:s.uid},i=t.infoData&&t.infoData.uid?t.infoData:Chat.usersData[t.uid],s={0:"",6:"user-communication",7:"user-pass",8:"user-fail"},a=Chat.getGroupStatus(),n=s[t.relationType]||"",r=function(){return e("sourceTitle")?'<span class="source-title">'+e("sourceTitle")+"</span>":""},r=function(){return e("sourceTitle")?'<span class="source-title">'+e("sourceTitle")+"</span>":""},o='<li class="'+n+'"><a href="'+function(){return"/chat/geek/chatinfo?"+(void 0===e("encryptUid")?"gid="+e("uid"):"uid="+e("encryptUid"))}()+'" data-uid="'+i.uid+'" data-eid="'+e("encryptUid")+'" data-url="/chat/geek.json?uid='+i.uid+'"><div class="figure"><img src="'+e("avatar")+'?x-oss-process=image/resize,w_60,limit_0" /></div><div class="text"><div class="title">'+function(){return'<span class="time">'+i.lastTime+"</span>"}()+r()+'<span class="name">'+e("name")+"</span>"+function(){var i="";return i=e("positionName")?"<p>"+e("positionName")+"·"+(e("lastCompany")||t.company||"")+"</p>":"<p></p>",5==a?i:'<p class="gray">'+(e("lastMsg")||"")+"</p>"}()+function(){return e("newMsgCount")?'<span class="notice-badge">'+e("newMsgCount")+"</span>":""}()+function(){var t=Chat.getDraft(i.uid);return t.text&&""!=t.text?'<p class="draft"><i></i>'+t.text+"</p>":""}();return t.encryptUid||(t.encryptUid=e("encryptUid")),Chat.userList.find("a[data-uid="+i.uid+"]").length>0&&(o=""),o},stat:function(){var t=(Chat.containerChat.find(".op-category .cur").text(),Chat.userList.find(".notice-badge")),e=0;$.each(t,function(t,i){e+=parseInt($(i).text(),10)}),Chat.sendKaEvent("Chat_User_group_"+Chat.getConGroup()+"_red_"+t.length+"_msg_"+e)},renderGroupList:function(){for(var t=ChatGroups.list,e="",i="",s=0;s<t.length;s++)t[s].isTop?e+=Chat.getGroupItem(t[s]):i+=Chat.getGroupItem(t[s]);Chat.userListTop.empty().append(e),Chat.userListMain.empty().append(i)},renderUserList:function(t,e){var i,t=t,s=Chat.concatGroup(t[e],e,t.length<=e+1),e=e,a="",n="";if(!(s=function(t){var e=8==Chat.getGroupStatus();return t.filter(function(t){return t&&8==t.relationType===e})}(function(t){var e=[];if(t)for(var i=0;i<t.length;i++)e.indexOf(t[i])<0&&e.push(t[i]);return e}(s)))||!s.length)return void(0==e?Chat.tabEmpty():Chat.userlistMoreEl.text("没有更多了").addClass("disabled").show());for(Chat.userlistMoreEl.text("加载更多").removeClass("disabled").show(),5==Chat.getGroupStatus()?(s=function(t){var e=t.filter(function(t){return t.newMsgCount>0}),i=t.filter(function(t){return t.newMsgCount<1});return e.concat(i)}(s),Chat.userList.addClass("user-list-new")):Chat.userList.removeClass("user-list-new"),i=0;i<s.length;i++)s[i].isTop?n+=Chat.renderUser(s[i]):a+=Chat.renderUser(s[i]);if(Chat.userListTop.append(n),Chat.userListMain.append(a),Chat.getResumedirectList(),0==e){Chat.userList.find("li:first a");s.length<Chat.userlistPageTotal&&Chat.userlistMoreEl.text("没有更多了").hide(),Chat.userList.scrollTop()>0&&Chat.userList.scrollTop(0)}Chat.stat()},countGroupMessage:function(t){var e=t.to?t.to.uid:t.toId,i=t.from?t.from.uid:t.fromId,s=ChatGroups.get(e),a=[];a.push(t);var n=GroupMessage.formate(a),r=function(){if(s||(s=ChatGroups.get(e)),(!s.maxMessageId||s.maxMessageId<t.mid)&&(s.maxMessageId=t.mid),s.newMsgCount=void 0==s.newMsgCount?0:s.newMsgCount,e!=Chat.curUserData.groupId&&_PAGE.uid!=i){Chat.curUserData.maxMsgId||(Chat.curUserData.cache=[],Chat.curUserData.cache.push(t)),s.newMsgCount++;var a=Chat.userList.find("a[data-uid="+e+"]");a.find(".notice-badge").length?a.find(".notice-badge").text(s.newMsgCount):a.find(".title").append('<span class="notice-badge">'+s.newMsgCount+"</span>"),1!=s.isSilent&&Chat.setUnReadMessageCount(1)}else s.maxMessageId&&ChatWebsocket.sendReadMessage({uid:s.groupId,mid:s.maxMessageId}),s.maxMessageId=null;Chat.addGroupMessage(t)};s?n.length&&r():Chat.usersInitStatus?(Chat.containerChat.find(".group-check").show(),$.get("/group/chat/getGroupInfo.json?groupId="+e,function(i){if(1!=i.resCode)return!1;if(n.length&&(i.userName=t.from?t.from.name:"",i.lastMsg=n[0].originalText),ChatGroups.get(e))r();else{ChatGroups.add(i);var s=Chat.getGroupItem(i);Chat.filterGroup&&s&&Chat.userListMain.prepend(s),r()}})):ChatGroups.pushMessage(t)},addGroupMessage:function(t){var e=t.to?t.to.uid:t.toId,i=Chat.userList.find("a[data-uid="+e+"]"),s=ChatGroups.get(e),a=s.lastTS,n=[];n.push(t);var r=GroupMessage.formate(n);if(r.length){var o=r[0].isSelf||!r[0].name||"system"==r[0].type?"":r[0].name+"：";if(e!=Chat.curUserData.groupId&&1==s.isSilent&&s.newMsgCount&&(o='<span class="silent-number">[<span>'+s.newMsgCount+"条</span>]</span>"+o),r[0].time>=a&&(s.lastMsg=r[0].originalText,s.lastTS=r[0].time,s.lastTime=Chat.getLastTime(r[0].time),s.userName=r[0].name||"",s.userId=r[0].fromId,i.find(".text .gray").html(o+r[0].originalText),i.find(".text .time").text(s.lastTime)),e==Chat.curUserData.groupId){var c=Chat.chatList.innerHeight()+Chat.chatList.scrollTop()>=Chat.chatList.get(0).scrollHeight;r[0].time-a>3e4&&Chat.chatEl.find(".chat-list ul").append(Chat.getGroupMsgItem({type:"time",style:"time",time:r[0].time,text:Chat.dateFormat(new Date(r[0].time),"Z hh:mm")})),Chat.chatEl.find(".chat-list ul").append(Chat.getGroupMsgItem(r[0])),c&&Chat.scrollToBottom()}else r[0].time>a&&i.parents("ul").prepend(i.parents("li"))}},initGroupChat:function(){var t=function(t){var e=$.Deferred();return $.post("/group/chat/updateGroupSetting.json",t,function(t){1==t.resCode?e.resolve():$.toast({type:"error",content:t.resmsg})}),e};Chat.chatEl.on("click",".chat-group-operate .op-settop",function(){var e=$(this),i=Chat.userList.find(".cur"),s=$(this).hasClass("selected")?0:1,a=s?"已置顶，点击取消":"置顶该群",n=s?"已置顶":"已取消置顶",r=s?Chat.userListTop:Chat.userListMain;t({groupId:Chat.curUserData.groupId,watch:s,silent:Chat.curUserData.isSilent}).then(function(){Chat.curUserData.isTop=s;var t=Chat.dateFormat(new Date,"hh:mm");e.toggleClass("selected"),e.find(".tooltip p").text(a),i.find(".time").text(t),i.prependTo(r),$.toast({type:"success",content:n})}),__conversion("group_operate_silent_"+s)}),Chat.chatEl.on("click",".chat-group-operate .op-silent",function(){var e=$(this),i=Chat.userList.find(".cur"),s=$(this).hasClass("selected")?0:1,a=s?"关闭消息免打扰":"开启消息免打扰",n=s?"已开启消息免打扰":"已关闭消息免打扰";t({groupId:Chat.curUserData.groupId,watch:Chat.curUserData.isTop,silent:s}).then(function(){Chat.curUserData.isSilent=s,e.toggleClass("selected"),i.toggleClass("item-silent"),e.find(".tooltip p").text(a),i.find(".notice-badge").length||i.find(".text").append('<span class="notice-badge"></span>'),$.toast({type:"success",content:n})}),__conversion("group_operate_silent_"+s)});var e=function(t){return Utemplate('<div class="group-member-list"><ul><%for(var i=0; i<this.list.length; i++){%><li data-uid="<%this.list[i].userId%>"><img src="<%this.list[i].avatarUrl%>?x-oss-process=image/resize,w_60,limit_0"><p><%this.list[i].name%></p></li><%}%></ul></div><div class="shadow"></div>',{list:t})},i=function(t,e){var i="",s="";1===e.gender?i='<i class="icon-man"></i>':0===e.gender&&(i='<i class="icon-lady"></i>'),1===e.certification&&(s='<i class="icon-approve"></i>');var a=t==_PAGE.uid?'style="visibility:hidden"':"",n=[];e.company&&n.push("<span>"+e.company+"</span>"),e.position&&n.push(e.position);var r=n.length>1?"multi-row":"";return'<p class="card-item-avatar"><img src="'+e.avatarUrl+'?x-oss-process=image/resize,w_220,limit_0" alt=""></p><div class="card-item-panel"><p class="card-info"><span class="name">'+e.nickName+"</span>"+s+i+'</p><p class="card-position '+r+'">'+n.join('<i class="vline"></i>')+'</p><p class="card-description">'+Chat.XssText(e.signature)+"</p><p "+a+' class="card-greet"><a data-uid="'+t+'" class="btn" href="javascript:">打招呼</a> </p></div>'},s=function(t){var e=$.Deferred();return Chat.xhrs.groupMemberChat&&Chat.xhrs.groupMemberChat.abort(),Chat.xhrs.groupMemberChat=$.get("/group/chat/groupUserCard.json",{userId:+t,groupId:Chat.curUserData.groupId},function(t){1==t.resCode?e.resolve(t.data):$.toast({type:"error",content:t.msg})}),e},a=function(t){var e=Chat.chatEl.find(".chat-group-operate");t.on("click",".group-member-list li img",function(){t.find(".member-item-card").length||t.find(".dialog-container").append('<div class="member-item-card"></div>');var a=$(this).parents("li").attr("data-uid"),n=$(this),r=t.find(".member-item-card");s(a).then(function(t){r.html(i(a,t));var s=n.position(),o={left:s.left+35,top:s.top+35};s.left+260>=e.width()&&(o.left=o.left-r.width()),$("body").height()<n.offset().top+175+r.find(".card-item-panel").height()&&(o.top=o.top-170-r.find(".card-item-panel").height()),r.css(o).fadeIn()}),__conversion("group_list_member_detail")}),t.on("click",".member-item-card .btn",function(e){$.post("/group/chat/privateGroup.json",{fromGroupId:Chat.curUserData.groupId,userId:$(this).attr("data-uid")},function(e){if(1==e.resCode){t.remove();var i=$.extend({count:2,lastTS:(new Date).getTime(),lastTime:Chat.getLastTime((new Date).getTime())},e.data);Chat.addNewGroup(i)}else $.toast({type:"error",content:e.msg})}),__conversion("group_member_card_greet")}),t.on("click",".group-member-list",function(e){$(e.target).is("img")||t.find(".member-item-card").hide()}),t.find(".group-member-list").on("scroll",function(){t.find(".member-item-card").hide()})},n=function(t,i){Chat.curUserData.count=i.length,Chat.chatEl.find(".chat-group-operate .item-group-name").text(Chat.curUserData.name+"（"+Chat.curUserData.count+"）"),$.dialog({bind:!0,title:"",content:e(i),closeText:!1,confirmText:!1,cancelText:!1,wrapClass:"group-members-around",opacityLock:!0,onOpen:function(t){var e=Chat.chatEl.find(".chat-group-operate");e.addClass("unfold"),$(t).find(".dialog-container").css({left:e.offset().left,top:e.offset().top+e.height()+1,width:e.innerWidth()}),a($(t))},onResize:function(t){var e=Chat.chatEl.find(".chat-group-operate");$(t).find(".dialog-container").css({left:e.offset().left,top:e.offset().top+e.height()+1,width:e.innerWidth()})},onClose:function(){Chat.chatEl.find(".chat-group-operate").removeClass("unfold")}})};Chat.chatEl.on("click",".chat-group-operate .item-group-name",function(){$(this);$.get("/group/chat/membersInfo.json?groupId="+Chat.curUserData.groupId,function(t){n(0,t.data)})}),Chat.chatEl.on("click",".item-friend .figure img",function(){var t=$(this),e=t.attr("data-uid");e&&s(e).then(function(s){var n='<div class="member-item-card">'+i(e,s)+"</div>";$.dialog({bind:!0,title:"",content:n,closeText:!1,confirmText:!1,cancelText:!1,lock:!0,wrapClass:"members-card-wrap",opacityLock:!0,onOpen:function(e){var i=t.offset().top;$(e).find(".card-item-panel").height()+190+t.offset().top>$("body").height()&&(i=i-$(e).find(".card-item-panel").height()-150),$(e).find(".dialog-container").css({left:t.offset().left+t.width()+15,top:i}),a($(e))},onResize:function(e){var i=t.offset().top;$(e).find(".card-item-panel").height()+190+t.offset().top>$("body").height()&&(i=i-$(e).find(".card-item-panel").height()-150),$(e).find(".dialog-container").css({left:t.offset().left+t.width()+15,top:i})}}),__conversion("group_record_member_detail")})})},getGroupMsgItem:function(t){var e=function(t){if("text"===t.style){var e="";return"received"===t.action&&(e+="<p>",(t.isAdmin||t.fromId==Chat.curUserData.adminId)&&(e+='<span class="item-identity">群主</span>'),e+='<span class="item-name">'+t.name+'</span><span class="item-position gray">'+(t.company||"")+t.position+"</span></p>"),'<div class="group-text">'+e+'<div class="text">'+t.text+"</div></div>"}if("image"===t.type){var i=t.image.tinyImage.width,s=t.image.tinyImage.height,a=t.image.originImage||{};return t.image.tinyImage.width>300&&(s/=Math.floor(i/300),s=Math.floor(s)),'<div class="text"><img class="img-tiny" data-large="'+a.url+'" large-x="'+a.width+'" large-y="'+a.height+'" src="'+t.image.tinyImage.url+'" height="'+s+'"></div>'}return"sticker"===t.type?'<div class="text"><img class="img-tiny" width="'+t.image.origWidth/2+'" " src="'+t.image.origUrl+'" height="'+t.image.origHeight/2+'"></div>':""};return function(t){var i=e(t);if("received"===t.action&&"system"!==t.style){return'<li class="item-friend "><div class="figure">'+(1==t.certification?'<i class="icon-certification"></i>':"")+'<img data-uid="'+t.fromId+'" src="'+t.avatar+'" alt=""></div>'+i+"</li>"}return"sent"===t.action&&"system"!==t.style?'<li class="item-myself">'+i+"</li>":"system"===t.style?'<li class="item-system"><div class="text">'+t.text+"</div></li>":"time"===t.type?'<li class="item-time"><span class="time">'+t.text+"</span></li>":""}(t)},fillGroupHistoryMessage:function(t){var t=Chat.curUserData.page||1,e=Chat.curUserData.groupId,i=function(t){var e=t[0],i=[];return $.each(t,function(t,s){var a,n=new Date(s.time);a=(new Date).getTime()-s.time>864e5?"MM-dd hh:mm":"Z hh:mm",(s.time-e.time>3e5||0===t)&&i.push({type:"time",style:"time",time:s.time,text:Chat.dateFormat(n,a)}),e=s,i.push(s)}),i};Chat.chatList.off("scroll"),$.get("/group/chat/groupHistoryMessages.json",{groupId:e,maxMsgId:1==t?0:Chat.curUserData.maxMsgId||0,count:20,page:t}).success(function(s){if(Chat.curUserData.groupId!=e)return!1;Chat.chatEl.find(".chat-list").css("visibility","visible"),Chat.chatEl.find(".chat-wrap-mask").remove();var a=Chat.chatListCon.find("li:first"),s=JSON.parse(s);if(Chat.curUserData.adminId=s.adminId,s.list.length){var n=GroupMessage.formate(s.list);1==t&&(n=n.reverse());var r,o="";for(n=i(n),r=0;r<n.length;r++)o+=Chat.getGroupMsgItem(n[r]);Chat.chatEl.find(".chat-list ul").prepend(o),1==t&&n.length?Chat.scrollToBottom():Chat.chatList.scrollTop(a.offset().top-Chat.chatList.height()),Chat.curUserData.canLoadingData=s.list.length>19,Chat.messageBarScroll()}else Chat.curUserData.canLoadingData=!1})},addNewGroup:function(t){setTimeout(function(){if(!ChatGroups.get(t.groupId)&&!Chat.userList.find("a[data-uid="+t.groupId+"]").length){ChatGroups.add(t);var e=$(Chat.renderUser(t));Chat.userListMain.prepend(e),Chat.userList.find("a[data-uid="+t.groupId+"]").click(),Chat.containerChat.find(".group-check").show()}Chat.scrollToByUser(t.groupId)},200)},renderGroupBar:function(t){Chat.chatEl.find(".detail-top").append(function(){var e=1==t.isTop?" selected":"";return'<div class="chat-group-cover chat-group-operate"><div class="fr"><span class="op-silent'+(1==t.isSilent?" selected":"")+'"><div class="tooltip"><p class="gray">'+(1==t.isSilent?"关闭消息免打扰":"开启消息免打扰")+'</p></div></span><span class="op-settop'+e+'"><div class="tooltip"><p class="gray">'+(1==t.isTop?"已置顶，点击取消":"置顶该群")+'</p></div></span></div><p><a class="item-group-name" ka="group_chat_members" href="javascript:;">'+t.name+"（"+t.count+"）</a></p></div>"}()),Chat.chatEl.find(".chat-controls").append(function(){return'<div class="chat-group-controls chat-group-cover"></div>'}()),Chat.chatEl.find('.btn-position[link-show="show"]').hide()},renderGroupBox:function(t){var e=t.attr("data-uid"),i=ChatGroups.get(e);Chat.curUserData=i,Chat.chatEl.show(),Chat.welcomeEl.hide(),Chat.userList.find(".cur").removeClass("cur"),t.parent("li").addClass("cur"),Chat.editorEl.removeClass("disabled"),Publisher.editorInput.focus(),Chat.chatList.find(".chat-info").hide(),Chat.chatList.find("ul").empty(),Chat.renderGroupBar(i),Chat.setDraft();var s=Chat.getDraft(e);e&&s.content?(t.find(".draft").remove(),Publisher.editorInput.html(s.content),Publisher.submitBtn.removeClass("btn-disabled"),Publisher.setCursorEnd(Publisher.editorInput.get(0))):(Publisher.editorInput.html(""),Publisher.submitBtn.addClass("btn-disabled")),Chat.curUserData.page=1,Chat.curUserData.maxMsgId=0,Chat.fillGroupHistoryMessage(),Chat.userList.find(".cur .notice-badge").remove(),Chat.userList.find(".cur .silent-number").remove(),Chat.curUserData.maxMessageId&&(ChatWebsocket.sendReadMessage({uid:Chat.curUserData.groupId,mid:Chat.curUserData.maxMessageId}),Chat.curUserData.maxMessageId=null,Chat.setUnReadMessageCount(-1*Chat.curUserData.newMsgCount)),Chat.curUserData.newMsgCount=0},messageBarScroll:function(){Chat.chatList.off("scroll").on("scroll",function(t){if(Chat.curUserData.historyPage||Chat.curUserData.groupId){var e=$(this);Chat.curUserData&&(Chat.timerHistory&&clearTimeout(Chat.timerHistory),Chat.timerHistory=setTimeout(function(){e.scrollTop()<100&&Chat.curUserData.canLoadingData&&(Chat.curUserData.groupId?(Chat.curUserData.page++,Chat.fillGroupHistoryMessage()):(Chat.curUserData.historyPage++,Chat.curUserData.historyLastItem=Chat.chatListCon.find("li").eq(0),Chat.getHistoryMessage({uid:Chat.curUserData.uid,name:Chat.curUserData.name,avatar:Chat.curUserData.avatar},Chat.curUserData.messageMinId,Chat.curUserData.historyPage,t)))},200))}})},unlockMessages:function(t){var e=Chat.curUserData,i={jobId:e.infoData.toPositionId,geekId:e.encryptUid,expectId:e.infoData.encryptExpectId};$.get("/bossweb/block/unlockchat.json",i,function(s){s.chatToast&&$.toast({type:"success",content:s.chatToast}),s.block&&s.blockPageData?Commercial.block(s.blockPageData,function(e,a){var n=$.extend({isPurchase:!0,jobId:e.jobId||i.jobId,business:e.business,targetType:e.targetType},a);Purchase.commercial({jobId:n.jobId,priceId:n.encryptPriceId,targetId:e.encryptTargetId,business:n.business||"",targetType:void 0!=s.blockPageData.targetType?s.blockPageData.targetType:n.targetType},{item:n,success:function(){Chat.unlockMessages(t),"send"==t.from&&Publisher.sendText()}})}):s.block||1!==s.rescode?$.toast({type:"error",content:s.resmsg}):Chat.renderBox(e.uid)})},renderBox:function(uid,eid,el,toggle,e){var uid=uid,el=el||Chat.userList.find('a[data-uid="'+uid+'"]'),eid=eid||el.attr("data-eid"),toggleTabs=Chat.toggleTypeEl.find("span");Chat.chatEl.show(),Chat.welcomeEl.hide(),Chat.chatEl.find(".chat-group-cover").remove(),Chat.chatEl.find('.btn-position[link-show="show"]').show(),$("#page_key_name").val(VersionStatus.preKa+"bpc_chat");var loadType=e&&"click"==e.type?"list":"listload",redDot=Chat.userList.find('a[data-uid="'+uid+'"]').find(".notice-badge").length?"red":"",view="chatview";if(1==Chat.containerChat.find(".data-tab .cur").index()&&(view="infoview"),7==Chat.containerChat.find(".menu-status .show .cur").attr("data-origin")&&(view="fileview2"),uid&&Chat.sendKaEvent("Geekshow_"+loadType+redDot+"_"+Chat.getPublicStatis().context+"_"+view+"_"+uid),Chat.toggleTypeEl.attr("title",""),el&&el.length||!uid||!eid||(Chat.addUser(uid,eid),el=Chat.userList.find('a[data-uid="'+uid+'"]')),toggle&&!toggle.back&&(Chat.filterParms.page>0||Chat.filterParms.status>0||""!=Chat.filterParms.jobid||Chat.filterParms.salary>0||Chat.filterParms.experience>0||Chat.filterParms.degree>0||Chat.filterParms.status>0||Chat.filterParms.origin>0))return Chat.filterParms={page:0,status:"",origin:"",jobid:"",salary:0,experience:0,degree:0},void Chat.getFilterUsers(Chat.filterParms,{uid:uid,eid:eid});toggle&&el.length&&(el.closest(".main-list").length&&Chat.userList.find(".top-list li").length?Chat.userList.scrollTop(el.parent().height()*(el.parent().index()+Chat.userList.find(".top-list li").length)):Chat.userList.scrollTop(el.parent().height()*el.parent().index())),Chat.userList.find("li").removeClass("cur"),el.parent().addClass("cur"),Chat.setDraft();var history=Chat.getDraft(uid);uid&&history.content?(el.find(".draft").remove(),Publisher.editorInput.html(history.content),Publisher.submitBtn.removeClass("btn-disabled"),Publisher.setCursorEnd(Publisher.editorInput.get(0))):(Publisher.editorInput.html(""),Publisher.submitBtn.addClass("btn-disabled")),Chat.chatList.find(".chat-info").html(""),Chat.chatListCon.html(""),Chat.chatBox.find(".notice-dialog").remove(),Chat.toUserId=uid,Chat.curUserData=Chat.usersData[Chat.toUserId],eid&&(Chat.curUserData.encryptUid=eid),Chat.chatList.unbind("scroll"),4==Chat.filterParms.origin?(Chat.tabcontentEls.removeClass("show-box"),Chat.attachContainer.addClass("show-box"),toggleTabs.removeClass("cur"),toggleTabs.eq(2).addClass("cur"),Chat.chatEl.find(".detail-bottom").show()):1==Chat.filterParms.status||5==Chat.filterParms.status?(Chat.tabcontentEls.removeClass("show-box"),Chat.resumeContainer.addClass("show-box"),toggleTabs.removeClass("cur"),toggleTabs.eq(1).addClass("cur"),Chat.chatEl.find(".detail-bottom").show()):Chat.resumeContainer.hasClass("show-box")||Chat.attachContainer.hasClass("show-box")?(Chat.resumeContainer.removeClass("show-box"),Chat.attachContainer.removeClass("show-box"),toggleTabs.removeClass("cur"),toggleTabs.eq(0).addClass("cur"),Chat.chatBox.addClass("show-box"),Chat.chatEl.find(".detail-bottom").hide()):Chat.chatEl.find(".detail-bottom").hide(),Chat.xhrs.detail&&Chat.xhrs.detail.abort(),Chat.xhrs.detail=$.ajax({type:"GET",url:el.attr("data-url"),dataType:"JSON",data:null,success:function(result){var result=result,expandGeekNote=function(){var t=$(".chat-container");t.find(".chat-geek-arrow").on("click",function(){var e=t.find(".chat-geek-remarks p"),i=t.find(".chat-geek-arrow");e.hasClass("expand-p")?(e.removeClass("expand-p"),i.addClass("chat-geek-arrow-expand")):(e.addClass("expand-p"),i.removeClass("chat-geek-arrow-expand"))})};if("string"==typeof result&&(result=eval("("+result+")")),1==result.status){var data=result.data,labels=data.labels,note=data.note,str='<h3 class="name"><p class="tip-text"></p>'+data.name+'</h3><div class="text"><p>'+data.applyStatusDes+"：<span>"+filterXss(data.lastCompany?data.lastCompany:data.school)+'<em class="vline"></em>'+filterXss(data.lastPosition?data.lastPosition:data.major)+"</span>期望职位：<span>"+filterXss(data.position)+'</span><span class="salary">'+data.price+"</span></p><p>"+data.year+'<em class="vline"></em>'+data.edu+'<em class="vline"></em>'+data.city+"</p></div>";if(labels&&labels.length&&(str+='<div class="chat-geek-tag">',$.each(labels,function(t,e){str+="<span>"+e+"</span>"}),str+="</div>"),note&&(str+='<div class="chat-geek-remarks"><div>备注:</div><p class="expand-p">'+note+'</p><div class="chat-geek-arrow"></div></div>'),data.uid!=Chat.curUserData.uid)return;Chat.curUserData.infoData=data,Chat.curUserData.encryptUid=data.encryptUid,Chat.usersData[data.uid].encryptUid=data.encryptUid,Chat.usersData[data.uid].isCloseInterview=data.isCloseInterview,Chat.curUserData.isCloseInterview=data.isCloseInterview,
el.attr("data-eid",data.encryptUid),void 0===data.encryptUid?el.attr("href","/chat/geek/chatinfo?gid="+data.uid):el.attr("href","/chat/geek/chatinfo?uid="+data.encryptUid),Chat.curUserData.messageMinId=0,Chat.curUserData.historyPage=1,Chat.curUserData.canLoadingData=!0,Chat.curUserData.historyLastItem=null,$.extend(Chat.usersData[uid].infoData,data),Chat.setFuntionButton(data),data.resumeVisible?(Chat.toggleTypeEl.find('span[data-target="attachment-container"]').removeClass("gray"),Chat.toggleTypeEl.find(".dropdown-wrap").hide()):(Chat.toggleTypeEl.find('span[data-target="attachment-container"]').addClass("gray"),Chat.toggleTypeEl.find(".dropdown-wrap").show(),data.bothTalked?Chat.toggleTypeEl.find(".dropdown-wrap .dropdown-menu").html('<ul><li data-type="resume"><i class="icon-resume"></i>请求附件简历</li></ul>').css("margin-left","-24px"):Chat.toggleTypeEl.find(".dropdown-wrap .dropdown-menu").html('<p class="gray"><i class="icon-resume"></i>暂无附件简历，在牛人回复后可以向他请求</p>').css("margin-left","-116px")),data.mobileVisible?Chat.opTopEls.find(".dropdown-phone").css("display","inline-block").attr("ka","showmobile_"+Chat.curUserData.uid):Chat.opTopEls.find(".dropdown-phone").css("display","none"),data.weixinVisible?Chat.opTopEls.find(".dropdown-weixin").css("display","inline-block").attr("ka","showwechat_"+Chat.curUserData.uid):Chat.opTopEls.find(".dropdown-weixin").css("display","none"),data.interview?Chat.opTopEls.find(".dropdown-interview").css("display","inline-block").attr("ka","showinterview_"+Chat.curUserData.uid):Chat.opTopEls.find(".dropdown-interview").css("display","none"),Chat.getHistoryMessage({uid:data.uid,name:data.name,avatar:data.avatar},Chat.curUserData.messageMinId,1,e),Chat.chatList.find(".chat-info").html(str),note&&expandGeekNote(),Chat.setRelationStatus(data),setTimeout(function(){Chat.readResumedirect(el)},300),Chat.messageBarScroll()}else-1==result.status?($.toast({content:"已在其他设备删除该联系人",type:"error"}),uid&&Chat.sendKaEvent("friend_deleted_"+uid)):($.toast({content:"数据加载失败，请稍后再试",type:"error"}),uid&&Chat.sendKaEvent("friend_error_"+uid))},error:function(t){}}),Chat.usersData[uid]||Chat.addUser(uid,eid),Chat.curUserData&&(Chat.curUserData.isTop?(Chat.setTopEl.addClass("selected").attr("ka","geek_toping_cancel_"+Chat.curUserData.uid),Chat.setTopEl.find(".tooltip p").text("已置顶，点击取消")):(Chat.setTopEl.removeClass("selected").attr("ka","geek_toping_set_"+Chat.curUserData.uid),Chat.setTopEl.find(".tooltip p").text("置顶联系人")),$(".detail-top .icon-report").attr("data-uid",Chat.curUserData.uid).attr("ka","chat_report_"+Chat.curUserData.uid),Chat.curUserData.mids=[],Chat.curUserData.lastMessage={},Chat.clearMessageCount(Chat.curUserData,Chat.curUserData.newMsgCount))},setTop:function(t){var t=t,e=t.hasClass("selected")?0:1;if(t.hasClass("disabled"))return!1;t.addClass("disabled"),$.ajax({url:"/chat/friendIsTop.json",data:{friendId:Chat.curUserData.uid,isTop:e},type:"post",dataType:"JSON",timeout:5e3,success:function(i){if(i.rescode){var s=Chat.userList.find(".cur"),a=(s.attr("latest-index"),s.index());e?(s.find("a").attr("data-settop",1),t.attr("ka","geek_toping_cancel_"+Chat.curUserData.uid),t.addClass("selected").find(".tooltip p").text("已置顶，点击取消"),Chat.curUserData.isTop=1,Chat.usersData[Chat.curUserData.uid].isTop=1,$.toast({content:"已置顶",type:"success"}),s.prependTo(Chat.userListTop).attr("latest-index",a).find(".time").text(Chat.dateFormat(new Date,"hh:mm"))):(s.find("a").removeAttr("data-settop"),t.attr("ka","geek_toping_set_"+Chat.curUserData.uid),t.removeClass("selected").find(".tooltip p").text("置顶联系人"),Chat.curUserData.isTop=0,Chat.usersData[Chat.curUserData.uid].isTop=0,s.prependTo(Chat.userListMain).find(".time").text(Chat.dateFormat(new Date,"hh:mm")),$.toast({content:"已取消置顶",type:"success"}))}else $.confirm({content:i.resmsg,title:"温馨提示",closeIcon:!0,columnClass:"",autoClose:"confirm|4000"});t.removeClass("disabled")},error:function(t){}})},toggleUser:function(data,message){var sideEl=$(".side-menu"),data=data;sideEl.find("dl").removeClass("cur"),sideEl.find(".menu-chat").click().addClass("cur"),$(".page-container").hide(),$(".chat-container").show(),$("body").removeClass("page-iframe"),Menu.setUrl("chat"),Chat.groupHistory[-1]=data.uid;var setUserChecked=function(){chatUserPresenter.flushJob(),Menu.toggleTopMenu("top-chat")};Chat.usersData[data.uid]||void 0===data.jid?setUserChecked():$.ajax({type:"POST",url:"/chat/addRelation.json",dataType:"JSON",data:{gid:data.uid,jid:data.jid,expectId:data.expectId},success:function(result){var result=result;"string"==typeof result&&(result=eval("("+result+")")),1==result.status&&$.ajax({type:"GET",url:"/chat/geek.json?uid="+data.uid,dataType:"JSON",data:null,success:function(result){var result=result;if("string"==typeof result&&(result=eval("("+result+")")),1==result.status){var data=result.data,userInfo={avatar:data.avatar,isTop:0,lastTime:data.lastTime,name:data.name,sex:0,newMsgCount:0,uid:data.uid,encryptUid:data.encryptUid,lastTS:(new Date).getTime()};Chat.usersData[data.uid]=userInfo,Chat.usersData[data.uid].infoData=data,setUserChecked()}else $.toast({content:"数据加载失败，请稍后再试",type:"error"})},error:function(t){}})},error:function(t){}}),setTimeout(function(){$("#page_key_name").val(VersionStatus.preKa+"bpc_chat")},10)},getHistoryMessage:function(info,maxId,page,e){page>1&&Chat.hisLoading.show(),1==page&&Chat.editorEl.addClass("disabled"),Chat.xhrs.history&&Chat.xhrs.history.abort(),Chat.xhrs.history=$.ajax({url:"/chat/historymsg.json",type:"GET",data:{gid:info.uid,maxMsgId:maxId,c:20,page:page},dataType:"JSON",timeout:2e4,success:function(result){var result=result;if("string"==typeof result&&(result=eval("("+result+")")),1==result.type&&result.messages){var len=result.messages.length,i,message,timeMessage;if(len>0){if(Chat.curUserData.historyLastItem)for(i=len-1;i>=0;i--)message=result.messages[i],message.mSource="server",message.typeSource="history",timeMessage||4==message.type||4==message.body.type||message.uncount||(timeMessage=message),ChatWebsocket.receiveTextMessage(message);else{for(i=0;i<len;i++)message=result.messages[i],message.mSource="server",message.typeSource="history",timeMessage||4==message.type||4==message.body.type||message.uncount||(timeMessage=message),ChatWebsocket.receiveTextMessage(message),message.from.uid==Chat.curUserData.uid&&(Chat.curUserData.maxMessageId=result.messages[i].mid);1==page&&(Chat.editorEl.removeClass("disabled"),1!=Chat.containerChat.find(".data-tab .cur").index()&&Publisher.editorInput.focus())}if(timeMessage&&Chat.showTimeLine(timeMessage,!0,!0),len>19){Chat.chatList.find(".chat-info").hide();var $record=Chat.chatEl.find(".chat-list");$record.innerHeight()>=$record.prop("scrollHeight")?(Chat.curUserData.historyPage=page+1,Chat.curUserData.canLoadingData=!1,Chat.getHistoryMessage(info,result.messages[0].mid,Chat.curUserData.historyPage,e)):setTimeout(function(){Chat.curUserData.canLoadingData=!0},300)}else Chat.curUserData.canLoadingData=!1,Chat.chatList.find(".chat-info").fadeIn(),1==page&&Chat.scrollToBottom();Chat.curUserData.messageMinId=result.messages[0].mid}if(Chat.curUserData.historyLastItem)try{Chat.chatList.scrollTop(Chat.curUserData.historyLastItem.offset().top-Chat.chatList.height())}catch(t){}}else Chat.curUserData.canLoadingData=!1,Chat.chatList.find(".chat-info").fadeIn();1==page&&Chat.curUserData.maxMessageId&&(Chat.websocketConnected?Chat.sendReadMessage({userData:Chat.curUserData,uid:Chat.curUserData.uid,mid:Chat.curUserData.maxMessageId}):(Chat.interConnect&&clearInterval(Chat.interConnect),Chat.interConnect=setInterval(function(){Chat.websocketConnected&&(Chat.sendReadMessage({userData:Chat.curUserData,uid:Chat.curUserData.uid,mid:Chat.curUserData.maxMessageId}),clearInterval(Chat.interConnect))},1e3))),Chat.editorEl.removeClass("disabled"),Chat.hisLoading.hide()},error:function(t){Chat.curUserData.canLoadingData=!0,Chat.hisLoading.hide(),Chat.editorEl.removeClass("disabled"),Publisher.editorInput.focus()}}),$.when(Chat.xhrs.history).then(function(){var t=Chat.chatEl.find(".toggle-type span[data-target=attachment-container]"),e=Chat.containerChat.find(".op-category .cur").attr("data-origin"),i=Chat.chatEl.find(".toggle-type span[data-target=resume-container]");(1==Chat.containerChat.find(".op-category .cur").attr("data-status")||1==Chat.groupStatus||5==Chat.groupStatus)&&page<2?i.trigger("click"):!t.hasClass("gray")&&4==e&&page<2?t.trigger("click"):(Chat.chatEl.find(".chat-list").css("visibility","visible"),setTimeout(function(){"chat-box"==Chat.toggleTypeEl.find(".cur").attr("data-target")&&Chat.chatEl.find(".chat-wrap-mask").remove()},10))}),Chat.curUserData.canLoadingData=!1},getUserInfo:function(uid,callback){$.ajax({url:"/chat/geek.json",data:{uid:uid},dataType:"JSON",timeout:5e3,success:function(e){"string"==typeof e&&(e=eval("("+e+")")),callback(e)},error:function(t){callback({status:0,msg:"系统错误"})}})},isNewGeek:function(t){var e=Chat.usersData[t];return 1==(e.infoData?e.infoData.newGeek:e.newGeek)},totalNewGeek:function(){var t=Chat.containerChat.find(".op-category a[data-status=5]");Chat.notification[5].length>0?t.find("span").html("(<em>"+Chat.notification[5].length+"</em>)"):t.find("span").text("")},addNewGeekUser:function(t){Chat.newGeek.indexOf(t)<0&&Chat.newGeek.push(t),Chat.totalNewGeek()},addToUserList:function(t){var e=Chat.usersData[t],i=Chat.usersID.filter(function(e){return e.uid==t});8==e.relationType||i.length||Chat.usersID.push({uid:e.uid,name:e.name,avatar:e.avatar,lastMsg:e.lastMsg})},addUser:function(t,e,i){var s={},a=[-1,1,5],n=Chat.containerChat.find(".op-category .cur"),r=function(){var e=Chat.renderUser(s),i=Chat.usersData[t],a=Chat.getGroupStatus(),n=i.newGeek?i.newGeek:i.infoData.newGeek;(n||"-1"==a&&8!=i.relationType||a==i.relationType)&&!Chat.filterGroup&&$(e).prependTo(Chat.userListMain),1==n&&Chat.addNewGeekUser(s.uid),Chat.setGroupPoint(s.uid),Chat.addToUserList(t)};if(!(t&&t<1001||i&&i.to&&i.to.uid<1001)){if(t&&Chat.usersData[t])s=Chat.usersData[t];else if(i){var o=i.from.uid==Chat.myselfData.uid?i.to:i.from;s={avatar:o.avatar,fromSource:i.mSource,isTop:0,lastTime:i.time,name:o.name,sex:0,newMsgCount:0,uid:o.uid,encryptUid:e,lastTS:i.time};var c="",l=s.lastTime,d=new Date,h=new Date(d.getFullYear(),d.getMonth(),d.getDate()),u=h-l;if(c=d.getFullYear()!=new Date(l).getFullYear()&&d.getFullYear()-new Date(l).getFullYear()>1?d.getFullYear()-new Date(l).getFullYear()+"年前":u>864e5?Chat.dateFormat(new Date(l),"MM月dd日"):u>0?"昨天":Chat.dateFormat(new Date(l),"hh:mm"),Chat.usersData[t]=s,s.lastTime=c,i.offline)return;Chat.getUserInfo(t,function(e){if(1==e.status){var o=e.data,c=!1;o.lastTS=i.time,Chat.usersData[t].infoData=o,Chat.usersData[t].relationType=o.relationType||0,Chat.usersTempData.length||(Chat.usersTempData[0]=[],c=!0),Chat.usersTempData[0].unshift(o),s.encryptUid=o.encryptUid,s.uid!=Chat.myselfData.uid&&(a.indexOf(Chat.groupStatus)>-1||1==n.attr("data-val"))&&(r(e.newGeek),c&&(Chat.containerChat.find(".data-tips").hide(),Chat.containerChat.find(".user-list").show(),Chat.containerChat.find(".chat-search").show(),Chat.detailContainer.show(),Chat.welcomeEl.show()))}else-1==e.status&&(Chat.usersData[t]=null,t&&Chat.sendKaEvent("friend_deleted_add_"+t))})}s.orderNum=Chat.chatUserCount,Chat.chatUserCount++,s.encryptUid&&s.uid!=Chat.myselfData.uid&&(a.indexOf(Chat.groupStatus)>-1||1==n.attr("data-val"))&&r()}},addUserMsgBox:function(t,e){},showMessage:function(message){if(_PAGE.runChat&&message){12==message.body.type&&1==message.body.hyperLink.hyperLinkType&&(message.body.text=message.body.hyperLink.text),20==message.body.type&&(message.body.text="[动画表情]");var base=Chat.showMessageBase(message),messageHtml="";switch(message.body.type){case 1:3==message.body.templateId||6==message.body.templateId?(messageHtml=this.showSystemMessage(message),"请先填写接收附件简历邮箱"==message.body.text&&Chat.showSetEmail(function(){Chat.exchangeResume(1,{from:{uid:Chat.curUserData.uid}})})):messageHtml=this.showTextMessage(message);break;case 2:message.isSelf||(message.body.text="收到语音消息，请登录APP端查收",messageHtml=this.showSystemMessage(message));break;case 3:if(1==message.body.templateId){if(message.body.image){var tinyData=message.body.image.tinyImage,originData=message.body.image.originImage;message.body.text='<img src="'+tinyData.url+'" class="img-tiny" width="'+(tinyData.width>originData.width?originData.width:tinyData.width)+'" height="'+(tinyData.height>originData.height?originData.height:tinyData.height)+'" data-large="'+originData.url+'" large-x="'+originData.width+'" large-y="'+originData.height+'" />'}messageHtml=this.showTextMessage(message)}break;case 4:if(20==message.body.action.aid){var extend=eval("("+message.body.action.extend+")");Chat.setDialogMessageDomStatus(extend.msg_id)}else if(27==message.body.action.aid)message.body.text="请求交换联系方式已发送",messageHtml=this.showSystemMessage(message);else if(32==message.body.action.aid)message.body.text="请求交换微信已发送",messageHtml=this.showSystemMessage(message);else if(37==message.body.action.aid){var email=_PAGE.email;if(message.body.action.extend&&message.body.action.extend.indexOf("{")>-1){var extend=eval("("+message.body.action.extend+")");email=extend.resumeEmail}message.body.text="简历请求已发送。如果牛人同意，TA的简历将发送到{"+email+"}!",messageHtml=this.showSystemMessage(message)}break;case 7:message.isSelf?0==message.body.dialog.type||4==message.body.dialog.type&&(base.userData.isCloseInterview=!0):2==message.body.dialog.type||1==message.body.dialog.type||11==message.body.dialog.type||0==message.body.dialog.type?messageHtml=this.showDialogMessage(message):9==message.body.dialog.type?(message.body.text="面试时间到",messageHtml=this.showSystemMessage(message)):(message.body.text="收到一条消息，请在手机上查看。",messageHtml=this.showSystemMessage(message));break;case 12:var hyperLinkType=message.body.hyperLink.hyperLinkType;if(2==hyperLinkType&&(message.body.hyperLink.text.indexOf("面试提醒")>-1||message.body.hyperLink.text.indexOf("面试邀请")>-1)&&message.to.uid==Chat.myselfData.uid)message.body.text=message.body.hyperLink.text,messageHtml=this.showSystemMessage(message),Chat.opTopEls.find(".dropdown-interview").css("display","inline-block"),PageSet.markerInfo[11]&&Chat.flashTip(Chat.opTopEls.find(".dropdown-interview"),"在这里查看面试信息",11);else if(3==hyperLinkType&&message.to.uid==Chat.myselfData.uid)message.body.text=message.body.hyperLink.text,messageHtml=this.showSystemMessage(message);else if(1==hyperLinkType)message.body.text="附件简历已经发送到您的邮箱",messageHtml=this.showTextMessage(message),Chat.toggleTypeEl.find('span[data-target="attachment-container"]').removeClass("gray"),Chat.toggleTypeEl.find(".dropdown-wrap").css("display","none"),PageSet.markerInfo[10]&&Chat.flashTip(Chat.toggleTypeEl.find('span[data-target="attachment-container"]'),"在这里查看已收到的简历",10);else if(6===hyperLinkType){var p2=this.getRemarksAndTagType(message);this.joinSystemMessage(message,p2),messageHtml=this.showSystemMessage(message)}break;case 14:messageHtml=this.showInterviewMessage(message);break;case 16:3==message.type&&1==message.body.templateId?message.body.text="收到一条消息，请在手机上查看。":message.body.text="该牛人正在使用提问加油卡寻求你的帮助，可登录app查看。",messageHtml=this.showSystemMessage(message);break;case 20:if(1==message.body.templateId||20==message.body.type){var packId=message.body.sticker.packId,sid=message.body.sticker.sid;if(message.body.sticker&&message.body.sticker.image){var originData=message.body.sticker.image.originImage,tinyData=message.body.sticker.image.tinyImage,extraStr="";if(0==packId){var isCollected=!1;if(Chat.storedEmtions)for(var k=0;k<Chat.storedEmtions.length;k++)Chat.storedEmtions[k].itemId==sid&&(isCollected=!0);isCollected||(extraStr='<span class="btn-store" data-origin="'+originData.url+'" data-packId="'+packId+'" data-sid="'+sid+'">添加表情</span>')}message.body.text='<img src="'+originData.url+'"  class="img-tiny" width="'+originData.width/2+'" height="'+originData.height/2+'"/>'+extraStr}messageHtml=this.showTextMessage(message)}break;case 99:messageHtml=this.showSystemMessage(message);break;default:message.body.text="收到一条消息，请在手机上查看。",messageHtml=this.showSystemMessage(message)}99==message.body.type&&message.from.uid==Chat.curUserData.uid&&0==Chat.chatListCon.find("#temp-"+message.mid).length?($(messageHtml).appendTo(Chat.chatListCon),Chat.scrollToBottom()):(message.from.uid==Chat.myselfData.uid&&message.to&&message.to.uid==Chat.curUserData.uid||message.to&&message.to.uid==Chat.myselfData.uid&&message.from.uid==Chat.curUserData.uid)&&(messageHtml&&message.from.uid==Chat.curUserData.uid||message.from.uid==Chat.myselfData.uid)&&(Chat.curUserData.historyLastItem&&"history"==message.typeSource&&0==Chat.chatListCon.find("#temp-"+message.mid).length?($(messageHtml).prependTo(Chat.chatListCon),Chat.showTimeLine(message,!0)):message.offline||0!=Chat.chatListCon.find("#temp-"+message.mid).length||(Chat.showTimeLine(message),$(messageHtml).appendTo(Chat.chatListCon),Chat.scrollToBottom()),message.from.uid!=Chat.curUserData.uid||Chat.curUserData.lastMessage[message.mid]||(Chat.curUserData.lastMessage[message.mid]=!0))}},flashTip:function(t,e,i){var s=$('<div class="tooltip"><p class="gray">'+e+"</p></div>");if(t.find(".tooltip").length<1){t.prepend(s);var a=t.width()/2-s.width()/2;t.find(".tooltip").css({left:a,display:"inline-block"})}PageSet.markerInfo[i]&&$.ajax({url:"/setting/notify/set.json",type:"POST",data:{type:i},dataType:"JSON",timeout:5e3,success:function(t){},error:function(t){}}),setTimeout(function(){t.find(".tooltip").remove()},3e3),PageSet.markerInfo[i]=!1},showMessageOther:function(t){if(_PAGE.runChat&&t){var e=null;switch(t.body.type){case 1:1==t.body.templateId?Chat.showMessage(t):3==t.body.templateId||7==t.body.templateId||6==t.body.templateId?Chat.showMessage(t):5==t.body.templateId&&t.to.uid==Chat.myselfData.uid&&(t.body.text=t.body.text.replace(/\<\/?[a-zA-Z]+\>/g,"").replace(/<\/?phone>/g,"").replace(/<\/?copy>/g,"").replace(/&lt;phone&gt;/g,"").replace(/&lt;\/phone&gt;/g,"").replace(/&lt;copy&gt;/g,"").replace(/&lt;\/copy&gt;/g,""),Chat.showMessageBase(t),e=Chat.showSystemMessage(t),t.body.text.indexOf("微信号")>-1?(Chat.opTopEls.find(".dropdown-weixin").css("display","inline-block"),PageSet.markerInfo[12]&&Chat.flashTip(Chat.opTopEls.find(".dropdown-weixin"),"在这里查看已经交换的微信",12)):t.body.text.indexOf("手机号")>-1&&(Chat.opTopEls.find(".dropdown-phone").css("display","inline-block"),PageSet.markerInfo[9]&&Chat.flashTip(Chat.opTopEls.find(".dropdown-phone"),"在这里查看已经交换的电话",9)));break;case 4:if(!t.body.action)break;30==t.body.action.aid?Chat.outputData[t.body.action.aid]=JSON.parse(t.body.action.extend):31==t.body.action.aid?Chat.outputData[t.body.action.aid]=JSON.parse(t.body.action.extend):35==t.body.action.aid?Chat.outputData[t.body.action.aid]=JSON.parse(t.body.action.extend):47==t.body.action.aid||67==t.body.action.aid||63==t.body.action.aid||50==t.body.action.aid||61==t.body.action.aid||70==t.body.action.aid&&""!=t.body.action.extend&&(alert("您的账号当前处于不可使用状态，请登录BOSS直聘手机APP查看详情"),window.location.href="/logout/?toUrl=/user/security/blocktip.html");break;case 8:Chat.showMessageBase(t);break;case 10:Chat.showMessageBase(t),t.isSelf?t.body.text="发出一个红包，请登录APP查看":t.body.text="收到红包消息，请登录APP端查收",e=Chat.showSystemMessage(t);break;case 14:Chat.showMessage(t);break;case 16:1==t.body.templateId&&Chat.showMessage(t)}99==t.body.type&&t.from.uid==Chat.curUserData.uid&&0==Chat.chatListCon.find("#temp-"+t.mid).length?($(e).appendTo(Chat.chatListCon),Chat.scrollToBottom()):(t.from.uid==Chat.myselfData.uid&&t.to.uid==Chat.curUserData.uid||t.to.uid==Chat.myselfData.uid&&t.from.uid==Chat.curUserData.uid)&&(e&&t.from.uid==Chat.curUserData.uid||t.from.uid==Chat.myselfData.uid)&&(Chat.curUserData.historyLastItem&&"history"==t.typeSource&&0==Chat.chatListCon.find("#temp-"+t.mid).length?($(e).prependTo(Chat.chatListCon),Chat.showTimeLine(t,!0)):t.offline||0!=Chat.chatListCon.find("#temp-"+t.mid).length||(Chat.showTimeLine(t),$(e).appendTo(Chat.chatListCon),Chat.scrollToBottom()),t.from.uid!=Chat.curUserData.uid||Chat.curUserData.lastMessage[t.mid]||(Chat.curUserData.lastMessage[t.mid]=!0))}},updateMessagePage:function(t){if(Chat.propMessages.push(t),window.location.href.indexOf("/boss/item/myItemList.html")>-1){var e=$(".frame-container").contents().find(".op-category"),i=e.find('a[data-type="notice"]'),s=null;if(!e.length)return;if(s=$(".frame-container").get(0).contentWindow,i.hasClass("cur"))return;if(i.append('<i class="dot"></i>'),s)try{s.ZhiBean.propNoticeList(1)}catch(t){}}},showInterviewMessage:function(t){if(4!=t.type){var e=t.from.uid==Chat.myselfData.uid,i=e?"item-myself":"item-friend",s=t.pushText.replace(t.from.name,"").replace("给你",""),a="",n=s.indexOf("取消")>-1?'<i class="icon-interview-cancel"></i>':'<i class="icon-interview-send"></i>',r=s+n;return e||(n=s.indexOf("接受")>-1?'<i class="icon-interview-accept"></i>':'<i class="icon-interview-reject"></i>',r=n+s,a='<div class="figure"><img src="'+t.from.avatar+'" alt=""></div>'),'<li class="'+i+'">'+a+'<div class="text">'+r+"</div></li>"}},showTextMessage:function(t){var e="",i="",s="",a="",n=t.body.text?t.body.text:t.pushText,r=t.time,o=this.messageConverToHtml(filterXss(n)).replace(/&amp;middot;/g,"&#183;").replace(/&amp;lt;/g,"&#60;").replace(/&amp;gt;/g,"&#62;"),c="temp-"+(t.tempID?t.tempID:r);if("newSubmit"==t.typeSource&&(o=this.messageConverToHtml(filterXss(t.body.text)).replace(/&amp;lt;/g,"&#60;").replace(/&amp;gt;/g,"&#62;").replace(/&middot;/g,"")),t.from.uid==Chat.myselfData.uid){if("history"==t.typeSource)switch(i='<i class="status"></i>',t.status){case 0:case 1:e="status-delivery";break;case 2:e="status-read";break;default:e="",i=""}else"newSubmit"==t.typeSource?(s='id="'+c+'"',i='<i class="status"></i>'):t.from.uid==Chat.myselfData.uid&&(e="status-delivery",i='<i class="status"></i>');var l=Chat.messageStatusData[t.to.uid];return l||(l=Chat.messageStatusData[t.to.uid]={}),t.mid?(s='id="temp-'+t.mid+'"',l[t.mid]={}):(Chat.messageStatusDataTemp[t.tempID]=t.to.uid,l[t.tempID]={tempID:t.tempID}),"<li "+s+' class="item-myself '+e+'"><div class="figure"></div><div class="text">'+i+o+"</div></li>"}return t.mid&&(s='id="temp-'+t.mid+'"'),3==t.body.type&&1==t.body.templateId&&t.body.image&&(a="item-image"),12==t.body.type&&1==t.body.templateId&&t.body.hyperLink&&1==t.body.hyperLink.hyperLinkType&&(a="item-file",o=Chat.revertFilenameToIcon(t.body.hyperLink.text)+'<p data-origin="'+t.body.hyperLink.url+'"><b>'+t.body.hyperLink.text+"</b>"+t.body.text+"</p>"),("您收到一条来自该牛人的消息"===o||"您收到了来自该牛人的消息"===o||t.encryptedBody)&&(o+='<a href="javascript:;" class="msg-item-unlock">点击解锁</a><i class="icon-msg-lock"></i>'),"<li "+s+' class="item-friend '+a+'"><div class="figure"><img src="'+t.from.avatar+'" alt="" /></div><div class="text">'+o+"</div></li>"},showSystemMessage:function(t){if(t.body.text){return'<li class="item-system" id="temp-'+(t.mid||t.time)+'"><div class="text">'+t.body.text+"</div></li>"}},getRemarksAndTagType:function(t){var e=/&ba=([^&]+)/,i=decodeURIComponent(t.body.hyperLink.url);return(i.match(e)?JSON.parse(i.match(e)[1]):"").p2},joinSystemMessage:function(t,e){var i="",s=t.body.hyperLink.text.split(" ");s.length;s.pop();var a=s.join(" ");1===e?i="更新标签："+a:2===e?i="更新备注："+a:3===e&&(i="备注信息仅您自己可见"),t.body.text=i},showDialogMessage:function(t){var e,i,s="",a="",n="";switch(t.body.dialog.type){case 0:s="item-phone",a="icon-contact";break;case 1:s="item-weixin",a="icon-weixin";break;case 2:s="item-resume",a="icon-resume";break;case 11:s="item-phone",a="icon-contact"}Chat.setLatestDialog(t),t.body.dialog.operated&&(n="disabled"),e=$('<li class="item-friend '+s+'"><div class="figure"><img src="'+t.from.avatar+'" alt="" /></div><div class="text"><i class="'+a+'"></i>'+this.messageConverToHtml(t.body.dialog.text)+'<i class="icon-arow-right"></i><span class="op"><a href="javascript:;" class="link-agree '+n+'">同意</a><a href="javascript:;" class="link-refuse '+n+'">拒绝</a></span></div></li>'),t.body.dialog.operated||t.from.uid!=Chat.curUserData.uid||(i=$('<div class="notice-dialog" data-type="'+t.body.dialog.type+'"><div class="op"><span class="btn btn-refuse">拒绝</span><span class="btn btn-agree '+n+'">同意</span></div><div class="text">'+this.messageConverToHtml(t.body.dialog.text)+"</div></div>"),"history"==t.typeSource&&Chat.checkDialogMessage(t),i.appendTo(Chat.chatBox));var r=function(a){var a=a;if(a.hasClass("disabled"))return!1;e.find(".link-agree,.link-refuse").addClass("disabled"),"item-phone"==s&&(a.hasClass("link-agree")||a.hasClass("btn-agree")?Chat.exchangePhone(1,t,i,e):Chat.exchangePhone(0,t,i,e)),"item-weixin"==s&&(a.hasClass("link-agree")||a.hasClass("btn-agree")?Chat.exchangeWeixin(1,t,i,e):Chat.exchangeWeixin(0,t,i,e)),"item-resume"==s&&(a.hasClass("link-agree")||a.hasClass("btn-agree")?Chat.exchangeResume(1,t,i,e):Chat.exchangeResume(0,t,i,e))};return e.on("click",".link-agree,.link-refuse",function(t){r($(this))}),i&&(i.on("click",".btn",function(t){r($(this))}),i.on("click",".close",function(){i.remove()})),e},setLatestDialog:function(t){var e=t.body.dialog.type,i=t.body.dialog.operated,s=t.mid;Chat.curUserData&&(Chat.curUserData.latestDialogs||(Chat.curUserData.latestDialogs={}),Chat.curUserData.latestDialogs[e]||(Chat.curUserData.latestDialogs[e]={}),!i&&Chat.curUserData.latestDialogs[e].mid&&s<Chat.curUserData.latestDialogs[e].mid||(Chat.curUserData.latestDialogs[e].mid=s,Chat.curUserData.latestDialogs[e].operated=i))},checkDialogMessage:function(t){var e=t.body.dialog.type,i=t.body.dialog.operated,s=t.mid;return!(!i&&Chat.curUserData.latestDialogs&&Chat.curUserData.latestDialogs[e]&&Chat.curUserData.latestDialogs[e].mid&&s<Chat.curUserData.latestDialogs[e].mid)},showHistoryData:function(t){var t=t;if(Chat.chatHistoryData[t]){var e,i=Chat.chatHistoryData[t].chatList,s='<li class="item-time item-history-line"><span class="time">点此查看历史消息</span></li>';if(i.length>0){for(e=0;e<i.length;e++)s+=i[e];return $(s).appendTo(Chat.chatListCon),Chat.sendReadMessage({userData:Chat.curUserData,uid:t,mid:0}),Chat.scrollToBottom(),!0}}},setHistoryData:function(t,e){var i;t.typeSource,t.from.uid==Chat.myselfData.uid?i=t.to.uid:t.to.uid==Chat.myselfData.uid&&(i=t.from.uid),Chat.chatHistoryData[i]||(Chat.chatHistoryData[i]={chatList:[]});var s=Chat.chatHistoryData[i].chatList;s.length>10&&Chat.chatHistoryData[i].chatList.shift(),Chat.chatHistoryData[i].chatList.push(e)},setDialogMessageDomStatus:function(t,e){t&&Chat.chatListCon.find("#temp-"+t).find(".btn").addClass("disabled").unbind("click")},messageConverToHtml:function(t){if(!t)return"";var e=Emotion.textCodeToImg(t);if(/^<img src="/.test(e))e=e.replace("&lt;","<").replace("&gt;",">");else{var i=/^(?!(http|https)).*/.test(e)?"http://":"";e=e.replace(/(((^https?:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)$/g,"<a href='"+i+"$1' target='_blank'>$1</a>")}return t?e.replace(/\n/g,"<br/>").replace(/\\n/g,"<br/>"):""},setTextMessageDomStatus:function(t,e,i,s){if(Chat.curUserData.uid==t){var a,n=Chat.messageStatusData[t];if(n)if(e&&i&&(n[e]=n[i],a=Chat.chatListCon.find("#temp-"+n[i].tempID),delete n[i],delete Chat.messageStatusDataTemp[i]),e&&!i&&(a=Chat.chatListCon.find("#temp-"+e)),"read"==s)Chat.chatListCon.find(".status-delivery").removeClass("status-delivery").addClass("status-read");else if(s){var r=n[e||i];if(!r)return;a.attr("class",a.attr("class").replace(/status\-/g,"")).addClass("status-"+s),e&&a.attr("id","temp-"+e),"error"==s&&(delete n[r.tempID],delete n[e])}}},sendReadMessage:function(t){t.mid&&t.uid!=Chat.myselfData.uid&&ChatWebsocket.sendReadMessage({uid:t.uid,mid:t.mid,callback:function(e){t.curUserData.maxMessageId=null}})},getOutputData:function(){return Chat.outputData},sendTextMessage:function(t){t.noWebsocket;PageSet.hasShowReplyTip||Chat.curUserData.groupId||5!=Chat.curUserData.infoData.relationType||Chat.chatListCon.find(".item-myself").length||(Chat.workflowTip(null,1),PageSet.hasShowReplyTip=!0);var e={};e=t.body.sticker?Chat.protobufMessage.createMessage.graphic(t):Chat.protobufMessage.createMessage.text(t),Chat.curUserData.groupId?Chat.addGroupMessage(t):Chat.showMessage(t),ChatWebsocket.send(e)},setUnReadMessage:function(t){Chat.unReadMessage[t.mid]||(Chat.unReadMessage[t.mid]=t)},checkUnreadMessage:function(){var t,e=Chat.unReadMessage;for(var i in e)t=e[i].from.uid,8==Chat.usersData[t].relationType&&Chat.setUnReadMessageCount(-1)},getTopInfo:function(t){var t=t,e="",i="";if(t.parent().hasClass("dropdown-phone"))e="/chat/query/exchangephone.json",i="电话";else if(t.parent().hasClass("dropdown-weixin"))e="/chat/query/exchangeweixin.json",i="微信";else if(t.parent().hasClass("dropdown-interview"))return e="/chat/query/interviewschedule.json",i="面试信息",t.parent().find(".dropdown-menu").remove(),Publisher.interview(t,"dialog-down-default interview-message-dialog"),!0;t.parent().find(".dropdown-menu").html('<p class="gray"><i class="icon-toast-loading"></i><span>请稍后</span></p>'),$.ajax({url:e,data:{uid:Chat.curUserData.encryptUid},dataType:"JSON",timeout:3e4,success:function(e){var e=e;e.rescode?(e.phone&&t.parent().find(".dropdown-menu").html('<p class="gray"><i class="icon-contact"></i>'+e.phone+"</p>"),e.weixin&&t.parent().find(".dropdown-menu").html('<p class="gray"><i class="icon-weixin"></i>'+e.weixin+"</p>"),e.data&&e.data.appointmenttime,"电话"==i&&""==e.phone&&t.parent().find(".dropdown-menu").html('<p class="gray"><span>获取电话失败</span></p>'),"微信"==i&&""==e.weixin&&t.parent().find(".dropdown-menu").html('<p class="gray"><span>获取微信失败</span></p>'),"面试信息"!=i||e.data&&e.data.appointmenttime||t.parent().find(".dropdown-menu").html('<p class="gray"><span>获取面试信息失败</span></p>')):t.parent().find(".dropdown-menu").html('<p class="gray"><span>获取'+i+"失败</span></p>")},error:function(e){t.parent().find(".dropdown-menu").html('<p class="gray"><span>获取'+i+"失败</span></p>")}})},exchangeWeixin:function(t,e,i){var s="",a={},n="";switch(t){case 1:var r=e.body.dialog.buttons[0].url.match(/%3C(.+)%3E/);r&&(n=r[1]),s="/chat/acceptWeixin.json",a={to:e.from.uid,mid:e.mid,aid:33,action:0,extend:n};break;case 0:s="/chat/rejectWeixin.json",a={to:e.from.uid,mid:e.mid,aid:34,action:1};break;case 2:s="/chat/requestWeixin.json",a={to:e.from.uid}}$.ajax({url:s,data:a,dataType:"JSON",cache:!1,timeout:3e4,success:function(s){2==t&&1==s.result?(Chat.mids[s.mid]="RequestWeixin",Chat.showMessage({time:(new Date).getTime(),from:e.from,body:{type:99,text:"请求交换微信已发送"}})):2==s.result?Chat.showSetWeixin(function(){Chat.exchangeWeixin(t,e,i)}):(Chat.showMessage({time:(new Date).getTime(),from:e.from,body:{type:99,text:s.msg}}),i&&i.remove(),1==t&&1==s.result&&Chat.opTopEls.find(".dropdown-weixin").css("display","inline-block"))},error:function(t){Chat.showMessage({time:(new Date).getTime(),from:e.from,to:e.to,body:{type:99,text:"系统错误!"}})}})},exchangePhone:function(t,e,i){var s="",a={};switch(t){case 1:s="/chat/acceptContact.json",a={to:e.from.uid,mid:e.mid,aid:28,action:0};break;case 0:s="/chat/rejectContact.json",a={to:e.from.uid,mid:e.mid,aid:29,action:1};break;case 2:s="/chat/requestContact.json",a={to:e.from.uid}}$.ajax({url:s,data:a,dataType:"JSON",cache:!1,timeout:3e4,success:function(s){2==t&&1==s.result?(Chat.mids[s.mid]="RequestPhone",Chat.showMessage({time:(new Date).getTime(),from:e.from,body:{type:99,text:"请求交换联系方式已发送"}}),i&&i.remove()):1!=s.result?(Chat.showMessage({time:(new Date).getTime(),from:e.from,to:e.to,body:{type:99,text:s.msg}}),i&&i.remove()):(i&&i.remove(),1==t&&1==s.result&&Chat.opTopEls.find(".dropdown-phone").css("display","inline-block"))},error:function(t){Chat.showMessage({time:(new Date).getTime(),from:e.from,to:e.to,body:{type:99,text:"系统错误!"}})}})},exchangeResume:function(t,e,i,s){var a="",n={},r="",s=s;switch(t){case 1:var o=e.body.dialog.buttons[0].url.match(/%3C(.+)%3E/);o&&(r=o[1]),a="/chat/acceptResume.json",n={to:e.from.uid,mid:e.mid,aid:41,action:0,extend:r};break;case 0:a="/chat/rejectResume.json",n={to:e.from.uid,mid:e.mid,aid:42,action:1};break;case 2:
a="/chat/requestResume.json",n={to:e.from.uid}}$.ajax({url:a,data:n,dataType:"JSON",cache:!1,timeout:3e4,success:function(a){2==t&&1==a.result?(Chat.mids[a.mid]="RequestResume",Chat.showMessage({time:(new Date).getTime(),from:e.from,body:{type:99,text:"简历请求已发送。如果牛人同意，TA的简历将发送到 {"+Chat.myselfData.email+"}"}}),a.email&&(_PAGE.email=a.email,Chat.myselfData&&(Chat.myselfData.email=a.email))):2==a.result?Chat.showSetEmail(function(){Chat.exchangeResume(2,{from:{uid:Chat.curUserData.uid}})}):1==a.result&&(s&&s.removeClass("item-resume"),Chat.showMessage({time:(new Date).getTime(),from:e.from,body:{type:99,text:a.msg}}),i&&i.remove())},error:function(t){Chat.showMessage({time:(new Date).getTime(),from:e.from,to:e.to,body:{type:99,text:"系统错误!"}})}})},showSetWeixin:function(t){$.dialog({title:"输入微信",content:'<form action="/user/updateWeixin.json"><div class="form-row through-row"><input type="text" name="weixin" placeholder="输入您的微信" class="ipt" /></div><div class="tip-text">对方同意后，可以看到彼此的微信号，您也可以在个人信息中修改。</div></form>',closeText:!1,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-chat-default",lock:!0,opacityLock:!0,onOpen:function(e){e.find("form").on("submit",function(i){Chat.saveSetWeixin($(this),e,t),i.preventDefault()})},onConfirm:function(e){Chat.saveSetWeixin(e.find("form"),e,t)},onClose:function(t){}})},saveSetWeixin:function(t,e,i){var t=t,s=t.find(".ipt"),a=t.attr("action");return""==s.val().replace(/(^\s*)|(\s*$)/g,"")?($.toast({content:"请填写微信号",type:"warning"}),s.focus(),!1):/^[a-zA-Z\d_\-]{5,50}$/.test(s.val())?($.ajax({type:"POST",url:a,dataType:"JSON",data:t.serialize(),success:function(t){var t=t;1==t.rescode?i&&i():$.toast({content:"保存失败",type:"error"})},error:function(t){$.toast({content:"保存失败",type:"error"})}}),void e.remove()):($.toast({content:"请填写正确的微信号",type:"warning"}),s.focus(),!1)},showSetEmail:function(t){$.dialog({title:"输入您用于接收简历的邮箱",content:'<form action="/bossweb/saveresumeemail.json"><div class="form-row through-row"><input type="text" name="email" placeholder="例：aaron@zhipin.com" class="ipt" /></div><div class="tip-text">牛人发送的简历将发送到该邮箱，您可以在 App 的个人资料中修改，建议使用您的企业邮箱</div></form>',closeText:!1,confirmText:"确定",cancelText:"取消",preKa:"",wrapClass:"dialog-chat-default",lock:!0,opacityLock:!0,onOpen:function(e){e.find("form").on("submit",function(i){Chat.saveSetEmail($(this),e,t),i.preventDefault()})},onConfirm:function(e){Chat.saveSetEmail(e.find("form"),e,t)},onClose:function(t){}})},saveSetEmail:function(t,e,i){var t=t,s=t.find(".ipt"),a=t.attr("action");return""==s.val().replace(/(^\s*)|(\s*$)/g,"")?($.toast({content:"请填写邮箱",type:"warning"}),s.focus(),!1):/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(s.val())?($.ajax({type:"POST",url:a,dataType:"JSON",data:t.serialize(),success:function(t){var t=t;1==t.rescode?i&&i():$.toast({content:"保存失败",type:"error"})},error:function(t){$.toast({content:"保存失败",type:"error"})}}),void e.remove()):($.toast({content:"请填写正确的邮箱",type:"warning"}),s.focus(),!1)},viewLargeImage:function(t){var t=t,e=t.attr("data-large"),i=t.attr("large-y"),s=new Image;s.src=e,t.parent().append('<div class="pre-loading"><span class="loading-more"><i></i><i></i><i></i></span></div>'),s.onload=function(){t.parent().find(".pre-loading").remove(),$.dialog({title:"",content:'<div class="img-viewer"><img src="'+e+'" /></div>',closeText:!0,confirmText:!1,cancelText:!1,wrapClass:"dialog-layer-full",lock:!0,onOpen:function(t){t.find(".dialog-con").on("click",function(e){$(e.target).parents(".img-viewer").length||t.remove()}),window.innerHeight<i&&t.find(".img-viewer").css({position:"static",transform:"translate(0, 0)"})}})}},viewFullResume:function(t,e,i){var e=e||"/resume/download4web?geekId="+Chat.curUserData.encryptUid,t=t,s={},a=i&&i.hasClass("link-fullscreen");s=a?i.closest(".attachment-view").find("img").clone():$('<img src="'+t+'" />'),$.dialog({title:'<a href="'+e+'" class="link-attachment"><span class="tooltip">下载</span></a><a href="javascript:;" class="close" ka="dialog-close"><i class="icon-close"></i><span class="tooltip">关闭</span></a>',content:'<div class="pre-loading"><span class="loading-more"><i></i><i></i><i></i></span></div>',closeText:!1,confirmText:!1,cancelText:!1,wrapClass:"dialog-layer-full dialog-layer-resume",lock:!0,onOpen:function(t){a&&s.height()>0?(t.find(".dialog-con").html('<div class="img-viewer"></div>'),t.find(".img-viewer").append(s),window.innerHeight<s.height()&&t.find(".img-viewer").css({position:"static",transform:"translate(0, 0)"})):Resume.loadAttachment("/resume/prview4web/"+Chat.userList.find(".cur a").attr("data-eid")+".json",t.find(".dialog-con")),t.find(".dialog-con").on("click",function(e){$(e.target).parents(".img-viewer").length||$(e.target).parents(".attachment-detail").length||t.remove()})}})},showOperateHelp:function(t){$.dialog({title:"帮助",content:'<div class="operate-help">\t\t\t\t\t\t<h4>牛人分类－工作流：</h4>\t\t\t\t\t\t<ul>\t\t\t\t\t\t\t<li><span class="name"><i class="icon-category-all"></i>全部</span><p>正在与您沟通所有牛人，与app联系人列表一致</p></li>\t\t\t\t\t\t\t<li><span class="name"><i class="icon-category-newgeek"></i>新牛人</span><p>指主动与您沟通，且您<span class="text-blue">尚未查看</span>的新牛人</p></li>\t\t\t\t\t\t\t<li><span class="name"><i class="icon-category-communication"></i>沟通中</span><p>指主动与您沟通，且您<span class="text-communication">已回复</span>或点击了<span class="text-communication">待沟通</span>的牛人，以及您主动与对方沟通，且<span class="text-communication">对方已回复</span>的牛人</p></li>\t\t\t\t\t\t\t<li><span class="name"><i class="icon-category-pass"></i>合适</span><p>指已经被您点击了<span class="text-green">合适</span>的牛人</p></li>\t\t\t\t\t\t\t<li><span class="name"><i class="icon-category-fail"></i>不合适</span><p>指已经被您点击了<span class="text-red">不合适</span>的牛人</p></li>\t\t\t\t\t\t</ul>\t\t\t\t\t\t<h4>牛人分类－其他：</h4>\t\t\t\t\t\t<ul>\t\t\t\t\t\t\t<li><span class="name">牛人发起</span><p>指由对方主动发起沟通的牛人</p></li>\t\t\t\t\t\t\t<li><span class="name">我发起</span><p>指由您主动发起与对方沟通的牛人</p></li>\t\t\t\t\t\t\t<li><span class="name">同事推荐</span><p>指您的同事通过转发给同事功能推荐给您的牛人</p></li>\t\t\t\t\t\t\t<li><span class="name">有附件简历的</span><p>指您已经获得对方附件简历的牛人</p></li>\t\t\t\t\t\t</ul>\t\t\t\t\t\t<div class="intro">\t\t\t\t\t\t\t<p>需要其他分类方式？</p>\t\t\t\t\t\t\t<p>反馈给产品经理（邮箱：zhanglei@bosszhipin.com）</p>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',closeText:!0,confirmText:!1,cancelText:!1,wrapClass:"dialog-chat-default dialog-chat-help",lock:!0,onOpen:function(t){}})},showTimeLine:function(t,e,i){if(4!=t.type&&4!=t.body.type&&!t.uncount){var s,a=new Date(t.time),n=Chat.curUserData.lastMessageTime||t.time;s=(new Date).getTime()-t.time>864e5?"MM-dd hh:mm":"Z hh:mm",n&&(i||Math.abs(a.getTime()-n)>3e5)&&0==Chat.chatListCon.find("#temp-time-"+t.time).length&&(e?$('<li class="item-time" id="temp-time-'+t.time+'"><span class="time">'+this.dateFormat(a,s)+"</span></li>").prependTo(Chat.chatListCon):$('<li class="item-time" id="temp-time-'+t.time+'"><span class="time">'+this.dateFormat(a,s)+"</span></li>").appendTo(Chat.chatListCon)),Chat.curUserData.lastMessageTime=t.time}},dateFormat:function(t,e){var i={Z:"","M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"H+":t.getHours()>12?t.getHours()-12:t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in i)new RegExp("("+s+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[s]:("00"+i[s]).substr((""+i[s]).length)));return e},scrollToBottom:function(){Chat.chatList.scrollTop(Chat.chatListCon.outerHeight()+119)},verifyTalk:function(t,e){Chat.usersData[e];if(Chat.usersData[e]&&Chat.usersData[e].infoData){var i=Chat.usersData[e].infoData;i.bothTalked||(void 0==i.outCount&&(i.outCount=0),void 0==i.inCount&&(i.inCount=0),"my"==t?i.outCount++:"to"==t&&i.inCount++,i.outCount&&i.inCount&&(i.bothTalked=!0),Chat.setFuntionButton(i))}},setFuntionButton:function(t){var e=Chat.ControlsEl;t.bothTalked?(e.find(".btn-resume").removeClass("disabled").find("span").text("求简历"),e.find(".btn-contact").removeClass("disabled").find("span").text("求手机"),e.find(".btn-weixin").removeClass("disabled").find("span").text("求微信"),e.find(".btn-interview").removeClass("disabled").find("span").text("约面试")):(e.find(".btn-resume").addClass("disabled").find("span").text("求简历：双方回复后可用"),e.find(".btn-contact").addClass("disabled").find("span").text("交换手机：双方回复后可用"),e.find(".btn-weixin").addClass("disabled").find("span").text("交换微信：双方回复后可用"),e.find(".btn-interview").addClass("disabled").find("span").text("约面试：双方回复后可用"))},subtractPoint:function(t){if(Chat.notification[t.relationType]){!function(t){var e=Chat.notification[5];e.indexOf(t)>-1&&(e.splice(e.indexOf(t),1),Chat.totalNewGeek())}(t.uid),function(e,i){var s=e.indexOf(t.uid);if(s>-1&&(e.splice(s,1),e.length<1)){Chat.containerEl.find(".op-category").find("a[data-status="+i+"]").find(".dot").remove()}}(Chat.notification[t.relationType],t.relationType),t.newGeek}},setGroupPoint:function(t){if(Chat.usersData[t]){var e=Chat.usersData[t],i=e.relationType,s=e.infoData?e.infoData.newGeek:e.newGeek,a=Chat.containerEl.find(".op-category").find("a[data-status="+i+"]");e.newMsgCount>0&&(8!=i&&5!=i&&function(e,i){e&&e.find(".dot").length<1&&e.append($('<em class="dot"></em>')),i&&i.indexOf(t)<0&&i.push(t)}(a,Chat.notification[i]),(5==i||1==s)&&function(t){var e=Chat.notification[5];e.indexOf(t)<0&&e.push(t),Chat.totalNewGeek()}(t))}},setRelationStatus:function(t){var e=t.relationType,i="",s="";switch(strTips="",curTabIdx=Chat.toggleTypeEl.find(".cur").index(),curTabType="",0==curTabIdx&&(curTabType="chat"),1==curTabIdx&&(curTabType="resume"),2==curTabIdx&&(curTabType="attachment"),e){case 5:i='<a href="javascript:;" target-status="8" class="link-fail">不合适<span>可在设置中编辑自动回复</span></a><a href="javascript:;" target-status="6" class="link-communication">置为沟通中<span>可在设置中编辑自动回复</span></a>',s='<span class="status-text">未处理</span>';break;case 6:i='<a href="javascript:;" target-status="8" class="link-fail">不合适<span>可在设置中编辑自动回复</span></a><a href="javascript:;" target-status="7" class="link-pass">合适<span>可在设置中编辑自动回复</span></a>',s='<span class="status-text">沟通中</span>';break;case 7:i='<a href="javascript:;" target-status="6" class="link-communication">置为沟通中<span>可在设置中编辑自动回复</span></a><a href="javascript:;" target-status="8" class="link-fail">不合适<span>可在设置中编辑自动回复</span></a>',s='<span class="status-text">合适</span>';break;case 8:i='<a href="javascript:;" target-status="6" class="link-communication">置为沟通中<span>可在设置中编辑自动回复</span></a><a href="javascript:;" target-status="7" class="link-pass">合适<span>可在设置中编辑自动回复</span></a>',s='<span class="status-text">不合适</span>';break;default:i="",s='<span class="status-text">等待回复</span>'}var a=t.cooperate>1?"icon-coop fill":"icon-coop",n=Chat.curUserData;i+='<em href="javascript:;" class="'+a+'" data-cooperate="'+t.cooperate+'" data-eid="'+n.encryptUid+'" data-uid="'+n.uid+'" data-expect="'+t.expectId+'"><i>同事协作</i></em>',Chat.ControlsEl.find(".btn-transmit").hide(),Chat.sendKaEvent("funcn_load_1_"+parseInt(t.cooperate)-1),Chat.ControlsEl.find(".links").html(i),Chat.chatEl.find(".detail-bottom .btns").html('<a href="javascript:;" class="link-chat">回复</a>'+i);var r="";switch(t.toPositionId&&t.toPosition&&(r='<span class="text-blue link-job" data-jobid="'+t.toPositionId+'">'+filterXss(t.toPosition)+"</span>"),t.sourceType){case 1:strTips=s+"，"+t.initTime+"由您发起，当前沟通职位"+r,VersionStatus.isHunter&&(strTips=s+"，"+t.initTime+"由您发起");break;case 2:strTips=s+"，"+t.initTime+"向您发起投递，当前沟通职位"+r,VersionStatus.isHunter&&(strTips=s+"，"+t.initTime+"向您发起沟通");break;case 3:t.toPositionId&&t.toPosition&&(r="，沟通职位"+r),strTips=s+"，"+t.initTime+"来自"+t.sourceExtend+r,VersionStatus.isHunter&&(strTips=s+"，"+t.initTime+"来自"+t.sourceExtend);break;case 4:strTips=s+"，"+t.initTime+"向您发起投递，当前沟通职位"+r,VersionStatus.isHunter&&(strTips=s+"，"+t.initTime+"向您发起投递");break;case 5:t.toPositionId&&t.toPosition&&(r="，沟通职位"+r),strTips=s+"，"+t.initTime+"由"+t.sourceExtend+"推荐"+r,VersionStatus.isHunter&&(strTips=s+"，"+t.initTime+"由"+t.sourceExtend+"推荐")}Chat.chatList.find(".chat-info .tip-text").html(strTips),Chat.chatEl.find(".detail-bottom .text").html(strTips),Chat.chatList.find(".chat-info .tip-text .link-job").attr("ka","chat_top_job"),Chat.chatEl.find(".detail-bottom .text .link-job").attr("ka","chat_bottom_job")},changeUserView:function(t,e){var t=t,e=e||"down",i=!0,s=Chat.userList.find(".cur");if(s.length||(i=!1,s=Chat.userList.find("li").eq(0)),s.length){var a=s.height(),n=s.index(),r=Chat.toggleTypeEl.find(".cur").index();t&&t.hasClass("btn-prev")&&(e="up"),s.parent().hasClass("main-list")&&Chat.userListTop.find("li").length&&(n=s.index()+Chat.userListTop.find("li").length),"up"==e?(s.prev("li").length?(s.prev("li").addClass("cur").find("a").click(),s.removeClass("cur")):s.parent().hasClass("main-list")&&Chat.userListTop.find("li").length&&(s.removeClass("cur"),Chat.userListTop.find("li:last").addClass("cur").find("a").click()),0==r&&s.position().top<a&&setTimeout(function(){Chat.userList.scrollTop(a*n-a)},100),(1==r||2==r)&&s.position().top<a&&setTimeout(function(){Chat.userList.scrollTop(a*n-a)},100)):(s.next("li").length||!i?i?(s.removeClass("cur"),s.next("li").addClass("cur").find("a").click()):s.addClass("cur").find("a").click():s.parent().hasClass("top-list")&&Chat.userListMain.find("li").length&&(s.removeClass("cur"),Chat.userListMain.find("li:first").addClass("cur").find("a").click()),0==r&&s.position().top>Chat.userList.height()-2*a&&setTimeout(function(){Chat.userList.scrollTop(a*n-Chat.userList.height()+2*a)},100),(1==r||2==r)&&s.position().top>Chat.userList.height()-2*a-136&&setTimeout(function(){Chat.userList.scrollTop(a*n-Chat.userList.height()+3*a)},100)),Chat.sendKaEvent("tab-"+Chat.toggleTypeEl.find(".cur").index()+"-"+e)}},showMessageBase:function(t){var e;if(t.from.uid==Chat.myselfData.uid?t.isSelf=!0:t.isSelf=!1,!t.offline&&4!=t.type&&4!=t.body.type&&(Chat.curUserData.infoData&&!Chat.curUserData.infoData.bothTalked&&(t.isSelf?Chat.verifyTalk("my",t.to.uid):1!=t.body.type&&2!=t.body.type&&3!=t.body.type||Chat.verifyTalk("to",t.from.uid)),"history"!=t.typeSource&&t.isSelf&&!t.uncount)){var i=Chat.getGroupStatus();5==i&&(Chat.groupLastModify[i]=Chat.groupHistory[i])}var s=0;if(Chat.curUserData.uid&&!t.offline&&!t.received&&(Chat.curUserData.uid==t.from.uid||t.to&&Chat.curUserData.uid==t.to.uid)){var a=Chat.curUserData;t.isSelf||99==t.body.type||"history"==t.typeSource||Chat.sendReadMessage({userData:a,uid:t.from.uid,mid:t.mid}),e=a.uid}else{if(t.from.uid==Chat.myselfData.uid)var n=t.to;else if(t.to&&t.to.uid==Chat.myselfData.uid)var n=t.from;Chat.usersData[n.uid]||Chat.addUser(n.uid,n.encryptUid,t);var a=Chat.usersData[n.uid];if(t.isSelf||(s=1),e=n.uid,!t.offline&&!t.received){var r=Chat.userList.find('a[data-uid="'+e+'"]').parent();r.length?r.prependTo(r.closest("ul")):Chat.usersData[e]&&Chat.addUser(e,Chat.usersData[e].encryptUid)}}if(function(){return!(4==t.body.type&&1==t.body.templateId&&!t.pushText)&&!(!t.pushText&&!t.body.text)}()&&s&&"history"!=t.typeSource&&!t.received&&4!=t.type&&!t.uncount){var o=Chat.usersData[a.uid],c=t.body,l=3==t.type&&1==c.type&&3==c.templateId;(!t.offline||!a.maxMessageId||t.offline&&a.maxMessageId&&t.mid>a.maxMessageId)&&(t.offline&&Chat.curUserData.uid==a.uid||o&&8!=o.relationType&&(a.newMsgCount||l?l||a.newMsgCount++:a.newMsgCount=1,Chat.setUnReadMessage(t),Chat.showMessageCountInfo(a),l||Chat.setUnReadMessageCount(1)))}t.isSelf||a.maxMessageId&&!(a.maxMessageId<t.mid)||(a.maxMessageId=t.mid);var d=3==t.type&&14==t.body.type&&"history"!=t.typeSource,h=12==t.body.type&&1==t.body.hyperLink.hyperLinkType&&"history"!=t.typeSource;d&&(t.body.text=t.pushText.replace(t.from.name,"").replace("给你",""));var u=filterXss(t.body.text);if(!t.body.text&&t.encryptedBody&&(u=t.pushText||"您收到一条来自该牛人的消息"),u&&"history"!=t.typeSource&&4!=t.type||d||h){var p=(new Date(t.time),Chat.userList.find('a[data-uid="'+a.uid+'"]'));p.find(".time").text(Chat.getLastTime(t.time)),p.find(".gray").html(filterXss(u.substring(0,40)));Chat.usersData[a.uid];t.time>=Chat.usersData[a.uid].lastTS&&(Chat.usersData[a.uid].lastTime=Chat.getLastTime(t.time),Chat.usersData[a.uid].lastTS=t.time),Chat.usersData[a.uid].lastMsg=u}return PAGE_ACTIVITY&&(!PAGE_ACTIVITY||$(".side-menu .menu-chat").hasClass("cur"))||t.offline||t.received||t.from.uid==Chat.myselfData.uid||t.from.uid==Chat.curUserData.uid||t.to.uid!=Chat.myselfData.uid||"history"==t.typeSource||!Chat.usersData[a.uid]||8==Chat.usersData[a.uid].relationType||chatNotification.show(t.from.name,t.from.avatar,t),{userData:a,setUnReadMessageCount:Chat.setUnReadMessageCount}},setUnReadMessageCount:function(t){Chat.unreadMessageCount+=t,Chat.unreadMessageCount>99?Chat.unreadCountBox.html('<i class="dot-plenty"></i>'):Chat.unreadCountBox.html(Chat.unreadMessageCount),Chat.unreadMessageCount&&Chat.unreadMessageCount>0?Chat.unreadCountBox.css("display","inline-block"):Chat.unreadCountBox.hide(),Chat.onChangeReadMessageCount(Chat.unreadMessageCount),"undefined"!=typeof DeskNotice&&DeskNotice.messageShow(Chat.unreadMessageCount)},onChangeReadMessageCount:function(){},clearMessageCount:function(t,e){e&&(t.newMsgCount-e<0&&(e=t.newMsgCount),Chat.setUnReadMessageCount(-1*e),t.newMsgCount-=e,Chat.showMessageCountInfo(t))},showMessageCountInfo:function(t){var e=t.newMsgCount,i=Chat.userList.find('a[data-uid="'+t.uid+'"]');Chat.usersData[t.uid].newMsgCount=e,e?(e=e>999?999:e,Chat.usersData[t.uid]&&(i.find(".notice-badge").length?i.find(".notice-badge").text(e):i.find(".text").append('<span class="notice-badge">'+e+"</span>")),Chat.setGroupPoint(t.uid)):(i.find(".notice-badge").remove(),Chat.subtractPoint(t))},addUserCount:function(t){Chat.usersData[t.from.uid]&&Chat.userList.find('a[data-uid="'+t.from.uid+'"]').find(".figure").prepend('<span class="notice-badge"></span>')},addMessageId:function(t,e){(!Chat.curUserData||Chat.curUserData&&Chat.curUserData.userId!=t)&&(Chat.usersData[t].mids||(Chat.usersData[t].mids=[]),Chat.usersData[t].mids.push(e))},setMessageMinId:function(t,e){Chat.usersData[t].messageMinId||(Chat.usersData[t].messageMinId=e)},setMessageMaxId:function(t,e){Chat.usersData[t].maxMessageId<e&&(Chat.usersData[t].maxMessageId=e)},getLastTime:function(t){this.lastMessageTime=t;var e=new Date,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=i-t;return e.getFullYear()!=new Date(t).getFullYear()&&e.getFullYear()-new Date(t).getFullYear()>1?e.getFullYear()-new Date(t).getFullYear()+"年前":s>864e5?Chat.dateFormat(new Date(t),"MM月dd日"):s>0?"昨天":Chat.dateFormat(new Date(t),"hh:mm")},workflowTip:function(t,e,i){var s,t=t,a=t?parseInt(t.attr("target-status"),10):null,e=e||"",n="",r="",o="",c=1==e,i=i,l=!1,d=!1,h=Chat.curUserData;switch(a){case 6:e=2,o="tochat";break;case 7:e=3,o="pass";break;case 8:e=4,o="fail"}if(n="/setting/notify/tip.json?type="+e,i&&(n+="&reasonType="+i),3==e&&(n+="&geekId="+h.uid),1!=e||a||(o="tochat"),$.ajax({url:n,type:"GET",data:null,dataType:"JSON",timeout:3e4,success:function(i){i.rescode&&3==e&&i.requireContact&&(l=!0),i.rescode&&3==e&&i.requireResume&&(d=!0),i.rescode&&1==i.showGuide?$.confirm({content:i.html,title:"提示",closeIcon:!0,confirmButton:"确定",cancelButton:!1,buttonOther:1!=e?'<label class="checkbox"><input type="checkbox" name="noMoreShow" value="1" checked="checked" /><span>不再显示</span></label>':"",columnClass:"pop-default pop-default-workflow pop-default-"+e,onOpen:function(){var t=this,e=t.$body.find('.buttons input[type="checkbox"]'),i=t.$content.find('input[name="noMoreShow"]');1==i.val()?(e.val(1),e.attr("checked","checked")):(e.val(0),e.removeAttr("checked")),e.on("change",function(){$(this).is(":checked")?i.val(1):i.val(0)}),PageSet.bindEvent(t.$content),t.$body.find(".closeIcon").on("click",function(){Chat.sendKaEvent(o+"-close")})},confirm:function(){var i=this,a=i.$content.find("form").serialize();(e=3)&&(a+="&geekId="+h.uid),1!=e&&2!=e&&3!=e&&4!=e||$.ajax({url:"/setting/notify/set.json",type:"POST",data:a,dataType:"JSON",timeout:5e3,success:function(e){var e=e;e.rescode?(r=e.msg,s=e.requireType,e.requireContact&&(l=!0),e.requireResume&&(d=!0),Chat.setWorkflow(h,t,r,s,l,d,c),1==e.nextHtml&&"1"==i.$content.find('form input[name="noMoreShow"]').val()&&($("#guide-wrap").show(),$("#guide-wrap").find(".guide-box").eq(0).show())):$.toast({type:"error",content:e.resmsg||"设置失败"})},error:function(t){}});var n=o;i.$content.find('input[name="sendMsg"]').length&&(n+="-msg"+i.$content.find('input[name="sendMsg"]:checked').val()),i.$content.find('input[name="requireType"]').length&&(n+="-require"+i.$content.find('input[name="requireType"]:checked').val()),i.$content.find('input[name="noMoreShow"]').length&&(n+="-go"+i.$content.find('input[name="noMoreShow"]').val()),Chat.sendKaEvent(n)}}):i.rescode&&!i.showGuide&&(r=i.msg,s=i.requireType,Chat.setWorkflow(h,t,r,s,l,d,c))},error:function(t){}}),t){var u=t.attr("data-reason")?t.attr("data-reason"):"";Chat.sendKaEvent("Geekdeal_"+o+u+"_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+h.uid)}},setWorkflow:function(t,e,i,s,a,n,r){var t=t,o=e?parseInt(e.attr("target-status"),10):null;r&&(o=6);var c={geekId:t.encryptUid,relationType:o};e&&e.attr("data-reason")&&(c.reason=e.attr("data-reason")),$.ajax({url:"/chat/relation/groupset.json",type:"POST",data:c,dataType:"JSON",timeout:5e3,success:function(s){var s=s,r=Chat.getGroupStatus(),c="";if(s.rescode){if(Chat.usersData[t.uid].infoData&&(Chat.usersData[t.uid].relationType=o,Chat.usersData[t.uid].infoData.relationType=o,(5!=r||6!=o||e)&&chatUserPresenter.setStatus(t.uid,o)),!e)return;var l=e.index();switch(e.closest(".detail-bottom").length?(Chat.ControlsEl.find(".links a").removeClass("cur"),Chat.ControlsEl.find(".links a").eq(l).addClass("cur")):e.closest(".chat-controls").length&&(Chat.chatEl.find(".detail-bottom .btns .btn,.detail-bottom .btns a").removeClass("cur"),Chat.chatEl.find(".detail-bottom .btns .btn,.detail-bottom .btns a").eq(l).addClass("cur")),e.parent().children().removeClass("cur"),e.addClass("cur"),o){case 5:c="新";break;case 6:c="沟通中";break;case 7:c="合适";break;case 8:c="不合适"}Chat.chatEl.find(".status-text").text(c);var r=Chat.getGroupStatus(),d=e.clone(),h=d.find("span").remove().end().text();[5,6,7,8].indexOf(r)<0&&8!=o&&$.toast({content:"已置为"+h.replace("置为",""),type:"success"}),i&&Publisher.sendText(t,i),n&&Chat.exchangeResume(2,{from:{uid:t.uid}}),a&&Chat.exchangePhone(2,{from:{uid:t.uid}})}},error:function(t){}})},getResumedirectList:function(){$.ajax({type:"GET",url:"/chat/resumedirectList.json",dataType:"JSON",data:null,success:function(t){if(1==t.status&&t.data.length>0){var e;for(e=0;e<t.data.length;e++){var i=t.data,s=Chat.userList.find('a[data-uid="'+i[e].geekId+'"]');s.find(".name .badge-resume").length||s.find(".name").append('<em class="badge-resume">直通车</em>'),s.attr("data-recordId",i[e].recordId),Chat.usersData[i[e].geekId]&&!Chat.usersData[i[e].geekId].resumeDirectAdded&&0==i[e].status&&(Chat.usersData[i[e].geekId].newMsgCount=1,Chat.showMessageCountInfo(Chat.usersData[i[e].geekId]),Chat.setUnReadMessageCount(1),Chat.usersData[i[e].geekId].resumeDirectAdded=!0)}}}})},readResumedirect:function(t){var t=t,e=t.attr("data-uid"),i=t.attr("data-recordId");Chat.usersData[e]&&i&&!Chat.usersData[e].resumeDirectMinus&&$.ajax({type:"POST",url:"/chat/readresumedirect.json",dataType:"JSON",data:{id:i},success:function(i){1==i.rescode&&(Chat.usersData[e].resumeDirectMinus||(t.find(".notice-badge").remove(),Chat.clearMessageCount(Chat.usersData[e],1),Chat.usersData[e].resumeDirectMinus=!0))}})},revertFilenameToIcon:function(t){var e=t.replace(/.+\./,"").toLowerCase();return t="",'<i class="icon-file icon-file-'+("jpeg"==e?"jpg":"docx"==e?"doc":"pptx"==e?"ppt":e)+'"></i>'},showFailedMessageTip:function(){var t=$('<div class="notice-dialog" data-type="fail-message"><div class="op"><span class="btn btn-reload" ka="chat_sendfail_btn_reload_'+_PAGE.uid+'">刷新</span><a href="javascript:;" class="close" ka="chat_sendfail_btn_close_'+_PAGE.uid+'"><i class="icon-close"></i></a></div><div class="text"><i class="icon-fail-message"></i>消息发送失败，请刷新页面 或 重新登录</div></div>');t.find(".btn-reload").on("click",function(){window.location.reload()}),t.find(".close").on("click",function(){t.remove()}),Chat.chatEl.find('.notice-dialog[data-type="fail-message"]').remove(),Chat.chatEl.find(".chat-list ul").after(t),setTimeout(function(){t.fadeOut(function(){t&&t.remove()})},4e3)},getConGroup:function(){var t=Chat.containerChat.find(".op-category .cur"),e={"-1":"aaa",1:"nnn",5:"xxa",6:"xxb",7:"xxc",8:"xxd"},i={1:"dda",2:"ddb",3:"ddc",4:"ddd"};return t.attr("data-status")?e[t.attr("data-status")]:i[t.attr("data-origin")]},getPublicStatis:function(){var t=Chat.getConGroup(),e="0",i="0",s=Chat.toggleTypeEl.find(".cur").index(),a=["chatview","infoview","fileview"];return"全部职位"!=$(".top-chat .dropdown-select").text()&&(e="1"),"筛选"!=Chat.containerChat.find(".sel-filter .dropdown-select").eq(0).text()&&(i="1"),t+="0"+e+i,{context:t,view:a[s]}},sendKaEvent:function(t){try{_T.sendEvent(t)}catch(t){}}},ChatWebsocket={init:function(){this.settings={cid:"",token:"",password:"",receiveUrl:"",receiveStepTime:5e3,onSendMessage:function(t){},onRecevieMessage:function(t){},onlineDebug:!!getQueryString("debug")},this.Messages=[],this.cacheTimestamp=0,ChatWebsocket.failNum=0,ChatWebsocket.reConnectTimer;var t=cookie.get("wt")||cookie.get("t")||"xGrtxwdSkouHdhs";t&&(ChatWebsocket.settings.password=t),this.uuid="ws-"+getUuid(16,16),this.client=new Paho.MQTT.Client(_PAGE.ws.server,_PAGE.ws.port,"/chatws",this.uuid),this.client.onConnectionLost=this.onConnectionLost,this.client.onMessageArrived=this.onMessageArrived,this.client.onMessageDelivered=this.onMessageDelivered,this.connection(!0),ChatWebsocket.isKickOut=!1},logCss:"font-weight:bold;color:#ff0000;",connection:function(t){this.client.connect({userName:_PAGE.token,password:ChatWebsocket.settings.password,timeout:60,keepAliveInterval:25,cleanSession:!0,onSuccess:this.onConnect,onFailure:this.onFailure,mqttVersion:3,useSSL:!!_PAGE.ws.useSSL});var e=t?"start":"retry";ChatWebsocket.failNum<5&&Chat.sendKaEvent("connect_"+e+"_"+_PAGE.uid+"_"+(new Date).getTime())},reConnection:function(){this.connection()},sendPresence:function(){var t=cookie.get("__a").split("."),e=Chat.protobufMessage.createMessage.presence({type:1,lastMessageId:Chat.receiveMaxId<0?0:Chat.receiveMaxId,clientInfo:{version:"",system:"",systemVersion:"",model:cookie.get("sid")||"",uniqid:t[1]+""+t[0]||"",network:_PAGE.clientIP||"",appid:9018,platform:"web",channel:"-1",ssid:"",bssid:"",longitude:0,latitude:0}});ChatWebsocket.settings.onlineDebug&&(console.log("%cpresence:",ChatWebsocket.logCss),console.log(e)),ChatWebsocket.send(e,1)},onConnect:function(t){ChatWebsocket.settings.onlineDebug&&console.log("%cconnect:",ChatWebsocket.logCss),ChatWebsocket.sendPresence(),Chat.websocketConnected=!0,Chat.sendKaEvent("connect_success_"+_PAGE.uid+"_"+(new Date).getTime())},onFailure:function(t,e,i){if(ChatWebsocket.settings.onlineDebug&&(console.log("%conFailure:",ChatWebsocket.logCss),console.log(t,e,i)),ChatWebsocket.failNum<5&&Chat.sendKaEvent("connect_fail_"+_PAGE.uid+"_"+t.errorCode+"_"+(new Date).getTime()),ChatWebsocket.failNum++,"object"==typeof t&&6==t.errorCode){var s=t.errorMessage.match(/^AMQJS0006E Bad Connack return code:(\d).+$/);s&&(3==parseInt(s[1],10)?(ChatWebsocket.reConnectTimer&&clearTimeout(ChatWebsocket.reConnectTimer),ChatWebsocket.reConnectTimer=setTimeout(function(){ChatWebsocket.reConnection()},2e3)):(alert("登录信息失效，请重新登录"),window.location.href=isZpdesk?"/logoutToUrl?toUrl=/user/login.html":"/logout/"))}else ChatWebsocket.reConnectTimer&&clearTimeout(ChatWebsocket.reConnectTimer),ChatWebsocket.reConnectTimer=setTimeout(function(){ChatWebsocket.reConnection()},2e3)},onConnectionLost:function(t){this.onlineDebug&&(console.log("%conConnectionLost(data):"+new Date+" "+(new Date).getTime(),ChatWebsocket.logCss),console.log(t)),ChatWebsocket.failNum<5&&Chat.sendKaEvent("connect_lost_"+_PAGE.uid+"_"+t.errorCode+"_"+(new Date).getTime()),8!=t.errorCode&&5!=t.errorCode||ChatWebsocket.isKickOut||ChatWebsocket.reConnection(),0!==t.errorCode&&(console.log("%conConnectionLost(message):",ChatWebsocket.logCss),console.log(t.errorMessage))},onMessageArrived:function(t){try{var e=t.payloadBytes,i=Chat.protobufMessage.decode(e);switch(i=ChatWebsocket.eachParseInt(i),ChatWebsocket.settings.onlineDebug&&(console.log("%conMessageArrived(data):",ChatWebsocket.logCss),console.log(t),console.log("%conMessageArrived(message):",ChatWebsocket.logCss),console.log(i)),i.type){case 1:ChatWebsocket.receiveMessage(i);break;case 5:ChatWebsocket.receiveSyncMessage(i);break;case 6:ChatWebsocket.receiveStatusMessage(i)}}catch(t){console.log("%conMessageArrived(try error):",ChatWebsocket.logCss),console.log(t)}},onMessageDelivered:function(t){var e=t.payloadBytes,i=Chat.protobufMessage.decode(e);switch(i=ChatWebsocket.eachParseInt(i),i.type){case 1:for(var t=i.messages,s=0;s<t.length;s++)Chat.setTextMessageDomStatus(Chat.userList.find('a[data-eid="'+t[s].to.name+'"]').attr("data-uid"),t[s].mid,null,"delivery");break;case 6:for(var s=0;s<i.messageRead.length;s++){var a=Chat.usersData[i.messageRead[0].userId];a&&a.maxMessageId==i.messageRead[0].messageId&&(a.maxMessageId=null)}}ChatWebsocket.settings.onlineDebug&&(console.log("%conMessageDelivered(data):",ChatWebsocket.logCss),console.log(t),console.log("%conMessageDelivered(message):",ChatWebsocket.logCss),console.log(i))},send:function(t,e,i){ChatWebsocket.settings.onlineDebug&&(console.log("%csend:",ChatWebsocket.logCss),console.log(t)),this.client.isConnected()?this.client.send("chat",t.toArrayBuffer(),1,!0):1==t.type&&1==t.messages[0].type&&1==t.messages[0].body.type&&(ChatWebsocket.reConnection(),Chat.setTextMessageDomStatus(Chat.curUserData.uid,t.messages[0].cmid,null,"error"),Chat.showFailedMessageTip())},eachParseInt:function(t){for(var e in t){var i=t[e];i&&"object"==typeof i&&("boolean"==typeof i.unsigned&&"number"==typeof i.high&&"number"==typeof i.low?(longVal=new dcodeIO.Long(i.low,i.high),t[e]=parseInt(longVal.toString(),10)):this.eachParseInt(i))}return t},sendReadMessage:function(t){var t=Chat.protobufMessage.createMessage.read(t);ChatWebsocket.send(t,null)},receiveTextMessage:function(t){if(t.from&&t.to)if(t.from.uid>1e3){if(2===t.type||5===t.type||6===t.type)return Chat.countGroupMessage(t),!0;3==t.type?Chat.showMessageOther(t):1!=t.type&&2!=t.type&&4!=t.type||t.from.uid!=Chat.myselfData.uid&&t.to.uid!=Chat.myselfData.uid||Chat.showMessage(t)}else 990===t.from.uid?Counselor.received(t):(3==t.type||1==t.type&&t.body.action&&70==t.body.action.aid&&""!=t.body.extend)&&(797==t.from.uid?Chat.updateMessagePage(t):998!=t.from.uid&&1e3!=t.from.uid||Chat.showMessageOther(t))},uniqueMessage:function(t){return!(this.Messages.indexOf(t.mid)<0)||(this.Messages.length&&t.time-this.cacheTimestamp>5e3&&(this.Messages.splice(0,1),this.cacheTimestamp=t.time),this.Messages.push(t.mid),!1)},receiveMessage:function(t){for(var e=0;e<t.messages.length;e++){var i=t.messages[e];if(i.to.uid<=1e3)return!1;if(this.uniqueMessage(i))return!1;if(3==i.type&&4==i.body.type)if(i.body.action&&10==i.body.action.aid){var s=PAGE_ACTIVITY;alert("您的帐号已经登录过了，请勿重复登录。"),window.location.href=isZpdesk?"/logoutToUrl?toUrl=/user/login.html":s?"/logout/":INTERFACE_URLS.homeUrl,ChatWebsocket.isKickOut=!0}else if(i.body.action&&0==i.body.action.aid)switch(parseInt(i.body.action.extend,10)){case 1011:window.location.href=INTERFACE_URLS.homeUrl;break;case 1012:var a=cookie.get("wt"),n=cookie.get("t");if(n&&a&&n!=a)return void(window.location.href="/logout/");alert("您订购的网页版聊天服务已到期，请重新购买！"),window.location.reload();break;case 1013:alert("抱歉，您的BOSS账号刚被冻结。请前往App端申请解冻，解冻后可正常使用"),window.location.href="/logout/";break;case 1014:alert("抱歉，由于被多人举报，您需要认证身份后才可继续使用，请您打开BOSS直聘APP进行认证。"),window.location.href="/logout/"}Chat.receiveMaxId<i.mid&&(Chat.receiveMaxId=i.mid);var r=!1;for(var o in Chat.mids)o!=Chat.receiveMaxId?o<Chat.receiveMaxId&&delete Chat.mids[o]:r=!0;if(r){
var c=Chat.usersData[i.to.uid];c&&Chat.setMessageMinId(i.to.uid,i.mid)}else if(i.mSource="server",ChatWebsocket.receiveTextMessage(i),i.mid&&i.from.uid>1e3){var c=Chat.usersData[i.from.uid];c&&(Chat.addMessageId(i.from.uid,i.mid),Chat.setMessageMinId(i.from.uid,i.mid),Chat.setMessageMaxId(i.from.uid,i.mid))}}},receiveStatusMessage:function(t){if(t.messageRead)for(var e=0;e<t.messageRead.length;e++)t.messageRead[e].sync?ChatWebsocket.synchReadMessage(t.messageRead[e].userId,t.messageRead[e].messageId):t.messageRead[e].userId==Chat.curUserData.uid?Chat.setTextMessageDomStatus(t.messageRead[e].userId,t.messageRead[e].messageId,null,"read"):Chat.usersData[t.messageRead[e].userId]&&Chat.usersData[t.messageRead[e].userId].maxMessageId&&(t.messageRead[e].messageId,Chat.usersData[t.messageRead[e].userId].maxMessageId)},receiveSyncMessage:function(t){if(t.messageSync)for(var e=0;e<t.messageSync.length;e++){var i=t.messageSync[e],s=Chat.messageStatusDataTemp[i.clientMid];s&&(Chat.mids[i.serverMid]="Text")}},synchReadMessage:function(t,e){var i=Chat.usersData[t];if(i){i.mids||(i.mids=[]),i.mids.sort(function(t,e){return t>e});for(var s=0,a=0;a<i.mids.length&&i.mids[a]<=e;a++)s++;i.mids.splice(0,s),Chat.clearMessageCount(i,s)}}},Resume={loadDetail:function(t,e,i){var s=e.find(".resume-content-load"),a=Chat.getGroupStatus();if(t){if(s.data("url")==t&&""!=s.html())return s.html(s.html()),Chat.chatEl.find(".chat-list").css("visibility","visible"),Chat.chatEl.find(".chat-wrap-mask").remove(),void(i||Chat.sendKaEvent("Geekshow_tab_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid));1!=a&&5!=a&&(Chat.resumeContainer.find(".resume-content-latest").html("").hide(),Chat.resumeContainer.find(".resume-content-load").html("")),Chat.xhrs.resume&&Chat.xhrs.resume.abort();var n=function(t,e){var e=$.trim(e)+"";return e.length>0&&(e='<div class="message-info"> <span>'+e+"</span> </div>"),5!=Chat.getGroupStatus()&&(e=""),t.replace("{{__LAST_MESSAGE__}}",e)};s.data("url",null),Chat.xhrs.resume=$.ajax({type:"GET",url:t,dataType:"text",data:null,success:function(a){var r=Chat.curUserData.uid,o=Chat.usersData[r],c=n(a,o.lastMsg);s.data("url",t).html(c),i||Chat.sendKaEvent("Geekshow_tab_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid);var l=Chat.chatEl.find(".detail-bottom .btns .icon-coop");l.length&&(s.find(".tip-closedata").length?(l.hide(),Chat.ControlsEl.find(".icon-coop").hide()):(l.show(),Chat.ControlsEl.find(".icon-coop").show())),Chat.chatEl.find(".chat-list").css("visibility","visible"),Chat.chatEl.find(".chat-wrap-mask").remove(),e.scrollTop(0)},error:function(){}})}},loadAttachment:function(t,e,i){e.html('<div class="data-tips"><div class="spinner spinner-circle"><div class="loader"></div><span>正在加载简历...</span></div></div>'),$.ajax({type:"GET",url:t,dataType:"JSON",data:null,success:function(t){if(t.rescode){e.html(t.html),Chat.chatEl.find(".chat-list").css("visibility","visible"),Chat.chatEl.find(".chat-wrap-mask").remove(),i||e.hasClass("dialog-con")||Chat.sendKaEvent("Geekshow_tab_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid),e.find(".link-attachment").removeAttr("ka").on("click",function(){Chat.sendKaEvent("Geekshow_download_"+Chat.getPublicStatis().context+"_"+Chat.getPublicStatis().view+"_"+Chat.curUserData.uid)}),e.find(".link-fullscreen").on("click",function(){Chat.viewFullResume($(this).attr("data-origin"),$(this).parent().find(".link-attachment").attr("href"),$(this))}),e.find(".btn-resume").on("click",function(){var t=$(this);t.hasClass("disabled")||$.confirm({content:"向牛人索取简历吗？<p>如果牛人同意，TA的简历将发送到<br/>"+Chat.myselfData.email+"</p>",title:"温馨提示",closeIcon:!0,columnClass:"",onOpen:function(){},confirm:function(){Chat.exchangeResume(2,{from:{uid:Chat.curUserData.uid}}),t.text("已发出请求").addClass("disabled")},error:function(t){}})});var s=e.find(".attachment-view"),a=s.find("img"),n=a.attr("data-src")||a.attr("src"),r=a.attr("data-download"),o=function(){if(a.length){var t=new Image;t.src=n,s.append('<div class="data-tips"><div class="spinner spinner-circle"><div class="loader"></div><span>正在加载简历...</span></div></div>'),t.onload=function(){var i=t.height||a.height();a.attr("src",n),s.find(".data-tips").remove(),e.hasClass("dialog-con")&&window.innerHeight<i&&(e.find(".attachment-detail").css({position:"static",transform:"translate(0, 0)",display:"inline-block"}),e.css({textAlign:"center"})),e.scrollTop(0)},t.onerror=function(){e.html('<div class="attachment-detail"><div class="attachment-blank"><b>此附件简历暂时无法预览，您可以</b><div class="btns"><a href="'+r+'" ka="attachment-download2" class="btn">下载附件简历</a></div><p><a href="javascript:;" class="link-refresh">重试预览</a></p></div></div>'),Chat.sendKaEvent("boss_attachment_error_"+n)}}};o(),e.on("click",".link-refresh",function(){o()}),s.hover(function(){s.find(".attachment-download").css({"margin-left":Chat.containerChat.width()/2-10+"px"}).show()},function(){s.find(".attachment-download").hide()})}},error:function(t){}})}};$(function(){Publisher.init(),Chat.init()});var Safety={init:function(){if($(".safety").length){$(".safety-help").on("click",function(){$(this).parents(".help-box").toggleClass("tips-info-open")});var t=0,e=setInterval(function(){t++,t<50?$.get("/user/loginconfirm/check.json").success(function(t){if(t.rescode)switch(t.status){case-1:clearInterval(e);break;case 1:clearInterval(e),$(".safety-container").eq(0).addClass("hide"),$(".safety-container").eq(1).removeClass("hide"),setTimeout(function(){window.location.href=t.toUrl},2e3);break;case 2:clearInterval(e),setTimeout(function(){window.location.href=t.toUrl},2e3)}}):clearInterval(e)},2e3)}}};$(function(){Safety.init()});var Report={init:function(){Report.uploadCount=0,Report.setContent()},setContent:function(){var t=function(t){t.remove(),Report.uploadCount--};$("body").on("click",".icon-report,.link-report",function(){var e=$(this).attr("data-uid")||"",i=$(this).attr("data-expect")||"";$.get("/user/report/form.json",function(s){s.rescode?$.dialog({content:s.html,title:"举报",cancelButton:"取消",confirmButton:"确认",wrapClass:"pop-report",onOpen:function(e){"FormsUI"in window&&FormsUI.dropSelect(e),"DropDown"in window&&DropDown.init(e),e.find(".verify-box img").on("click",function(){$(this).attr("src","/captcha/?randomKey="+$(this).siblings(".randomkey").val()+"&_r="+(new Date).getTime())}),e.find("#fileupload").on("click",function(t){$(this).next(".verify-box")?Report.checkForm($(".verify-box"))?Report.uploadPictures($(this),e):t.preventDefault():Report.uploadPictures($(this),e)}),e.on("click",".link-close",function(){t($(this).parents("li"))})},onConfirm:function(t){return Report.submitForm(t,e,i)}}):1011==s.code&&"undefined"!=typeof Detail?Detail.showSign(1011):$.toast({content:s.resmsg,type:"error"})})})},uploadPictures:function(t,e){var i=/(\.|\/)(png|jpg|jpeg)$/i,t=t,s=t.siblings(".preview"),a=t.closest(".upload"),n=e.find(".verify-box .ipt");$("#fileupload").fileupload({type:"POST",url:"/faqfeedback/pc/upload/picture.json",dataType:"json",acceptFileTypes:i,maxFileSize:3e6,add:function(t,s){var n=s.files[0],r=n.name;i.test(r)?n.size>3e6?alert("请上传3M以内的文件"):Report.uploadCount>=6?e.find(".preview").siblings(".text-error").html("最多可以上传6张照片"):(e.find(".preview").siblings(".text-error").html(""),a.find("a").html('上传图片<i class="icon-toast-loading"></i>'),s.formData={randomKey:e.find(".randomkey").val()||"",captcha:e.find(".verify-box input").val()||""},s.submit()):alert("请上传png、jpg、jpeg 格式的文件")},done:function(t,i){var r=i.result;r.rescode?(Report.uploadCount++,setTimeout(function(){s.find("ul").append('<li><img src="'+r.url[0]+'" data-img="'+r.url[1]+'"/><i class="link-close"></i></li>'),e.addClass("upload-complate"),a.find("a").html("上传图片")},500),e.addClass("upload-complate")):(a.find("a").html("上传图片"),$.toast({content:r.resmsg,type:"error"}),"验证码错误"==r.resmsg&&(n.val("").focus(),e.find(".verify-box img").click()))},error:function(t,e){a.find("a").html("上传图片"),$.toast({content:"上传失败",type:"error"})}})},submitForm:function(t,e,i){var s=t,a=$.trim(s.find("textarea").val()),n=!1,r=this,o="",c="",l="";if(s.find(".ipt-wrap").each(function(){return n=r.checkForm($(this)),r.checkForm($(this))}),n&&!s.find(".preview img").length)return t.find(".preview").siblings(".text-error").html("请上传照片！"),!1;s.find(".preview img").each(function(){o+=$(this).attr("data-img")+","}),o=o.substring(0,o.length-1),""!=e?(c=e,l=i):"_reportData"in window?(c=_reportData.reportedId,l=_reportData.targetId):(c=Chat.curUserData.uid,l=Chat.curUserData.infoData.expectId);var d={reportedId:c,reasonCode:$('input[name="reasonCode"]').val(),content:a,targetId:l,imgUrl:o||"",randomKey:s.find(".randomkey").val(),captcha:$(".verify-box input").val()};return n&&(n=!1,$.ajax({url:"/user/report/save.json",type:"POST",data:d,dataType:"JSON",timeout:3e4,success:function(e){e.rescode?($.toast({content:"发送成功，感谢您的反馈 ：）",type:"success"}),Report.uploadCount=0,t.remove()):($.toast({content:e.resmsg,type:"error"}),"验证码错误"==e.resmsg&&(s.find(".verify-box .ipt").val("").focus(),s.find(".verify-box img").click()))},error:function(t){}})),!1},checkForm:function(t){var e,i=t.find(".ipt").val();if(void 0!=t.find(".ipt").attr("data-range")){if(e=t.find(".ipt").attr("data-range").split(",")[1],i.length>e)return t.next(".text-error").html("请输入"+e+"个字以内的内容"),!1;t.next(".text-error").html("")}if(""==i){var s=t.find(".ipt").attr("data-blank");return t.find(".ipt").focus(),t.next(".text-error").html(s),!1}return t.next(".text-error").html(""),!0}};$(function(){Report.init()});var BossSettings={URL:{greeting:{url:"/boss/update/greeting.json",method:"POST"},greetingPage:{url:"/boss/account/greeting.json",method:"GET"}},count:0,init:function(){this.submitUsal(),this.switchGreetingStatus()},recruitmentSayHello:function(){var t=this;$(this).hasClass("boss-say-hello")&&$.ajax({url:$(".boss-say-hello").attr("data-url"),method:"get",dataType:"json",success:function(e){$(".set-sayhello-box").html(e),t.submitUsal()}})},submitUsal:function(){var t=this;$(".set-sayhello-box .radio-list").on("change",".radio input",function(e){e.preventDefault();var i=$(this).val();$.ajax({url:t.URL.greeting.url,method:t.URL.greeting.method,dataType:"json",data:{status:1,templateId:i},success:function(t){if(1==t.rescode)$.toast({content:"设置成功",lock:!0,type:"success",wrapClass:"",position:"top",time:3e3});else if(0==t.rescode){var e=t.resmsg;$.toast({content:e,lock:!0,type:"error",wrapClass:"",position:"top",time:3e3})}}})})},submitSwitch:function(t,e){if(!e.hasClass("disabled")){e.addClass("disabled");var i=this;$.ajax({url:i.URL.greeting.url,method:i.URL.greeting.method,dataType:"json",data:{status:t},success:function(s){1==s.rescode?(i.showModalToast("设置成功","success"),i.switchSuccessFn(t,e)):0==s.rescode&&i.showModalToast(s.resmsg,"error"),e.removeClass("disabled")},error:function(){e.removeClass("disabled")}})}},switchGreetingStatus:function(){var t=this;$(".set-sayhello-box .setting-switch").on("click",".switch-op .op-switch",function(){var e=$(this);e.hasClass("op-switch-on")?t.submitSwitch(0,e):t.submitSwitch(1,e)})},switchSuccessFn:function(t,e){var i=this,s=e.parents(".switch-op").siblings("p.gray"),a={0:"招呼语已关闭，系统将不再为您发出打招呼语，您可能会收到更少牛人的回复",1:"选择一个招呼语，在您和牛人发起聊天时，系统为您自动发出"};if(0==t){e.removeClass("op-switch-on").addClass("op-switch-off"),e.parents(".setting-switch").siblings().remove(),s.text(a[0]);try{_T.sendEvent("icebreaker_off")}catch(t){}}else i.getGreetingData().then(function(t){$(".set-sayhello-box .sayhello-form").empty().append($(t)),i.submitUsal(),i.switchGreetingStatus();try{_T.sendEvent("icebreaker_on")}catch(t){}})},getGreetingData:function(){var t=$.Deferred(),e=this;return $.ajax({url:e.URL.greetingPage.url,method:e.URL.greetingPage.method,dataType:"json",success:function(i){1==i.rescode?t.resolve(i.html):0==i.rescode&&(t.reject(),e.showModalToast(i.resmsg,"error"))}}),t},showModalToast:function(t,e){$.toast({content:t,lock:!0,type:e,wrapClass:"",position:"top",time:3e3})}},menuInterview=function(){var t={};t.list=function(){var t=$.Deferred();return $.get("/bossweb/interview/list.json",function(e){setTimeout(function(){t.resolve(e.interviewList)},500)}),t};var e={wrap:function(){return'<div class="interview-overlays"><div class="data-tips"><div class="spinner spinner-circle"><div class="loader"></div><span>正在加载数据...</span></div></div></div>'},list:function(t){return Utemplate('<p class="subhead">面试安排<%if(0 < this.total){%>（<%this.total%>）<%}%></p><%if(!this.today.length && !this.others.length){%><div class="interview-list-empty"><p class="icon-empty"></p>你目前还没有面试安排</div><%}%><dl><%if (this.today.length){%><dt>今天<span class="gray"><%this.date%></span></dt><%}%><%for(var i=0;i<this.today.length;i++){%><dd <%if(!this.today[i].expired){%>class="active"<%}%>><div class="geek-intro"><p class="figure"><img src="<%this.today[i].avatar%>"><%if(this.today[i].gender == 1){%><i class="icon-gender men"></i><%}%><%if(this.today[i].gender == 0){%><i class="icon-gender women"></i><%}%></p><span class="name"><%this.today[i].geekName%></span><span class="phone"><i class="icon-phone"></i><%this.today[i].phone%></span></div><div class="date-intro"><p><span class="gray">时间：</span><%this.today[i].date%>   <%this.today[i].clock%></p><p><span class="gray">职位：</span><%this.today[i].jobName%></p></div><p class="btn-box"><a href="javascript:;" class="btn" data-uid="<%this.today[i].geekId%>">继续沟通</a></p></dd><%}%><%if(this.others.length){%><dt>以后</dt><%}%><%for(var j=0;j<this.others.length;j++){%><dd class="active"><div class="geek-intro"><p class="figure"><img src="<%this.others[j].avatar%>"><%if(this.others[j].gender == 1){%><i class="icon-gender men"></i><%}%><%if(this.others[j].gender == 0){%><i class="icon-gender women"></i><%}%></p><span class="name"><%this.others[j].geekName%></span><span class="phone"><i class="icon-phone"></i><%this.others[j].phone%></span></div><div class="date-intro"><p><span class="gray">时间：</span><%this.others[j].date%>   <%this.others[j].clock%></p><p><span class="gray">职位：</span><%this.others[j].jobName%></p></div><p class="btn-box"><a href="javascript:;" data-uid="<%this.others[j].geekId%>" class="btn">继续沟通</a></p></dd><%}%></dl>',t)}},i=function(){var t=$(".link-vipaccount"),e=Math.floor(t.offset().left)+Math.floor(t.width()/2)-245,i={};return e+$(".interview-overlays").width()>=$("body").width()?i.right="10px":i.left=e+"px",i},s=function(){for(var t=document.getElementsByTagName("iframe"),e=0;e<t.length;e++)try{t[e].contentWindow.document.addEventListener("click",function(){$(".interview-overlays").remove()})}catch(t){}},a=function(){var a=$(e.wrap());a.css(i()),$("body").append(a),s(),t.list().then(function(t){$(".interview-detail .dot").remove(),$.each(t,function(t,e){var i=new Date(e.appointTime);e.date=i.getMonth()+1+"月"+i.getDate()+"日",e.clock=i.getHours()+"："+("0"+i.getMinutes()).substr(-2,2)});var i=t.filter(function(t){return t.today}),s=t.filter(function(t){return!t.today}),n=new Date;$(".interview-overlays").empty().html(e.list({today:i,others:s,date:n.getMonth()+1+"月"+n.getDate()+"日",total:t.length})),a.off("click").on("click",".btn-box .btn",function(){var e=$(this).attr("data-uid"),i=t.filter(function(t){return t.geekId==e});i.length&&$.post("/chat/addRelation.json",{gid:i[0].geekId,jid:i[0].jobId,lid:i[0].lid,expectId:i[0].expectId},function(){Chat.toggleUser({uid:e,eid:i[0].encryptGeekId,jid:i[0].jobId})})})})};return $(document).on("click.interview",function(t){if($(".interview-overlays").length&&!$(t.target).hasClass("interview-detail")){var e=$(".interview-overlays"),i=e.offset(),s=t.clientX,a=t.clientY,n=Math.floor(i.left),r=Math.floor(e.width())+n,o=Math.floor(i.top),c=Math.floor(e.height())+o;s>n&&s<r&&a>o&&a<c||$(".interview-overlays").remove()}}),{view:a}}();